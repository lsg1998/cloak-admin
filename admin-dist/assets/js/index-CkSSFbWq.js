import{a5 as R,d as Z,h as u,P,Z as ve,r as o,Q as ge,c as ye,o as F,b as e,w as l,_ as be,u as p,x as Q,e as i,E as W,W as he,a as n,g as ke,t as b,br as we,ar as Ve,as as Ce,bs as xe,U as ze,$ as Ue,aE as Re,a0 as $e,N as f}from"./index-CixW5Lxi.js";import{_ as De}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Be=_=>R.get("/admin/roles",_),Se=_=>R.post("/admin/roles",_),j=(_,w)=>R.put(`/admin/roles/${_}`,w),Te=_=>R.delete(`/admin/roles/${_}`),Ae={class:"role-management"},Ee={class:"table-header"},Pe={class:"table-title"},je={class:"table-actions"},Ke={class:"role-info"},Me={class:"role-name"},Ne={class:"description-info"},Le={class:"time-info"},Oe={class:"action-buttons"},qe={class:"pagination-wrapper"},Ie={class:"dialog-footer"},Fe={class:"permission-content"},Qe={class:"permission-header"},We={class:"dialog-footer"},Ze=Z({name:"roleManage"}),Ge=Z({...Ze,setup(_){const w=u(!1),$=u(!1),D=u(!1),h=u(!1),V=u(!1),B=u(""),S=u(),T=u(),x=u(null),v=P({name:"",status:null}),r=P({current:1,size:20,total:0}),K=u([]),d=P({id:null,name:"",description:"",status:1}),G={name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:2,max:20,message:"角色名称长度在 2 到 20 个字符",trigger:"blur"}],description:[{required:!0,message:"请输入角色描述",trigger:"blur"}]},H=u([{id:"system",name:"系统管理",children:[{id:"system.user",name:"用户管理"},{id:"system.role",name:"角色管理"},{id:"system.log",name:"操作日志"}]},{id:"product",name:"商品管理",children:[{id:"product.view",name:"查看商品"},{id:"product.add",name:"添加商品"},{id:"product.edit",name:"编辑商品"},{id:"product.delete",name:"删除商品"}]},{id:"order",name:"订单管理",children:[{id:"order.view",name:"查看订单"},{id:"order.edit",name:"编辑订单"},{id:"order.delete",name:"删除订单"}]}]),z=u([]),A=()=>{r.current=1,g()},J=()=>{Object.assign(v,{name:"",status:null}),A()},X=()=>{B.value="添加角色",Object.assign(d,{id:null,name:"",description:"",status:1}),h.value=!0},Y=s=>{B.value="编辑角色",Object.assign(d,{...s}),h.value=!0},ee=s=>{x.value=s,s.name==="admin"?z.value=["system","product","order"]:s.name==="editor"?z.value=["product.view","product.add","product.edit","order.view","order.edit"]:z.value=["product.view","order.view"],V.value=!0},te=s=>{$e.confirm(`确定要删除角色 "${s.name}" 吗？删除后无法恢复！`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"}).then(async()=>{try{await Te(s.id),f.success("删除成功"),g()}catch{f.error("删除失败")}})},le=async s=>{try{await j(s.id,{status:s.status}),f.success(s.status?"角色已启用":"角色已禁用")}catch{f.error("状态更新失败"),s.status=s.status?0:1}},ae=async()=>{S.value&&S.value.validate(async s=>{if(s){$.value=!0;try{d.id?(await j(d.id,d),f.success("更新成功")):(await Se(d),f.success("添加成功")),h.value=!1,g()}catch{f.error(d.id?"更新失败":"添加失败")}finally{$.value=!1}}})},se=async()=>{if(!(!T.value||!x.value)){D.value=!0;try{const s=T.value.getCheckedKeys();await j(x.value.id,{permissions:s}),f.success("权限保存成功"),V.value=!1,g()}catch{f.error("权限保存失败")}finally{D.value=!1}}},oe=s=>{r.size=s,g()},ne=s=>{r.current=s,g()},g=async()=>{w.value=!0;try{const s={page:r.current,size:r.size,name:v.name||void 0,status:v.status||void 0},{data:t}=await Be(s);K.value=t.list,r.total=t.total}catch{f.error("获取角色列表失败")}finally{w.value=!1}};return ve(()=>{g()}),(s,t)=>{const m=o("el-icon"),E=o("el-input"),k=o("el-form-item"),M=o("el-option"),ie=o("el-select"),c=o("el-button"),N=o("el-form"),L=o("el-card"),U=o("el-tag"),y=o("el-table-column"),de=o("el-avatar"),re=o("el-switch"),ue=o("el-table"),ce=o("el-pagination"),O=o("el-col"),q=o("el-radio"),pe=o("el-radio-group"),me=o("el-row"),I=o("el-dialog"),fe=o("el-tree"),_e=ge("loading");return F(),ye("div",Ae,[e(L,{class:"search-card",shadow:"never"},{default:l(()=>[e(N,{model:v,inline:"",class:"search-form"},{default:l(()=>[e(k,{label:"角色名称"},{default:l(()=>[e(E,{modelValue:v.name,"onUpdate:modelValue":t[0]||(t[0]=a=>v.name=a),placeholder:"请输入角色名称",clearable:"",style:{width:"200px"},onKeyup:be(A,["enter"])},{prefix:l(()=>[e(m,null,{default:l(()=>[e(p(Q))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(k,{label:"状态"},{default:l(()=>[e(ie,{modelValue:v.status,"onUpdate:modelValue":t[1]||(t[1]=a=>v.status=a),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:l(()=>[e(M,{label:"启用",value:1}),e(M,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),e(k,null,{default:l(()=>[e(c,{type:"primary",onClick:A},{default:l(()=>[e(m,null,{default:l(()=>[e(p(Q))]),_:1}),t[11]||(t[11]=i(" 搜索 ",-1))]),_:1}),e(c,{onClick:J},{default:l(()=>[e(m,null,{default:l(()=>[e(p(W))]),_:1}),t[12]||(t[12]=i(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(L,{class:"table-card",shadow:"never"},{header:l(()=>[n("div",Ee,[n("div",Pe,[e(c,{type:"primary",onClick:X},{default:l(()=>[e(m,null,{default:l(()=>[e(p(Ue))]),_:1}),t[13]||(t[13]=i(" 添加角色 ",-1))]),_:1}),t[14]||(t[14]=n("span",null,"角色列表",-1)),e(U,{type:"info",size:"small"},{default:l(()=>[i(b(r.total)+" 条记录",1)]),_:1})]),n("div",je,[e(c,{size:"small",onClick:g},{default:l(()=>[e(m,null,{default:l(()=>[e(p(W))]),_:1}),t[15]||(t[15]=i(" 刷新 ",-1))]),_:1})])])]),default:l(()=>[he((F(),ke(ue,{data:K.value,stripe:"",border:"",style:{width:"100%"},"header-cell-style":{background:"#f8f9fa",color:"#606266"}},{default:l(()=>[e(y,{prop:"id",label:"ID",width:"80",align:"center"}),e(y,{prop:"name",label:"角色名称",width:"150","show-overflow-tooltip":""},{default:l(({row:a})=>[n("div",Ke,[e(de,{size:32,class:"role-avatar"},{default:l(()=>[i(b(a.name.charAt(0).toUpperCase()),1)]),_:2},1024),n("span",Me,b(a.name),1)])]),_:1}),e(y,{prop:"description",label:"角色描述","min-width":"200","show-overflow-tooltip":""},{default:l(({row:a})=>[n("div",Ne,[e(m,{class:"description-icon"},{default:l(()=>[e(p(we))]),_:1}),n("span",null,b(a.description),1)])]),_:1}),e(y,{prop:"permissions",label:"权限数量",width:"120",align:"center"},{default:l(({row:a})=>[e(U,{type:"primary",size:"small",effect:"light"},{default:l(()=>[i(b(a.permissions?a.permissions.length:0)+" 个权限 ",1)]),_:2},1024)]),_:1}),e(y,{prop:"status",label:"状态",width:"100",align:"center"},{default:l(({row:a})=>[e(re,{modelValue:a.status,"onUpdate:modelValue":C=>a.status=C,"active-value":1,"inactive-value":0,onChange:C=>le(a)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(y,{prop:"created_at",label:"创建时间",width:"180","show-overflow-tooltip":""},{default:l(({row:a})=>[n("div",Le,[e(m,{class:"time-icon"},{default:l(()=>[e(p(Ve))]),_:1}),n("span",null,b(a.created_at),1)])]),_:1}),e(y,{label:"操作",width:"250",fixed:"right",align:"center"},{default:l(({row:a})=>[n("div",Oe,[e(c,{size:"small",type:"primary",link:"",onClick:C=>Y(a)},{default:l(()=>[e(m,null,{default:l(()=>[e(p(Ce))]),_:1}),t[16]||(t[16]=i(" 编辑 ",-1))]),_:1},8,["onClick"]),e(c,{size:"small",type:"warning",link:"",onClick:C=>ee(a)},{default:l(()=>[e(m,null,{default:l(()=>[e(p(xe))]),_:1}),t[17]||(t[17]=i(" 权限 ",-1))]),_:1},8,["onClick"]),e(c,{size:"small",type:"danger",link:"",onClick:C=>te(a)},{default:l(()=>[e(m,null,{default:l(()=>[e(p(ze))]),_:1}),t[18]||(t[18]=i(" 删除 ",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[_e,w.value]]),n("div",qe,[e(ce,{"current-page":r.current,"onUpdate:currentPage":t[2]||(t[2]=a=>r.current=a),"page-size":r.size,"onUpdate:pageSize":t[3]||(t[3]=a=>r.size=a),"page-sizes":[10,20,50,100],total:r.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:oe,onCurrentChange:ne},null,8,["current-page","page-size","total"])])]),_:1}),e(I,{modelValue:h.value,"onUpdate:modelValue":t[8]||(t[8]=a=>h.value=a),title:B.value,width:"600px","close-on-click-modal":!1,"destroy-on-close":""},{footer:l(()=>[n("div",Ie,[e(c,{onClick:t[7]||(t[7]=a=>h.value=!1)},{default:l(()=>[...t[21]||(t[21]=[i("取消",-1)])]),_:1}),e(c,{type:"primary",onClick:ae,loading:$.value},{default:l(()=>[...t[22]||(t[22]=[i(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:l(()=>[e(N,{model:d,rules:G,ref_key:"formRef",ref:S,"label-width":"100px",class:"role-form"},{default:l(()=>[e(me,{gutter:20},{default:l(()=>[e(O,{span:12},{default:l(()=>[e(k,{label:"角色名称",prop:"name"},{default:l(()=>[e(E,{modelValue:d.name,"onUpdate:modelValue":t[4]||(t[4]=a=>d.name=a),placeholder:"请输入角色名称","prefix-icon":p(Re)},null,8,["modelValue","prefix-icon"])]),_:1})]),_:1}),e(O,{span:12},{default:l(()=>[e(k,{label:"状态",prop:"status"},{default:l(()=>[e(pe,{modelValue:d.status,"onUpdate:modelValue":t[5]||(t[5]=a=>d.status=a)},{default:l(()=>[e(q,{label:1},{default:l(()=>[e(U,{type:"success",size:"small"},{default:l(()=>[...t[19]||(t[19]=[i("启用",-1)])]),_:1})]),_:1}),e(q,{label:0},{default:l(()=>[e(U,{type:"danger",size:"small"},{default:l(()=>[...t[20]||(t[20]=[i("禁用",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(k,{label:"角色描述",prop:"description"},{default:l(()=>[e(E,{modelValue:d.description,"onUpdate:modelValue":t[6]||(t[6]=a=>d.description=a),type:"textarea",rows:3,placeholder:"请输入角色描述",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(I,{modelValue:V.value,"onUpdate:modelValue":t[10]||(t[10]=a=>V.value=a),title:"权限设置",width:"600px","close-on-click-modal":!1,"destroy-on-close":""},{footer:l(()=>[n("div",We,[e(c,{onClick:t[9]||(t[9]=a=>V.value=!1)},{default:l(()=>[...t[23]||(t[23]=[i("取消",-1)])]),_:1}),e(c,{type:"primary",onClick:se,loading:D.value},{default:l(()=>[...t[24]||(t[24]=[i(" 保存权限 ",-1)])]),_:1},8,["loading"])])]),default:l(()=>{var a;return[n("div",Fe,[n("div",Qe,[n("span",null,'为角色 "'+b((a=x.value)==null?void 0:a.name)+'" 设置权限',1)]),e(fe,{ref_key:"permissionTreeRef",ref:T,data:H.value,props:{children:"children",label:"name"},"show-checkbox":"","node-key":"id","default-checked-keys":z.value,class:"permission-tree"},null,8,["data","default-checked-keys"])])]}),_:1},8,["modelValue"])])}}}),Xe=De(Ge,[["__scopeId","data-v-9005d04c"]]);export{Xe as default};
