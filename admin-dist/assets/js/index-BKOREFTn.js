import{a5 as P,d as ct,h as C,P as F,Z as ut,r as u,Q as pt,c as d,o as r,b as s,w as n,_ as E,e as p,a as e,t as l,u as V,b6 as _t,b5 as ft,b7 as vt,b8 as gt,W as yt,E as mt,F as bt,f as ht,n as kt,g as j,R as D,N as S,a0 as zt}from"./index-2V8v6Wus.js";import{_ as xt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const L={getVisitorIps:m=>P.get("/admin/statistics/visitor-ips",m),getVisitorIp:m=>P.get(`/admin/statistics/visitor-ips/${m}`),getIpStatistics:()=>P.get("/admin/statistics/visitor-ips-stats"),deleteVisitorIp:m=>P.delete(`/admin/statistics/visitor-ips/${m}`)},It={class:"visitor-ip-list"},Ct={class:"stat-content"},Vt={class:"stat-value"},St={class:"stat-icon"},wt={class:"stat-content"},Bt={class:"stat-value"},Pt={class:"stat-icon"},Dt={class:"stat-content"},Lt={class:"stat-value"},At={class:"stat-icon"},Nt={class:"stat-content"},Tt={class:"stat-value"},Kt={class:"stat-icon"},Mt={class:"table-header"},Ut={class:"table-actions"},Et={class:"ip-list"},Ot={class:"ip-header"},$t={class:"ip-address"},Ft={class:"ip-actions"},jt={class:"ip-content"},Wt={class:"ip-section"},Gt={class:"address-info"},Rt={class:"address-line"},Ht={class:"value"},Qt={class:"address-line"},Zt={class:"value"},qt={class:"ip-section"},Jt={class:"organization-info"},Xt={class:"org-name"},Yt={class:"org-tags"},te={class:"ip-section"},ee={class:"basic-type"},se={class:"type-line"},ae={class:"type-line"},ne={class:"value"},oe={class:"type-line"},le={class:"value"},ie={class:"ip-section"},re={class:"detailed-type"},de={class:"type-line"},ce={class:"type-line"},ue={class:"value"},pe={class:"type-line"},_e={class:"value"},fe={class:"pagination-wrapper"},ve={key:0,class:"ip-detail"},ge={key:0},ye={key:1,class:"text-gray-400"},me={key:0},be={key:1,class:"text-gray-400"},he={key:0},ke={key:1,class:"text-gray-400"},ze={key:0},xe={key:1,class:"text-gray-400"},Ie={key:0},Ce={key:1,class:"text-gray-400"},Ve={key:0},Se={key:1,class:"text-gray-400"},we={key:0},Be={key:1,class:"text-gray-400"},Pe={key:0},De={key:1,class:"text-gray-400"},Le={key:0,class:"referer-info"},Ae={key:1,class:"text-gray-400"},Ne={key:0,class:"location-info"},Te=ct({__name:"index",setup(m){const A=C(!1),N=C(!1),i=C(null),g=F({ip:"",country:"",city:""}),f=F({page:1,size:20,total:0}),T=C([]),h=C({totalIps:0,todayIps:0,countryStats:[],cityStats:[]}),K=a=>a?new Date(a).toLocaleString("zh-CN"):"--",W=a=>{const t=[];return a.country&&t.push(a.country),a.region&&t.push(a.region),a.city&&t.push(a.city),t.length>0?t.join(" - "):null},M=a=>{const t=["proxy","vpn","tor","anonymizer"],c=(a.organization||"").toLowerCase();return t.some(v=>c.includes(v))},G=a=>{const t=["amazon","google","microsoft","cloudflare","digitalocean","linode","vultr","aws","gcp","azure"],c=(a.organization||"").toLowerCase();return t.some(v=>c.includes(v))},O=a=>w(a)?"爬虫":M(a)?"代理":"访客",$=a=>w(a)?"primary":M(a)?"warning":"success",w=a=>{const t=["bot","crawler","spider","scraper","googlebot","bingbot","facebook","twitter"],c=(a.user_agent||"").toLowerCase(),v=(a.organization||"").toLowerCase();return t.some(y=>c.includes(y)||v.includes(y))},R=a=>{const t=a.user_agent||"";return t.includes("Mobile")?"Mobile":t.includes("Tablet")?"Tablet":t.includes("Desktop")?"Desktop":null},H=a=>{const t=a.user_agent||"";return t.includes("Windows")?"Windows":t.includes("Mac")?"macOS":t.includes("Linux")?"Linux":t.includes("Android")?"Android":t.includes("iOS")?"iOS":null},Q=a=>{const t=(a.user_agent||"").toLowerCase(),c=(a.organization||"").toLowerCase();return t.includes("googlebot")||c.includes("google")?"Googlebot":t.includes("bingbot")||c.includes("microsoft")?"BingBot":t.includes("facebook")||c.includes("facebook")?"Facebook Crawler":t.includes("twitter")||c.includes("twitter")?"Twitter Bot":t.includes("ahrefs")||c.includes("ahrefs")?"aHrefs Bot":t.includes("httpx")?"httpx":t.includes("barkrowler")?"Barkrowler":w(a)?"Generic Bot":null},Z=a=>{const t=(a.user_agent||"").toLowerCase(),c=(a.organization||"").toLowerCase();return t.includes("googlebot")||c.includes("google")||t.includes("bingbot")||c.includes("microsoft")?"搜索引擎蜘蛛":t.includes("facebook")||c.includes("facebook")||t.includes("twitter")||c.includes("twitter")?"社交媒体爬虫":t.includes("ahrefs")||c.includes("ahrefs")?"SEO分析爬虫":w(a)?"通用网络爬虫":null},k=async()=>{try{A.value=!0;const a={page:f.page,size:f.size,...g},t=await L.getVisitorIps(a);t.code===200&&(T.value=t.data.list,f.total=t.data.total)}catch(a){console.error("获取访客IP列表失败:",a),S.error("获取访客IP列表失败")}finally{A.value=!1}},U=async()=>{try{const a=await L.getIpStatistics();a.code===200&&(h.value=a.data)}catch(a){console.error("获取统计数据失败:",a),S.error("获取统计数据失败")}},z=()=>{f.page=1,k()},q=()=>{Object.assign(g,{ip:"",country:"",city:""}),z()},J=a=>{f.size=a,f.page=1,k()},X=a=>{f.page=a,k()},Y=async a=>{try{const t=await L.getVisitorIp(a.ip_address);t.code===200&&(i.value=t.data,N.value=!0)}catch(t){console.error("获取IP详情失败:",t),S.error("获取IP详情失败")}},tt=async a=>{try{await zt.confirm(`确定要删除IP"${a.ip_address}"的记录吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await L.deleteVisitorIp(a.ip_address)).code===200&&(S.success("删除成功"),k(),U())}catch(t){t!=="cancel"&&(console.error("删除访客IP失败:",t),S.error("删除失败"))}};return ut(()=>{k(),U()}),(a,t)=>{const c=u("el-input"),v=u("el-form-item"),y=u("el-button"),et=u("el-form"),b=u("el-card"),x=u("el-icon"),B=u("el-col"),st=u("el-row"),I=u("el-tag"),at=u("el-pagination"),_=u("el-descriptions-item"),nt=u("el-link"),ot=u("el-descriptions"),lt=u("el-dialog"),it=pt("loading");return r(),d("div",It,[s(b,{class:"search-card",shadow:"never"},{default:n(()=>[s(et,{model:g,inline:!0,class:"search-form"},{default:n(()=>[s(v,{label:"IP地址"},{default:n(()=>[s(c,{modelValue:g.ip,"onUpdate:modelValue":t[0]||(t[0]=o=>g.ip=o),placeholder:"请输入IP地址",clearable:"",style:{width:"200px"},onKeyup:E(z,["enter"])},null,8,["modelValue"])]),_:1}),s(v,{label:"国家"},{default:n(()=>[s(c,{modelValue:g.country,"onUpdate:modelValue":t[1]||(t[1]=o=>g.country=o),placeholder:"请输入国家",clearable:"",style:{width:"150px"},onKeyup:E(z,["enter"])},null,8,["modelValue"])]),_:1}),s(v,{label:"城市"},{default:n(()=>[s(c,{modelValue:g.city,"onUpdate:modelValue":t[2]||(t[2]=o=>g.city=o),placeholder:"请输入城市",clearable:"",style:{width:"150px"},onKeyup:E(z,["enter"])},null,8,["modelValue"])]),_:1}),s(v,null,{default:n(()=>[s(y,{type:"primary",onClick:z},{default:n(()=>[...t[6]||(t[6]=[p("搜索",-1)])]),_:1}),s(y,{onClick:q},{default:n(()=>[...t[7]||(t[7]=[p("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),s(st,{gutter:20,class:"statistics-cards"},{default:n(()=>[s(B,{span:6},{default:n(()=>[s(b,{class:"stat-card"},{default:n(()=>[e("div",Ct,[e("div",Vt,l(h.value.totalIps),1),t[8]||(t[8]=e("div",{class:"stat-label"},"总IP数",-1))]),e("div",St,[s(x,null,{default:n(()=>[s(V(_t))]),_:1})])]),_:1})]),_:1}),s(B,{span:6},{default:n(()=>[s(b,{class:"stat-card"},{default:n(()=>[e("div",wt,[e("div",Bt,l(h.value.todayIps),1),t[9]||(t[9]=e("div",{class:"stat-label"},"今日新增",-1))]),e("div",Pt,[s(x,null,{default:n(()=>[s(V(ft))]),_:1})])]),_:1})]),_:1}),s(B,{span:6},{default:n(()=>[s(b,{class:"stat-card"},{default:n(()=>[e("div",Dt,[e("div",Lt,l(h.value.countryStats.length),1),t[10]||(t[10]=e("div",{class:"stat-label"},"涉及国家",-1))]),e("div",At,[s(x,null,{default:n(()=>[s(V(vt))]),_:1})])]),_:1})]),_:1}),s(B,{span:6},{default:n(()=>[s(b,{class:"stat-card"},{default:n(()=>[e("div",Nt,[e("div",Tt,l(h.value.cityStats.length),1),t[11]||(t[11]=e("div",{class:"stat-label"},"涉及城市",-1))]),e("div",Kt,[s(x,null,{default:n(()=>[s(V(gt))]),_:1})])]),_:1})]),_:1})]),_:1}),s(b,{class:"table-card",shadow:"never"},{default:n(()=>[e("div",Mt,[t[13]||(t[13]=e("div",{class:"table-title"},"访客IP列表",-1)),e("div",Ut,[s(y,{onClick:U},{default:n(()=>[s(x,null,{default:n(()=>[s(V(mt))]),_:1}),t[12]||(t[12]=p(" 刷新统计 ",-1))]),_:1})])]),yt((r(),d("div",Et,[(r(!0),d(bt,null,ht(T.value,(o,rt)=>(r(),d("div",{key:o.id,class:kt(["ip-item",{"last-item":rt===T.value.length-1}])},[e("div",Ot,[e("div",$t,l(o.ip_address),1),e("div",Ft,[s(y,{type:"primary",size:"small",onClick:dt=>Y(o)},{default:n(()=>[...t[14]||(t[14]=[p("查看",-1)])]),_:1},8,["onClick"]),s(y,{type:"danger",size:"small",onClick:dt=>tt(o)},{default:n(()=>[...t[15]||(t[15]=[p("删除",-1)])]),_:1},8,["onClick"])])]),e("div",jt,[e("div",Wt,[t[18]||(t[18]=e("div",{class:"section-title"},"地址信息",-1)),e("div",Gt,[e("div",Rt,[t[16]||(t[16]=e("span",{class:"label"},"地址:",-1)),e("span",Ht,l(W(o)||"-"),1)]),e("div",Qt,[t[17]||(t[17]=e("span",{class:"label"},"时间:",-1)),e("span",Zt,l(K(o.last_visit)),1)])])]),e("div",qt,[t[21]||(t[21]=e("div",{class:"section-title"},"组织信息",-1)),e("div",Jt,[e("div",Xt,l(o.organization||"-"),1),e("div",Yt,[M(o)?(r(),j(I,{key:0,size:"small",type:"info"},{default:n(()=>[...t[19]||(t[19]=[p("代理",-1)])]),_:1})):D("",!0),G(o)?(r(),j(I,{key:1,size:"small",type:"warning"},{default:n(()=>[...t[20]||(t[20]=[p("机房",-1)])]),_:1})):D("",!0)])])]),e("div",te,[t[25]||(t[25]=e("div",{class:"section-title"},"基础类型",-1)),e("div",ee,[e("div",se,[t[22]||(t[22]=e("span",{class:"label"},"类型:",-1)),s(I,{type:$(o),size:"small"},{default:n(()=>[p(l(O(o)),1)]),_:2},1032,["type"])]),e("div",ae,[t[23]||(t[23]=e("span",{class:"label"},"设备:",-1)),e("span",ne,l(R(o)||"-"),1)]),e("div",oe,[t[24]||(t[24]=e("span",{class:"label"},"系统:",-1)),e("span",le,l(H(o)||"-"),1)])])]),e("div",ie,[t[29]||(t[29]=e("div",{class:"section-title"},"详细类型",-1)),e("div",re,[e("div",de,[t[26]||(t[26]=e("span",{class:"label"},"类型:",-1)),s(I,{type:$(o),size:"small"},{default:n(()=>[p(l(O(o)),1)]),_:2},1032,["type"])]),e("div",ce,[t[27]||(t[27]=e("span",{class:"label"},"名称:",-1)),e("span",ue,l(Q(o)||"-"),1)]),e("div",pe,[t[28]||(t[28]=e("span",{class:"label"},"说明:",-1)),e("span",_e,l(Z(o)||"-"),1)])])])])],2))),128))])),[[it,A.value]]),e("div",fe,[s(at,{"current-page":f.page,"onUpdate:currentPage":t[3]||(t[3]=o=>f.page=o),"page-size":f.size,"onUpdate:pageSize":t[4]||(t[4]=o=>f.size=o),total:f.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:J,onCurrentChange:X},null,8,["current-page","page-size","total"])])]),_:1}),s(lt,{modelValue:N.value,"onUpdate:modelValue":t[5]||(t[5]=o=>N.value=o),title:"IP详情",width:"600px","close-on-click-modal":!1},{default:n(()=>[i.value?(r(),d("div",ve,[s(ot,{column:2,border:""},{default:n(()=>[s(_,{label:"IP地址"},{default:n(()=>[p(l(i.value.ip_address),1)]),_:1}),s(_,{label:"国家"},{default:n(()=>[i.value.country?(r(),d("span",ge,l(i.value.country),1)):(r(),d("span",ye,"--"))]),_:1}),s(_,{label:"国家代码"},{default:n(()=>[i.value.country?(r(),d("span",me,l(i.value.country),1)):(r(),d("span",be,"--"))]),_:1}),s(_,{label:"地区"},{default:n(()=>[i.value.region?(r(),d("span",he,l(i.value.region),1)):(r(),d("span",ke,"--"))]),_:1}),s(_,{label:"城市"},{default:n(()=>[i.value.city?(r(),d("span",ze,l(i.value.city),1)):(r(),d("span",xe,"--"))]),_:1}),s(_,{label:"时区"},{default:n(()=>[i.value.timezone?(r(),d("span",Ie,l(i.value.timezone),1)):(r(),d("span",Ce,"--"))]),_:1}),s(_,{label:"ISP"},{default:n(()=>[i.value.organization?(r(),d("span",Ve,l(i.value.organization),1)):(r(),d("span",Se,"--"))]),_:1}),s(_,{label:"主机名"},{default:n(()=>[i.value.hostname?(r(),d("span",we,l(i.value.hostname),1)):(r(),d("span",Be,"--"))]),_:1}),s(_,{label:"邮编"},{default:n(()=>[i.value.postal_code?(r(),d("span",Pe,l(i.value.postal_code),1)):(r(),d("span",De,"--"))]),_:1}),s(_,{label:"来源页面"},{default:n(()=>[i.value.referer?(r(),d("div",Le,[s(nt,{href:i.value.referer,target:"_blank",type:"primary",size:"small"},{default:n(()=>[p(l(i.value.referer),1)]),_:1},8,["href"])])):(r(),d("span",Ae,"--"))]),_:1}),s(_,{label:"访问次数"},{default:n(()=>[s(I,{type:"info"},{default:n(()=>[p(l(i.value.visit_count),1)]),_:1})]),_:1}),s(_,{label:"首次访问"},{default:n(()=>[p(l(K(i.value.first_visit)),1)]),_:1}),s(_,{label:"最后访问"},{default:n(()=>[p(l(K(i.value.last_visit)),1)]),_:1})]),_:1}),i.value.location?(r(),d("div",Ne,[t[30]||(t[30]=e("h4",null,"地理位置",-1)),e("p",null,"坐标: "+l(i.value.location),1)])):D("",!0)])):D("",!0)]),_:1},8,["modelValue"])])}}}),Ue=xt(Te,[["__scopeId","data-v-a69684ea"]]);export{Ue as default};
