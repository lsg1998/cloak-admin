import{a5 as X,d as ve,h as m,P as he,Z as ge,r as c,Q as ye,c as u,o as d,a as n,b as e,w as s,t as i,_ as be,u as g,x as H,e as _,E as we,W as T,g as w,n as ke,at as J,au as De,J as xe,R as Z,F as Q,f as W,av as Ve,N as B}from"./index-D6reRM_r.js";import{_ as ze}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ce=(D={})=>{const S=Object.fromEntries(Object.entries(D).filter(([,y])=>y!=null&&y!==""));return X.get("/admin/em-track/list",S)},q=D=>X.get("/admin/em-track/orders",D),Ee={class:"em-track-management"},Se={class:"summary-cards"},Le={class:"summary-item"},Pe={class:"summary-value"},Ue={class:"summary-item"},Ie={class:"summary-value"},Me={class:"summary-item"},Fe={class:"summary-value"},Ne={class:"summary-item"},Re={class:"summary-value"},Te={class:"summary-item"},Be={class:"summary-value"},Oe={class:"summary-item"},Ye={class:"summary-value"},je={class:"em-param-cell"},Ke={class:"count-badge visitor"},$e={key:0,class:"count-badge order"},Ae={key:1,class:"count-badge zero"},Ge={key:0,class:"amount-cell"},He={class:"amount"},Je={class:"currency"},Ze={key:1,class:"no-data"},Qe={key:0,class:"order-numbers-cell"},We={key:1,class:"no-data"},qe={key:0,class:"countries-cell"},Xe={key:1,class:"no-data"},et={key:0,class:"time-text"},tt={key:1,class:"no-data"},at={class:"pagination-wrapper"},st=ve({__name:"index",setup(D){const S=[{text:"ä»Šå¤©",value:()=>{const l=new Date;return[l,l]}},{text:"æ˜¨å¤©",value:()=>{const l=new Date;return l.setDate(l.getDate()-1),[l,l]}},{text:"æœ€è¿‘3å¤©",value:()=>{const l=new Date,t=new Date;return t.setDate(t.getDate()-2),[t,l]}},{text:"æœ€è¿‘7å¤©",value:()=>{const l=new Date,t=new Date;return t.setDate(t.getDate()-6),[t,l]}},{text:"æœ¬æœˆ",value:()=>{const l=new Date;return[new Date(l.getFullYear(),l.getMonth(),1),l]}}],y=m(!1),O=m([]),Y=m(0),f=m({total_em_params:0,em_with_orders:0,em_without_orders:0,total_orders:0,total_visitors:0,order_rate:0}),p=new Date().toISOString().slice(0,10),L=m([p,p]),o=he({start_date:p,end_date:p,em_param:"",has_order:"",page:1,size:50}),P=m(!1),U=m(!1),x=m(""),j=m([]),I=m(!1),M=m(!1),K=m([]),ee=l=>{l&&l.length===2?(o.start_date=l[0],o.end_date=l[1]):(o.start_date=p,o.end_date=p),o.page=1,z()},V=()=>{o.page=1,z()},te=()=>{L.value=[p,p],o.start_date=p,o.end_date=p,o.em_param="",o.has_order="",o.page=1,o.size=50,z()},ae=()=>{},z=async()=>{y.value=!0;try{const l=await Ce(o);l.data&&(O.value=l.data.list||[],Y.value=l.data.total||0,f.value=l.data.summary||f.value)}catch(l){B.error(l.message||"è·å–æ•°æ®å¤±è´¥")}finally{y.value=!1}},se=async l=>{x.value=l.em_param,P.value=!0,U.value=!0;try{const t=await q({em_param:l.em_param,start_date:o.start_date,end_date:o.end_date});t.data&&(j.value=t.data.orders||[])}catch{B.error("è·å–è®¢å•è¯¦æƒ…å¤±è´¥")}finally{U.value=!1}},le=async l=>{x.value=l.em_param,I.value=!0,M.value=!0;try{const t=await q({em_param:l.em_param,start_date:o.start_date,end_date:o.end_date});t.data&&(K.value=t.data.visitors||[])}catch{B.error("è·å–è®¿å®¢åˆ—è¡¨å¤±è´¥")}finally{M.value=!1}},oe=({row:l})=>l.has_order?"row-has-order":"row-no-order",re={pending:"å¾…ç¡®è®¤",confirmed:"å·²ç¡®è®¤",processing:"å¤„ç†ä¸­",shipped:"å·²å‘è´§",delivered:"å·²é€è¾¾",cancelled:"å·²å–æ¶ˆ",refunded:"å·²é€€æ¬¾",deleted:"å·²åˆ é™¤",duplicate:"å·²é‡å¤"},ne={pending:"warning",confirmed:"primary",processing:"info",shipped:"success",delivered:"success",cancelled:"danger",refunded:"danger",deleted:"info",duplicate:"warning"},de=l=>re[l]||l,ie=l=>ne[l]||"info",ue={JP:"ğŸ‡¯ğŸ‡µ",HU:"ğŸ‡­ğŸ‡º",SK:"ğŸ‡¸ğŸ‡°",CZ:"ğŸ‡¨ğŸ‡¿",AT:"ğŸ‡¦ğŸ‡¹",PL:"ğŸ‡µğŸ‡±",ES:"ğŸ‡ªğŸ‡¸",IT:"ğŸ‡®ğŸ‡¹",PT:"ğŸ‡µğŸ‡¹",DE:"ğŸ‡©ğŸ‡ª",FR:"ğŸ‡«ğŸ‡·",HR:"ğŸ‡­ğŸ‡·",SI:"ğŸ‡¸ğŸ‡®",LT:"ğŸ‡±ğŸ‡¹",LV:"ğŸ‡±ğŸ‡»",US:"ğŸ‡ºğŸ‡¸",GB:"ğŸ‡¬ğŸ‡§",CN:"ğŸ‡¨ğŸ‡³",RO:"ğŸ‡·ğŸ‡´",BG:"ğŸ‡§ğŸ‡¬",GR:"ğŸ‡¬ğŸ‡·",NL:"ğŸ‡³ğŸ‡±",BE:"ğŸ‡§ğŸ‡ª",SE:"ğŸ‡¸ğŸ‡ª",DK:"ğŸ‡©ğŸ‡°",FI:"ğŸ‡«ğŸ‡®",IE:"ğŸ‡®ğŸ‡ª",EE:"ğŸ‡ªğŸ‡ª"},$=l=>l&&ue[l.toUpperCase()]||"ğŸŒ";return ge(()=>{z()}),(l,t)=>{const v=c("el-card"),ce=c("el-date-picker"),C=c("el-form-item"),h=c("el-icon"),_e=c("el-input"),A=c("el-option"),me=c("el-select"),E=c("el-button"),pe=c("el-form"),r=c("el-table-column"),b=c("el-tag"),F=c("el-table"),fe=c("el-pagination"),G=c("el-dialog"),N=ye("loading");return d(),u("div",Ee,[n("div",Se,[e(v,{class:"summary-card",shadow:"hover"},{default:s(()=>[n("div",Le,[n("div",Pe,i(f.value.total_em_params),1),t[7]||(t[7]=n("div",{class:"summary-label"},"EMè´¦å·æ€»æ•°",-1))])]),_:1}),e(v,{class:"summary-card success",shadow:"hover"},{default:s(()=>[n("div",Ue,[n("div",Ie,i(f.value.em_with_orders),1),t[8]||(t[8]=n("div",{class:"summary-label"},"æœ‰è®¢å•",-1))])]),_:1}),e(v,{class:"summary-card danger",shadow:"hover"},{default:s(()=>[n("div",Me,[n("div",Fe,i(f.value.em_without_orders),1),t[9]||(t[9]=n("div",{class:"summary-label"},"æ— è®¢å•",-1))])]),_:1}),e(v,{class:"summary-card primary",shadow:"hover"},{default:s(()=>[n("div",Ne,[n("div",Re,i(f.value.total_orders),1),t[10]||(t[10]=n("div",{class:"summary-label"},"æ€»è®¢å•æ•°",-1))])]),_:1}),e(v,{class:"summary-card info",shadow:"hover"},{default:s(()=>[n("div",Te,[n("div",Be,i(f.value.total_visitors),1),t[11]||(t[11]=n("div",{class:"summary-label"},"æ€»è®¿å®¢æ•°",-1))])]),_:1}),e(v,{class:"summary-card warning",shadow:"hover"},{default:s(()=>[n("div",Oe,[n("div",Ye,i(f.value.order_rate)+"%",1),t[12]||(t[12]=n("div",{class:"summary-label"},"å‡ºå•ç‡",-1))])]),_:1})]),e(v,{class:"search-card",shadow:"never"},{default:s(()=>[e(pe,{model:o,inline:"",class:"search-form"},{default:s(()=>[e(C,{label:"æ—¥æœŸèŒƒå›´"},{default:s(()=>[e(ce,{modelValue:L.value,"onUpdate:modelValue":t[0]||(t[0]=a=>L.value=a),type:"daterange","range-separator":"è‡³","start-placeholder":"å¼€å§‹æ—¥æœŸ","end-placeholder":"ç»“æŸæ—¥æœŸ","value-format":"YYYY-MM-DD",shortcuts:S,style:{width:"280px"},onChange:ee},null,8,["modelValue"])]),_:1}),e(C,{label:"EMå‚æ•°"},{default:s(()=>[e(_e,{modelValue:o.em_param,"onUpdate:modelValue":t[1]||(t[1]=a=>o.em_param=a),placeholder:"æœç´¢EMå‚æ•°",clearable:"",style:{width:"200px"},onKeyup:be(V,["enter"])},{prefix:s(()=>[e(h,null,{default:s(()=>[e(g(H))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(C,{label:"å‡ºå•çŠ¶æ€"},{default:s(()=>[e(me,{modelValue:o.has_order,"onUpdate:modelValue":t[2]||(t[2]=a=>o.has_order=a),placeholder:"å…¨éƒ¨",clearable:"",style:{width:"130px"}},{default:s(()=>[e(A,{label:"æœ‰è®¢å•",value:"yes"}),e(A,{label:"æ— è®¢å•",value:"no"})]),_:1},8,["modelValue"])]),_:1}),e(C,null,{default:s(()=>[e(E,{type:"primary",onClick:V},{default:s(()=>[e(h,null,{default:s(()=>[e(g(H))]),_:1}),t[13]||(t[13]=_(" æŸ¥è¯¢ ",-1))]),_:1}),e(E,{onClick:te},{default:s(()=>[e(h,null,{default:s(()=>[e(g(we))]),_:1}),t[14]||(t[14]=_(" é‡ç½® ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(v,{shadow:"never",class:"table-card"},{default:s(()=>[T((d(),w(F,{data:O.value,border:"",stripe:"",style:{width:"100%"},"row-class-name":oe,onSortChange:ae},{default:s(()=>[e(r,{type:"index",label:"#",width:"50",align:"center"}),e(r,{label:"EMå‚æ•°(è´¦å·)","min-width":"180",align:"center"},{default:s(({row:a})=>[n("div",je,[e(b,{class:ke(a.has_order?"em-tag-success":"em-tag-danger"),effect:a.has_order?"dark":"light",size:"default"},{default:s(()=>[e(h,null,{default:s(()=>[e(g(J))]),_:1}),_(" "+i(a.em_param),1)]),_:2},1032,["class","effect"])])]),_:1}),e(r,{label:"å‡ºå•çŠ¶æ€",width:"110",align:"center",sortable:"custom",prop:"has_order"},{default:s(({row:a})=>[a.has_order?(d(),w(b,{key:0,type:"success",effect:"dark",size:"default"},{default:s(()=>[e(h,null,{default:s(()=>[e(g(De))]),_:1}),t[15]||(t[15]=_(" æœ‰è®¢å• ",-1))]),_:1})):(d(),w(b,{key:1,type:"danger",effect:"plain",size:"default"},{default:s(()=>[e(h,null,{default:s(()=>[e(g(xe))]),_:1}),t[16]||(t[16]=_(" æ— è®¢å• ",-1))]),_:1}))]),_:1}),e(r,{label:"è®¿å®¢æ•°",width:"100",align:"center",sortable:"custom",prop:"visitor_count"},{default:s(({row:a})=>[n("span",Ke,i(a.visitor_count),1)]),_:1}),e(r,{label:"è®¢å•æ•°",width:"100",align:"center",sortable:"custom",prop:"order_count"},{default:s(({row:a})=>[a.order_count>0?(d(),u("span",$e,i(a.order_count),1)):(d(),u("span",Ae,"0"))]),_:1}),e(r,{label:"è®¢å•é‡‘é¢",width:"140",align:"center",sortable:"custom",prop:"total_amount"},{default:s(({row:a})=>[a.has_order?(d(),u("div",Ge,[n("span",He,i(a.total_amount),1),n("span",Je,i(a.currencies.join("/")),1)])):(d(),u("span",Ze,"--"))]),_:1}),e(r,{label:"è®¢å•å·","min-width":"200",align:"center"},{default:s(({row:a})=>[a.order_numbers&&a.order_numbers.length>0?(d(),u("div",Qe,[(d(!0),u(Q,null,W(a.order_numbers.slice(0,3),(k,R)=>(d(),w(b,{key:R,size:"small",type:"info",style:{margin:"2px"}},{default:s(()=>[_(i(k),1)]),_:2},1024))),128)),a.order_numbers.length>3?(d(),w(b,{key:0,size:"small",type:"warning",style:{margin:"2px"}},{default:s(()=>[_(" +"+i(a.order_numbers.length-3),1)]),_:2},1024)):Z("",!0)])):(d(),u("span",We,"--"))]),_:1}),e(r,{label:"è®¿å®¢å›½å®¶",width:"140",align:"center"},{default:s(({row:a})=>[a.countries&&a.countries.length>0?(d(),u("div",qe,[(d(!0),u(Q,null,W(a.countries.slice(0,5),(k,R)=>(d(),w(b,{key:R,size:"small",type:"success",effect:"plain",style:{margin:"1px"}},{default:s(()=>[_(i($(k))+" "+i(k),1)]),_:2},1024))),128))])):(d(),u("span",Xe,"--"))]),_:1}),e(r,{label:"æœ€æ–°è®¿é—®",width:"170",align:"center",sortable:"custom",prop:"latest_visit"},{default:s(({row:a})=>[a.latest_visit?(d(),u("span",et,i(a.latest_visit),1)):(d(),u("span",tt,"--"))]),_:1}),e(r,{label:"æ“ä½œ",width:"120",fixed:"right",align:"center"},{default:s(({row:a})=>[a.has_order?(d(),w(E,{key:0,type:"primary",size:"small",link:"",onClick:k=>se(a)},{default:s(()=>[e(h,null,{default:s(()=>[e(g(Ve))]),_:1}),t[17]||(t[17]=_(" æŸ¥çœ‹è®¢å• ",-1))]),_:1},8,["onClick"])):Z("",!0),e(E,{type:"info",size:"small",link:"",onClick:k=>le(a)},{default:s(()=>[e(h,null,{default:s(()=>[e(g(J))]),_:1}),t[18]||(t[18]=_(" è®¿å®¢ ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[N,y.value]]),n("div",at,[e(fe,{"current-page":o.page,"onUpdate:currentPage":t[3]||(t[3]=a=>o.page=a),"page-size":o.size,"onUpdate:pageSize":t[4]||(t[4]=a=>o.size=a),"page-sizes":[20,50,100,200],total:Y.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:V,onCurrentChange:V},null,8,["current-page","page-size","total"])])]),_:1}),e(G,{modelValue:P.value,"onUpdate:modelValue":t[5]||(t[5]=a=>P.value=a),title:`${x.value} - è®¢å•è¯¦æƒ…`,width:"900px",top:"5vh"},{default:s(()=>[T((d(),u("div",null,[e(F,{data:j.value,border:"",stripe:"",size:"small"},{default:s(()=>[e(r,{prop:"order_number",label:"è®¢å•å·",width:"160"}),e(r,{prop:"customer_name",label:"å®¢æˆ·å§“å",width:"120"}),e(r,{prop:"phone",label:"ç”µè¯",width:"140"}),e(r,{label:"é‡‘é¢",width:"120",align:"center"},{default:s(({row:a})=>[_(i(a.total_amount)+" "+i(a.currency),1)]),_:1}),e(r,{label:"çŠ¶æ€",width:"100",align:"center"},{default:s(({row:a})=>[e(b,{type:ie(a.status),size:"small"},{default:s(()=>[_(i(de(a.status)),1)]),_:2},1032,["type"])]),_:1}),e(r,{prop:"product_title",label:"å•†å“","min-width":"150","show-overflow-tooltip":""}),e(r,{prop:"ip_address",label:"IP",width:"130"}),e(r,{prop:"created_at",label:"ä¸‹å•æ—¶é—´",width:"170"})]),_:1},8,["data"])])),[[N,U.value]])]),_:1},8,["modelValue","title"]),e(G,{modelValue:I.value,"onUpdate:modelValue":t[6]||(t[6]=a=>I.value=a),title:`${x.value} - è®¿å®¢åˆ—è¡¨`,width:"800px",top:"5vh"},{default:s(()=>[T((d(),u("div",null,[e(F,{data:K.value,border:"",stripe:"",size:"small"},{default:s(()=>[e(r,{prop:"ip_address",label:"IPåœ°å€",width:"140"}),e(r,{label:"å›½å®¶/åœ°åŒº",width:"120"},{default:s(({row:a})=>[_(i($(a.country))+" "+i(a.country),1)]),_:1}),e(r,{prop:"region",label:"åœ°åŒº",width:"120"}),e(r,{prop:"city",label:"åŸå¸‚",width:"120"}),e(r,{prop:"organization",label:"ISP","min-width":"150","show-overflow-tooltip":""}),e(r,{prop:"visit_count",label:"è®¿é—®æ¬¡æ•°",width:"90",align:"center"}),e(r,{prop:"first_visit",label:"é¦–æ¬¡è®¿é—®",width:"170"}),e(r,{prop:"last_visit",label:"æœ€åè®¿é—®",width:"170"})]),_:1},8,["data"])])),[[N,M.value]])]),_:1},8,["modelValue","title"])])}}}),rt=ze(st,[["__scopeId","data-v-17990fa9"]]);export{rt as default};
