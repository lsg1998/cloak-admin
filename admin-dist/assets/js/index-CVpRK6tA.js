import{d as G,P as K,h as w,Z as fe,r as m,Q as ce,c as M,o as r,b as e,w as a,a as d,u as z,at as ve,t as i,au as be,av as ge,aw as ye,_ as J,ax as Ve,F as O,f as Q,g as f,e as o,x as ke,E as W,W as we,ay as ze,L as Ue,R as Z,N as Y}from"./index-D1XermCW.js";import{g as Ce,a as xe,b as De,c as he,s as Se}from"./email-7Ui4IWBa.js";import{_ as Ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Re={class:"email-logs"},Me={class:"stat-card"},Le={class:"stat-icon success"},Ye={class:"stat-info"},qe={class:"stat-value"},Fe={class:"stat-card"},Ie={class:"stat-icon danger"},Ae={class:"stat-info"},Be={class:"stat-value"},Ne={class:"stat-card"},Pe={class:"stat-icon warning"},je={class:"stat-info"},Ke={class:"stat-value"},Te={class:"stat-card"},He={class:"stat-icon info"},$e={class:"stat-info"},Je={class:"stat-value"},Oe={class:"table-header"},Qe={class:"table-title"},We={class:"table-actions"},Ze={style:{"line-height":"1.6"}},Ge={key:1},Xe={key:0},el=["innerHTML"],ll=G({name:"EmailLogs"}),al=G({...ll,setup(tl){const n=K({order_id:"",email_to:"",template_code:"",country_code:"",status:"",start_date:"",end_date:""}),q=w([]),v=K({page:1,page_size:20,total:0}),T=w([]),F=w(!1),h=w({overall:null}),I=w([]),A=w(!1),_=w(null),S=w(!1),B=w(),N=w(!1),s=K({email_to:"",template_code:"",country_code:"en",variables:{order_number:"",customer_name:"",product_title:"",quantity:"",total_amount:"",currency:"EUR",address:"",city:"",country:"",product_image:""}}),X={email_to:[{required:!0,message:"请输入收件人邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],template_code:[{required:!0,message:"请选择邮件模板",trigger:"change"}],country_code:[{required:!0,message:"请选择语言/国家",trigger:"change"}]},C=async()=>{F.value=!0;try{const u={page:v.page,page_size:v.page_size,...n},{data:l}=await Ce(u);T.value=l.list,v.total=l.pagination.total}catch(u){console.error("加载数据失败:",u),Y.error("加载数据失败")}finally{F.value=!1}},L=async()=>{try{const u={};n.start_date&&(u.start_date=n.start_date),n.end_date&&(u.end_date=n.end_date);const{data:l}=await xe(u);h.value=l}catch(u){console.error("加载统计数据失败:",u)}},ee=async()=>{try{const{data:u}=await De();I.value=u}catch(u){console.error("加载国家代码失败:",u)}},le=u=>{u&&u.length===2?(n.start_date=u[0],n.end_date=u[1]):(n.start_date="",n.end_date="")},P=()=>{v.page=1,C(),L()},ae=()=>{n.order_id="",n.email_to="",n.template_code="",n.country_code="",n.status="",n.start_date="",n.end_date="",q.value=[],v.page=1,C(),L()},te=u=>{v.page=u,C()},oe=u=>{v.page_size=u,v.page=1,C()},se=async u=>{try{const{data:l}=await he(u.id);_.value=l,A.value=!0}catch(l){console.error("加载详情失败:",l),Y.error("加载详情失败")}},de=()=>{S.value=!0},ne=async()=>{B.value&&await B.value.validate(async u=>{if(u){N.value=!0;try{const l={email_to:s.email_to,template_code:s.template_code,country_code:s.country_code,variables:s.variables};await Se(l),Y.success("邮件发送成功"),S.value=!1,C(),L()}catch(l){console.error("邮件发送失败:",l),Y.error(l.message||"邮件发送失败")}finally{N.value=!1}}})};return fe(()=>{C(),L(),ee()}),(u,l)=>{const k=m("el-icon"),D=m("el-card"),y=m("el-col"),E=m("el-row"),b=m("el-input"),p=m("el-form-item"),g=m("el-option"),R=m("el-select"),ue=m("el-date-picker"),x=m("el-button"),H=m("el-form"),c=m("el-tag"),U=m("el-table-column"),re=m("el-table"),ie=m("el-pagination"),j=m("el-divider"),$=m("el-dialog"),V=m("el-descriptions-item"),_e=m("el-text"),pe=m("el-descriptions"),me=ce("loading");return r(),M("div",Re,[e(E,{gutter:20,class:"stats-row"},{default:a(()=>[e(y,{span:6},{default:a(()=>[e(D,{shadow:"hover"},{default:a(()=>{var t;return[d("div",Me,[d("div",Le,[e(k,null,{default:a(()=>[e(z(ve))]),_:1})]),d("div",Ye,[d("div",qe,i(((t=h.value.overall)==null?void 0:t.success_count)||0),1),l[25]||(l[25]=d("div",{class:"stat-label"},"发送成功",-1))])])]}),_:1})]),_:1}),e(y,{span:6},{default:a(()=>[e(D,{shadow:"hover"},{default:a(()=>{var t;return[d("div",Fe,[d("div",Ie,[e(k,null,{default:a(()=>[e(z(be))]),_:1})]),d("div",Ae,[d("div",Be,i(((t=h.value.overall)==null?void 0:t.failed_count)||0),1),l[26]||(l[26]=d("div",{class:"stat-label"},"发送失败",-1))])])]}),_:1})]),_:1}),e(y,{span:6},{default:a(()=>[e(D,{shadow:"hover"},{default:a(()=>{var t;return[d("div",Ne,[d("div",Pe,[e(k,null,{default:a(()=>[e(z(ge))]),_:1})]),d("div",je,[d("div",Ke,i(((t=h.value.overall)==null?void 0:t.sending_count)||0),1),l[27]||(l[27]=d("div",{class:"stat-label"},"发送中",-1))])])]}),_:1})]),_:1}),e(y,{span:6},{default:a(()=>[e(D,{shadow:"hover"},{default:a(()=>{var t;return[d("div",Te,[d("div",He,[e(k,null,{default:a(()=>[e(z(ye))]),_:1})]),d("div",$e,[d("div",Je,i(((t=h.value.overall)==null?void 0:t.total)||0),1),l[28]||(l[28]=d("div",{class:"stat-label"},"总计",-1))])])]}),_:1})]),_:1})]),_:1}),e(D,{class:"search-card",shadow:"never"},{default:a(()=>[e(H,{model:n,inline:"",class:"search-form"},{default:a(()=>[e(p,{label:"订单号"},{default:a(()=>[e(b,{modelValue:n.order_id,"onUpdate:modelValue":l[0]||(l[0]=t=>n.order_id=t),placeholder:"请输入订单ID",clearable:"",style:{width:"150px"},onKeyup:J(P,["enter"])},null,8,["modelValue"])]),_:1}),e(p,{label:"收件人"},{default:a(()=>[e(b,{modelValue:n.email_to,"onUpdate:modelValue":l[1]||(l[1]=t=>n.email_to=t),placeholder:"请输入邮箱",clearable:"",style:{width:"200px"},onKeyup:J(P,["enter"])},{prefix:a(()=>[e(k,null,{default:a(()=>[e(z(Ve))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"邮件类型"},{default:a(()=>[e(R,{modelValue:n.template_code,"onUpdate:modelValue":l[2]||(l[2]=t=>n.template_code=t),placeholder:"请选择类型",clearable:"",style:{width:"180px"}},{default:a(()=>[e(g,{label:"拣货通知",value:"picking_notification"}),e(g,{label:"发货通知",value:"shipped_notification"}),e(g,{label:"到达提醒",value:"arrival_reminder"}),e(g,{label:"补发通知",value:"reshipment_notice"}),e(g,{label:"手动发送",value:"manual_send"})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"国家"},{default:a(()=>[e(R,{modelValue:n.country_code,"onUpdate:modelValue":l[3]||(l[3]=t=>n.country_code=t),placeholder:"请选择国家",clearable:"",style:{width:"120px"}},{default:a(()=>[(r(!0),M(O,null,Q(I.value,t=>(r(),f(g,{key:t.code,label:t.name,value:t.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"状态"},{default:a(()=>[e(R,{modelValue:n.status,"onUpdate:modelValue":l[4]||(l[4]=t=>n.status=t),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:a(()=>[e(g,{label:"成功",value:"success"}),e(g,{label:"失败",value:"failed"}),e(g,{label:"发送中",value:"sending"})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"发送时间"},{default:a(()=>[e(ue,{modelValue:q.value,"onUpdate:modelValue":l[5]||(l[5]=t=>q.value=t),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:le,style:{width:"240px"}},null,8,["modelValue"])]),_:1}),e(p,null,{default:a(()=>[e(x,{type:"primary",onClick:P},{default:a(()=>[e(k,null,{default:a(()=>[e(z(ke))]),_:1}),l[29]||(l[29]=o(" 搜索 ",-1))]),_:1}),e(x,{onClick:ae},{default:a(()=>[e(k,null,{default:a(()=>[e(z(W))]),_:1}),l[30]||(l[30]=o(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(D,{class:"table-card",shadow:"never"},{header:a(()=>[d("div",Oe,[d("div",Qe,[l[31]||(l[31]=d("span",null,"邮件发送记录",-1)),e(c,{type:"info",size:"small"},{default:a(()=>[o(i(v.total)+" 条记录",1)]),_:1})]),d("div",We,[e(x,{type:"primary",size:"small",onClick:de},{default:a(()=>[e(k,null,{default:a(()=>[e(z(Ue))]),_:1}),l[32]||(l[32]=o(" 发送邮件 ",-1))]),_:1}),e(x,{size:"small",onClick:C},{default:a(()=>[e(k,null,{default:a(()=>[e(z(W))]),_:1}),l[33]||(l[33]=o(" 刷新 ",-1))]),_:1})])])]),default:a(()=>[we((r(),f(re,{data:T.value,border:"",stripe:""},{default:a(()=>[e(U,{prop:"id",label:"ID",width:"70",align:"center"}),e(U,{label:"订单信息","min-width":"180"},{default:a(({row:t})=>[d("div",Ze,[d("div",null,[l[34]||(l[34]=d("strong",null,"订单号:",-1)),o(" "+i(t.order_number||"-"),1)]),d("div",null,[l[35]||(l[35]=d("strong",null,"客户:",-1)),o(" "+i(t.customer_name||"-"),1)])])]),_:1}),e(U,{prop:"email_to",label:"收件人","min-width":"200","show-overflow-tooltip":""}),e(U,{label:"邮件类型",width:"140"},{default:a(({row:t})=>[t.template_code==="picking_notification"?(r(),f(c,{key:0,type:"warning",size:"small"},{default:a(()=>[...l[36]||(l[36]=[o(" 拣货通知 ",-1)])]),_:1})):t.template_code==="shipped_notification"?(r(),f(c,{key:1,type:"success",size:"small"},{default:a(()=>[...l[37]||(l[37]=[o(" 发货通知 ",-1)])]),_:1})):t.template_code==="arrival_reminder"?(r(),f(c,{key:2,type:"danger",size:"small"},{default:a(()=>[...l[38]||(l[38]=[o(" 到达提醒 ",-1)])]),_:1})):t.template_code==="reshipment_notice"?(r(),f(c,{key:3,type:"info",size:"small"},{default:a(()=>[...l[39]||(l[39]=[o(" 补发通知 ",-1)])]),_:1})):t.email_type==="manual_send"?(r(),f(c,{key:4,type:"primary",size:"small"},{default:a(()=>[...l[40]||(l[40]=[o(" 手动发送 ",-1)])]),_:1})):(r(),f(c,{key:5,size:"small"},{default:a(()=>[o(i(t.email_type),1)]),_:2},1024))]),_:1}),e(U,{label:"国家",width:"70",align:"center"},{default:a(({row:t})=>[t.country_code?(r(),f(c,{key:0,size:"small"},{default:a(()=>[o(i(t.country_code.toUpperCase()),1)]),_:2},1024)):(r(),M("span",Ge,"-"))]),_:1}),e(U,{prop:"subject",label:"邮件主题","min-width":"250","show-overflow-tooltip":""}),e(U,{label:"状态",width:"90",align:"center"},{default:a(({row:t})=>[t.status==="success"?(r(),f(c,{key:0,type:"success",size:"small"},{default:a(()=>[...l[41]||(l[41]=[o("成功",-1)])]),_:1})):t.status==="failed"?(r(),f(c,{key:1,type:"danger",size:"small"},{default:a(()=>[...l[42]||(l[42]=[o("失败",-1)])]),_:1})):t.status==="sending"?(r(),f(c,{key:2,type:"warning",size:"small"},{default:a(()=>[...l[43]||(l[43]=[o("发送中",-1)])]),_:1})):(r(),f(c,{key:3,type:"info",size:"small"},{default:a(()=>[o(i(t.status),1)]),_:2},1024))]),_:1}),e(U,{prop:"created_at",label:"发送时间",width:"160"}),e(U,{label:"操作",width:"120",fixed:"right",align:"center"},{default:a(({row:t})=>[e(x,{link:"",type:"primary",size:"small",onClick:ol=>se(t)},{default:a(()=>[e(k,null,{default:a(()=>[e(z(ze))]),_:1}),l[44]||(l[44]=o(" 查看 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[me,F.value]]),e(ie,{"current-page":v.page,"onUpdate:currentPage":l[6]||(l[6]=t=>v.page=t),"page-size":v.page_size,"onUpdate:pageSize":l[7]||(l[7]=t=>v.page_size=t),total:v.total,"page-sizes":[20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:oe,onCurrentChange:te,class:"pagination"},null,8,["current-page","page-size","total"])]),_:1}),e($,{modelValue:S.value,"onUpdate:modelValue":l[22]||(l[22]=t=>S.value=t),title:"发送邮件",width:"600px","close-on-click-modal":!1},{footer:a(()=>[e(x,{onClick:l[21]||(l[21]=t=>S.value=!1)},{default:a(()=>[...l[46]||(l[46]=[o("取消",-1)])]),_:1}),e(x,{type:"primary",onClick:ne,loading:N.value},{default:a(()=>[...l[47]||(l[47]=[o("立即发送",-1)])]),_:1},8,["loading"])]),default:a(()=>[e(H,{model:s,rules:X,ref_key:"sendFormRef",ref:B,"label-width":"120px"},{default:a(()=>[e(p,{label:"收件人邮箱",prop:"email_to"},{default:a(()=>[e(b,{modelValue:s.email_to,"onUpdate:modelValue":l[8]||(l[8]=t=>s.email_to=t),placeholder:"请输入收件人邮箱地址"},null,8,["modelValue"])]),_:1}),e(p,{label:"邮件模板",prop:"template_code"},{default:a(()=>[e(R,{modelValue:s.template_code,"onUpdate:modelValue":l[9]||(l[9]=t=>s.template_code=t),placeholder:"请选择邮件模板",style:{width:"100%"}},{default:a(()=>[e(g,{label:"📦 拣货通知",value:"picking_notification"}),e(g,{label:"🚚 发货通知",value:"shipped_notification"}),e(g,{label:"📍 到达提醒",value:"arrival_reminder"}),e(g,{label:"🔄 补发通知",value:"reshipment_notice"})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"语言/国家",prop:"country_code"},{default:a(()=>[e(R,{modelValue:s.country_code,"onUpdate:modelValue":l[10]||(l[10]=t=>s.country_code=t),placeholder:"请选择语言",style:{width:"100%"}},{default:a(()=>[(r(!0),M(O,null,Q(I.value,t=>(r(),f(g,{key:t.code,label:t.name,value:t.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(j,null,{default:a(()=>[...l[45]||(l[45]=[o("模板变量（可选）",-1)])]),_:1}),e(E,{gutter:20},{default:a(()=>[e(y,{span:12},{default:a(()=>[e(p,{label:"订单号"},{default:a(()=>[e(b,{modelValue:s.variables.order_number,"onUpdate:modelValue":l[11]||(l[11]=t=>s.variables.order_number=t),placeholder:"如：ORD20241027001"},null,8,["modelValue"])]),_:1})]),_:1}),e(y,{span:12},{default:a(()=>[e(p,{label:"客户姓名"},{default:a(()=>[e(b,{modelValue:s.variables.customer_name,"onUpdate:modelValue":l[12]||(l[12]=t=>s.variables.customer_name=t),placeholder:"如：John Doe"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(E,{gutter:20},{default:a(()=>[e(y,{span:12},{default:a(()=>[e(p,{label:"商品标题"},{default:a(()=>[e(b,{modelValue:s.variables.product_title,"onUpdate:modelValue":l[13]||(l[13]=t=>s.variables.product_title=t),placeholder:"如：Premium Product"},null,8,["modelValue"])]),_:1})]),_:1}),e(y,{span:12},{default:a(()=>[e(p,{label:"数量"},{default:a(()=>[e(b,{modelValue:s.variables.quantity,"onUpdate:modelValue":l[14]||(l[14]=t=>s.variables.quantity=t),placeholder:"如：1"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(E,{gutter:20},{default:a(()=>[e(y,{span:12},{default:a(()=>[e(p,{label:"总金额"},{default:a(()=>[e(b,{modelValue:s.variables.total_amount,"onUpdate:modelValue":l[15]||(l[15]=t=>s.variables.total_amount=t),placeholder:"如：99.99"},null,8,["modelValue"])]),_:1})]),_:1}),e(y,{span:12},{default:a(()=>[e(p,{label:"货币"},{default:a(()=>[e(b,{modelValue:s.variables.currency,"onUpdate:modelValue":l[16]||(l[16]=t=>s.variables.currency=t),placeholder:"如：EUR"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(p,{label:"地址"},{default:a(()=>[e(b,{modelValue:s.variables.address,"onUpdate:modelValue":l[17]||(l[17]=t=>s.variables.address=t),placeholder:"如：123 Main Street"},null,8,["modelValue"])]),_:1}),e(E,{gutter:20},{default:a(()=>[e(y,{span:12},{default:a(()=>[e(p,{label:"城市"},{default:a(()=>[e(b,{modelValue:s.variables.city,"onUpdate:modelValue":l[18]||(l[18]=t=>s.variables.city=t),placeholder:"如：Bratislava"},null,8,["modelValue"])]),_:1})]),_:1}),e(y,{span:12},{default:a(()=>[e(p,{label:"国家"},{default:a(()=>[e(b,{modelValue:s.variables.country,"onUpdate:modelValue":l[19]||(l[19]=t=>s.variables.country=t),placeholder:"如：Slovakia"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(p,{label:"商品图片"},{default:a(()=>[e(b,{modelValue:s.variables.product_image,"onUpdate:modelValue":l[20]||(l[20]=t=>s.variables.product_image=t),placeholder:"商品图片URL（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e($,{modelValue:A.value,"onUpdate:modelValue":l[24]||(l[24]=t=>A.value=t),title:"邮件详情",width:"70%"},{default:a(()=>[_.value?(r(),M("div",Xe,[e(pe,{column:2,border:""},{default:a(()=>[e(V,{label:"邮件ID"},{default:a(()=>[o(i(_.value.id),1)]),_:1}),e(V,{label:"订单ID"},{default:a(()=>[o(i(_.value.order_id),1)]),_:1}),e(V,{label:"订单号"},{default:a(()=>[o(i(_.value.order_number||"-"),1)]),_:1}),e(V,{label:"客户姓名"},{default:a(()=>[o(i(_.value.customer_name||"-"),1)]),_:1}),e(V,{label:"收件人邮箱",span:2},{default:a(()=>[o(i(_.value.email_to),1)]),_:1}),e(V,{label:"邮件类型"},{default:a(()=>[o(i(_.value.email_type),1)]),_:1}),e(V,{label:"模板代码"},{default:a(()=>[o(i(_.value.template_code||"-"),1)]),_:1}),e(V,{label:"国家代码"},{default:a(()=>[o(i(_.value.country_code||"-"),1)]),_:1}),e(V,{label:"状态"},{default:a(()=>[_.value.status==="success"?(r(),f(c,{key:0,type:"success"},{default:a(()=>[...l[48]||(l[48]=[o("成功",-1)])]),_:1})):_.value.status==="failed"?(r(),f(c,{key:1,type:"danger"},{default:a(()=>[...l[49]||(l[49]=[o("失败",-1)])]),_:1})):(r(),f(c,{key:2,type:"warning"},{default:a(()=>[o(i(_.value.status),1)]),_:1}))]),_:1}),e(V,{label:"任务ID"},{default:a(()=>[o(i(_.value.task_id||"-"),1)]),_:1}),e(V,{label:"发送时间"},{default:a(()=>[o(i(_.value.created_at),1)]),_:1}),_.value.error_message?(r(),f(V,{key:0,label:"错误信息",span:2},{default:a(()=>[e(_e,{type:"danger"},{default:a(()=>[o(i(_.value.error_message),1)]),_:1})]),_:1})):Z("",!0)]),_:1}),e(j,null,{default:a(()=>[...l[50]||(l[50]=[o("邮件主题",-1)])]),_:1}),e(b,{modelValue:_.value.subject,"onUpdate:modelValue":l[23]||(l[23]=t=>_.value.subject=t),readonly:""},null,8,["modelValue"]),e(j,null,{default:a(()=>[...l[51]||(l[51]=[o("邮件内容",-1)])]),_:1}),d("div",{class:"email-content",innerHTML:_.value.html_content},null,8,el)])):Z("",!0)]),_:1},8,["modelValue"])])}}}),ul=Ee(al,[["__scopeId","data-v-72a97191"]]);export{ul as default};
