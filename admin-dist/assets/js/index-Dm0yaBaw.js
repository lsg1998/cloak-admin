import{d as X,h as m,P as z,Z as _e,r as i,c as h,o as f,a as s,b as e,w as o,g as w,R as J,e as r,t as D,u as v,as as ce,U as j,$ as q,aU as pe,aX as fe,F as M,f as W,aC as be,E as ke,N as _,a0 as me}from"./index-jNulkSYc.js";import{g as ve,u as A}from"./pixel-Boy0pkpZ.js";import{g as ge}from"./product-DuXkyVhH.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ye={class:"pixel-config"},Ve={class:"card-header"},we={class:"card-header"},Ce={class:"card-header"},Ae={class:"card-header"},Ue={class:"action-bar"},Ne=X({name:"PixelConfig"}),Se=X({...Ne,setup(Oe){const G=m(!1),C=m(!1),P=m("添加 Google Ads 账户"),B=m(),U=m(-1),E=m(!1),L=m([]),u=m([]),d=z({name:"",conversion_id:"",conversion_label:"",enabled:!0,product_ids:[]}),Y={name:[{required:!0,message:"请输入账户名称",trigger:"blur"}],conversion_id:[{required:!0,message:"请输入转化ID",trigger:"blur"},{pattern:/^\d+$/,message:"转化ID只能包含数字",trigger:"blur"}],conversion_label:[{required:!0,message:"请输入转化标签",trigger:"blur"}]},t=z({facebook_enabled:0,facebook_pixel_id:"",tiktok_enabled:0,tiktok_pixel_id:""}),c=m([]),Z=async()=>{E.value=!0;try{const{data:n}=await ge({});L.value=n.list.map(l=>({id:l.id,title:l.title}))}catch(n){console.error("加载商品列表失败",n)}finally{E.value=!1}},I=async()=>{try{const{data:n}=await ve();if(n){if(n.google_ads_accounts)try{u.value=typeof n.google_ads_accounts=="string"?JSON.parse(n.google_ads_accounts):n.google_ads_accounts}catch{u.value=[]}if(t.facebook_enabled=n.facebook_enabled||!1,t.facebook_pixel_id=n.facebook_pixel_id||"",t.tiktok_enabled=n.tiktok_enabled||!1,t.tiktok_pixel_id=n.tiktok_pixel_id||"",n.custom_pixels)try{c.value=typeof n.custom_pixels=="string"?JSON.parse(n.custom_pixels):n.custom_pixels}catch{c.value=[]}}else t.facebook_enabled=!1,t.facebook_pixel_id="",t.tiktok_enabled=!1,t.tiktok_pixel_id="",c.value=[],u.value=[]}catch(n){_.error("加载配置失败"),console.error(n)}},H=()=>{P.value="添加 Google Ads 账户",U.value=-1,Object.assign(d,{name:"",conversion_id:"",conversion_label:"",enabled:!0,product_ids:[]}),C.value=!0},K=(n,l)=>{P.value="编辑 Google Ads 账户",U.value=l,Object.assign(d,{...n,product_ids:n.product_ids||[]}),C.value=!0},Q=async()=>{if(B.value)try{await B.value.validate();const n={name:d.name,conversion_id:d.conversion_id,conversion_label:d.conversion_label,enabled:d.enabled,product_ids:d.product_ids||[]};U.value>=0?u.value[U.value]=n:u.value.push(n),await A({google_ads_accounts:JSON.stringify(u.value),facebook_enabled:t.facebook_enabled,facebook_pixel_id:t.facebook_pixel_id,tiktok_enabled:t.tiktok_enabled,tiktok_pixel_id:t.tiktok_pixel_id,custom_pixels:JSON.stringify(c.value)}),C.value=!1,_.success(U.value>=0?"账户更新成功":"账户添加成功")}catch(n){console.error(n),_.error("保存失败，请重试")}},ee=async n=>{try{await me.confirm("确定要删除这个 Google Ads 账户吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),u.value.splice(n,1),await A({google_ads_accounts:JSON.stringify(u.value),facebook_enabled:t.facebook_enabled,facebook_pixel_id:t.facebook_pixel_id,tiktok_enabled:t.tiktok_enabled,tiktok_pixel_id:t.tiktok_pixel_id,custom_pixels:JSON.stringify(c.value)}),_.success("删除成功")}catch(l){l!=="cancel"&&(console.error(l),_.error("删除失败，请重试"))}},le=async()=>{try{await A({google_ads_accounts:JSON.stringify(u.value),facebook_enabled:t.facebook_enabled,facebook_pixel_id:t.facebook_pixel_id,tiktok_enabled:t.tiktok_enabled,tiktok_pixel_id:t.tiktok_pixel_id,custom_pixels:JSON.stringify(c.value)}),_.success("状态已更新")}catch(n){console.error(n),_.error("状态更新失败，请重试")}},oe=async()=>{c.value.push({name:"",code:"",enabled:!0});try{await A({google_ads_accounts:JSON.stringify(u.value),facebook_enabled:t.facebook_enabled,facebook_pixel_id:t.facebook_pixel_id,tiktok_enabled:t.tiktok_enabled,tiktok_pixel_id:t.tiktok_pixel_id,custom_pixels:JSON.stringify(c.value)}),_.success("自定义像素已添加")}catch(n){console.error(n),_.error("添加失败，请重试")}},ae=async n=>{c.value.splice(n,1);try{await A({google_ads_accounts:JSON.stringify(u.value),facebook_enabled:t.facebook_enabled,facebook_pixel_id:t.facebook_pixel_id,tiktok_enabled:t.tiktok_enabled,tiktok_pixel_id:t.tiktok_pixel_id,custom_pixels:JSON.stringify(c.value)}),_.success("自定义像素已删除")}catch(l){console.error(l),_.error("删除失败，请重试")}},te=async()=>{G.value=!0;try{await A({google_ads_accounts:JSON.stringify(u.value),facebook_enabled:t.facebook_enabled,facebook_pixel_id:t.facebook_pixel_id,tiktok_enabled:t.tiktok_enabled,tiktok_pixel_id:t.tiktok_pixel_id,custom_pixels:JSON.stringify(c.value)}),_.success("配置保存成功，所有商品页面已生效"),await I()}catch(n){_.error("保存配置失败"),console.error(n)}finally{G.value=!1}},ne=()=>{I(),_.info("已重置为当前保存的配置")};return _e(()=>{I(),Z()}),(n,l)=>{const b=i("el-icon"),k=i("el-button"),x=i("el-table-column"),F=i("el-tag"),R=i("el-text"),N=i("el-switch"),de=i("el-table"),T=i("el-empty"),S=i("el-card"),p=i("el-form-item"),y=i("el-input"),O=i("el-form"),$=i("el-col"),ie=i("el-row"),se=i("el-option"),re=i("el-select"),ue=i("el-dialog");return f(),h("div",ye,[l[29]||(l[29]=s("div",{class:"page-header"},[s("h2",null,"全局像素配置"),s("p",null,"配置网站的像素跟踪代码，支持多个 Google Ads 账户，可为每个账户指定商品范围")],-1)),e(S,{class:"config-card",shadow:"never"},{header:o(()=>[s("div",Ve,[l[12]||(l[12]=s("span",{class:"card-title"},"Google Ads 账户管理",-1)),e(k,{type:"primary",onClick:H},{default:o(()=>[e(b,null,{default:o(()=>[e(v(q))]),_:1}),l[11]||(l[11]=r(" 添加账户 ",-1))]),_:1})])]),default:o(()=>[e(de,{data:u.value,stripe:"",border:"",style:{width:"100%"}},{default:o(()=>[e(x,{type:"index",label:"序号",width:"60",align:"center"}),e(x,{prop:"name",label:"账户名称","min-width":"150"},{default:o(({row:a})=>[e(F,null,{default:o(()=>[r(D(a.name),1)]),_:2},1024)]),_:1}),e(x,{prop:"conversion_id",label:"转化ID","min-width":"150"},{default:o(({row:a})=>[e(R,{type:"primary"},{default:o(()=>[r("AW-"+D(a.conversion_id),1)]),_:2},1024)]),_:1}),e(x,{prop:"conversion_label",label:"转化标签","min-width":"180"},{default:o(({row:a})=>[e(R,{type:"info"},{default:o(()=>[r(D(a.conversion_label),1)]),_:2},1024)]),_:1}),e(x,{prop:"product_ids",label:"应用商品","min-width":"180"},{default:o(({row:a})=>[!a.product_ids||a.product_ids.length===0?(f(),w(F,{key:0,type:"success"},{default:o(()=>[...l[13]||(l[13]=[r("全部商品",-1)])]),_:1})):(f(),w(F,{key:1,type:"warning"},{default:o(()=>[r("指定 "+D(a.product_ids.length)+" 个商品",1)]),_:2},1024))]),_:1}),e(x,{prop:"enabled",label:"状态",width:"100",align:"center"},{default:o(({row:a})=>[e(N,{modelValue:a.enabled,"onUpdate:modelValue":V=>a.enabled=V,onChange:le},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(x,{label:"操作",width:"180",align:"center",fixed:"right"},{default:o(({row:a,$index:V})=>[e(k,{type:"primary",size:"small",link:"",onClick:g=>K(a,V)},{default:o(()=>[e(b,null,{default:o(()=>[e(v(ce))]),_:1}),l[14]||(l[14]=r(" 编辑 ",-1))]),_:1},8,["onClick"]),e(k,{type:"danger",size:"small",link:"",onClick:g=>ee(V)},{default:o(()=>[e(b,null,{default:o(()=>[e(v(j))]),_:1}),l[15]||(l[15]=r(" 删除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),u.value.length===0?(f(),w(T,{key:0,description:"暂无 Google Ads 账户，点击右上角添加"})):J("",!0)]),_:1}),e(ie,{gutter:20},{default:o(()=>[e($,{span:12},{default:o(()=>[e(S,{class:"config-card",shadow:"never"},{header:o(()=>[s("div",we,[e(b,{class:"platform-icon facebook"},{default:o(()=>[e(v(pe))]),_:1}),l[16]||(l[16]=s("span",{class:"card-title"},"Facebook 像素",-1))])]),default:o(()=>[e(O,{"label-width":"100px"},{default:o(()=>[e(p,{label:"启用"},{default:o(()=>[e(N,{modelValue:t.facebook_enabled,"onUpdate:modelValue":l[0]||(l[0]=a=>t.facebook_enabled=a),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),t.facebook_enabled?(f(),w(p,{key:0,label:"像素ID"},{default:o(()=>[e(y,{modelValue:t.facebook_pixel_id,"onUpdate:modelValue":l[1]||(l[1]=a=>t.facebook_pixel_id=a),placeholder:"例如: 123456789012345"},null,8,["modelValue"])]),_:1})):J("",!0)]),_:1})]),_:1})]),_:1}),e($,{span:12},{default:o(()=>[e(S,{class:"config-card",shadow:"never"},{header:o(()=>[s("div",Ce,[e(b,{class:"platform-icon tiktok"},{default:o(()=>[e(v(fe))]),_:1}),l[17]||(l[17]=s("span",{class:"card-title"},"TikTok 像素",-1))])]),default:o(()=>[e(O,{"label-width":"100px"},{default:o(()=>[e(p,{label:"启用"},{default:o(()=>[e(N,{modelValue:t.tiktok_enabled,"onUpdate:modelValue":l[2]||(l[2]=a=>t.tiktok_enabled=a),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),t.tiktok_enabled?(f(),w(p,{key:0,label:"像素ID"},{default:o(()=>[e(y,{modelValue:t.tiktok_pixel_id,"onUpdate:modelValue":l[3]||(l[3]=a=>t.tiktok_pixel_id=a),placeholder:"例如: C1234567890ABCDEF"},null,8,["modelValue"])]),_:1})):J("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),e(S,{class:"config-card",shadow:"never"},{header:o(()=>[s("div",Ae,[l[19]||(l[19]=s("span",{class:"card-title"},"自定义像素",-1)),e(k,{type:"primary",onClick:oe},{default:o(()=>[e(b,null,{default:o(()=>[e(v(q))]),_:1}),l[18]||(l[18]=r(" 添加自定义像素 ",-1))]),_:1})])]),default:o(()=>[(f(!0),h(M,null,W(c.value,(a,V)=>(f(),h("div",{key:V,class:"custom-pixel-item"},[e(O,{"label-width":"100px"},{default:o(()=>[e(p,{label:"像素名称"},{default:o(()=>[e(y,{modelValue:a.name,"onUpdate:modelValue":g=>a.name=g,placeholder:"例如: 第三方统计代码"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(p,{label:"启用状态"},{default:o(()=>[e(N,{modelValue:a.enabled,"onUpdate:modelValue":g=>a.enabled=g},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(p,{label:"像素代码"},{default:o(()=>[e(y,{modelValue:a.code,"onUpdate:modelValue":g=>a.code=g,type:"textarea",rows:4,placeholder:"粘贴像素代码..."},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(p,null,{default:o(()=>[e(k,{type:"danger",onClick:g=>ae(V)},{default:o(()=>[e(b,null,{default:o(()=>[e(v(j))]),_:1}),l[20]||(l[20]=r(" 删除 ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128)),c.value.length===0?(f(),w(T,{key:0,description:"暂无自定义像素"})):J("",!0)]),_:1}),s("div",Ue,[e(k,{type:"primary",size:"large",onClick:te,loading:G.value},{default:o(()=>[e(b,null,{default:o(()=>[e(v(be))]),_:1}),l[21]||(l[21]=r(" 保存所有配置 ",-1))]),_:1},8,["loading"]),e(k,{size:"large",onClick:ne},{default:o(()=>[e(b,null,{default:o(()=>[e(v(ke))]),_:1}),l[22]||(l[22]=r(" 重置 ",-1))]),_:1})]),e(ue,{modelValue:C.value,"onUpdate:modelValue":l[10]||(l[10]=a=>C.value=a),title:P.value,width:"700px"},{footer:o(()=>[e(k,{onClick:l[9]||(l[9]=a=>C.value=!1)},{default:o(()=>[...l[27]||(l[27]=[r("取消",-1)])]),_:1}),e(k,{type:"primary",onClick:Q},{default:o(()=>[...l[28]||(l[28]=[r("确定",-1)])]),_:1})]),default:o(()=>[e(O,{ref_key:"accountFormRef",ref:B,model:d,rules:Y,"label-width":"120px"},{default:o(()=>[e(p,{label:"账户名称",prop:"name"},{default:o(()=>[e(y,{modelValue:d.name,"onUpdate:modelValue":l[4]||(l[4]=a=>d.name=a),placeholder:"例如: 主投账户"},null,8,["modelValue"])]),_:1}),e(p,{label:"转化ID",prop:"conversion_id"},{default:o(()=>[e(y,{modelValue:d.conversion_id,"onUpdate:modelValue":l[5]||(l[5]=a=>d.conversion_id=a),placeholder:"例如: 17612844136"},{prepend:o(()=>[...l[23]||(l[23]=[r("AW-",-1)])]),_:1},8,["modelValue"]),l[24]||(l[24]=s("div",{class:"form-tip"},"在 Google Ads 后台创建转化操作后获取",-1))]),_:1}),e(p,{label:"转化标签",prop:"conversion_label"},{default:o(()=>[e(y,{modelValue:d.conversion_label,"onUpdate:modelValue":l[6]||(l[6]=a=>d.conversion_label=a),placeholder:"例如: REXpCP2e1aUbEOjYus5B"},null,8,["modelValue"]),l[25]||(l[25]=s("div",{class:"form-tip"},"转化操作对应的标签代码",-1))]),_:1}),e(p,{label:"应用商品"},{default:o(()=>[e(re,{modelValue:d.product_ids,"onUpdate:modelValue":l[7]||(l[7]=a=>d.product_ids=a),multiple:"",filterable:"",placeholder:"不选择则应用到全部商品",style:{width:"100%"},loading:E.value},{default:o(()=>[(f(!0),h(M,null,W(L.value,a=>(f(),w(se,{key:a.id,label:a.title,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"]),l[26]||(l[26]=s("div",{class:"form-tip"},"不选择任何商品时，此像素将应用到全部商品页面",-1))]),_:1}),e(p,{label:"启用状态"},{default:o(()=>[e(N,{modelValue:d.enabled,"onUpdate:modelValue":l[8]||(l[8]=a=>d.enabled=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Pe=xe(Se,[["__scopeId","data-v-d10160a3"]]);export{Pe as default};
