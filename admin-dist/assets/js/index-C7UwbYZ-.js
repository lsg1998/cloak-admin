import{d as Q,P as E,h as V,s as pe,Z as me,r as u,Q as fe,c,o as i,b as e,w as t,_ as K,F as P,f as $,u as f,g as C,e as r,x as ve,E as A,a as o,bu as O,t as n,bv as ge,au as he,bw as ye,W as be,R as j,ay as we,N as ke}from"./index-tWB8d80m.js";import{e as Ve,f as ze,g as Ce,h as xe}from"./sms-BCDIXfFj.js";import{_ as De}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Se={class:"sms-logs"},Ue={class:"stat-content"},Ne={class:"stat-icon total"},Ye={class:"stat-info"},Ie={class:"stat-value"},Me={class:"stat-content"},Te={class:"stat-icon success"},Be={class:"stat-info"},Fe={class:"stat-value"},Le={class:"stat-content"},Re={class:"stat-icon failed"},Ee={class:"stat-info"},Ke={class:"stat-value"},Pe={class:"stat-content"},$e={class:"stat-icon rate"},Ae={class:"stat-info"},Oe={class:"stat-value"},je={class:"table-header"},Qe={class:"table-title"},We={class:"table-actions"},Ze={key:0},qe={class:"order-number"},Ge={key:0,class:"customer-name"},He={key:1,class:"no-order"},Je={key:1},Xe={key:0,class:"message-id"},et={key:1},tt={key:0},at={key:1},st={key:0,class:"detail-container"},lt={key:0},ot={key:1},nt={key:1},dt={class:"sms-content-preview"},it={class:"sms-bubble"},_t={class:"sms-meta"},ut=Q({name:"SmsLogs"}),rt=Q({...ut,setup(ct){const d=E({order_id:"",phone:"",sms_type:"",status:"",start_date:"",end_date:""}),S=V([]),p=E({page:1,page_size:20,total:0}),I=V([]),U=V(!1),b=V({}),N=V(!1),_=V(null),W=pe(()=>{var z,g;const l=((z=b.value.overall)==null?void 0:z.total)||0,s=((g=b.value.overall)==null?void 0:g.success_count)||0;return l===0?0:(s/l*100).toFixed(1)}),Z={picking:"拣货通知",shipped:"发货通知",arrival:"到达提醒",reshipment:"补发通知",custom:"自定义"},q={picking:"warning",shipped:"success",arrival:"primary",reshipment:"danger",custom:"info"},M=l=>Z[l]||l,T=l=>q[l]||"info",G={success:"发送成功",failed:"发送失败",pending:"发送中"},H={success:"success",failed:"danger",pending:"warning"},B=l=>G[l]||l,F=l=>H[l]||"info",w=async()=>{U.value=!0;try{const l={page:p.page,page_size:p.page_size,...d},{data:s}=await Ce(l);I.value=s.list,p.total=s.pagination.total}catch(l){console.error("加载数据失败:",l),ke.error("加载数据失败")}finally{U.value=!1}},J=async()=>{try{const{data:l}=await xe();b.value=l}catch(l){console.error("加载统计数据失败:",l)}},X=l=>{l&&l.length===2?(d.start_date=l[0],d.end_date=l[1]):(d.start_date="",d.end_date="")},Y=()=>{p.page=1,w()},ee=()=>{d.order_id="",d.phone="",d.sms_type="",d.status="",d.start_date="",d.end_date="",S.value=[],p.page=1,w()},te=l=>{p.page=l,w()},ae=l=>{p.page_size=l,p.page=1,w()},se=l=>{_.value=l,N.value=!0};return me(()=>{w(),J()}),(l,s)=>{const z=u("el-input"),g=u("el-form-item"),L=u("el-option"),R=u("el-select"),le=u("el-date-picker"),h=u("el-icon"),x=u("el-button"),oe=u("el-form"),k=u("el-card"),D=u("el-col"),ne=u("el-row"),y=u("el-tag"),m=u("el-table-column"),de=u("el-table"),ie=u("el-pagination"),v=u("el-descriptions-item"),_e=u("el-descriptions"),ue=u("el-divider"),re=u("el-dialog"),ce=fe("loading");return i(),c("div",Se,[e(k,{class:"search-card",shadow:"never"},{default:t(()=>[e(oe,{model:d,inline:"",class:"search-form"},{default:t(()=>[e(g,{label:"订单号"},{default:t(()=>[e(z,{modelValue:d.order_id,"onUpdate:modelValue":s[0]||(s[0]=a=>d.order_id=a),placeholder:"请输入订单ID",clearable:"",style:{width:"150px"},onKeyup:K(Y,["enter"])},null,8,["modelValue"])]),_:1}),e(g,{label:"手机号"},{default:t(()=>[e(z,{modelValue:d.phone,"onUpdate:modelValue":s[1]||(s[1]=a=>d.phone=a),placeholder:"请输入手机号",clearable:"",style:{width:"150px"},onKeyup:K(Y,["enter"])},null,8,["modelValue"])]),_:1}),e(g,{label:"短信类型"},{default:t(()=>[e(R,{modelValue:d.sms_type,"onUpdate:modelValue":s[2]||(s[2]=a=>d.sms_type=a),placeholder:"请选择类型",clearable:"",style:{width:"130px"}},{default:t(()=>[(i(!0),c(P,null,$(f(Ve),a=>(i(),C(L,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"发送状态"},{default:t(()=>[e(R,{modelValue:d.status,"onUpdate:modelValue":s[3]||(s[3]=a=>d.status=a),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:t(()=>[(i(!0),c(P,null,$(f(ze),a=>(i(),C(L,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"发送时间"},{default:t(()=>[e(le,{modelValue:S.value,"onUpdate:modelValue":s[4]||(s[4]=a=>S.value=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:X,style:{width:"240px"}},null,8,["modelValue"])]),_:1}),e(g,null,{default:t(()=>[e(x,{type:"primary",onClick:Y},{default:t(()=>[e(h,null,{default:t(()=>[e(f(ve))]),_:1}),s[8]||(s[8]=r(" 搜索 ",-1))]),_:1}),e(x,{onClick:ee},{default:t(()=>[e(h,null,{default:t(()=>[e(f(A))]),_:1}),s[9]||(s[9]=r(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(ne,{gutter:20,class:"stats-row"},{default:t(()=>[e(D,{span:6},{default:t(()=>[e(k,{shadow:"hover",class:"stat-card"},{default:t(()=>{var a;return[o("div",Ue,[o("div",Ne,[e(h,null,{default:t(()=>[e(f(O))]),_:1})]),o("div",Ye,[o("div",Ie,n(((a=b.value.overall)==null?void 0:a.total)||0),1),s[10]||(s[10]=o("div",{class:"stat-label"},"总发送数",-1))])])]}),_:1})]),_:1}),e(D,{span:6},{default:t(()=>[e(k,{shadow:"hover",class:"stat-card"},{default:t(()=>{var a;return[o("div",Me,[o("div",Te,[e(h,null,{default:t(()=>[e(f(ge))]),_:1})]),o("div",Be,[o("div",Fe,n(((a=b.value.overall)==null?void 0:a.success_count)||0),1),s[11]||(s[11]=o("div",{class:"stat-label"},"发送成功",-1))])])]}),_:1})]),_:1}),e(D,{span:6},{default:t(()=>[e(k,{shadow:"hover",class:"stat-card"},{default:t(()=>{var a;return[o("div",Le,[o("div",Re,[e(h,null,{default:t(()=>[e(f(he))]),_:1})]),o("div",Ee,[o("div",Ke,n(((a=b.value.overall)==null?void 0:a.failed_count)||0),1),s[12]||(s[12]=o("div",{class:"stat-label"},"发送失败",-1))])])]}),_:1})]),_:1}),e(D,{span:6},{default:t(()=>[e(k,{shadow:"hover",class:"stat-card"},{default:t(()=>[o("div",Pe,[o("div",$e,[e(h,null,{default:t(()=>[e(f(ye))]),_:1})]),o("div",Ae,[o("div",Oe,n(W.value)+"%",1),s[13]||(s[13]=o("div",{class:"stat-label"},"成功率",-1))])])]),_:1})]),_:1})]),_:1}),e(k,{class:"table-card",shadow:"never"},{header:t(()=>[o("div",je,[o("div",Qe,[e(h,{class:"title-icon"},{default:t(()=>[e(f(O))]),_:1}),s[14]||(s[14]=o("span",null,"短信发送记录",-1)),e(y,{type:"info",size:"small"},{default:t(()=>[r(n(p.total)+" 条记录",1)]),_:1})]),o("div",We,[e(x,{size:"small",onClick:w},{default:t(()=>[e(h,null,{default:t(()=>[e(f(A))]),_:1}),s[15]||(s[15]=r(" 刷新 ",-1))]),_:1})])])]),default:t(()=>[be((i(),C(de,{data:I.value,border:"",stripe:""},{default:t(()=>[e(m,{prop:"id",label:"ID",width:"70",align:"center"}),e(m,{label:"订单信息",width:"180"},{default:t(({row:a})=>[a.order_id>0?(i(),c("div",Ze,[o("div",qe,n(a.order_number||`#${a.order_id}`),1),a.customer_name?(i(),c("div",Ge,n(a.customer_name),1)):j("",!0)])):(i(),c("span",He,"无关联订单"))]),_:1}),e(m,{prop:"phone",label:"手机号",width:"140"}),e(m,{prop:"sms_type",label:"短信类型",width:"100",align:"center"},{default:t(({row:a})=>[e(y,{type:T(a.sms_type),size:"small"},{default:t(()=>[r(n(M(a.sms_type)),1)]),_:2},1032,["type"])]),_:1}),e(m,{prop:"country_code",label:"语言",width:"80",align:"center"},{default:t(({row:a})=>[a.country_code?(i(),C(y,{key:0,size:"small",type:"info"},{default:t(()=>[r(n(a.country_code.toUpperCase()),1)]),_:2},1024)):(i(),c("span",Je,"-"))]),_:1}),e(m,{prop:"content",label:"短信内容","min-width":"250","show-overflow-tooltip":""}),e(m,{prop:"status",label:"状态",width:"100",align:"center"},{default:t(({row:a})=>[e(y,{type:F(a.status),size:"small"},{default:t(()=>[r(n(B(a.status)),1)]),_:2},1032,["type"])]),_:1}),e(m,{prop:"message_id",label:"消息ID",width:"200","show-overflow-tooltip":""},{default:t(({row:a})=>[a.message_id?(i(),c("span",Xe,n(a.message_id),1)):(i(),c("span",et,"-"))]),_:1}),e(m,{prop:"response_message",label:"响应信息",width:"150","show-overflow-tooltip":""},{default:t(({row:a})=>[a.response_message?(i(),c("span",tt,n(a.response_message),1)):(i(),c("span",at,"-"))]),_:1}),e(m,{prop:"created_at",label:"发送时间",width:"160"}),e(m,{label:"操作",width:"100",fixed:"right",align:"center"},{default:t(({row:a})=>[e(x,{link:"",type:"primary",size:"small",onClick:pt=>se(a)},{default:t(()=>[e(h,null,{default:t(()=>[e(f(we))]),_:1}),s[16]||(s[16]=r(" 详情 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ce,U.value]]),e(ie,{"current-page":p.page,"onUpdate:currentPage":s[5]||(s[5]=a=>p.page=a),"page-size":p.page_size,"onUpdate:pageSize":s[6]||(s[6]=a=>p.page_size=a),total:p.total,"page-sizes":[20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ae,onCurrentChange:te,class:"pagination"},null,8,["current-page","page-size","total"])]),_:1}),e(re,{modelValue:N.value,"onUpdate:modelValue":s[7]||(s[7]=a=>N.value=a),title:"短信发送详情",width:"600px"},{default:t(()=>{var a;return[_.value?(i(),c("div",st,[e(_e,{column:2,border:""},{default:t(()=>[e(v,{label:"ID"},{default:t(()=>[r(n(_.value.id),1)]),_:1}),e(v,{label:"手机号"},{default:t(()=>[r(n(_.value.phone),1)]),_:1}),e(v,{label:"订单号"},{default:t(()=>[_.value.order_id>0?(i(),c("span",lt,n(_.value.order_number||`#${_.value.order_id}`),1)):(i(),c("span",ot,"-"))]),_:1}),e(v,{label:"客户名"},{default:t(()=>[r(n(_.value.customer_name||"-"),1)]),_:1}),e(v,{label:"短信类型"},{default:t(()=>[e(y,{type:T(_.value.sms_type),size:"small"},{default:t(()=>[r(n(M(_.value.sms_type)),1)]),_:1},8,["type"])]),_:1}),e(v,{label:"语言"},{default:t(()=>[_.value.country_code?(i(),C(y,{key:0,size:"small"},{default:t(()=>[r(n(_.value.country_code.toUpperCase()),1)]),_:1})):(i(),c("span",nt,"-"))]),_:1}),e(v,{label:"发送状态"},{default:t(()=>[e(y,{type:F(_.value.status),size:"small"},{default:t(()=>[r(n(B(_.value.status)),1)]),_:1},8,["type"])]),_:1}),e(v,{label:"发送时间"},{default:t(()=>[r(n(_.value.created_at),1)]),_:1}),e(v,{label:"消息ID",span:2},{default:t(()=>[r(n(_.value.message_id||"-"),1)]),_:1}),e(v,{label:"响应信息",span:2},{default:t(()=>[r(n(_.value.response_message||"-"),1)]),_:1})]),_:1}),e(ue,null,{default:t(()=>[...s[17]||(s[17]=[r("短信内容",-1)])]),_:1}),o("div",dt,[o("div",it,n(_.value.content),1),o("div",_t,[o("span",null,"字符数: "+n(((a=_.value.content)==null?void 0:a.length)||0),1)])])])):j("",!0)]}),_:1},8,["modelValue"])])}}}),gt=De(rt,[["__scopeId","data-v-836a974c"]]);export{gt as default};
