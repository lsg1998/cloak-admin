import{d as fe,h as f,P as A,Z as be,r as d,Q as ve,c as k,o as _,b as l,w as t,_ as ke,e as s,a as L,W as ye,u as we,$ as Ve,g as U,R as K,t as T,F as Ce,f as Ee,N as y,a0 as Te}from"./index-C3RpVFoX.js";import{c as D}from"./cloakRule-DnbF6MgM.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ze={class:"cloak-rule-list"},Le={class:"table-header"},Ge={class:"table-actions"},Oe={key:1,class:"text-gray-400"},Ue={key:0},De={key:1,class:"text-gray-400"},Ne={key:0},Re={key:1,class:"text-gray-400"},Me={class:"pagination-wrapper"},Se={class:"dialog-footer"},Ie=fe({__name:"index",setup(Fe){const N=f(!1),R=f(!1),w=f(!1),G=f(""),M=f(),V=f("DEFAULT"),Z=[{label:"日本",value:"JA"},{label:"中国",value:"ZH"},{label:"英国",value:"EN"},{label:"斯洛伐克",value:"SK"},{label:"斯洛文尼亚",value:"SI"},{label:"波兰",value:"PL"},{label:"葡萄牙",value:"PT"},{label:"匈牙利",value:"HU"},{label:"意大利",value:"IT"},{label:"西班牙",value:"ES"},{label:"捷克",value:"CZ"}],m=A({name:"",mode:"",is_active:null}),u=A({page:1,size:20,total:0}),S=f([]),q=f([]),n=A({name:"",target_regions:[],mode:"cloak",google_detection_mode:"DEFAULT",spider_whitelist:[],block_pc:0,block_proxy:0,blocked_keywords:[],allowed_countries:[],blocked_countries:[],allowed_organizations:[],blocked_organizations:[],description:"",is_active:1}),H={name:[{required:!0,message:"请输入规则名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],mode:[{required:!0,message:"请选择模式",trigger:"change"}]},J=o=>({cloak:"warning",green:"success",open:"info",audit:"danger"})[o]||"info",Q=o=>({cloak:"斗篷",green:"绿色",open:"全开",audit:"审核"})[o]||o,W=o=>({DEFAULT:"info",GOOGLE_STRICT:"danger",GOOGLE_LENIENT:"success"})[o]||"info",X=o=>({DEFAULT:"默认",GOOGLE_STRICT:"严格",GOOGLE_LENIENT:"宽松"})[o]||o,$=()=>{let o=n.description||"";o=o.replace(/\[GOOGLE_\w+\]/g,""),V.value!=="DEFAULT"&&(o=`[${V.value}] ${o}`.trim()),n.description=o},Y=o=>o.includes("GOOGLE_STRICT")?"GOOGLE_STRICT":o.includes("GOOGLE_LENIENT")?"GOOGLE_LENIENT":"DEFAULT",ee=o=>o?new Date(o).toLocaleString("zh-CN"):"--",C=async()=>{try{N.value=!0;const o={page:u.page,size:u.size,...m},e=await D.getCloakRules(o);e.code===200&&(S.value=e.data.list,u.total=e.data.total)}catch(o){console.error("获取斗篷规则列表失败:",o),y.error("获取斗篷规则列表失败")}finally{N.value=!1}},I=()=>{u.page=1,C()},le=()=>{Object.assign(m,{name:"",mode:"",is_active:null}),I()},te=o=>{u.size=o,u.page=1,C()},ae=o=>{u.page=o,C()},oe=o=>{q.value=o},ne=()=>{G.value="新增斗篷规则",h(),w.value=!0},se=o=>{G.value="编辑斗篷规则",Object.assign(n,{...o,target_regions:o.target_regions||[],spider_whitelist:o.spider_whitelist||[],blocked_keywords:o.blocked_keywords||[],allowed_countries:o.allowed_countries||[],blocked_countries:o.blocked_countries||[],allowed_organizations:o.allowed_organizations||[],blocked_organizations:o.blocked_organizations||[]}),V.value=Y(o.description||""),w.value=!0},de=async o=>{try{y.info(`查看使用规则"${o.name}"的商品功能待实现`)}catch(e){console.error("查看商品失败:",e),y.error("查看商品失败")}},ie=async o=>{try{await Te.confirm(`确定要删除规则"${o.name}"吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await D.deleteCloakRule(o.id)).code===200&&(y.success("删除成功"),C())}catch(e){e!=="cancel"&&(console.error("删除斗篷规则失败:",e),y.error("删除失败"))}},h=()=>{var o;Object.assign(n,{name:"",target_regions:[],mode:"cloak",spider_whitelist:[],block_pc:0,block_proxy:0,blocked_keywords:[],allowed_countries:[],blocked_countries:[],allowed_organizations:[],blocked_organizations:[],redirect_url:"",audit_url:"",description:"",is_active:1}),V.value="DEFAULT",(o=M.value)==null||o.clearValidate()},re=async()=>{var o;try{await((o=M.value)==null?void 0:o.validate()),$(),R.value=!0;const e=G.value.includes("编辑");let b;if(e){const i=n.id;b=await D.updateCloakRule(i,n)}else b=await D.createCloakRule(n);b.code===200&&(y.success(e?"更新成功":"创建成功"),w.value=!1,C())}catch(e){console.error("提交失败:",e),y.error("提交失败")}finally{R.value=!1}},ue=()=>{h()};return be(()=>{C()}),(o,e)=>{const b=d("el-input"),i=d("el-form-item"),p=d("el-option"),O=d("el-select"),g=d("el-button"),B=d("el-form"),j=d("el-card"),pe=d("el-icon"),c=d("el-table-column"),F=d("el-tag"),_e=d("el-table"),ce=d("el-pagination"),E=d("el-col"),x=d("el-row"),r=d("el-radio"),v=d("el-tooltip"),z=d("el-radio-group"),me=d("el-dialog"),ge=ve("loading");return _(),k("div",ze,[l(j,{class:"search-card",shadow:"never"},{default:t(()=>[l(B,{model:m,inline:!0,class:"search-form"},{default:t(()=>[l(i,{label:"规则名称"},{default:t(()=>[l(b,{modelValue:m.name,"onUpdate:modelValue":e[0]||(e[0]=a=>m.name=a),placeholder:"请输入规则名称",clearable:"",style:{width:"200px"},onKeyup:ke(I,["enter"])},null,8,["modelValue"])]),_:1}),l(i,{label:"模式"},{default:t(()=>[l(O,{modelValue:m.mode,"onUpdate:modelValue":e[1]||(e[1]=a=>m.mode=a),placeholder:"请选择模式",clearable:"",style:{width:"150px"}},{default:t(()=>[l(p,{label:"斗篷",value:"cloak"}),l(p,{label:"绿色",value:"green"}),l(p,{label:"全开",value:"open"}),l(p,{label:"审核",value:"audit"})]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"状态"},{default:t(()=>[l(O,{modelValue:m.is_active,"onUpdate:modelValue":e[2]||(e[2]=a=>m.is_active=a),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:t(()=>[l(p,{label:"启用",value:1}),l(p,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),l(i,null,{default:t(()=>[l(g,{type:"primary",onClick:I},{default:t(()=>[...e[16]||(e[16]=[s("搜索",-1)])]),_:1}),l(g,{onClick:le},{default:t(()=>[...e[17]||(e[17]=[s("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(j,{class:"table-card",shadow:"never"},{default:t(()=>[L("div",Le,[e[19]||(e[19]=L("div",{class:"table-title"},"斗篷规则列表",-1)),L("div",Ge,[l(g,{type:"primary",onClick:ne},{default:t(()=>[l(pe,null,{default:t(()=>[l(we(Ve))]),_:1}),e[18]||(e[18]=s(" 新增规则 ",-1))]),_:1})])]),ye((_(),U(_e,{data:S.value,stripe:"",style:{width:"100%"},onSelectionChange:oe},{default:t(()=>[l(c,{type:"selection",width:"55"}),l(c,{prop:"id",label:"ID",width:"80"}),l(c,{prop:"name",label:"规则名称","min-width":"150","show-overflow-tooltip":""}),l(c,{prop:"mode",label:"模式",width:"100",align:"center"},{default:t(({row:a})=>[l(F,{type:J(a.mode)},{default:t(()=>[s(T(Q(a.mode)),1)]),_:2},1032,["type"])]),_:1}),S.value.some(a=>a.mode==="cloak")?(_(),U(c,{key:0,prop:"google_detection_mode",label:"谷歌检测",width:"120",align:"center"},{default:t(({row:a})=>[a.mode==="cloak"?(_(),U(F,{key:0,type:W(a.google_detection_mode)},{default:t(()=>[s(T(X(a.google_detection_mode)),1)]),_:2},1032,["type"])):(_(),k("span",Oe,"--"))]),_:1})):K("",!0),l(c,{prop:"target_regions",label:"投放地区",width:"120","show-overflow-tooltip":""},{default:t(({row:a})=>[a.target_regions&&a.target_regions.length>0?(_(),k("span",Ue,T(a.target_regions.join(", ")),1)):(_(),k("span",De,"--"))]),_:1}),l(c,{prop:"blocked_organizations",label:"屏蔽组织","min-width":"150","show-overflow-tooltip":""},{default:t(({row:a})=>[a.blocked_organizations&&a.blocked_organizations.length>0?(_(),k("span",Ne,T(a.blocked_organizations.join(", ")),1)):(_(),k("span",Re,"--"))]),_:1}),l(c,{prop:"is_active",label:"状态",width:"80",align:"center"},{default:t(({row:a})=>[l(F,{type:a.is_active?"success":"danger"},{default:t(()=>[s(T(a.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(c,{prop:"created_at",label:"创建时间",width:"160"},{default:t(({row:a})=>[s(T(ee(a.created_at)),1)]),_:1}),l(c,{label:"操作",width:"280",fixed:"right"},{default:t(({row:a})=>[l(g,{type:"primary",size:"small",onClick:P=>se(a)},{default:t(()=>[...e[20]||(e[20]=[s(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(g,{type:"warning",size:"small",onClick:P=>de(a)},{default:t(()=>[...e[21]||(e[21]=[s(" 查看商品 ",-1)])]),_:1},8,["onClick"]),l(g,{type:"danger",size:"small",onClick:P=>ie(a)},{default:t(()=>[...e[22]||(e[22]=[s(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ge,N.value]]),L("div",Me,[l(ce,{"current-page":u.page,"onUpdate:currentPage":e[3]||(e[3]=a=>u.page=a),"page-size":u.size,"onUpdate:pageSize":e[4]||(e[4]=a=>u.size=a),total:u.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:te,onCurrentChange:ae},null,8,["current-page","page-size","total"])])]),_:1}),l(me,{modelValue:w.value,"onUpdate:modelValue":e[15]||(e[15]=a=>w.value=a),title:G.value,width:"800px","close-on-click-modal":!1,onClose:ue},{footer:t(()=>[L("div",Se,[l(g,{onClick:e[14]||(e[14]=a=>w.value=!1)},{default:t(()=>[...e[36]||(e[36]=[s("取消",-1)])]),_:1}),l(g,{type:"primary",loading:R.value,onClick:re},{default:t(()=>[...e[37]||(e[37]=[s(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:t(()=>[l(B,{ref_key:"formRef",ref:M,model:n,rules:H,"label-width":"120px",class:"cloak-rule-form"},{default:t(()=>[l(x,{gutter:20},{default:t(()=>[l(E,{span:24},{default:t(()=>[l(i,{label:"规则名称",prop:"name"},{default:t(()=>[l(b,{modelValue:n.name,"onUpdate:modelValue":e[5]||(e[5]=a=>n.name=a),placeholder:"请输入规则名称",maxlength:"50"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(x,{gutter:20},{default:t(()=>[l(E,{span:24},{default:t(()=>[l(i,{label:"模式",prop:"mode"},{default:t(()=>[l(z,{modelValue:n.mode,"onUpdate:modelValue":e[6]||(e[6]=a=>n.mode=a)},{default:t(()=>[l(v,{content:"只有投放地区客户能访问真实链接",placement:"top"},{default:t(()=>[l(r,{value:"cloak"},{default:t(()=>[...e[23]||(e[23]=[s("斗篷",-1)])]),_:1})]),_:1}),l(v,{content:"所有客户访问真实链接",placement:"top"},{default:t(()=>[l(r,{value:"open"},{default:t(()=>[...e[24]||(e[24]=[s("全开",-1)])]),_:1})]),_:1}),l(v,{content:"所有客户访问重定向链接",placement:"top"},{default:t(()=>[l(r,{value:"green"},{default:t(()=>[...e[25]||(e[25]=[s("绿色",-1)])]),_:1})]),_:1}),l(v,{content:"所有客户访问审核页面",placement:"top"},{default:t(()=>[l(r,{value:"audit"},{default:t(()=>[...e[26]||(e[26]=[s("审核",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(x,{gutter:20},{default:t(()=>[l(E,{span:24},{default:t(()=>[l(i,{label:"投放地区"},{default:t(()=>[l(O,{modelValue:n.target_regions,"onUpdate:modelValue":e[7]||(e[7]=a=>n.target_regions=a),multiple:"",placeholder:"请选择投放地区",style:{width:"100%"}},{default:t(()=>[(_(),k(Ce,null,Ee(Z,a=>l(p,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(x,{gutter:20},{default:t(()=>[l(E,{span:24},{default:t(()=>[l(i,{label:"状态"},{default:t(()=>[l(z,{modelValue:n.is_active,"onUpdate:modelValue":e[8]||(e[8]=a=>n.is_active=a)},{default:t(()=>[l(r,{label:1},{default:t(()=>[...e[27]||(e[27]=[s("启用",-1)])]),_:1}),l(r,{label:0},{default:t(()=>[...e[28]||(e[28]=[s("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(i,{label:"屏蔽组织"},{default:t(()=>[l(O,{modelValue:n.blocked_organizations,"onUpdate:modelValue":e[9]||(e[9]=a=>n.blocked_organizations=a),multiple:"",filterable:"","allow-create":"",placeholder:"请输入要屏蔽的组织关键词",style:{width:"100%"}},{default:t(()=>[l(p,{label:"Google",value:"google"}),l(p,{label:"Facebook",value:"facebook"}),l(p,{label:"Amazon",value:"amazon"}),l(p,{label:"Microsoft",value:"microsoft"}),l(p,{label:"Cloudflare",value:"cloudflare"})]),_:1},8,["modelValue"])]),_:1}),n.mode==="cloak"?(_(),U(i,{key:0,label:"谷歌检测模式"},{default:t(()=>[l(z,{modelValue:V.value,"onUpdate:modelValue":e[10]||(e[10]=a=>V.value=a),onChange:$},{default:t(()=>[l(v,{content:"使用系统默认的谷歌检测规则",placement:"top"},{default:t(()=>[l(r,{value:"DEFAULT"},{default:t(()=>[...e[29]||(e[29]=[s("默认",-1)])]),_:1})]),_:1}),l(v,{content:"更激进的过滤规则：严格识别和过滤谷歌爬虫、审核系统，对可疑流量展示合规内容",placement:"top"},{default:t(()=>[l(r,{value:"GOOGLE_STRICT"},{default:t(()=>[...e[30]||(e[30]=[s("谷歌(严格)",-1)])]),_:1})]),_:1}),l(v,{content:"较温和的过滤规则：只过滤明确的谷歌机器人",placement:"top"},{default:t(()=>[l(r,{value:"GOOGLE_LENIENT"},{default:t(()=>[...e[31]||(e[31]=[s("谷歌(宽松)",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})):K("",!0),l(x,{gutter:20},{default:t(()=>[l(E,{span:12},{default:t(()=>[l(i,{label:"屏蔽PC"},{default:t(()=>[l(z,{modelValue:n.block_pc,"onUpdate:modelValue":e[11]||(e[11]=a=>n.block_pc=a)},{default:t(()=>[l(r,{label:0},{default:t(()=>[...e[32]||(e[32]=[s("未开启",-1)])]),_:1}),l(r,{label:1},{default:t(()=>[...e[33]||(e[33]=[s("开启",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(E,{span:12},{default:t(()=>[l(i,{label:"屏蔽代理"},{default:t(()=>[l(z,{modelValue:n.block_proxy,"onUpdate:modelValue":e[12]||(e[12]=a=>n.block_proxy=a)},{default:t(()=>[l(r,{label:0},{default:t(()=>[...e[34]||(e[34]=[s("未开启",-1)])]),_:1}),l(r,{label:1},{default:t(()=>[...e[35]||(e[35]=[s("开启",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(i,{label:"备注"},{default:t(()=>[l(b,{modelValue:n.description,"onUpdate:modelValue":e[13]||(e[13]=a=>n.description=a),type:"textarea",rows:3,placeholder:"请输入备注信息",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Be=xe(Ie,[["__scopeId","data-v-8e3502d0"]]);export{Be as default};
