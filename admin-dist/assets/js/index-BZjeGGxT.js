import{d as ie,h as g,P as j,Z as re,r as d,Q as ue,c as w,o as b,b as e,w as a,_ as pe,e as s,a as z,W as _e,u as ce,$ as me,g as fe,t as C,F as ge,f as be,N as x,a0 as ve}from"./index-2V8v6Wus.js";import{c as D}from"./cloakRule-BGoW6K2n.js";import{_ as ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ye={class:"cloak-rule-list"},we={class:"table-header"},Ve={class:"table-actions"},ze={key:0},Ce={key:1,class:"text-gray-400"},xe={key:0},Ue={key:1,class:"text-gray-400"},he={class:"pagination-wrapper"},Re={class:"dialog-footer"},Se=ie({__name:"index",setup(De){const M=g(!1),T=g(!1),v=g(!1),U=g(""),B=g(),I=[{label:"日本",value:"JA"},{label:"中国",value:"ZH"},{label:"英国",value:"EN"},{label:"斯洛伐克",value:"SK"},{label:"斯洛文尼亚",value:"SI"},{label:"波兰",value:"PL"},{label:"葡萄牙",value:"PT"},{label:"匈牙利",value:"HU"},{label:"意大利",value:"IT"},{label:"西班牙",value:"ES"},{label:"捷克",value:"CZ"}],_=j({name:"",mode:"",is_active:null}),r=j({page:1,size:20,total:0}),N=g([]),L=g([]),n=j({name:"",target_regions:[],mode:"cloak",spider_whitelist:[],block_pc:0,block_proxy:0,blocked_keywords:[],allowed_countries:[],blocked_countries:[],allowed_organizations:[],blocked_organizations:[],description:"",is_active:1}),O={name:[{required:!0,message:"请输入规则名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],mode:[{required:!0,message:"请选择模式",trigger:"change"}]},K=o=>({cloak:"warning",green:"success",open:"info",audit:"danger"})[o]||"info",Z=o=>({cloak:"斗篷",green:"绿色",open:"全开",audit:"审核"})[o]||o,q=o=>o?new Date(o).toLocaleString("zh-CN"):"--",k=async()=>{try{M.value=!0;const o={page:r.page,size:r.size,..._},l=await D.getCloakRules(o);l.code===200&&(N.value=l.data.list,r.total=l.data.total)}catch(o){console.error("获取斗篷规则列表失败:",o),x.error("获取斗篷规则列表失败")}finally{M.value=!1}},E=()=>{r.page=1,k()},H=()=>{Object.assign(_,{name:"",mode:"",is_active:null}),E()},G=o=>{r.size=o,r.page=1,k()},J=o=>{r.page=o,k()},Q=o=>{L.value=o},W=()=>{U.value="新增斗篷规则",F(),v.value=!0},X=o=>{U.value="编辑斗篷规则",Object.assign(n,{...o,target_regions:o.target_regions||[],spider_whitelist:o.spider_whitelist||[],blocked_keywords:o.blocked_keywords||[],allowed_countries:o.allowed_countries||[],blocked_countries:o.blocked_countries||[],allowed_organizations:o.allowed_organizations||[],blocked_organizations:o.blocked_organizations||[]}),v.value=!0},Y=async o=>{try{await ve.confirm(`确定要删除规则"${o.name}"吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await D.deleteCloakRule(o.id)).code===200&&(x.success("删除成功"),k())}catch(l){l!=="cancel"&&(console.error("删除斗篷规则失败:",l),x.error("删除失败"))}},F=()=>{var o;Object.assign(n,{name:"",target_regions:[],mode:"cloak",spider_whitelist:[],block_pc:0,block_proxy:0,blocked_keywords:[],allowed_countries:[],blocked_countries:[],allowed_organizations:[],blocked_organizations:[],redirect_url:"",audit_url:"",description:"",is_active:1}),(o=B.value)==null||o.clearValidate()},ee=async()=>{var o;try{await((o=B.value)==null?void 0:o.validate()),T.value=!0;const l=U.value.includes("编辑");let m;if(l){const i=n.id;m=await D.updateCloakRule(i,n)}else m=await D.createCloakRule(n);m.code===200&&(x.success(l?"更新成功":"创建成功"),v.value=!1,k())}catch(l){console.error("提交失败:",l),x.error("提交失败")}finally{T.value=!1}},le=()=>{F()};return re(()=>{k()}),(o,l)=>{const m=d("el-input"),i=d("el-form-item"),u=d("el-option"),h=d("el-select"),f=d("el-button"),P=d("el-form"),$=d("el-card"),ae=d("el-icon"),c=d("el-table-column"),A=d("el-tag"),te=d("el-table"),oe=d("el-pagination"),y=d("el-col"),V=d("el-row"),p=d("el-radio"),R=d("el-tooltip"),S=d("el-radio-group"),ne=d("el-dialog"),se=ue("loading");return b(),w("div",ye,[e($,{class:"search-card",shadow:"never"},{default:a(()=>[e(P,{model:_,inline:!0,class:"search-form"},{default:a(()=>[e(i,{label:"规则名称"},{default:a(()=>[e(m,{modelValue:_.name,"onUpdate:modelValue":l[0]||(l[0]=t=>_.name=t),placeholder:"请输入规则名称",clearable:"",style:{width:"200px"},onKeyup:pe(E,["enter"])},null,8,["modelValue"])]),_:1}),e(i,{label:"模式"},{default:a(()=>[e(h,{modelValue:_.mode,"onUpdate:modelValue":l[1]||(l[1]=t=>_.mode=t),placeholder:"请选择模式",clearable:"",style:{width:"150px"}},{default:a(()=>[e(u,{label:"斗篷",value:"cloak"}),e(u,{label:"绿色",value:"green"}),e(u,{label:"全开",value:"open"}),e(u,{label:"审核",value:"audit"})]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"状态"},{default:a(()=>[e(h,{modelValue:_.is_active,"onUpdate:modelValue":l[2]||(l[2]=t=>_.is_active=t),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:a(()=>[e(u,{label:"启用",value:1}),e(u,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),e(i,null,{default:a(()=>[e(f,{type:"primary",onClick:E},{default:a(()=>[...l[15]||(l[15]=[s("搜索",-1)])]),_:1}),e(f,{onClick:H},{default:a(()=>[...l[16]||(l[16]=[s("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e($,{class:"table-card",shadow:"never"},{default:a(()=>[z("div",we,[l[18]||(l[18]=z("div",{class:"table-title"},"斗篷规则列表",-1)),z("div",Ve,[e(f,{type:"primary",onClick:W},{default:a(()=>[e(ae,null,{default:a(()=>[e(ce(me))]),_:1}),l[17]||(l[17]=s(" 新增规则 ",-1))]),_:1})])]),_e((b(),fe(te,{data:N.value,stripe:"",style:{width:"100%"},onSelectionChange:Q},{default:a(()=>[e(c,{type:"selection",width:"55"}),e(c,{prop:"id",label:"ID",width:"80"}),e(c,{prop:"name",label:"规则名称","min-width":"150","show-overflow-tooltip":""}),e(c,{prop:"mode",label:"模式",width:"100",align:"center"},{default:a(({row:t})=>[e(A,{type:K(t.mode)},{default:a(()=>[s(C(Z(t.mode)),1)]),_:2},1032,["type"])]),_:1}),e(c,{prop:"target_regions",label:"投放地区",width:"120","show-overflow-tooltip":""},{default:a(({row:t})=>[t.target_regions&&t.target_regions.length>0?(b(),w("span",ze,C(t.target_regions.join(", ")),1)):(b(),w("span",Ce,"--"))]),_:1}),e(c,{prop:"blocked_organizations",label:"屏蔽组织","min-width":"150","show-overflow-tooltip":""},{default:a(({row:t})=>[t.blocked_organizations&&t.blocked_organizations.length>0?(b(),w("span",xe,C(t.blocked_organizations.join(", ")),1)):(b(),w("span",Ue,"--"))]),_:1}),e(c,{prop:"is_active",label:"状态",width:"80",align:"center"},{default:a(({row:t})=>[e(A,{type:t.is_active?"success":"danger"},{default:a(()=>[s(C(t.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),e(c,{prop:"created_at",label:"创建时间",width:"160"},{default:a(({row:t})=>[s(C(q(t.created_at)),1)]),_:1}),e(c,{label:"操作",width:"200",fixed:"right"},{default:a(({row:t})=>[e(f,{type:"primary",size:"small",onClick:de=>X(t)},{default:a(()=>[...l[19]||(l[19]=[s(" 编辑 ",-1)])]),_:1},8,["onClick"]),e(f,{type:"danger",size:"small",onClick:de=>Y(t)},{default:a(()=>[...l[20]||(l[20]=[s(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[se,M.value]]),z("div",he,[e(oe,{"current-page":r.page,"onUpdate:currentPage":l[3]||(l[3]=t=>r.page=t),"page-size":r.size,"onUpdate:pageSize":l[4]||(l[4]=t=>r.size=t),total:r.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:G,onCurrentChange:J},null,8,["current-page","page-size","total"])])]),_:1}),e(ne,{modelValue:v.value,"onUpdate:modelValue":l[14]||(l[14]=t=>v.value=t),title:U.value,width:"800px","close-on-click-modal":!1,onClose:le},{footer:a(()=>[z("div",Re,[e(f,{onClick:l[13]||(l[13]=t=>v.value=!1)},{default:a(()=>[...l[31]||(l[31]=[s("取消",-1)])]),_:1}),e(f,{type:"primary",loading:T.value,onClick:ee},{default:a(()=>[...l[32]||(l[32]=[s(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:a(()=>[e(P,{ref_key:"formRef",ref:B,model:n,rules:O,"label-width":"120px",class:"cloak-rule-form"},{default:a(()=>[e(V,{gutter:20},{default:a(()=>[e(y,{span:24},{default:a(()=>[e(i,{label:"规则名称",prop:"name"},{default:a(()=>[e(m,{modelValue:n.name,"onUpdate:modelValue":l[5]||(l[5]=t=>n.name=t),placeholder:"请输入规则名称",maxlength:"50"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(V,{gutter:20},{default:a(()=>[e(y,{span:24},{default:a(()=>[e(i,{label:"模式",prop:"mode"},{default:a(()=>[e(S,{modelValue:n.mode,"onUpdate:modelValue":l[6]||(l[6]=t=>n.mode=t)},{default:a(()=>[e(R,{content:"只有投放地区客户能访问真实链接",placement:"top"},{default:a(()=>[e(p,{value:"cloak"},{default:a(()=>[...l[21]||(l[21]=[s("斗篷",-1)])]),_:1})]),_:1}),e(R,{content:"所有客户访问真实链接",placement:"top"},{default:a(()=>[e(p,{value:"open"},{default:a(()=>[...l[22]||(l[22]=[s("全开",-1)])]),_:1})]),_:1}),e(R,{content:"所有客户访问重定向链接",placement:"top"},{default:a(()=>[e(p,{value:"green"},{default:a(()=>[...l[23]||(l[23]=[s("绿色",-1)])]),_:1})]),_:1}),e(R,{content:"所有客户访问审核页面",placement:"top"},{default:a(()=>[e(p,{value:"audit"},{default:a(()=>[...l[24]||(l[24]=[s("审核",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(V,{gutter:20},{default:a(()=>[e(y,{span:24},{default:a(()=>[e(i,{label:"投放地区"},{default:a(()=>[e(h,{modelValue:n.target_regions,"onUpdate:modelValue":l[7]||(l[7]=t=>n.target_regions=t),multiple:"",placeholder:"请选择投放地区",style:{width:"100%"}},{default:a(()=>[(b(),w(ge,null,be(I,t=>e(u,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(V,{gutter:20},{default:a(()=>[e(y,{span:24},{default:a(()=>[e(i,{label:"状态"},{default:a(()=>[e(S,{modelValue:n.is_active,"onUpdate:modelValue":l[8]||(l[8]=t=>n.is_active=t)},{default:a(()=>[e(p,{label:1},{default:a(()=>[...l[25]||(l[25]=[s("启用",-1)])]),_:1}),e(p,{label:0},{default:a(()=>[...l[26]||(l[26]=[s("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(i,{label:"屏蔽组织"},{default:a(()=>[e(h,{modelValue:n.blocked_organizations,"onUpdate:modelValue":l[9]||(l[9]=t=>n.blocked_organizations=t),multiple:"",filterable:"","allow-create":"",placeholder:"请输入要屏蔽的组织关键词",style:{width:"100%"}},{default:a(()=>[e(u,{label:"Google",value:"google"}),e(u,{label:"Facebook",value:"facebook"}),e(u,{label:"Amazon",value:"amazon"}),e(u,{label:"Microsoft",value:"microsoft"}),e(u,{label:"Cloudflare",value:"cloudflare"})]),_:1},8,["modelValue"])]),_:1}),e(V,{gutter:20},{default:a(()=>[e(y,{span:12},{default:a(()=>[e(i,{label:"屏蔽PC"},{default:a(()=>[e(S,{modelValue:n.block_pc,"onUpdate:modelValue":l[10]||(l[10]=t=>n.block_pc=t)},{default:a(()=>[e(p,{label:0},{default:a(()=>[...l[27]||(l[27]=[s("未开启",-1)])]),_:1}),e(p,{label:1},{default:a(()=>[...l[28]||(l[28]=[s("开启",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(y,{span:12},{default:a(()=>[e(i,{label:"屏蔽代理"},{default:a(()=>[e(S,{modelValue:n.block_proxy,"onUpdate:modelValue":l[11]||(l[11]=t=>n.block_proxy=t)},{default:a(()=>[e(p,{label:0},{default:a(()=>[...l[29]||(l[29]=[s("未开启",-1)])]),_:1}),e(p,{label:1},{default:a(()=>[...l[30]||(l[30]=[s("开启",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(i,{label:"备注"},{default:a(()=>[e(m,{modelValue:n.description,"onUpdate:modelValue":l[12]||(l[12]=t=>n.description=t),type:"textarea",rows:3,placeholder:"请输入备注信息",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Ee=ke(Se,[["__scopeId","data-v-825c557f"]]);export{Ee as default};
