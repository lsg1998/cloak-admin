import{d as Q,h as x,P as q,Z as pe,r as n,Q as me,c as fe,o as A,b as e,w as l,_ as j,u as d,x as K,ax as E,e as r,E as O,W as ce,a as i,g as I,t as w,aB as _e,ar as ge,as as ve,U as be,$ as we,R as ye,aM as Ve,bq as L,a0 as he,N as g}from"./index-BD29NrMW.js";import{l as xe,u as F,m as Ce,n as ze}from"./user-DvWp0lqX.js";import{_ as ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ue={class:"user-management"},Pe={class:"table-header"},Be={class:"table-title"},De={class:"table-actions"},Se={class:"user-info"},qe={class:"username"},Ae={class:"email-info"},Ee={class:"time-info"},Ne={class:"time-info"},Re={class:"action-buttons"},$e={class:"pagination-wrapper"},Me={class:"dialog-footer"},Te=Q({name:"accountManage"}),je=Q({...Te,setup(Ke){const U=x(!1),P=x(!1),y=x(!1),B=x(""),D=x(),m=q({username:"",email:"",status:null}),p=q({current:1,size:20,total:0}),N=x([]),o=q({id:null,username:"",email:"",password:"",confirmPassword:"",role:"viewer",status:1}),W={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(s,a,u)=>{a!==o.password?u(new Error("两次输入的密码不一致")):u()},trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}]},Z=s=>({admin:"danger",editor:"warning",viewer:"info"})[s]||"info",G=s=>({admin:"超级管理员",editor:"编辑员",viewer:"查看员"})[s]||s,z=()=>{p.current=1,v()},H=()=>{Object.assign(m,{username:"",email:"",status:null}),z()},J=()=>{B.value="添加用户",Object.assign(o,{id:null,username:"",email:"",password:"",confirmPassword:"",role:"viewer",status:1}),y.value=!0},X=s=>{B.value="编辑用户",Object.assign(o,{...s,confirmPassword:""}),y.value=!0},Y=s=>{he.confirm(`确定要删除用户 "${s.username}" 吗？删除后无法恢复！`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"}).then(async()=>{try{await xe(s.id),g.success("删除成功"),v()}catch{g.error("删除失败")}})},ee=async s=>{try{await F(s.id,{status:s.status}),g.success(s.status?"用户已启用":"用户已禁用")}catch{g.error("状态更新失败"),s.status=s.status?0:1}},le=async()=>{D.value&&D.value.validate(async s=>{if(s){P.value=!0;try{const a={...o};delete a.confirmPassword,o.id?(await F(o.id,a),g.success("更新成功")):(await Ce(a),g.success("添加成功")),y.value=!1,v()}catch{g.error(o.id?"更新失败":"添加失败")}finally{P.value=!1}}})},ae=s=>{p.size=s,v()},te=s=>{p.current=s,v()},v=async()=>{U.value=!0;try{const s={page:p.current,size:p.size,username:m.username||void 0,email:m.email||void 0,status:m.status||void 0},{data:a}=await ze(s);N.value=a.list,p.total=a.total}catch{g.error("获取用户列表失败")}finally{U.value=!1}};return pe(()=>{v()}),(s,a)=>{const u=n("el-icon"),V=n("el-input"),f=n("el-form-item"),C=n("el-option"),R=n("el-select"),c=n("el-button"),$=n("el-form"),M=n("el-card"),b=n("el-tag"),_=n("el-table-column"),se=n("el-avatar"),oe=n("el-switch"),ne=n("el-table"),re=n("el-pagination"),h=n("el-col"),S=n("el-row"),T=n("el-radio"),de=n("el-radio-group"),ie=n("el-dialog"),ue=me("loading");return A(),fe("div",Ue,[e(M,{class:"search-card",shadow:"never"},{default:l(()=>[e($,{model:m,inline:"",class:"search-form"},{default:l(()=>[e(f,{label:"用户名"},{default:l(()=>[e(V,{modelValue:m.username,"onUpdate:modelValue":a[0]||(a[0]=t=>m.username=t),placeholder:"请输入用户名",clearable:"",style:{width:"200px"},onKeyup:j(z,["enter"])},{prefix:l(()=>[e(u,null,{default:l(()=>[e(d(K))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(f,{label:"邮箱"},{default:l(()=>[e(V,{modelValue:m.email,"onUpdate:modelValue":a[1]||(a[1]=t=>m.email=t),placeholder:"请输入邮箱",clearable:"",style:{width:"200px"},onKeyup:j(z,["enter"])},{prefix:l(()=>[e(u,null,{default:l(()=>[e(d(E))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(f,{label:"状态"},{default:l(()=>[e(R,{modelValue:m.status,"onUpdate:modelValue":a[2]||(a[2]=t=>m.status=t),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:l(()=>[e(C,{label:"启用",value:1}),e(C,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),e(f,null,{default:l(()=>[e(c,{type:"primary",onClick:z},{default:l(()=>[e(u,null,{default:l(()=>[e(d(K))]),_:1}),a[13]||(a[13]=r(" 搜索 ",-1))]),_:1}),e(c,{onClick:H},{default:l(()=>[e(u,null,{default:l(()=>[e(d(O))]),_:1}),a[14]||(a[14]=r(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(M,{class:"table-card",shadow:"never"},{header:l(()=>[i("div",Pe,[i("div",Be,[e(c,{type:"primary",onClick:J},{default:l(()=>[e(u,null,{default:l(()=>[e(d(we))]),_:1}),a[15]||(a[15]=r(" 添加用户 ",-1))]),_:1}),a[16]||(a[16]=i("span",null,"用户列表",-1)),e(b,{type:"info",size:"small"},{default:l(()=>[r(w(p.total)+" 条记录",1)]),_:1})]),i("div",De,[e(c,{size:"small",onClick:v},{default:l(()=>[e(u,null,{default:l(()=>[e(d(O))]),_:1}),a[17]||(a[17]=r(" 刷新 ",-1))]),_:1})])])]),default:l(()=>[ce((A(),I(ne,{data:N.value,stripe:"",border:"",style:{width:"100%"},"header-cell-style":{background:"#f8f9fa",color:"#606266"}},{default:l(()=>[e(_,{prop:"id",label:"ID",width:"80",align:"center"}),e(_,{prop:"username",label:"用户名",width:"120","show-overflow-tooltip":""},{default:l(({row:t})=>[i("div",Se,[e(se,{size:32,src:t.avatar,class:"user-avatar"},{default:l(()=>[r(w(t.username.charAt(0).toUpperCase()),1)]),_:2},1032,["src"]),i("span",qe,w(t.username),1)])]),_:1}),e(_,{prop:"email",label:"邮箱",width:"200","show-overflow-tooltip":""},{default:l(({row:t})=>[i("div",Ae,[e(u,{class:"email-icon"},{default:l(()=>[e(d(E))]),_:1}),i("span",null,w(t.email),1)])]),_:1}),e(_,{prop:"role",label:"角色",width:"120",align:"center"},{default:l(({row:t})=>[e(b,{type:Z(t.role),size:"small",effect:"light"},{default:l(()=>[r(w(G(t.role)),1)]),_:2},1032,["type"])]),_:1}),e(_,{prop:"status",label:"状态",width:"100",align:"center"},{default:l(({row:t})=>[e(oe,{modelValue:t.status,"onUpdate:modelValue":k=>t.status=k,"active-value":1,"inactive-value":0,onChange:k=>ee(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(_,{prop:"last_login",label:"最后登录",width:"180","show-overflow-tooltip":""},{default:l(({row:t})=>[i("div",Ee,[e(u,{class:"time-icon"},{default:l(()=>[e(d(_e))]),_:1}),i("span",null,w(t.last_login||"从未登录"),1)])]),_:1}),e(_,{prop:"created_at",label:"创建时间",width:"180","show-overflow-tooltip":""},{default:l(({row:t})=>[i("div",Ne,[e(u,{class:"time-icon"},{default:l(()=>[e(d(ge))]),_:1}),i("span",null,w(t.created_at),1)])]),_:1}),e(_,{label:"操作",width:"200",fixed:"right",align:"center"},{default:l(({row:t})=>[i("div",Re,[e(c,{size:"small",type:"primary",link:"",onClick:k=>X(t)},{default:l(()=>[e(u,null,{default:l(()=>[e(d(ve))]),_:1}),a[18]||(a[18]=r(" 编辑 ",-1))]),_:1},8,["onClick"]),e(c,{size:"small",type:"danger",link:"",onClick:k=>Y(t)},{default:l(()=>[e(u,null,{default:l(()=>[e(d(be))]),_:1}),a[19]||(a[19]=r(" 删除 ",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[ue,U.value]]),i("div",$e,[e(re,{"current-page":p.current,"onUpdate:currentPage":a[3]||(a[3]=t=>p.current=t),"page-size":p.size,"onUpdate:pageSize":a[4]||(a[4]=t=>p.size=t),"page-sizes":[10,20,50,100],total:p.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ae,onCurrentChange:te},null,8,["current-page","page-size","total"])])]),_:1}),e(ie,{modelValue:y.value,"onUpdate:modelValue":a[12]||(a[12]=t=>y.value=t),title:B.value,width:"600px","close-on-click-modal":!1,"destroy-on-close":""},{footer:l(()=>[i("div",Me,[e(c,{onClick:a[11]||(a[11]=t=>y.value=!1)},{default:l(()=>[...a[25]||(a[25]=[r("取消",-1)])]),_:1}),e(c,{type:"primary",onClick:le,loading:P.value},{default:l(()=>[...a[26]||(a[26]=[r(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:l(()=>[e($,{model:o,rules:W,ref_key:"formRef",ref:D,"label-width":"100px",class:"user-form"},{default:l(()=>[e(S,{gutter:20},{default:l(()=>[e(h,{span:12},{default:l(()=>[e(f,{label:"用户名",prop:"username"},{default:l(()=>[e(V,{modelValue:o.username,"onUpdate:modelValue":a[5]||(a[5]=t=>o.username=t),placeholder:"请输入用户名","prefix-icon":d(Ve)},null,8,["modelValue","prefix-icon"])]),_:1})]),_:1}),e(h,{span:12},{default:l(()=>[e(f,{label:"邮箱",prop:"email"},{default:l(()=>[e(V,{modelValue:o.email,"onUpdate:modelValue":a[6]||(a[6]=t=>o.email=t),placeholder:"请输入邮箱","prefix-icon":d(E)},null,8,["modelValue","prefix-icon"])]),_:1})]),_:1})]),_:1}),o.id?ye("",!0):(A(),I(S,{key:0,gutter:20},{default:l(()=>[e(h,{span:12},{default:l(()=>[e(f,{label:"密码",prop:"password"},{default:l(()=>[e(V,{modelValue:o.password,"onUpdate:modelValue":a[7]||(a[7]=t=>o.password=t),type:"password",placeholder:"请输入密码","show-password":"","prefix-icon":d(L)},null,8,["modelValue","prefix-icon"])]),_:1})]),_:1}),e(h,{span:12},{default:l(()=>[e(f,{label:"确认密码",prop:"confirmPassword"},{default:l(()=>[e(V,{modelValue:o.confirmPassword,"onUpdate:modelValue":a[8]||(a[8]=t=>o.confirmPassword=t),type:"password",placeholder:"请确认密码","show-password":"","prefix-icon":d(L)},null,8,["modelValue","prefix-icon"])]),_:1})]),_:1})]),_:1})),e(S,{gutter:20},{default:l(()=>[e(h,{span:12},{default:l(()=>[e(f,{label:"角色",prop:"role"},{default:l(()=>[e(R,{modelValue:o.role,"onUpdate:modelValue":a[9]||(a[9]=t=>o.role=t),placeholder:"请选择角色",style:{width:"100%"}},{default:l(()=>[e(C,{label:"超级管理员",value:"admin"},{default:l(()=>[e(b,{type:"danger",size:"small"},{default:l(()=>[...a[20]||(a[20]=[r("超级管理员",-1)])]),_:1})]),_:1}),e(C,{label:"编辑员",value:"editor"},{default:l(()=>[e(b,{type:"warning",size:"small"},{default:l(()=>[...a[21]||(a[21]=[r("编辑员",-1)])]),_:1})]),_:1}),e(C,{label:"查看员",value:"viewer"},{default:l(()=>[e(b,{type:"info",size:"small"},{default:l(()=>[...a[22]||(a[22]=[r("查看员",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(h,{span:12},{default:l(()=>[e(f,{label:"状态",prop:"status"},{default:l(()=>[e(de,{modelValue:o.status,"onUpdate:modelValue":a[10]||(a[10]=t=>o.status=t)},{default:l(()=>[e(T,{label:1},{default:l(()=>[e(b,{type:"success",size:"small"},{default:l(()=>[...a[23]||(a[23]=[r("启用",-1)])]),_:1})]),_:1}),e(T,{label:0},{default:l(()=>[e(b,{type:"danger",size:"small"},{default:l(()=>[...a[24]||(a[24]=[r("禁用",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Fe=ke(je,[["__scopeId","data-v-081069c1"]]);export{Fe as default};
