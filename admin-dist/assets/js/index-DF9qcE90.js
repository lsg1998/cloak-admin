import{a5 as P,d as qe,h as m,P as oe,Z as Ye,r as p,Q as He,c as r,o as i,b as s,a as t,w as a,_ as Je,g as I,q as he,u as b,aK as Xe,x as ke,e as c,aY as Ze,t as n,aU as et,aO as tt,bn as st,aN as at,bo as lt,bp as ot,F as ne,f as ie,W as re,E as ze,n as nt,R as B,aB as it,ay as rt,N as k,a0 as dt}from"./index-D1XermCW.js";import{g as ut}from"./product-Drqu-ObM.js";import{_ as ct}from"./_plugin-vue_export-helper-DlAUqK2U.js";const K={getVisitorIps:y=>P.get("/admin/statistics/visitor-ips",y),getVisitorIp:y=>P.get(`/admin/statistics/visitor-ips/${y}`),getIpStatistics:y=>P.get("/admin/statistics/visitor-ips-stats",y),deleteVisitorIp:y=>P.delete(`/admin/statistics/visitor-ips/${y}`),syncBehaviorData:()=>P.post("/admin/statistics/sync-behavior-data")},Ce={getSummary:y=>P.get("/admin/user-behavior/summary",y),getTimeline:y=>P.get("/admin/user-behavior/timeline",y),fetchFromRedis:y=>P.get("/admin/user-behavior/fetch-from-redis",{ip:y})},pt={class:"visitor-ip-list"},_t={class:"statistics-title"},ft={class:"stat-content"},vt={class:"stat-value"},mt={class:"stat-icon"},yt={class:"stat-content"},gt={class:"stat-value"},bt={class:"stat-icon"},ht={class:"stat-content"},kt={class:"stat-value"},zt={class:"stat-icon"},Ct={class:"stat-content"},xt={class:"stat-value"},It={class:"stat-icon"},St={class:"stat-content"},Vt={class:"stat-value"},Tt={class:"stat-icon"},wt={class:"stat-content"},Pt={class:"stat-value"},Lt={class:"stat-icon"},Bt={class:"source-stats-list"},Dt={class:"source-name"},At={class:"source-count"},Mt={class:"count-value"},Rt={class:"table-header"},Ut={class:"table-actions"},Nt={class:"ip-list"},Ft={class:"ip-header"},$t={class:"ip-address"},Et={class:"ip-actions"},Ot={class:"ip-content"},Kt={class:"ip-section"},jt={class:"address-info"},Gt={class:"address-line"},Qt={class:"value"},Wt={class:"address-line"},qt={class:"value"},Yt={class:"address-line"},Ht=["title"],Jt={class:"address-line"},Xt=["title"],Zt={class:"ip-section"},es={class:"organization-info"},ts={class:"org-line"},ss={class:"value"},as={class:"org-line"},ls=["title"],os={class:"org-line"},ns={class:"value"},is={class:"org-line"},rs={class:"value"},ds={class:"org-line"},us={class:"value"},cs={class:"org-line"},ps={class:"value"},_s={class:"org-tags"},fs={class:"ip-section"},vs={class:"basic-type"},ms={class:"type-line"},ys={class:"type-line"},gs={class:"value"},bs={class:"type-line"},hs={class:"value"},ks={class:"type-line"},zs={key:1,class:"value"},Cs={class:"type-line"},xs={key:1,class:"value"},Is={class:"ip-section"},Ss={class:"behavior-info"},Vs={class:"behavior-summary"},Ts={key:0,class:"duration-text"},ws={key:1,class:"no-data-text"},Ps={class:"behavior-actions"},Ls={key:0,class:"ip-section"},Bs={class:"detailed-type"},Ds={class:"type-line"},As={class:"type-line"},Ms={class:"value"},Rs={class:"type-line"},Us={class:"value"},Ns={class:"pagination-wrapper"},Fs={class:"product-select-dialog"},$s={key:0,class:"ip-detail"},Es={key:0},Os={key:1,class:"text-gray-400"},Ks={key:0},js={key:1,class:"text-gray-400"},Gs={key:0},Qs={key:1,class:"text-gray-400"},Ws={key:0},qs={key:1,class:"text-gray-400"},Ys={key:0},Hs={key:1,class:"text-gray-400"},Js={key:0},Xs={key:1,class:"text-gray-400"},Zs={key:0},ea={key:1,class:"text-gray-400"},ta={key:0},sa={key:1,class:"text-gray-400"},aa={key:0,class:"referer-info"},la={key:1,class:"text-gray-400"},oa={key:0,class:"referer-info"},na={key:1,class:"text-gray-400"},ia={key:1,class:"text-gray-400"},ra={key:0,class:"location-info"},da={class:"timeline-container"},ua={key:0,class:"timeline-content"},ca={class:"timeline-header"},pa={class:"timeline-list"},_a={class:"timeline-item-content"},fa={class:"action-description"},va={class:"action-text"},ma={key:0,class:"action-detail"},ya=qe({__name:"index",setup(y){const j=m(!1),G=m(!1),Q=m(!1),d=m(null),W=m(!1),q=m(!1),C=m(null),g=oe({ip:"",timeRange:"today",visitorType:"",productId:""}),R=m(!1),Y=m(!1),H=m([]),U=m([]),N=m(""),D=m(""),V=oe({page:1,size:20,total:0}),z=oe({page:1,size:20,total:0}),J=m([]),T=m({totalIps:0,todayIps:0,totalCountries:0,totalCities:0,genuineCount:0,fakeCount:0,countryStats:[],cityStats:[],productTypeStats:[],sourceStats:[]}),X=l=>l?new Date(l).toLocaleString("zh-CN"):"--",xe=l=>{const e=[];return l.country&&e.push(l.country),l.region&&e.push(l.region),l.city&&e.push(l.city),e.length>0?e.join(" - "):null},F=l=>{const e=["proxy","vpn","tor","anonymizer"],u=(l.organization||"").toLowerCase();return e.some(f=>u.includes(f))},Ie=l=>{const e=["amazon","google","microsoft","cloudflare","digitalocean","linode","vultr","aws","gcp","azure"],u=(l.organization||"").toLowerCase();return e.some(f=>u.includes(f))},de=l=>A(l)?"爬虫":F(l)?"代理":"访客",ue=l=>A(l)?"primary":F(l)?"warning":"success",Z=l=>{const e=["google","facebook","twitter","linkedin","microsoft","bytedance","tiktok"],u=(l.organization||"").toLowerCase(),f=(l.user_agent||"").trim(),h=e.some(v=>u.includes(v)),E=!f||f.length<20;return h&&E},A=l=>{if(Z(l))return!0;const e=["bot","crawler","spider","scraper","crawl","googlebot","bingbot","slurp","duckduckbot","facebook","facebookexternalhit","facebot","twitter","twitterbot","linkedin","linkedinbot","whatsapp","telegrambot","bytedance","bytespider","semrush","ahrefs","mj12bot","petalbot","yandex","baidu"],u=(l.user_agent||"").toLowerCase(),f=(l.organization||"").toLowerCase();return e.some(h=>u.includes(h)||f.includes(h))},Se=l=>{const e=l.user_agent||"";return e.includes("Mobile")?"Mobile":e.includes("Tablet")?"Tablet":e.includes("Desktop")?"Desktop":null},Ve=l=>{const e=l.user_agent||"";return e.includes("Android")?"Android":e.includes("iOS")||e.includes("iPhone")||e.includes("iPad")?"iOS":e.includes("Windows")?"Windows":e.includes("Mac")?"macOS":e.includes("Linux")?"Linux":null},Te=l=>{const e=(l.user_agent||"").toLowerCase(),u=(l.organization||"").toLowerCase();return Z(l)?u.includes("google")?"Google 审核爬虫":u.includes("facebook")?"Facebook 审核爬虫":u.includes("twitter")?"Twitter 审核爬虫":u.includes("linkedin")?"LinkedIn 审核爬虫":u.includes("microsoft")?"Microsoft 审核爬虫":u.includes("bytedance")||u.includes("tiktok")?"TikTok 审核爬虫":"审核爬虫":e.includes("googlebot")||u.includes("google")&&e.includes("bot")?"Googlebot":e.includes("bingbot")||u.includes("microsoft")&&e.includes("bot")?"BingBot":e.includes("facebook")?"Facebook Crawler":e.includes("twitter")?"Twitter Bot":e.includes("ahrefs")||u.includes("ahrefs")?"aHrefs Bot":e.includes("httpx")?"httpx":e.includes("barkrowler")?"Barkrowler":A(l)?"通用爬虫":null},we=l=>{const e=(l.user_agent||"").toLowerCase(),u=(l.organization||"").toLowerCase();return Z(l)?"广告/内容合规审核（无UA或异常UA）":e.includes("googlebot")||u.includes("google")&&e.includes("bot")||e.includes("bingbot")||u.includes("microsoft")&&e.includes("bot")?"搜索引擎蜘蛛":e.includes("facebook")||e.includes("twitter")?"社交媒体爬虫":e.includes("ahrefs")||u.includes("ahrefs")?"SEO分析爬虫":A(l)?"通用网络爬虫":null},ce=l=>({A:"primary",B:"success",C:"warning",D:"danger",E:"info"})[l]||"info",pe=l=>({A:"A页",B:"B页",C:"C页",D:"D页",E:"E页"})[l]||l,Pe=l=>({YouTube:"danger","Android App":"success",Google:"primary",Facebook:"primary",Instagram:"warning",TikTok:"danger","Twitter/X":"info",直接访问:"info",其他:""})[l]||"info",Le=()=>({today:"今天",yesterday:"昨天",week:"本周",month:"本月",all:"全部时间"})[g.timeRange]||"今天",M=async()=>{try{j.value=!0;const l={page:z.page,size:z.size,...g},e=await K.getVisitorIps(l);e.code===200&&(J.value=e.data.list,z.total=e.data.total)}catch(l){console.error("获取访客IP列表失败:",l),k.error("获取访客IP列表失败")}finally{j.value=!1}},$=async()=>{try{const l=await K.getIpStatistics({timeRange:g.timeRange||"today"});l.code===200&&(T.value=l.data)}catch(l){console.error("获取统计数据失败:",l),k.error("获取统计数据失败")}},ee=()=>{z.page=1,M(),$()},Be=()=>{Object.assign(g,{ip:"",timeRange:"today",visitorType:"",productId:""}),D.value="",ee()},te=async()=>{try{Y.value=!0;const{data:l}=await ut({page:V.page,size:V.size});H.value=l.list||[],U.value=l.list||[],V.total=l.total||0}catch{k.error("加载商品列表失败")}finally{Y.value=!1}},De=()=>{if(!N.value){U.value=H.value;return}const l=N.value.toLowerCase();U.value=H.value.filter(e=>{var u,f;return((u=e.title)==null?void 0:u.toLowerCase().includes(l))||((f=e.spu_id)==null?void 0:f.toLowerCase().includes(l))})},_e=l=>{g.productId=l.spu_id,D.value=l.title,R.value=!1,k.success(`已选择商品: ${l.title}`)},Ae=()=>{g.productId="",D.value=""},Me=async()=>{try{await dt.confirm("确定要同步Redis中的用户行为数据到MySQL吗？","同步确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),G.value=!0;const{data:l}=await K.syncBehaviorData();l.successCount>0?(k.success(`同步完成！成功: ${l.successCount} 条，失败: ${l.failCount} 条`),await Promise.all([M(),$()])):k.info("没有数据需要同步")}catch(l){l!=="cancel"&&k.error(l.message||"同步失败")}finally{G.value=!1}},Re=l=>{z.size=l,z.page=1,M()},Ue=l=>{z.page=l,M()},Ne=async l=>{try{const e=await K.getVisitorIp(l.ip_address);e.code===200&&(d.value=e.data,Q.value=!0)}catch(e){console.error("获取IP详情失败:",e),k.error("获取IP详情失败")}},Fe=async l=>{try{const e=await Ce.fetchFromRedis(l.ip_address);e.code===200&&(e.data?(l.behaviorSummary=e.data,k.success("获取成功（来自Redis）")):k.info("Redis中暂无该IP的轨迹数据"))}catch(e){console.error("从Redis获取数据失败:",e),k.error("获取失败")}},$e=async l=>{try{if(!l.behaviorSummary){k.warning("该IP暂无行为轨迹数据");return}q.value=!0,W.value=!0,C.value=null;const e={sessionId:l.behaviorSummary.sessionId,ip:l.ip_address,productId:l.behaviorSummary.productId,date:l.behaviorSummary.visitDate.replace(/-/g,"")},u=await Ce.getTimeline(e);u.code===200&&(C.value=u.data)}catch(e){console.error("获取用户行为轨迹失败:",e),k.error("获取用户行为轨迹失败")}finally{q.value=!1}},Ee=l=>({enter:"success",leave:"info",scroll:"primary",click_sku:"warning",select_province:"warning",select_city:"warning",fill_name:"warning",fill_phone:"warning",submit_order:"danger",order_success:"success",order_fail:"danger"})[l]||"info",Oe=l=>({enter:"success",leave:"info",scroll:"",click_sku:"warning",select_province:"primary",select_city:"primary",fill_name:"warning",fill_phone:"warning",submit_order:"danger",order_success:"success",order_fail:"danger"})[l]||"info";return Ye(()=>{M(),$(),te()}),(l,e)=>{const u=p("el-input"),f=p("el-form-item"),h=p("el-option"),E=p("el-select"),v=p("el-icon"),w=p("el-button"),Ke=p("el-form"),S=p("el-card"),L=p("el-col"),fe=p("el-row"),x=p("el-tag"),ve=p("el-pagination"),se=p("el-table-column"),je=p("el-table"),ae=p("el-dialog"),_=p("el-descriptions-item"),me=p("el-link"),ye=p("el-descriptions"),O=p("el-text"),Ge=p("el-timeline-item"),Qe=p("el-timeline"),We=p("el-empty"),le=He("loading");return i(),r("div",pt,[s(S,{class:"search-card",shadow:"never"},{default:a(()=>[s(Ke,{model:g,inline:!0,class:"search-form"},{default:a(()=>[s(f,{label:"IP地址"},{default:a(()=>[s(u,{modelValue:g.ip,"onUpdate:modelValue":e[0]||(e[0]=o=>g.ip=o),placeholder:"请输入IP地址",clearable:"",style:{width:"200px"},onKeyup:Je(ee,["enter"])},null,8,["modelValue"])]),_:1}),s(f,{label:"时间筛选"},{default:a(()=>[s(E,{modelValue:g.timeRange,"onUpdate:modelValue":e[1]||(e[1]=o=>g.timeRange=o),placeholder:"请选择时间范围",style:{width:"150px"}},{default:a(()=>[s(h,{label:"当天",value:"today"}),s(h,{label:"昨天",value:"yesterday"}),s(h,{label:"本周",value:"week"}),s(h,{label:"本月",value:"month"}),s(h,{label:"全部",value:"all"})]),_:1},8,["modelValue"])]),_:1}),s(f,{label:"访客类型"},{default:a(()=>[s(E,{modelValue:g.visitorType,"onUpdate:modelValue":e[2]||(e[2]=o=>g.visitorType=o),placeholder:"请选择类型",clearable:"",style:{width:"150px"}},{default:a(()=>[s(h,{label:"访客",value:"visitor"}),s(h,{label:"爬虫",value:"bot"}),s(h,{label:"代理",value:"proxy"})]),_:1},8,["modelValue"])]),_:1}),s(f,{label:"商品筛选"},{default:a(()=>[s(u,{modelValue:D.value,"onUpdate:modelValue":e[3]||(e[3]=o=>D.value=o),placeholder:"点击选择商品",readonly:"",style:{width:"200px"},onClick:e[4]||(e[4]=o=>R.value=!0)},{suffix:a(()=>[g.productId?(i(),I(v,{key:0,onClick:he(Ae,["stop"]),style:{cursor:"pointer"}},{default:a(()=>[s(b(Xe))]),_:1})):(i(),I(v,{key:1},{default:a(()=>[s(b(ke))]),_:1}))]),_:1},8,["modelValue"])]),_:1}),s(f,null,{default:a(()=>[s(w,{type:"primary",onClick:ee},{default:a(()=>[...e[13]||(e[13]=[c("搜索",-1)])]),_:1}),s(w,{onClick:Be},{default:a(()=>[...e[14]||(e[14]=[c("重置",-1)])]),_:1}),s(w,{type:"success",onClick:Me,loading:G.value},{default:a(()=>[s(v,null,{default:a(()=>[s(b(Ze))]),_:1}),e[15]||(e[15]=c(" 一键同步轨迹 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),t("div",_t,[t("h3",null,"统计数据（"+n(Le())+"）",1)]),s(fe,{gutter:20,class:"statistics-cards"},{default:a(()=>[s(L,{span:4},{default:a(()=>[s(S,{class:"stat-card"},{default:a(()=>[t("div",ft,[t("div",vt,n(T.value.totalIps),1),e[16]||(e[16]=t("div",{class:"stat-label"},"总IP数",-1))]),t("div",mt,[s(v,null,{default:a(()=>[s(b(et))]),_:1})])]),_:1})]),_:1}),s(L,{span:4},{default:a(()=>[s(S,{class:"stat-card"},{default:a(()=>[t("div",yt,[t("div",gt,n(T.value.todayIps),1),e[17]||(e[17]=t("div",{class:"stat-label"},"今日新增",-1))]),t("div",bt,[s(v,null,{default:a(()=>[s(b(tt))]),_:1})])]),_:1})]),_:1}),s(L,{span:4},{default:a(()=>[s(S,{class:"stat-card genuine"},{default:a(()=>[t("div",ht,[t("div",kt,n(T.value.genuineCount),1),e[18]||(e[18]=t("div",{class:"stat-label"},"访问正品",-1))]),t("div",zt,[s(v,null,{default:a(()=>[s(b(st))]),_:1})])]),_:1})]),_:1}),s(L,{span:4},{default:a(()=>[s(S,{class:"stat-card fake"},{default:a(()=>[t("div",Ct,[t("div",xt,n(T.value.fakeCount),1),e[19]||(e[19]=t("div",{class:"stat-label"},"访问仿品",-1))]),t("div",It,[s(v,null,{default:a(()=>[s(b(at))]),_:1})])]),_:1})]),_:1}),s(L,{span:4},{default:a(()=>[s(S,{class:"stat-card"},{default:a(()=>[t("div",St,[t("div",Vt,n(T.value.totalCountries),1),e[20]||(e[20]=t("div",{class:"stat-label"},"涉及国家",-1))]),t("div",Tt,[s(v,null,{default:a(()=>[s(b(lt))]),_:1})])]),_:1})]),_:1}),s(L,{span:4},{default:a(()=>[s(S,{class:"stat-card"},{default:a(()=>[t("div",wt,[t("div",Pt,n(T.value.totalCities),1),e[21]||(e[21]=t("div",{class:"stat-label"},"涉及城市",-1))]),t("div",Lt,[s(v,null,{default:a(()=>[s(b(ot))]),_:1})])]),_:1})]),_:1})]),_:1}),s(fe,{gutter:20,class:"statistics-cards",style:{"margin-top":"20px"}},{default:a(()=>[s(L,{span:24},{default:a(()=>[s(S,{class:"source-stats-card"},{default:a(()=>[e[23]||(e[23]=t("div",{class:"card-header"},[t("h3",null,"访问来源统计")],-1)),t("div",Bt,[(i(!0),r(ne,null,ie(T.value.sourceStats,o=>(i(),r("div",{key:o.source,class:"source-item"},[t("div",Dt,[s(x,{type:Pe(o.source),size:"default"},{default:a(()=>[c(n(o.source),1)]),_:2},1032,["type"])]),t("div",At,[t("span",Mt,n(o.count),1),e[22]||(e[22]=t("span",{class:"count-label"},"次",-1))])]))),128))])]),_:1})]),_:1})]),_:1}),s(S,{class:"table-card",shadow:"never"},{default:a(()=>[t("div",Rt,[e[25]||(e[25]=t("div",{class:"table-title"},"访客IP列表",-1)),t("div",Ut,[s(w,{onClick:$},{default:a(()=>[s(v,null,{default:a(()=>[s(b(ze))]),_:1}),e[24]||(e[24]=c(" 刷新统计 ",-1))]),_:1})])]),re((i(),r("div",Nt,[(i(!0),r(ne,null,ie(J.value,(o,ge)=>(i(),r("div",{key:o.id,class:nt(["ip-item",{"last-item":ge===J.value.length-1}])},[t("div",Ft,[t("div",$t,n(o.ip_address),1),t("div",Et,[s(w,{type:"primary",size:"small",onClick:be=>Ne(o)},{default:a(()=>[...e[26]||(e[26]=[c("查看",-1)])]),_:1},8,["onClick"])])]),t("div",Ot,[t("div",Kt,[e[31]||(e[31]=t("div",{class:"section-title"},"地址信息",-1)),t("div",jt,[t("div",Gt,[e[27]||(e[27]=t("span",{class:"label"},"地址:",-1)),t("span",Qt,n(xe(o)||"-"),1)]),t("div",Wt,[e[28]||(e[28]=t("span",{class:"label"},"时间:",-1)),t("span",qt,n(X(o.last_visit)),1)]),t("div",Yt,[e[29]||(e[29]=t("span",{class:"label"},"访问页面:",-1)),t("span",{class:"value referer",title:o.access_address||"-"},n(o.access_address||"-"),9,Ht)]),t("div",Jt,[e[30]||(e[30]=t("span",{class:"label"},"来源:",-1)),t("span",{class:"value referer",title:o.referer||"-"},n(o.referer||"-"),9,Xt)])])]),t("div",Zt,[e[40]||(e[40]=t("div",{class:"section-title"},"组织信息",-1)),t("div",es,[t("div",ts,[e[32]||(e[32]=t("span",{class:"label"},"组织:",-1)),t("span",ss,n(o.organization||"-"),1)]),t("div",as,[e[33]||(e[33]=t("span",{class:"label"},"主机名:",-1)),t("span",{class:"value",title:o.hostname},n(o.hostname||"-"),9,ls)]),t("div",os,[e[34]||(e[34]=t("span",{class:"label"},"国家:",-1)),t("span",ns,n(o.country||"-"),1)]),t("div",is,[e[35]||(e[35]=t("span",{class:"label"},"地区:",-1)),t("span",rs,n(o.region||"-"),1)]),t("div",ds,[e[36]||(e[36]=t("span",{class:"label"},"城市:",-1)),t("span",us,n(o.city||"-"),1)]),t("div",cs,[e[37]||(e[37]=t("span",{class:"label"},"坐标:",-1)),t("span",ps,n(o.location||"-"),1)]),t("div",_s,[F(o)?(i(),I(x,{key:0,size:"small",type:"info"},{default:a(()=>[...e[38]||(e[38]=[c("代理",-1)])]),_:1})):B("",!0),Ie(o)?(i(),I(x,{key:1,size:"small",type:"warning"},{default:a(()=>[...e[39]||(e[39]=[c("机房",-1)])]),_:1})):B("",!0)])])]),t("div",fs,[e[46]||(e[46]=t("div",{class:"section-title"},"基础类型",-1)),t("div",vs,[t("div",ms,[e[41]||(e[41]=t("span",{class:"label"},"类型:",-1)),s(x,{type:ue(o),size:"small"},{default:a(()=>[c(n(de(o)),1)]),_:2},1032,["type"])]),t("div",ys,[e[42]||(e[42]=t("span",{class:"label"},"设备:",-1)),t("span",gs,n(Se(o)||"-"),1)]),t("div",bs,[e[43]||(e[43]=t("span",{class:"label"},"系统:",-1)),t("span",hs,n(Ve(o)||"-"),1)]),t("div",ks,[e[44]||(e[44]=t("span",{class:"label"},"商品:",-1)),o.product_id?(i(),I(x,{key:0,size:"small",type:"success"},{default:a(()=>[c(n(o.product_id),1)]),_:2},1024)):(i(),r("span",zs,"-"))]),t("div",Cs,[e[45]||(e[45]=t("span",{class:"label"},"产品类型:",-1)),o.product_type?(i(),I(x,{key:0,size:"small",type:ce(o.product_type)},{default:a(()=>[c(n(pe(o.product_type)),1)]),_:2},1032,["type"])):(i(),r("span",xs,"-"))])])]),t("div",Is,[e[49]||(e[49]=t("div",{class:"section-title"},"用户轨迹",-1)),t("div",Ss,[t("div",Vs,[s(v,null,{default:a(()=>[s(b(it))]),_:1}),o.behaviorSummary?(i(),r("span",Ts," 停留 "+n(o.behaviorSummary.durationText||"0秒"),1)):(i(),r("span",ws,"暂无轨迹数据"))]),t("div",Ps,[o.behaviorSummary?B("",!0):(i(),I(w,{key:0,type:"warning",size:"small",onClick:be=>Fe(o)},{default:a(()=>[s(v,null,{default:a(()=>[s(b(ze))]),_:1}),e[47]||(e[47]=c(" 获取 ",-1))]),_:1},8,["onClick"])),s(w,{type:"primary",size:"small",disabled:!o.behaviorSummary,onClick:be=>$e(o)},{default:a(()=>[s(v,null,{default:a(()=>[s(b(rt))]),_:1}),e[48]||(e[48]=c(" 查看详情 ",-1))]),_:1},8,["disabled","onClick"])])])]),A(o)||F(o)?(i(),r("div",Ls,[e[53]||(e[53]=t("div",{class:"section-title"},"详细类型",-1)),t("div",Bs,[t("div",Ds,[e[50]||(e[50]=t("span",{class:"label"},"类型:",-1)),s(x,{type:ue(o),size:"small"},{default:a(()=>[c(n(de(o)),1)]),_:2},1032,["type"])]),t("div",As,[e[51]||(e[51]=t("span",{class:"label"},"名称:",-1)),t("span",Ms,n(Te(o)||"-"),1)]),t("div",Rs,[e[52]||(e[52]=t("span",{class:"label"},"说明:",-1)),t("span",Us,n(we(o)||"-"),1)])])])):B("",!0)])],2))),128))])),[[le,j.value]]),t("div",Ns,[s(ve,{"current-page":z.page,"onUpdate:currentPage":e[5]||(e[5]=o=>z.page=o),"page-size":z.size,"onUpdate:pageSize":e[6]||(e[6]=o=>z.size=o),total:z.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Re,onCurrentChange:Ue},null,8,["current-page","page-size","total"])])]),_:1}),s(ae,{modelValue:R.value,"onUpdate:modelValue":e[10]||(e[10]=o=>R.value=o),title:"选择商品",width:"800px","close-on-click-modal":!1},{default:a(()=>[t("div",Fs,[s(u,{modelValue:N.value,"onUpdate:modelValue":e[7]||(e[7]=o=>N.value=o),placeholder:"搜索商品标题或ID",clearable:"",style:{"margin-bottom":"20px"},onInput:De},{prefix:a(()=>[s(v,null,{default:a(()=>[s(b(ke))]),_:1})]),_:1},8,["modelValue"]),re((i(),I(je,{data:U.value,height:"400","highlight-current-row":"",onRowClick:_e},{default:a(()=>[s(se,{prop:"spu_id",label:"商品ID",width:"180"}),s(se,{prop:"title",label:"商品标题","show-overflow-tooltip":""}),s(se,{label:"操作",width:"100",align:"center"},{default:a(o=>[s(w,{type:"primary",size:"small",onClick:he(ge=>_e(o.row),["stop"])},{default:a(()=>[...e[54]||(e[54]=[c("选择",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,Y.value]]),s(ve,{"current-page":V.page,"onUpdate:currentPage":e[8]||(e[8]=o=>V.page=o),"page-size":V.size,"onUpdate:pageSize":e[9]||(e[9]=o=>V.size=o),total:V.total,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",style:{"margin-top":"20px"},onSizeChange:te,onCurrentChange:te},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue"]),s(ae,{modelValue:Q.value,"onUpdate:modelValue":e[11]||(e[11]=o=>Q.value=o),title:"IP详情",width:"600px","close-on-click-modal":!1},{default:a(()=>[d.value?(i(),r("div",$s,[s(ye,{column:2,border:""},{default:a(()=>[s(_,{label:"IP地址"},{default:a(()=>[c(n(d.value.ip_address),1)]),_:1}),s(_,{label:"国家"},{default:a(()=>[d.value.country?(i(),r("span",Es,n(d.value.country),1)):(i(),r("span",Os,"--"))]),_:1}),s(_,{label:"国家代码"},{default:a(()=>[d.value.country?(i(),r("span",Ks,n(d.value.country),1)):(i(),r("span",js,"--"))]),_:1}),s(_,{label:"地区"},{default:a(()=>[d.value.region?(i(),r("span",Gs,n(d.value.region),1)):(i(),r("span",Qs,"--"))]),_:1}),s(_,{label:"城市"},{default:a(()=>[d.value.city?(i(),r("span",Ws,n(d.value.city),1)):(i(),r("span",qs,"--"))]),_:1}),s(_,{label:"时区"},{default:a(()=>[d.value.timezone?(i(),r("span",Ys,n(d.value.timezone),1)):(i(),r("span",Hs,"--"))]),_:1}),s(_,{label:"ISP"},{default:a(()=>[d.value.organization?(i(),r("span",Js,n(d.value.organization),1)):(i(),r("span",Xs,"--"))]),_:1}),s(_,{label:"主机名"},{default:a(()=>[d.value.hostname?(i(),r("span",Zs,n(d.value.hostname),1)):(i(),r("span",ea,"--"))]),_:1}),s(_,{label:"邮编"},{default:a(()=>[d.value.postal_code?(i(),r("span",ta,n(d.value.postal_code),1)):(i(),r("span",sa,"--"))]),_:1}),s(_,{label:"访问页面",span:2},{default:a(()=>[d.value.access_address?(i(),r("div",aa,[s(me,{href:d.value.access_address,target:"_blank",type:"primary",size:"small"},{default:a(()=>[c(n(d.value.access_address),1)]),_:1},8,["href"])])):(i(),r("span",la,"--"))]),_:1}),s(_,{label:"来源页面",span:2},{default:a(()=>[d.value.referer?(i(),r("div",oa,[s(me,{href:d.value.referer,target:"_blank",type:"primary",size:"small"},{default:a(()=>[c(n(d.value.referer),1)]),_:1},8,["href"])])):(i(),r("span",na,"--"))]),_:1}),s(_,{label:"产品类型"},{default:a(()=>[d.value.product_type?(i(),I(x,{key:0,type:ce(d.value.product_type),size:"small"},{default:a(()=>[c(n(pe(d.value.product_type)),1)]),_:1},8,["type"])):(i(),r("span",ia,"--"))]),_:1}),s(_,{label:"访问次数"},{default:a(()=>[s(x,{type:"info"},{default:a(()=>[c(n(d.value.visit_count),1)]),_:1})]),_:1}),s(_,{label:"首次访问"},{default:a(()=>[c(n(X(d.value.first_visit)),1)]),_:1}),s(_,{label:"最后访问"},{default:a(()=>[c(n(X(d.value.last_visit)),1)]),_:1})]),_:1}),d.value.location?(i(),r("div",ra,[e[55]||(e[55]=t("h4",null,"地理位置",-1)),t("p",null,"坐标: "+n(d.value.location),1)])):B("",!0)])):B("",!0)]),_:1},8,["modelValue"]),s(ae,{modelValue:W.value,"onUpdate:modelValue":e[12]||(e[12]=o=>W.value=o),title:"用户行为轨迹",width:"800px","close-on-click-modal":!1},{default:a(()=>[re((i(),r("div",da,[C.value?(i(),r("div",ua,[t("div",ca,[s(ye,{column:2,size:"small",border:""},{default:a(()=>[s(_,{label:"Session ID"},{default:a(()=>[s(O,{size:"small",type:"info"},{default:a(()=>[c(n(C.value.sessionId),1)]),_:1})]),_:1}),s(_,{label:"数据来源"},{default:a(()=>[s(x,{type:C.value.source==="redis"?"success":"info",size:"small"},{default:a(()=>[c(n(C.value.source==="redis"?"Redis (实时)":"MySQL (历史)"),1)]),_:1},8,["type"])]),_:1}),s(_,{label:"进入时间"},{default:a(()=>[c(n(C.value.enterTime),1)]),_:1}),s(_,{label:"离开时间"},{default:a(()=>[c(n(C.value.exitTime||"未离开"),1)]),_:1}),s(_,{label:"停留时长"},{default:a(()=>[s(O,{type:"primary"},{default:a(()=>[c(n(C.value.durationText),1)]),_:1})]),_:1}),s(_,{label:"操作次数"},{default:a(()=>[s(O,{type:"warning"},{default:a(()=>[c(n(C.value.actions.length)+" 次",1)]),_:1})]),_:1})]),_:1})]),t("div",pa,[s(Qe,null,{default:a(()=>[(i(!0),r(ne,null,ie(C.value.actions,o=>(i(),I(Ge,{key:o.sequence,timestamp:o.time,type:Ee(o.type),placement:"top"},{default:a(()=>[t("div",_a,[t("div",fa,[s(x,{type:Oe(o.type),size:"small"},{default:a(()=>[c(n(o.typeName),1)]),_:2},1032,["type"]),t("span",va,n(o.description),1)]),o.detail?(i(),r("div",ma,[s(O,{size:"small",type:"info"},{default:a(()=>[c(" 详情: "+n(JSON.stringify(o.detail)),1)]),_:2},1024)])):B("",!0)])]),_:2},1032,["timestamp","type"]))),128))]),_:1})])])):(i(),I(We,{key:1,description:"暂无轨迹数据"}))])),[[le,q.value]])]),_:1},8,["modelValue"])])}}}),ka=ct(ya,[["__scopeId","data-v-3e20e176"]]);export{ka as default};
