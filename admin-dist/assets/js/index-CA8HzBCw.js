import{d as q,h as z,P as F,s as G,Z as pe,r as u,Q as me,c as v,o as c,a as s,b as e,w as l,u as i,a$ as ge,t as b,aH as A,aZ as ve,a_ as be,_ as ke,x as J,g as x,R as he,F as K,f as L,e as m,E as Z,W as ye,b4 as N,b0 as xe,aQ as I,ar as Ce,ay as we,b5 as Pe,N as S,a0 as ze}from"./index-tWB8d80m.js";import{g as Ve}from"./product-BYJXh6zR.js";import{g as Ae}from"./pixel-WUOMm16a.js";import{_ as Se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Te={class:"pixel-management"},De={class:"stats-cards"},$e={class:"stat-content"},Ee={class:"stat-icon google"},Ue={class:"stat-info"},Be={class:"stat-number"},Fe={class:"stat-content"},Ge={class:"stat-icon enabled"},Ne={class:"stat-info"},Ie={class:"stat-number"},Re={class:"stat-content"},Me={class:"stat-icon google"},Oe={class:"stat-info"},Je={class:"stat-number"},Ke={class:"stat-content"},Le={class:"stat-icon facebook"},Ze={class:"stat-info"},qe={class:"stat-number"},He={class:"table-header"},Qe={class:"table-title"},je={class:"table-actions"},We={class:"product-info"},Xe={class:"product-details"},Ye={class:"product-title"},et={class:"product-id"},tt={key:0,class:"pixel-status"},lt={key:1,class:"pixel-status"},st={key:0,class:"pixel-status"},at={key:1,class:"pixel-status"},ot={key:0,class:"pixel-status"},nt={key:1,class:"pixel-status"},dt={key:1,style:{color:"#999999"}},it={class:"time-info"},ut={class:"action-buttons"},ct={class:"pagination-wrapper"},rt={class:"pixel-config-content"},_t={class:"config-actions"},ft=q({name:"PixelManagement"}),pt=q({...ft,setup(mt){const T=z(!1),D=z(!1),V=z(null),g=z(null),f=F({totalProducts:0,enabledProducts:0,googleAdsCount:0,facebookCount:0}),r=F({title:"",pixelStatus:"",platform:"",country:""}),_=F({current:1,size:20,total:0}),$=z([]),H=[{code:"SK",name:"斯洛伐克"},{code:"CZ",name:"捷克"},{code:"PL",name:"波兰"},{code:"HU",name:"匈牙利"},{code:"DE",name:"德国"},{code:"AT",name:"奥地利"},{code:"RO",name:"罗马尼亚"},{code:"JP",name:"日本"}],Q=G(()=>{const n={};return $.value.forEach(t=>{if(t.country){const o=t.country.toUpperCase();n[o]=(n[o]||0)+1}}),n}),E=G(()=>{const n=Q.value,t=[],o=[];return H.forEach(d=>{const p=n[d.code]||0;p>0?t.push({...d,count:p}):o.push(d)}),t.sort((d,p)=>p.count-d.count),{withProducts:t,withoutProducts:o}}),j=G(()=>{var n;if(!((n=g.value)!=null&&n.google_ads_accounts))return!1;try{return JSON.parse(g.value.google_ads_accounts).some(o=>o.enabled)}catch{return!1}}),R=()=>{_.current=1,C()},W=()=>{r.title="",r.pixelStatus="",r.platform="",r.country="",_.current=1,C()},X=n=>{_.size=n,_.current=1,C()},Y=n=>{_.current=n,C()},ee=n=>{V.value=n,D.value=!0},te=n=>{S.info(`查看商品 ${n.title} 的像素配置详情`)},le=n=>{ze.confirm(`确定要测试商品 "${n.title}" 的像素配置吗？`,"测试确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{S.success("像素测试已启动，请查看控制台输出")})},se=()=>{S.info("批量配置功能开发中...")},ae=()=>{V.value&&window.open(`/product/list?pixelConfig=${V.value.id}`,"_blank")},C=async()=>{T.value=!0;try{const[n,t]=await Promise.all([Ve({page:_.current,size:_.size,title:r.title||void 0,country:r.country||void 0,product_type:"original"}),Ae()]);$.value=n.data.list,_.total=n.data.total,g.value=t.data,oe(n.data.list)}catch{S.error("获取数据失败")}finally{T.value=!1}},oe=n=>{if(f.totalProducts=n.length,g.value){const t=g.value;f.enabledProducts=t.enabled?n.length:0;let o=!1;if(t.google_ads_accounts)try{o=JSON.parse(t.google_ads_accounts).some(p=>p.enabled)}catch(d){console.error("解析Google Ads账户配置失败:",d)}f.googleAdsCount=o?n.length:0,f.facebookCount=t.facebook_enabled?n.length:0}else f.enabledProducts=n.filter(t=>t.pixel_enabled).length,f.googleAdsCount=n.filter(t=>{var o,d;return(d=(o=t.pixel_config)==null?void 0:o.google_ads)==null?void 0:d.enabled}).length,f.facebookCount=n.filter(t=>{var o,d;return(d=(o=t.pixel_config)==null?void 0:o.facebook)==null?void 0:d.enabled}).length};return pe(()=>{C()}),(n,t)=>{var O;const o=u("el-icon"),d=u("el-card"),p=u("el-col"),ne=u("el-row"),de=u("el-input"),w=u("el-form-item"),k=u("el-option"),U=u("el-select"),h=u("el-button"),ie=u("el-form"),B=u("el-tag"),M=u("el-avatar"),y=u("el-table-column"),ue=u("el-table"),ce=u("el-pagination"),re=u("el-alert"),_e=u("el-dialog"),fe=me("loading");return c(),v("div",Te,[t[29]||(t[29]=s("div",{class:"page-header"},[s("h2",null,"像素配置管理"),s("p",null,"管理所有商品的像素跟踪配置，支持Google Ads、Facebook、TikTok等平台")],-1)),s("div",De,[e(ne,{gutter:20},{default:l(()=>[e(p,{span:6},{default:l(()=>[e(d,{class:"stat-card"},{default:l(()=>[s("div",$e,[s("div",Ee,[e(o,null,{default:l(()=>[e(i(ge))]),_:1})]),s("div",Ue,[s("div",Be,b(f.totalProducts),1),t[7]||(t[7]=s("div",{class:"stat-label"},"总商品数",-1))])])]),_:1})]),_:1}),e(p,{span:6},{default:l(()=>[e(d,{class:"stat-card"},{default:l(()=>[s("div",Fe,[s("div",Ge,[e(o,null,{default:l(()=>[e(i(A))]),_:1})]),s("div",Ne,[s("div",Ie,b(f.enabledProducts),1),t[8]||(t[8]=s("div",{class:"stat-label"},"已启用像素",-1))])])]),_:1})]),_:1}),e(p,{span:6},{default:l(()=>[e(d,{class:"stat-card"},{default:l(()=>[s("div",Re,[s("div",Me,[e(o,null,{default:l(()=>[e(i(ve))]),_:1})]),s("div",Oe,[s("div",Je,b(f.googleAdsCount),1),t[9]||(t[9]=s("div",{class:"stat-label"},"Google Ads",-1))])])]),_:1})]),_:1}),e(p,{span:6},{default:l(()=>[e(d,{class:"stat-card"},{default:l(()=>[s("div",Ke,[s("div",Le,[e(o,null,{default:l(()=>[e(i(be))]),_:1})]),s("div",Ze,[s("div",qe,b(f.facebookCount),1),t[10]||(t[10]=s("div",{class:"stat-label"},"Facebook",-1))])])]),_:1})]),_:1})]),_:1})]),e(d,{class:"search-card",shadow:"never"},{default:l(()=>[e(ie,{model:r,inline:"",class:"search-form"},{default:l(()=>[e(w,{label:"商品标题"},{default:l(()=>[e(de,{modelValue:r.title,"onUpdate:modelValue":t[0]||(t[0]=a=>r.title=a),placeholder:"请输入商品标题",clearable:"",style:{width:"200px"},onKeyup:ke(R,["enter"])},{prefix:l(()=>[e(o,null,{default:l(()=>[e(i(J))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(w,{label:"像素状态"},{default:l(()=>[e(U,{modelValue:r.pixelStatus,"onUpdate:modelValue":t[1]||(t[1]=a=>r.pixelStatus=a),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:l(()=>[e(k,{label:"已启用",value:"enabled"}),e(k,{label:"未启用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1}),e(w,{label:"平台类型"},{default:l(()=>[e(U,{modelValue:r.platform,"onUpdate:modelValue":t[2]||(t[2]=a=>r.platform=a),placeholder:"请选择平台",clearable:"",style:{width:"120px"}},{default:l(()=>[e(k,{label:"Google Ads",value:"google_ads"}),e(k,{label:"Facebook",value:"facebook"}),e(k,{label:"TikTok",value:"tiktok"})]),_:1},8,["modelValue"])]),_:1}),e(w,{label:"国家筛选"},{default:l(()=>[e(U,{modelValue:r.country,"onUpdate:modelValue":t[3]||(t[3]=a=>r.country=a),placeholder:"请选择国家",clearable:"",style:{width:"200px"}},{default:l(()=>[(c(!0),v(K,null,L(E.value.withProducts,a=>(c(),x(k,{key:a.code,label:`${a.name} (${a.count}条)`,value:a.code},null,8,["label","value"]))),128)),E.value.withProducts.length>0?(c(),x(k,{key:0,disabled:"",value:""},{default:l(()=>[...t[11]||(t[11]=[s("span",{style:{color:"#dcdfe6"}},"──────────",-1)])]),_:1})):he("",!0),(c(!0),v(K,null,L(E.value.withoutProducts,a=>(c(),x(k,{key:a.code,label:a.name,value:a.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(w,null,{default:l(()=>[e(h,{type:"primary",onClick:R},{default:l(()=>[e(o,null,{default:l(()=>[e(i(J))]),_:1}),t[12]||(t[12]=m(" 搜索 ",-1))]),_:1}),e(h,{onClick:W},{default:l(()=>[e(o,null,{default:l(()=>[e(i(Z))]),_:1}),t[13]||(t[13]=m(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(d,{class:"table-card",shadow:"never"},{default:l(()=>[s("div",He,[s("div",Qe,[t[14]||(t[14]=s("span",null,"像素配置列表",-1)),e(B,{type:"info",size:"small"},{default:l(()=>[m(b(_.total)+" 条记录",1)]),_:1})]),s("div",je,[e(h,{type:"primary",onClick:se},{default:l(()=>[e(o,null,{default:l(()=>[e(i(N))]),_:1}),t[15]||(t[15]=m(" 批量配置 ",-1))]),_:1}),e(h,{size:"small",onClick:C},{default:l(()=>[e(o,null,{default:l(()=>[e(i(Z))]),_:1}),t[16]||(t[16]=m(" 刷新 ",-1))]),_:1})])]),ye((c(),x(ue,{data:$.value,stripe:"",border:"",style:{width:"100%"},"header-cell-style":{background:"#f8f9fa",color:"#606266"}},{default:l(()=>[e(y,{prop:"title",label:"商品标题","min-width":"200","show-overflow-tooltip":""},{default:l(({row:a})=>[s("div",We,[a.image_urls&&a.image_urls[0]?(c(),x(M,{key:0,size:40,src:a.image_urls[0],shape:"square"},null,8,["src"])):(c(),x(M,{key:1,size:40,shape:"square"},{default:l(()=>[e(o,null,{default:l(()=>[e(i(xe))]),_:1})]),_:1})),s("div",Xe,[s("div",Ye,b(a.title),1),s("div",et,"ID: "+b(a.id),1)])])]),_:1}),e(y,{label:"像素状态",width:"100",align:"center"},{default:l(()=>{var a;return[e(B,{type:(a=g.value)!=null&&a.enabled?"success":"info",size:"small"},{default:l(()=>{var P;return[m(b((P=g.value)!=null&&P.enabled?"已启用":"未启用"),1)]}),_:1},8,["type"])]}),_:1}),e(y,{label:"Google Ads",width:"120",align:"center"},{default:l(()=>[j.value?(c(),v("div",tt,[e(o,{class:"status-icon success"},{default:l(()=>[e(i(A))]),_:1}),t[17]||(t[17]=s("span",{class:"status-text"},"已配置",-1))])):(c(),v("div",lt,[e(o,{class:"status-icon disabled"},{default:l(()=>[e(i(I))]),_:1}),t[18]||(t[18]=s("span",{class:"status-text"},"未配置",-1))]))]),_:1}),e(y,{label:"Facebook",width:"120",align:"center"},{default:l(()=>{var a;return[(a=g.value)!=null&&a.facebook_enabled?(c(),v("div",st,[e(o,{class:"status-icon success"},{default:l(()=>[e(i(A))]),_:1}),t[19]||(t[19]=s("span",{class:"status-text"},"已配置",-1))])):(c(),v("div",at,[e(o,{class:"status-icon disabled"},{default:l(()=>[e(i(I))]),_:1}),t[20]||(t[20]=s("span",{class:"status-text"},"未配置",-1))]))]}),_:1}),e(y,{label:"TikTok",width:"120",align:"center"},{default:l(()=>{var a;return[(a=g.value)!=null&&a.tiktok_enabled?(c(),v("div",ot,[e(o,{class:"status-icon success"},{default:l(()=>[e(i(A))]),_:1}),t[21]||(t[21]=s("span",{class:"status-text"},"已配置",-1))])):(c(),v("div",nt,[e(o,{class:"status-icon disabled"},{default:l(()=>[e(i(I))]),_:1}),t[22]||(t[22]=s("span",{class:"status-text"},"未配置",-1))]))]}),_:1}),e(y,{label:"自定义像素",width:"120",align:"center"},{default:l(()=>{var a;return[(a=g.value)!=null&&a.custom_pixels?(c(),x(B,{key:0,type:"warning",size:"small"},{default:l(()=>[...t[23]||(t[23]=[m("已配置",-1)])]),_:1})):(c(),v("span",dt,"--"))]}),_:1}),e(y,{prop:"updated_at",label:"更新时间",width:"180","show-overflow-tooltip":""},{default:l(({row:a})=>[s("div",it,[e(o,{class:"time-icon"},{default:l(()=>[e(i(Ce))]),_:1}),s("span",null,b(a.updated_at),1)])]),_:1}),e(y,{label:"操作",width:"200",fixed:"right",align:"center"},{default:l(({row:a})=>[s("div",ut,[e(h,{size:"small",type:"primary",link:"",onClick:P=>ee(a)},{default:l(()=>[e(o,null,{default:l(()=>[e(i(N))]),_:1}),t[24]||(t[24]=m(" 配置 ",-1))]),_:1},8,["onClick"]),e(h,{size:"small",type:"success",link:"",onClick:P=>te(a)},{default:l(()=>[e(o,null,{default:l(()=>[e(i(we))]),_:1}),t[25]||(t[25]=m(" 查看 ",-1))]),_:1},8,["onClick"]),e(h,{size:"small",type:"warning",link:"",onClick:P=>le(a)},{default:l(()=>[e(o,null,{default:l(()=>[e(i(Pe))]),_:1}),t[26]||(t[26]=m(" 测试 ",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[fe,T.value]]),s("div",ct,[e(ce,{"current-page":_.current,"onUpdate:currentPage":t[4]||(t[4]=a=>_.current=a),"page-size":_.size,"onUpdate:pageSize":t[5]||(t[5]=a=>_.size=a),"page-sizes":[10,20,50,100],total:_.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:X,onCurrentChange:Y},null,8,["current-page","page-size","total"])])]),_:1}),e(_e,{modelValue:D.value,"onUpdate:modelValue":t[6]||(t[6]=a=>D.value=a),title:`像素配置 - ${(O=V.value)==null?void 0:O.title}`,width:"800px","close-on-click-modal":!1},{default:l(()=>[s("div",rt,[e(re,{title:"像素配置说明",type:"info",closable:!1,"show-icon":""},{default:l(()=>[...t[27]||(t[27]=[s("p",null,"• Google Ads: 需要转化ID和转化标签",-1),s("p",null,"• Facebook: 需要像素ID",-1),s("p",null,"• TikTok: 需要像素ID",-1),s("p",null,"• 自定义: 可以添加任意像素代码",-1)])]),_:1}),s("div",_t,[e(h,{type:"primary",onClick:ae},{default:l(()=>[e(o,null,{default:l(()=>[e(i(N))]),_:1}),t[28]||(t[28]=m(" 打开详细配置 ",-1))]),_:1})])])]),_:1},8,["modelValue","title"])])}}}),ht=Se(pt,[["__scopeId","data-v-c71d2a92"]]);export{ht as default};
