import{d as U,h as u,Z as J,aJ as K,r as f,c as P,o as W,a as t,b as s,w as i,e as X,u as m,E as Z,az as j,t as _,aK as G,by as H,aV as Q,M as $,N as V}from"./index-tWB8d80m.js";import"./index-BpCvQqaw.js";import{d as I}from"./statistics-BtsH4dMb.js";import{aU as S}from"./installCanvasRenderer-Bf4uGEF_.js";import{_ as tt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const et={class:"customer-statistics"},st={class:"date-range-selector"},at={class:"stats-cards"},ot={class:"stat-card"},lt={class:"stat-icon total"},rt={class:"stat-content"},nt={class:"stat-value"},it={class:"stat-card"},ct={class:"stat-icon new"},dt={class:"stat-content"},ut={class:"stat-value"},_t={class:"stat-card"},pt={class:"stat-icon repeat"},vt={class:"stat-content"},ft={class:"stat-value"},mt={class:"stat-card"},ht={class:"stat-icon rate"},gt={class:"stat-content"},bt={class:"stat-value"},yt={class:"charts-container"},xt={class:"chart-card"},wt={class:"chart-content"},St={class:"chart-card"},Dt={class:"chart-content"},Ct={class:"chart-card full-width"},zt={class:"chart-content"},kt={class:"chart-card"},Yt={class:"chart-content"},Mt=U({__name:"index",setup(Vt){const h=u(!1),a=u(null),p=u([new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0],new Date().toISOString().split("T")[0]]),g=u(),b=u(),y=u();let l=null,r=null,n=null;const x=o=>o.toLocaleString(),A=()=>!a.value||a.value.total_customers===0?"0.00":(a.value.repeat_customers/a.value.total_customers*100).toFixed(2),E=o=>{o&&(p.value=o,w())},F=()=>{w()},w=async()=>{try{h.value=!0;const o={start_date:p.value[0],end_date:p.value[1]},e=await I(o);e.code===200?(a.value=e.data,await $(),O()):V.error(e.message||"获取统计数据失败")}catch(o){console.error("获取客户统计数据失败:",o),V.error("获取统计数据失败，请稍后重试")}finally{h.value=!1}},O=()=>{R(),L(),N()},R=()=>{if(!g.value||!a.value)return;l&&l.dispose(),l=S(g.value);const o={title:{text:"新客户获取趋势",left:"center",textStyle:{fontSize:14,color:"#333"}},tooltip:{trigger:"axis",formatter:"{b}<br/>新客户: {c}人"},xAxis:{type:"category",data:a.value.customer_trend.map(e=>e.date),axisLabel:{rotate:45}},yAxis:{type:"value",name:"新客户数"},series:[{data:a.value.customer_trend.map(e=>e.new_customer_count),type:"line",smooth:!0,itemStyle:{color:"#409EFF"},areaStyle:{color:"rgba(64, 158, 255, 0.1)"}}],grid:{top:60,right:30,bottom:80,left:60}};l.setOption(o)},L=()=>{if(!b.value||!a.value)return;r&&r.dispose(),r=S(b.value);const o={title:{text:"客户地区分布",left:"center",textStyle:{fontSize:14,color:"#333"}},tooltip:{trigger:"item",formatter:"{a}<br/>{b}: {c}人 ({d}%)"},series:[{name:"客户分布",type:"pie",radius:["40%","70%"],data:a.value.region_distribution.map(e=>({name:e.province,value:e.customer_count})),emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};r.setOption(o)},N=()=>{if(!y.value||!a.value)return;n&&n.dispose(),n=S(y.value);const o={title:{text:"客户购买频次分布",left:"center",textStyle:{fontSize:14,color:"#333"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:"{b}<br/>客户数: {c}人<br/>占比: {d}%"},xAxis:{type:"category",data:a.value.purchase_frequency.map(e=>e.frequency_range),axisLabel:{interval:0,rotate:30}},yAxis:{type:"value",name:"客户数"},series:[{data:a.value.purchase_frequency.map(e=>({value:e.customer_count,d:e.percentage})),type:"bar",itemStyle:{color:"#67C23A"},barWidth:"60%"}],grid:{top:60,right:30,bottom:80,left:60}};n.setOption(o)},D=()=>{l==null||l.resize(),r==null||r.resize(),n==null||n.resize()};return J(()=>{w(),window.addEventListener("resize",D)}),K(()=>{l==null||l.dispose(),r==null||r.dispose(),n==null||n.dispose(),window.removeEventListener("resize",D)}),(o,e)=>{var C,z,k,Y;const B=f("el-date-picker"),v=f("el-icon"),T=f("el-button"),c=f("el-table-column"),q=f("el-table");return W(),P("div",et,[e[10]||(e[10]=t("div",{class:"page-header"},[t("h1",{class:"page-title"},"客户统计"),t("p",{class:"page-description"},"查看客户地区分布、购买行为等统计数据")],-1)),t("div",st,[s(B,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=d=>p.value=d),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:E,"default-value":[new Date(Date.now()-30*24*60*60*1e3),new Date]},null,8,["modelValue","default-value"]),s(T,{type:"primary",onClick:F,loading:h.value},{default:i(()=>[s(v,null,{default:i(()=>[s(m(Z))]),_:1}),e[1]||(e[1]=X(" 刷新数据 ",-1))]),_:1},8,["loading"])]),t("div",at,[t("div",ot,[t("div",lt,[s(v,null,{default:i(()=>[s(m(j))]),_:1})]),t("div",rt,[t("div",nt,_(x(((C=a.value)==null?void 0:C.total_customers)||0)),1),e[2]||(e[2]=t("div",{class:"stat-label"},"总客户数",-1))])]),t("div",it,[t("div",ct,[s(v,null,{default:i(()=>[s(m(G))]),_:1})]),t("div",dt,[t("div",ut,_(x(((z=a.value)==null?void 0:z.new_customers)||0)),1),e[3]||(e[3]=t("div",{class:"stat-label"},"新客户数",-1))])]),t("div",_t,[t("div",pt,[s(v,null,{default:i(()=>[s(m(H))]),_:1})]),t("div",vt,[t("div",ft,_(x(((k=a.value)==null?void 0:k.repeat_customers)||0)),1),e[4]||(e[4]=t("div",{class:"stat-label"},"回头客数量",-1))])]),t("div",mt,[t("div",ht,[s(v,null,{default:i(()=>[s(m(Q))]),_:1})]),t("div",gt,[t("div",bt,_(A())+"%",1),e[5]||(e[5]=t("div",{class:"stat-label"},"回头客比例",-1))])])]),t("div",yt,[t("div",xt,[e[6]||(e[6]=t("div",{class:"chart-header"},[t("h3",null,"客户购买趋势"),t("p",null,"新客户获取趋势分析")],-1)),t("div",wt,[t("div",{ref_key:"customerTrendChart",ref:g,class:"chart"},null,512)])]),t("div",St,[e[7]||(e[7]=t("div",{class:"chart-header"},[t("h3",null,"客户地区分布"),t("p",null,"按省份统计客户分布情况")],-1)),t("div",Dt,[t("div",{ref_key:"regionChart",ref:b,class:"chart"},null,512)])]),t("div",Ct,[e[8]||(e[8]=t("div",{class:"chart-header"},[t("h3",null,"热门城市分布"),t("p",null,"客户数量最多的前10个城市")],-1)),t("div",zt,[s(q,{data:((Y=a.value)==null?void 0:Y.city_distribution)||[],style:{width:"100%"}},{default:i(()=>[s(c,{prop:"province",label:"省份",width:"120"}),s(c,{prop:"city",label:"城市",width:"120"}),s(c,{prop:"customer_count",label:"客户数量",width:"100",align:"center"}),s(c,{prop:"order_count",label:"订单数量",width:"100",align:"center"}),s(c,{label:"客户占比",width:"120",align:"center"},{default:i(({row:d})=>{var M;return[t("span",null,_((d.customer_count/(((M=a.value)==null?void 0:M.total_customers)||1)*100).toFixed(2))+"%",1)]}),_:1}),s(c,{label:"平均订单数",align:"center"},{default:i(({row:d})=>[t("span",null,_((d.order_count/d.customer_count).toFixed(1)),1)]),_:1})]),_:1},8,["data"])])]),t("div",kt,[e[9]||(e[9]=t("div",{class:"chart-header"},[t("h3",null,"客户购买频次分布"),t("p",null,"客户购买次数分布情况")],-1)),t("div",Yt,[t("div",{ref_key:"frequencyChart",ref:y,class:"chart"},null,512)])])])])}}}),Lt=tt(Mt,[["__scopeId","data-v-40acc447"]]);export{Lt as default};
