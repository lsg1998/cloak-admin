import{d as ee,h as U,P as K,Z as ke,r as c,Q as we,c as m,o as d,b as e,w as t,_ as q,u as p,x as J,F as Q,f as W,g as y,e as n,E as Z,W as ze,R as V,a as r,t as o,aB as G,aC as Ce,aD as xe,aE as Ve,aF as De,U as H,V as Oe,N as g,a0 as X}from"./index-2V8v6Wus.js";import{a as $,O as P,b as Ue,u as Be,d as Se,c as Le,e as Re,f as Ye}from"./order-P34lO5Uw.js";import{_ as $e}from"./_plugin-vue_export-helper-DlAUqK2U.js";const je={class:"order-management"},Ee={class:"table-header"},Me={class:"table-title"},Ne={class:"table-actions"},Ae={class:"order-number"},qe={class:"product-info"},Pe=["src","alt"],Te={class:"product-details"},Fe={class:"product-title"},Ie={class:"product-subtitle"},Ke={class:"customer-info"},Je={class:"customer-name"},Qe={class:"customer-phone"},We={key:0,class:"customer-email"},Ze={class:"address-info"},Ge={class:"amount-info"},He={class:"amount"},Xe={class:"currency"},et={class:"time-info"},tt={key:0,class:"ip-info"},at={class:"ip-address"},lt={key:0,class:"ip-location"},ot={key:1,class:"no-data"},st={key:1,class:"no-data"},nt={class:"url-info"},dt={key:1,class:"no-data"},rt={class:"action-buttons"},it={key:0,class:"batch-actions"},ut={class:"batch-buttons"},ct={class:"pagination-wrapper"},_t={key:0,class:"order-detail"},pt={key:0},mt={class:"product-detail-info"},ft=["src","alt"],vt={class:"product-detail-text"},yt={class:"product-title"},ht={class:"product-price"},gt={class:"product-quantity"},bt={key:1,class:"no-data"},kt={key:1,class:"no-data"},wt={key:1,class:"no-data"},zt={key:1,class:"no-data"},Ct={key:0,class:"user-agent-info"},xt={key:1,class:"no-data"},Vt={class:"dialog-footer"},Dt=ee({name:"OrderList"}),Ot=ee({...Dt,setup(Ut){const j=U(!1),E=U(!1),S=U(!1),s=U(null),D=U([]),i=K({order_number:"",customer_name:"",phone:"",status:"",start_date:"",end_date:""}),M=U(null),b=K({current:1,size:20,total:0}),T=U([]),B=()=>{b.current=1,x()},te=()=>{Object.assign(i,{order_number:"",customer_name:"",phone:"",status:"",start_date:"",end_date:""}),M.value=null,B()},ae=u=>{u?(i.start_date=u[0],i.end_date=u[1]):(i.start_date="",i.end_date="")},F=async u=>{try{const{data:l}=await Ue(u.id);s.value=l,S.value=!0}catch{g.error("获取订单详情失败")}},le=async(u,l)=>{try{await Be(u.id,{status:l}),g.success("订单状态更新成功"),x()}catch{g.error("订单状态更新失败")}},oe=u=>{X.confirm(`确定要删除订单 "${u.order_number}" 吗？删除后无法恢复！`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"}).then(async()=>{try{await Se(u.id),g.success("删除成功"),x()}catch{g.error("删除失败")}})},se=()=>{const u=D.value.map(l=>l.order_number).join("、");X.confirm(`确定要删除选中的 ${D.value.length} 个订单吗？
订单号：${u}`,"批量删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"}).then(async()=>{try{const l=D.value.map(_=>_.id);await Le(l),g.success("批量删除成功"),D.value=[],x()}catch{g.error("批量删除失败")}})},ne=async()=>{E.value=!0;try{const u={...i,order_number:i.order_number||void 0,customer_name:i.customer_name||void 0,phone:i.phone||void 0,status:i.status||void 0,start_date:i.start_date||void 0,end_date:i.end_date||void 0},l=await Re(u);let _,v;if(l&&l.data)v=l.data;else if(typeof l=="string"&&l.trim())v=l;else{g.warning("没有数据可导出");return}if(!v||typeof v=="string"&&v.trim()===""){g.warning("导出的数据为空");return}if(v instanceof Blob)_=v;else if(typeof v=="string")_=new Blob([v],{type:"text/csv; charset=utf-8"});else{const N=typeof v=="object"?JSON.stringify(v):String(v);_=new Blob([N],{type:"text/csv; charset=utf-8"})}if(_.size===0){g.warning("导出的数据为空");return}const w=window.URL.createObjectURL(_),O=document.createElement("a");O.href=w,O.download=`订单列表_${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(O),O.click(),document.body.removeChild(O),window.URL.revokeObjectURL(w),g.success("导出成功")}catch(u){console.error("导出失败:",u),g.error("导出失败")}finally{E.value=!1}},de=u=>{D.value=u},re=u=>{b.size=u,x()},ie=u=>{b.current=u,x()},x=async()=>{j.value=!0;try{const u={page:b.current,size:b.size,order_number:i.order_number||void 0,customer_name:i.customer_name||void 0,phone:i.phone||void 0,status:i.status||void 0,start_date:i.start_date||void 0,end_date:i.end_date||void 0},{data:l}=await Ye(u);T.value=l.list,b.total=l.total}catch{g.error("获取订单列表失败")}finally{j.value=!1}};return ke(()=>{x()}),(u,l)=>{const _=c("el-icon"),v=c("el-input"),w=c("el-form-item"),O=c("el-option"),N=c("el-select"),ue=c("el-date-picker"),z=c("el-button"),ce=c("el-form"),I=c("el-card"),k=c("el-tag"),h=c("el-table-column"),A=c("el-link"),L=c("el-avatar"),_e=c("el-dropdown-item"),pe=c("el-dropdown-menu"),me=c("el-dropdown"),fe=c("el-table"),ve=c("el-alert"),ye=c("el-pagination"),f=c("el-descriptions-item"),R=c("el-descriptions"),he=c("el-text"),ge=c("el-dialog"),be=we("loading");return d(),m("div",je,[e(I,{class:"search-card",shadow:"never"},{default:t(()=>[e(ce,{model:i,inline:"",class:"search-form"},{default:t(()=>[e(w,{label:"订单号"},{default:t(()=>[e(v,{modelValue:i.order_number,"onUpdate:modelValue":l[0]||(l[0]=a=>i.order_number=a),placeholder:"请输入订单号",clearable:"",style:{width:"200px"},onKeyup:q(B,["enter"])},{prefix:t(()=>[e(_,null,{default:t(()=>[e(p(J))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(w,{label:"客户姓名"},{default:t(()=>[e(v,{modelValue:i.customer_name,"onUpdate:modelValue":l[1]||(l[1]=a=>i.customer_name=a),placeholder:"请输入客户姓名",clearable:"",style:{width:"150px"},onKeyup:q(B,["enter"])},null,8,["modelValue"])]),_:1}),e(w,{label:"手机号"},{default:t(()=>[e(v,{modelValue:i.phone,"onUpdate:modelValue":l[2]||(l[2]=a=>i.phone=a),placeholder:"请输入手机号",clearable:"",style:{width:"150px"},onKeyup:q(B,["enter"])},null,8,["modelValue"])]),_:1}),e(w,{label:"订单状态"},{default:t(()=>[e(N,{modelValue:i.status,"onUpdate:modelValue":l[3]||(l[3]=a=>i.status=a),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:t(()=>[(d(!0),m(Q,null,W(p($),(a,C)=>(d(),y(O,{key:C,label:a,value:C},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(w,{label:"下单时间"},{default:t(()=>[e(ue,{modelValue:M.value,"onUpdate:modelValue":l[4]||(l[4]=a=>M.value=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:ae,style:{width:"240px"}},null,8,["modelValue"])]),_:1}),e(w,null,{default:t(()=>[e(z,{type:"primary",onClick:B},{default:t(()=>[e(_,null,{default:t(()=>[e(p(J))]),_:1}),l[9]||(l[9]=n(" 搜索 ",-1))]),_:1}),e(z,{onClick:te},{default:t(()=>[e(_,null,{default:t(()=>[e(p(Z))]),_:1}),l[10]||(l[10]=n(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(I,{class:"table-card",shadow:"never"},{header:t(()=>[r("div",Ee,[r("div",Me,[l[11]||(l[11]=r("span",null,"订单列表",-1)),e(k,{type:"info",size:"small"},{default:t(()=>[n(o(b.total)+" 条记录",1)]),_:1})]),r("div",Ne,[e(z,{size:"small",onClick:ne,loading:E.value},{default:t(()=>[e(_,null,{default:t(()=>[e(p(Oe))]),_:1}),l[12]||(l[12]=n(" 导出 ",-1))]),_:1},8,["loading"]),e(z,{size:"small",onClick:x},{default:t(()=>[e(_,null,{default:t(()=>[e(p(Z))]),_:1}),l[13]||(l[13]=n(" 刷新 ",-1))]),_:1})])])]),default:t(()=>[ze((d(),y(fe,{data:T.value,stripe:"",border:"",style:{width:"100%"},"header-cell-style":{background:"#f8f9fa",color:"#606266"},onSelectionChange:de},{default:t(()=>[e(h,{type:"selection",width:"55"}),e(h,{prop:"order_number",label:"订单号",width:"180","show-overflow-tooltip":""},{default:t(({row:a})=>[r("div",Ae,[e(A,{type:"primary",onClick:C=>F(a)},{default:t(()=>[n(o(a.order_number),1)]),_:2},1032,["onClick"])])]),_:1}),e(h,{label:"商品信息","min-width":"250","show-overflow-tooltip":""},{default:t(({row:a})=>[r("div",qe,[a.product_images&&a.product_images[0]?(d(),y(L,{key:0,size:40,class:"product-avatar"},{default:t(()=>[r("img",{src:a.product_images[0],alt:a.product_title,style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,Pe)]),_:2},1024)):(d(),y(L,{key:1,size:40,class:"product-avatar"},{default:t(()=>[e(_,null,{default:t(()=>[e(p(G))]),_:1})]),_:1})),r("div",Te,[r("div",Fe,o(a.product_title||"商品已删除"),1),r("div",Ie,"数量: "+o(a.quantity),1)])])]),_:1}),e(h,{label:"客户信息",width:"180"},{default:t(({row:a})=>[r("div",Ke,[r("div",Je,o(a.customer_name),1),r("div",Qe,o(a.phone),1),a.email?(d(),m("div",We,o(a.email),1)):V("",!0)])]),_:1}),e(h,{label:"收货地址","min-width":"200","show-overflow-tooltip":""},{default:t(({row:a})=>[r("div",Ze,o(a.province)+o(a.city)+o(a.district)+o(a.address),1)]),_:1}),e(h,{prop:"total_amount",label:"订单金额",width:"120",align:"center"},{default:t(({row:a})=>[r("div",Ge,[r("span",He,o(a.total_amount||a.product_price*a.quantity),1),r("span",Xe,o(a.currency||"JPY"),1)])]),_:1}),e(h,{prop:"payment_method",label:"支付方式",width:"100",align:"center"},{default:t(({row:a})=>[e(k,{size:"small",type:"info"},{default:t(()=>[n(o(a.payment_method||"COD"),1)]),_:2},1024)]),_:1}),e(h,{prop:"status",label:"订单状态",width:"100",align:"center"},{default:t(({row:a})=>[e(k,{type:p(P)[a.status],size:"small"},{default:t(()=>[n(o(p($)[a.status]||a.status),1)]),_:2},1032,["type"])]),_:1}),e(h,{prop:"created_at",label:"下单时间",width:"180","show-overflow-tooltip":""},{default:t(({row:a})=>[r("div",et,[e(_,{class:"time-icon"},{default:t(()=>[e(p(Ce))]),_:1}),r("span",null,o(a.created_at),1)])]),_:1}),e(h,{prop:"ip_address",label:"下单IP",width:"200",align:"center","show-overflow-tooltip":""},{default:t(({row:a})=>[a.ip_address?(d(),m("div",tt,[r("div",at,[e(k,{size:"small",type:"info"},{default:t(()=>[n(o(a.ip_address),1)]),_:2},1024)]),a.ip_info?(d(),m("div",lt,[a.ip_info.country?(d(),y(k,{key:0,size:"small",type:"success"},{default:t(()=>[n(o(a.ip_info.country),1)]),_:2},1024)):V("",!0),a.ip_info.city?(d(),y(k,{key:1,size:"small",type:"warning",style:{"margin-left":"4px"}},{default:t(()=>[n(o(a.ip_info.city),1)]),_:2},1024)):V("",!0)])):V("",!0)])):(d(),m("span",ot,"--"))]),_:1}),e(h,{prop:"language_code",label:"语言",width:"80",align:"center"},{default:t(({row:a})=>[a.language_code?(d(),y(k,{key:0,size:"small",type:"success"},{default:t(()=>[n(o(a.language_code.toUpperCase()),1)]),_:2},1024)):(d(),m("span",st,"--"))]),_:1}),e(h,{prop:"from_url",label:"来源URL","min-width":"200","show-overflow-tooltip":""},{default:t(({row:a})=>[r("div",nt,[a.from_url?(d(),y(A,{key:0,href:a.from_url,target:"_blank",type:"primary",size:"small"},{default:t(()=>[n(o(a.from_url.length>50?a.from_url.substring(0,50)+"...":a.from_url),1)]),_:2},1032,["href"])):(d(),m("span",dt,"--"))])]),_:1}),e(h,{label:"操作",width:"280",fixed:"right",align:"center"},{default:t(({row:a})=>[r("div",rt,[e(z,{size:"small",type:"primary",link:"",onClick:C=>F(a)},{default:t(()=>[e(_,null,{default:t(()=>[e(p(xe))]),_:1}),l[14]||(l[14]=n(" 查看 ",-1))]),_:1},8,["onClick"]),e(me,{onCommand:C=>le(a,C)},{dropdown:t(()=>[e(pe,null,{default:t(()=>[(d(!0),m(Q,null,W(p($),(C,Y)=>(d(),y(_e,{key:Y,command:Y,disabled:a.status===Y},{default:t(()=>[e(k,{type:p(P)[Y],size:"small"},{default:t(()=>[n(o(C),1)]),_:2},1032,["type"])]),_:2},1032,["command","disabled"]))),128))]),_:2},1024)]),default:t(()=>[e(z,{size:"small",type:"success",link:""},{default:t(()=>[e(_,null,{default:t(()=>[e(p(Ve))]),_:1}),l[15]||(l[15]=n(" 状态 ",-1)),e(_,{class:"el-icon--right"},{default:t(()=>[e(p(De))]),_:1})]),_:1})]),_:2},1032,["onCommand"]),e(z,{size:"small",type:"danger",link:"",onClick:C=>oe(a)},{default:t(()=>[e(_,null,{default:t(()=>[e(p(H))]),_:1}),l[16]||(l[16]=n(" 删除 ",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[be,j.value]]),D.value.length>0?(d(),m("div",it,[e(ve,{title:`已选择 ${D.value.length} 个订单`,type:"info","show-icon":"",closable:!1},{default:t(()=>[r("div",ut,[e(z,{size:"small",type:"danger",onClick:se},{default:t(()=>[e(_,null,{default:t(()=>[e(p(H))]),_:1}),l[17]||(l[17]=n(" 批量删除 ",-1))]),_:1})])]),_:1},8,["title"])])):V("",!0),r("div",ct,[e(ye,{"current-page":b.current,"onUpdate:currentPage":l[5]||(l[5]=a=>b.current=a),"page-size":b.size,"onUpdate:pageSize":l[6]||(l[6]=a=>b.size=a),"page-sizes":[10,20,50,100],total:b.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:re,onCurrentChange:ie},null,8,["current-page","page-size","total"])])]),_:1}),e(ge,{modelValue:S.value,"onUpdate:modelValue":l[8]||(l[8]=a=>S.value=a),title:"订单详情",width:"800px","close-on-click-modal":!1,"destroy-on-close":""},{footer:t(()=>[r("div",Vt,[e(z,{onClick:l[7]||(l[7]=a=>S.value=!1)},{default:t(()=>[...l[18]||(l[18]=[n("关闭",-1)])]),_:1})])]),default:t(()=>[s.value?(d(),m("div",_t,[e(R,{title:"订单信息",column:2,border:""},{default:t(()=>[e(f,{label:"订单号"},{default:t(()=>[n(o(s.value.order_number),1)]),_:1}),e(f,{label:"订单状态"},{default:t(()=>[e(k,{type:p(P)[s.value.status],size:"small"},{default:t(()=>[n(o(p($)[s.value.status]),1)]),_:1},8,["type"])]),_:1}),e(f,{label:"下单时间"},{default:t(()=>[n(o(s.value.created_at),1)]),_:1}),e(f,{label:"更新时间"},{default:t(()=>[n(o(s.value.updated_at),1)]),_:1}),e(f,{label:"支付方式"},{default:t(()=>[n(o(s.value.payment_method),1)]),_:1}),e(f,{label:"订单金额"},{default:t(()=>[n(o(s.value.total_amount||s.value.product_price*s.value.quantity)+" "+o(s.value.currency),1)]),_:1})]),_:1}),e(R,{title:"客户信息",column:2,border:"",style:{"margin-top":"20px"}},{default:t(()=>[e(f,{label:"客户姓名"},{default:t(()=>[n(o(s.value.customer_name),1)]),_:1}),e(f,{label:"联系电话"},{default:t(()=>[n(o(s.value.phone),1)]),_:1}),e(f,{label:"邮箱地址",span:2},{default:t(()=>[n(o(s.value.email||"未填写"),1)]),_:1}),e(f,{label:"收货地址",span:2},{default:t(()=>[n(o(s.value.province)+o(s.value.city)+o(s.value.district)+o(s.value.address)+" ",1),s.value.postal_code?(d(),m("span",pt,"（"+o(s.value.postal_code)+"）",1)):V("",!0)]),_:1}),s.value.comments?(d(),y(f,{key:0,label:"客户备注",span:2},{default:t(()=>[n(o(s.value.comments),1)]),_:1})):V("",!0)]),_:1}),e(R,{title:"商品信息",column:1,border:"",style:{"margin-top":"20px"}},{default:t(()=>[e(f,{label:"商品"},{default:t(()=>[r("div",mt,[s.value.product_images&&s.value.product_images[0]?(d(),y(L,{key:0,size:60},{default:t(()=>[r("img",{src:s.value.product_images[0],alt:s.value.product_title,style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,ft)]),_:1})):(d(),y(L,{key:1,size:60},{default:t(()=>[e(_,null,{default:t(()=>[e(p(G))]),_:1})]),_:1})),r("div",vt,[r("div",yt,o(s.value.product_title||"商品已删除"),1),r("div",ht,"单价: "+o(s.value.product_price)+" "+o(s.value.currency),1),r("div",gt,"数量: "+o(s.value.quantity),1)])])]),_:1})]),_:1}),e(R,{title:"技术信息",column:2,border:"",style:{"margin-top":"20px"}},{default:t(()=>[e(f,{label:"下单IP"},{default:t(()=>[s.value.ip_address?(d(),y(k,{key:0,type:"info",size:"small"},{default:t(()=>[n(o(s.value.ip_address),1)]),_:1})):(d(),m("span",bt,"--"))]),_:1}),e(f,{label:"语言代码"},{default:t(()=>[s.value.language_code?(d(),y(k,{key:0,type:"success",size:"small"},{default:t(()=>[n(o(s.value.language_code.toUpperCase()),1)]),_:1})):(d(),m("span",kt,"--"))]),_:1}),e(f,{label:"页面追踪标识",span:2},{default:t(()=>[s.value.pd_val?(d(),y(k,{key:0,type:"warning",size:"small"},{default:t(()=>[n(o(s.value.pd_val),1)]),_:1})):(d(),m("span",wt,"--"))]),_:1}),e(f,{label:"来源URL",span:2},{default:t(()=>[s.value.from_url?(d(),y(A,{key:0,href:s.value.from_url,target:"_blank",type:"primary",size:"small"},{default:t(()=>[n(o(s.value.from_url),1)]),_:1},8,["href"])):(d(),m("span",zt,"--"))]),_:1}),e(f,{label:"浏览器信息",span:2},{default:t(()=>[s.value.user_agent?(d(),m("div",Ct,[e(he,{size:"small",type:"info"},{default:t(()=>[n(o(s.value.user_agent),1)]),_:1})])):(d(),m("span",xt,"--"))]),_:1})]),_:1})])):V("",!0)]),_:1},8,["modelValue"])])}}}),Rt=$e(Ot,[["__scopeId","data-v-7e7c6b5f"]]);export{Rt as default};
