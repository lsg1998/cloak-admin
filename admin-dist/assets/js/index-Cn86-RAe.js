import{d as P,P as G,h as A,Z as K,aJ as X,r as u,Q as Y,c as O,o as y,a,b as e,w as t,e as w,u as x,x as $,E as ee,b0 as te,t as _,aT as ae,aW as le,bx as se,W as oe,g as M,M as ne,N as ie}from"./index-D6reRM_r.js";import"./index-BpCvQqaw.js";import{b as de}from"./statistics-BjuKx_0O.js";import{aU as E}from"./installCanvasRenderer-Bf4uGEF_.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ce={class:"device-statistics-page"},ue={class:"overview-stats"},_e={class:"stat-content"},ve={class:"stat-icon total"},fe={class:"stat-info"},me={class:"stat-number"},pe={class:"stat-content"},he={class:"stat-icon devices"},be={class:"stat-info"},ge={class:"stat-number"},ye={class:"stat-content"},we={class:"stat-icon peak"},xe={class:"stat-info"},Se={class:"stat-number"},Ce={class:"stat-sub"},Re={class:"stat-content"},ke={class:"stat-icon avg"},ze={class:"stat-info"},Ae={class:"stat-number"},Me={class:"chart-header"},Ve={key:3},Le={class:"visit-count"},Te={class:"percentage-cell"},We={class:"percentage-text"},De=P({name:"DeviceStatisticsPage"}),Oe=P({...De,setup(Ee){const d=G({timeRange:"24h",device:"",timezone:"Asia/Shanghai"}),C=A(!1),r=A(null),V=A(),L=A();let v=null,f=null;const R=o=>o?o.toLocaleString():"0",N=o=>o==null?null:`${o.toString().padStart(2,"0")}:00`,U=()=>({"24h":"24小时","3d":"最近3天",week:"本周",month:"本月","7d":"最近7天","30d":"最近30天"})[d.timeRange]||"设备",B=o=>({iOS:"danger",iPad:"warning",Android:"success","Android Tablet":"success",Windows:"primary","Windows Mobile":"primary",macOS:"info",Linux:"",Mobile:"success",其他:"",未知:""})[o]||"",W=o=>!r.value||!r.value.total_visits?0:Math.round(o/r.value.total_visits*100),H=()=>{h()},F=()=>{if(!V.value||!r.value)return;v=E(V.value);const o=d.timeRange==="24h"||d.timeRange==="3d",l=o?r.value.hourly_stats:r.value.daily_stats,s=l.map(c=>o?c.label:c.date),p=l.map(c=>c.count),b={tooltip:{trigger:"axis",formatter:c=>{const S=c[0];return`${S.name}<br/>访问量: ${R(S.value)}`}},grid:{left:"3%",right:"4%",bottom:"10%",containLabel:!0},xAxis:{type:"category",data:s,axisLabel:{rotate:o?0:45,interval:o&&d.timeRange==="24h"?2:0}},yAxis:{type:"value",name:"访问量"},series:[{name:"访问量",type:"line",data:p,smooth:!0,itemStyle:{color:"#67C23A"},lineStyle:{color:"#67C23A",width:2},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(103, 194, 58, 0.3)"},{offset:1,color:"rgba(103, 194, 58, 0.1)"}]}}}]};v.setOption(b),window.addEventListener("resize",T)},I=()=>{if(!L.value||!r.value||!r.value.device_stats.length)return;f=E(L.value);const o=r.value.device_stats.slice(0,10).map(s=>({value:s.count,name:s.device})),l={tooltip:{trigger:"item",formatter:s=>{const p=(s.value/r.value.total_visits*100).toFixed(1);return`${s.name}<br/>访问量: ${R(s.value)}<br/>占比: ${p}%`}},legend:{orient:"vertical",left:"left",top:"middle",itemWidth:12,itemHeight:12,textStyle:{fontSize:12}},series:[{name:"设备类型",type:"pie",radius:["40%","70%"],center:["60%","50%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:8,borderColor:"#fff",borderWidth:2},label:{show:!1},emphasis:{label:{show:!0,fontSize:14,fontWeight:"bold"}},data:o}]};f.setOption(l),window.addEventListener("resize",T)},T=()=>{v&&v.resize(),f&&f.resize()},h=async()=>{C.value=!0;try{const o=await de({timeRange:d.timeRange,device:d.device||void 0,timezone:d.timezone});o.code===200&&(r.value=o.data,await ne(),v&&v.dispose(),f&&f.dispose(),F(),I())}catch(o){console.error("加载设备统计数据失败:",o),ie.error("加载设备统计数据失败")}finally{C.value=!1}},J=()=>{d.timeRange="24h",d.device="",d.timezone="Asia/Shanghai",h()};return K(()=>{h()}),X(()=>{v&&v.dispose(),f&&f.dispose(),window.removeEventListener("resize",T)}),(o,l)=>{const s=u("el-option"),p=u("el-select"),b=u("el-form-item"),c=u("el-icon"),S=u("el-button"),Q=u("el-form"),m=u("el-card"),g=u("el-col"),D=u("el-row"),k=u("el-tag"),z=u("el-table-column"),Z=u("el-progress"),j=u("el-table"),q=Y("loading");return y(),O("div",ce,[l[12]||(l[12]=a("div",{class:"page-header"},[a("h2",null,"设备统计分析"),a("p",null,"根据设备类型和时间段进行详细的设备使用分析")],-1)),e(m,{class:"filter-card",shadow:"never"},{default:t(()=>[e(Q,{model:d,inline:"",class:"filter-form"},{default:t(()=>[e(b,{label:"时间段"},{default:t(()=>[e(p,{modelValue:d.timeRange,"onUpdate:modelValue":l[0]||(l[0]=n=>d.timeRange=n),placeholder:"请选择时间段",onChange:H,style:{width:"180px"}},{default:t(()=>[e(s,{label:"最近24小时",value:"24h"}),e(s,{label:"最近3天",value:"3d"}),e(s,{label:"本周",value:"week"}),e(s,{label:"本月",value:"month"}),e(s,{label:"最近7天",value:"7d"}),e(s,{label:"最近30天",value:"30d"})]),_:1},8,["modelValue"])]),_:1}),e(b,{label:"设备类型"},{default:t(()=>[e(p,{modelValue:d.device,"onUpdate:modelValue":l[1]||(l[1]=n=>d.device=n),placeholder:"请选择设备",clearable:"",onChange:h,style:{width:"180px"}},{default:t(()=>[e(s,{label:"全部设备",value:""}),e(s,{label:"iOS",value:"iOS"}),e(s,{label:"iPad",value:"iPad"}),e(s,{label:"Android",value:"Android"}),e(s,{label:"Android Tablet",value:"Android Tablet"}),e(s,{label:"Windows",value:"Windows"}),e(s,{label:"Windows Mobile",value:"Windows Mobile"}),e(s,{label:"macOS",value:"macOS"}),e(s,{label:"Linux",value:"Linux"}),e(s,{label:"Mobile",value:"Mobile"}),e(s,{label:"其他",value:"其他"}),e(s,{label:"未知",value:"未知"})]),_:1},8,["modelValue"])]),_:1}),e(b,{label:"时区"},{default:t(()=>[e(p,{modelValue:d.timezone,"onUpdate:modelValue":l[2]||(l[2]=n=>d.timezone=n),onChange:h,style:{width:"140px"}},{default:t(()=>[e(s,{label:"北京时间",value:"Asia/Shanghai"}),e(s,{label:"欧洲时间",value:"Europe/Paris"})]),_:1},8,["modelValue"])]),_:1}),e(b,null,{default:t(()=>[e(S,{type:"primary",onClick:h,loading:C.value},{default:t(()=>[e(c,null,{default:t(()=>[e(x($))]),_:1}),l[3]||(l[3]=w(" 查询 ",-1))]),_:1},8,["loading"]),e(S,{onClick:J},{default:t(()=>[e(c,null,{default:t(()=>[e(x(ee))]),_:1}),l[4]||(l[4]=w(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a("div",ue,[e(D,{gutter:20},{default:t(()=>[e(g,{xs:24,sm:12,md:6},{default:t(()=>[e(m,{class:"stat-card",shadow:"hover"},{default:t(()=>{var n;return[a("div",_e,[a("div",ve,[e(c,null,{default:t(()=>[e(x(te))]),_:1})]),a("div",fe,[a("div",me,_(R(((n=r.value)==null?void 0:n.total_visits)||0)),1),l[5]||(l[5]=a("div",{class:"stat-label"},"总访问量",-1))])])]}),_:1})]),_:1}),e(g,{xs:24,sm:12,md:6},{default:t(()=>[e(m,{class:"stat-card",shadow:"hover"},{default:t(()=>{var n;return[a("div",pe,[a("div",he,[e(c,null,{default:t(()=>[e(x(ae))]),_:1})]),a("div",be,[a("div",ge,_(((n=r.value)==null?void 0:n.device_count)||0),1),l[6]||(l[6]=a("div",{class:"stat-label"},"设备类型数",-1))])])]}),_:1})]),_:1}),e(g,{xs:24,sm:12,md:6},{default:t(()=>[e(m,{class:"stat-card",shadow:"hover"},{default:t(()=>{var n,i;return[a("div",ye,[a("div",we,[e(c,null,{default:t(()=>[e(x(le))]),_:1})]),a("div",xe,[a("div",Se,_(N((n=r.value)==null?void 0:n.peak_hour)||"-"),1),l[7]||(l[7]=a("div",{class:"stat-label"},"峰值时段",-1)),a("div",Ce,_(((i=r.value)==null?void 0:i.peak_count)||0)+"次访问",1)])])]}),_:1})]),_:1}),e(g,{xs:24,sm:12,md:6},{default:t(()=>[e(m,{class:"stat-card",shadow:"hover"},{default:t(()=>{var n;return[a("div",Re,[a("div",ke,[e(c,null,{default:t(()=>[e(x(se))]),_:1})]),a("div",ze,[a("div",Ae,_(((n=r.value)==null?void 0:n.avg_visits_per_hour)||0),1),l[8]||(l[8]=a("div",{class:"stat-label"},"平均每小时",-1)),l[9]||(l[9]=a("div",{class:"stat-sub"},"访问量",-1))])])]}),_:1})]),_:1})]),_:1})]),e(D,{gutter:20,class:"charts-section"},{default:t(()=>[e(g,{xs:24,lg:16},{default:t(()=>[e(m,{class:"chart-card",shadow:"never"},{header:t(()=>[a("div",Me,[a("span",null,_(U())+"设备访问趋势",1)])]),default:t(()=>[a("div",{ref_key:"trendChartRef",ref:V,class:"chart-container"},null,512)]),_:1})]),_:1}),e(g,{xs:24,lg:8},{default:t(()=>[e(m,{class:"chart-card",shadow:"never"},{header:t(()=>[...l[10]||(l[10]=[a("span",null,"设备类型分布",-1)])]),default:t(()=>[a("div",{ref_key:"deviceChartRef",ref:L,class:"chart-container"},null,512)]),_:1})]),_:1})]),_:1}),e(m,{class:"table-card",shadow:"never",style:{"margin-top":"20px"}},{header:t(()=>[...l[11]||(l[11]=[a("div",{class:"card-header"},[a("span",{class:"card-title"},"设备详细数据")],-1)])]),default:t(()=>{var n;return[oe((y(),M(j,{data:((n=r.value)==null?void 0:n.device_stats)||[],border:""},{default:t(()=>[e(z,{label:"排名",width:"80",align:"center"},{default:t(({$index:i})=>[i===0?(y(),M(k,{key:0,type:"danger",size:"small"},{default:t(()=>[w(_(i+1),1)]),_:2},1024)):i===1?(y(),M(k,{key:1,type:"warning",size:"small"},{default:t(()=>[w(_(i+1),1)]),_:2},1024)):i===2?(y(),M(k,{key:2,type:"success",size:"small"},{default:t(()=>[w(_(i+1),1)]),_:2},1024)):(y(),O("span",Ve,_(i+1),1))]),_:1}),e(z,{label:"设备类型","min-width":"150"},{default:t(({row:i})=>[e(k,{type:B(i.device),size:"small"},{default:t(()=>[w(_(i.device),1)]),_:2},1032,["type"])]),_:1}),e(z,{label:"访问量",width:"120",align:"right"},{default:t(({row:i})=>[a("span",Le,_(R(i.count)),1)]),_:1}),e(z,{label:"占比",width:"200"},{default:t(({row:i})=>[a("div",Te,[e(Z,{percentage:W(i.count),"stroke-width":10},null,8,["percentage"]),a("span",We,_(W(i.count))+"%",1)])]),_:1})]),_:1},8,["data"])),[[q,C.value]])]}),_:1})])}}}),Fe=re(Oe,[["__scopeId","data-v-c0bdbdbc"]]);export{Fe as default};
