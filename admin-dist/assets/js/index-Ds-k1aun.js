import{d as q,h as w,P as G,s as dt,Z as ut,r as d,Q as ct,c as k,o as _,a as s,b as t,w as l,u as i,aU as _t,t as m,aC as P,aS as rt,aT as ft,_ as pt,x as K,e as p,E as R,W as gt,aX as U,g as A,aV as mt,aK as $,ar as vt,ay as bt,aY as kt,N as S,a0 as ht}from"./index-MWNwcRpq.js";import{g as xt}from"./product-CYTBvD1r.js";import{g as yt}from"./pixel-vJh0lwFZ.js";import{_ as Ct}from"./_plugin-vue_export-helper-DlAUqK2U.js";const wt={class:"pixel-management"},zt={class:"stats-cards"},Vt={class:"stat-content"},Pt={class:"stat-icon google"},At={class:"stat-info"},St={class:"stat-number"},Tt={class:"stat-content"},Dt={class:"stat-icon enabled"},Bt={class:"stat-info"},Gt={class:"stat-number"},Ut={class:"stat-content"},$t={class:"stat-icon google"},Et={class:"stat-info"},Ft={class:"stat-number"},Nt={class:"stat-content"},It={class:"stat-icon facebook"},Mt={class:"stat-info"},Kt={class:"stat-number"},Rt={class:"table-header"},qt={class:"table-title"},Jt={class:"table-actions"},Ot={class:"product-info"},jt={class:"product-details"},Lt={class:"product-title"},Qt={class:"product-id"},Wt={key:0,class:"pixel-status"},Xt={key:1,class:"pixel-status"},Yt={key:0,class:"pixel-status"},Zt={key:1,class:"pixel-status"},Ht={key:0,class:"pixel-status"},te={key:1,class:"pixel-status"},ee={key:1,style:{color:"#999999"}},le={class:"time-info"},se={class:"action-buttons"},ae={class:"pagination-wrapper"},oe={class:"pixel-config-content"},ne={class:"config-actions"},ie=q({name:"PixelManagement"}),de=q({...ie,setup(ue){const T=w(!1),D=w(!1),z=w(null),g=w(null),r=G({totalProducts:0,enabledProducts:0,googleAdsCount:0,facebookCount:0}),f=G({title:"",pixelStatus:"",platform:""}),c=G({current:1,size:20,total:0}),E=w([]),J=dt(()=>{var n;if(!((n=g.value)!=null&&n.google_ads_accounts))return!1;try{return JSON.parse(g.value.google_ads_accounts).some(o=>o.enabled)}catch{return!1}}),F=()=>{c.current=1,h()},O=()=>{f.title="",f.pixelStatus="",f.platform="",c.current=1,h()},j=n=>{c.size=n,c.current=1,h()},L=n=>{c.current=n,h()},Q=n=>{z.value=n,D.value=!0},W=n=>{S.info(`查看商品 ${n.title} 的像素配置详情`)},X=n=>{ht.confirm(`确定要测试商品 "${n.title}" 的像素配置吗？`,"测试确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{S.success("像素测试已启动，请查看控制台输出")})},Y=()=>{S.info("批量配置功能开发中...")},Z=()=>{z.value&&window.open(`/product/list?pixelConfig=${z.value.id}`,"_blank")},h=async()=>{T.value=!0;try{const[n,e]=await Promise.all([xt({page:c.current,size:c.size,title:f.title||void 0,status:void 0,product_type:void 0}),yt()]);E.value=n.data.list,c.total=n.data.total,g.value=e.data,H(n.data.list)}catch{S.error("获取数据失败")}finally{T.value=!1}},H=n=>{if(r.totalProducts=n.length,g.value){const e=g.value;r.enabledProducts=e.enabled?n.length:0;let o=!1;if(e.google_ads_accounts)try{o=JSON.parse(e.google_ads_accounts).some(x=>x.enabled)}catch(u){console.error("解析Google Ads账户配置失败:",u)}r.googleAdsCount=o?n.length:0,r.facebookCount=e.facebook_enabled?n.length:0}else r.enabledProducts=n.filter(e=>e.pixel_enabled).length,r.googleAdsCount=n.filter(e=>{var o,u;return(u=(o=e.pixel_config)==null?void 0:o.google_ads)==null?void 0:u.enabled}).length,r.facebookCount=n.filter(e=>{var o,u;return(u=(o=e.pixel_config)==null?void 0:o.facebook)==null?void 0:u.enabled}).length};return ut(()=>{h()}),(n,e)=>{var M;const o=d("el-icon"),u=d("el-card"),x=d("el-col"),tt=d("el-row"),et=d("el-input"),V=d("el-form-item"),y=d("el-option"),N=d("el-select"),v=d("el-button"),lt=d("el-form"),B=d("el-tag"),I=d("el-avatar"),b=d("el-table-column"),st=d("el-table"),at=d("el-pagination"),ot=d("el-alert"),nt=d("el-dialog"),it=ct("loading");return _(),k("div",wt,[e[27]||(e[27]=s("div",{class:"page-header"},[s("h2",null,"像素配置管理"),s("p",null,"管理所有商品的像素跟踪配置，支持Google Ads、Facebook、TikTok等平台")],-1)),s("div",zt,[t(tt,{gutter:20},{default:l(()=>[t(x,{span:6},{default:l(()=>[t(u,{class:"stat-card"},{default:l(()=>[s("div",Vt,[s("div",Pt,[t(o,null,{default:l(()=>[t(i(_t))]),_:1})]),s("div",At,[s("div",St,m(r.totalProducts),1),e[6]||(e[6]=s("div",{class:"stat-label"},"总商品数",-1))])])]),_:1})]),_:1}),t(x,{span:6},{default:l(()=>[t(u,{class:"stat-card"},{default:l(()=>[s("div",Tt,[s("div",Dt,[t(o,null,{default:l(()=>[t(i(P))]),_:1})]),s("div",Bt,[s("div",Gt,m(r.enabledProducts),1),e[7]||(e[7]=s("div",{class:"stat-label"},"已启用像素",-1))])])]),_:1})]),_:1}),t(x,{span:6},{default:l(()=>[t(u,{class:"stat-card"},{default:l(()=>[s("div",Ut,[s("div",$t,[t(o,null,{default:l(()=>[t(i(rt))]),_:1})]),s("div",Et,[s("div",Ft,m(r.googleAdsCount),1),e[8]||(e[8]=s("div",{class:"stat-label"},"Google Ads",-1))])])]),_:1})]),_:1}),t(x,{span:6},{default:l(()=>[t(u,{class:"stat-card"},{default:l(()=>[s("div",Nt,[s("div",It,[t(o,null,{default:l(()=>[t(i(ft))]),_:1})]),s("div",Mt,[s("div",Kt,m(r.facebookCount),1),e[9]||(e[9]=s("div",{class:"stat-label"},"Facebook",-1))])])]),_:1})]),_:1})]),_:1})]),t(u,{class:"search-card",shadow:"never"},{default:l(()=>[t(lt,{model:f,inline:"",class:"search-form"},{default:l(()=>[t(V,{label:"商品标题"},{default:l(()=>[t(et,{modelValue:f.title,"onUpdate:modelValue":e[0]||(e[0]=a=>f.title=a),placeholder:"请输入商品标题",clearable:"",style:{width:"200px"},onKeyup:pt(F,["enter"])},{prefix:l(()=>[t(o,null,{default:l(()=>[t(i(K))]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(V,{label:"像素状态"},{default:l(()=>[t(N,{modelValue:f.pixelStatus,"onUpdate:modelValue":e[1]||(e[1]=a=>f.pixelStatus=a),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:l(()=>[t(y,{label:"已启用",value:"enabled"}),t(y,{label:"未启用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1}),t(V,{label:"平台类型"},{default:l(()=>[t(N,{modelValue:f.platform,"onUpdate:modelValue":e[2]||(e[2]=a=>f.platform=a),placeholder:"请选择平台",clearable:"",style:{width:"120px"}},{default:l(()=>[t(y,{label:"Google Ads",value:"google_ads"}),t(y,{label:"Facebook",value:"facebook"}),t(y,{label:"TikTok",value:"tiktok"})]),_:1},8,["modelValue"])]),_:1}),t(V,null,{default:l(()=>[t(v,{type:"primary",onClick:F},{default:l(()=>[t(o,null,{default:l(()=>[t(i(K))]),_:1}),e[10]||(e[10]=p(" 搜索 ",-1))]),_:1}),t(v,{onClick:O},{default:l(()=>[t(o,null,{default:l(()=>[t(i(R))]),_:1}),e[11]||(e[11]=p(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(u,{class:"table-card",shadow:"never"},{default:l(()=>[s("div",Rt,[s("div",qt,[e[12]||(e[12]=s("span",null,"像素配置列表",-1)),t(B,{type:"info",size:"small"},{default:l(()=>[p(m(c.total)+" 条记录",1)]),_:1})]),s("div",Jt,[t(v,{type:"primary",onClick:Y},{default:l(()=>[t(o,null,{default:l(()=>[t(i(U))]),_:1}),e[13]||(e[13]=p(" 批量配置 ",-1))]),_:1}),t(v,{size:"small",onClick:h},{default:l(()=>[t(o,null,{default:l(()=>[t(i(R))]),_:1}),e[14]||(e[14]=p(" 刷新 ",-1))]),_:1})])]),gt((_(),A(st,{data:E.value,stripe:"",border:"",style:{width:"100%"},"header-cell-style":{background:"#f8f9fa",color:"#606266"}},{default:l(()=>[t(b,{prop:"title",label:"商品标题","min-width":"200","show-overflow-tooltip":""},{default:l(({row:a})=>[s("div",Ot,[a.image_urls&&a.image_urls[0]?(_(),A(I,{key:0,size:40,src:a.image_urls[0],shape:"square"},null,8,["src"])):(_(),A(I,{key:1,size:40,shape:"square"},{default:l(()=>[t(o,null,{default:l(()=>[t(i(mt))]),_:1})]),_:1})),s("div",jt,[s("div",Lt,m(a.title),1),s("div",Qt,"ID: "+m(a.id),1)])])]),_:1}),t(b,{label:"像素状态",width:"100",align:"center"},{default:l(()=>{var a;return[t(B,{type:(a=g.value)!=null&&a.enabled?"success":"info",size:"small"},{default:l(()=>{var C;return[p(m((C=g.value)!=null&&C.enabled?"已启用":"未启用"),1)]}),_:1},8,["type"])]}),_:1}),t(b,{label:"Google Ads",width:"120",align:"center"},{default:l(()=>[J.value?(_(),k("div",Wt,[t(o,{class:"status-icon success"},{default:l(()=>[t(i(P))]),_:1}),e[15]||(e[15]=s("span",{class:"status-text"},"已配置",-1))])):(_(),k("div",Xt,[t(o,{class:"status-icon disabled"},{default:l(()=>[t(i($))]),_:1}),e[16]||(e[16]=s("span",{class:"status-text"},"未配置",-1))]))]),_:1}),t(b,{label:"Facebook",width:"120",align:"center"},{default:l(()=>{var a;return[(a=g.value)!=null&&a.facebook_enabled?(_(),k("div",Yt,[t(o,{class:"status-icon success"},{default:l(()=>[t(i(P))]),_:1}),e[17]||(e[17]=s("span",{class:"status-text"},"已配置",-1))])):(_(),k("div",Zt,[t(o,{class:"status-icon disabled"},{default:l(()=>[t(i($))]),_:1}),e[18]||(e[18]=s("span",{class:"status-text"},"未配置",-1))]))]}),_:1}),t(b,{label:"TikTok",width:"120",align:"center"},{default:l(()=>{var a;return[(a=g.value)!=null&&a.tiktok_enabled?(_(),k("div",Ht,[t(o,{class:"status-icon success"},{default:l(()=>[t(i(P))]),_:1}),e[19]||(e[19]=s("span",{class:"status-text"},"已配置",-1))])):(_(),k("div",te,[t(o,{class:"status-icon disabled"},{default:l(()=>[t(i($))]),_:1}),e[20]||(e[20]=s("span",{class:"status-text"},"未配置",-1))]))]}),_:1}),t(b,{label:"自定义像素",width:"120",align:"center"},{default:l(()=>{var a;return[(a=g.value)!=null&&a.custom_pixels?(_(),A(B,{key:0,type:"warning",size:"small"},{default:l(()=>[...e[21]||(e[21]=[p("已配置",-1)])]),_:1})):(_(),k("span",ee,"--"))]}),_:1}),t(b,{prop:"updated_at",label:"更新时间",width:"180","show-overflow-tooltip":""},{default:l(({row:a})=>[s("div",le,[t(o,{class:"time-icon"},{default:l(()=>[t(i(vt))]),_:1}),s("span",null,m(a.updated_at),1)])]),_:1}),t(b,{label:"操作",width:"200",fixed:"right",align:"center"},{default:l(({row:a})=>[s("div",se,[t(v,{size:"small",type:"primary",link:"",onClick:C=>Q(a)},{default:l(()=>[t(o,null,{default:l(()=>[t(i(U))]),_:1}),e[22]||(e[22]=p(" 配置 ",-1))]),_:1},8,["onClick"]),t(v,{size:"small",type:"success",link:"",onClick:C=>W(a)},{default:l(()=>[t(o,null,{default:l(()=>[t(i(bt))]),_:1}),e[23]||(e[23]=p(" 查看 ",-1))]),_:1},8,["onClick"]),t(v,{size:"small",type:"warning",link:"",onClick:C=>X(a)},{default:l(()=>[t(o,null,{default:l(()=>[t(i(kt))]),_:1}),e[24]||(e[24]=p(" 测试 ",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[it,T.value]]),s("div",ae,[t(at,{"current-page":c.current,"onUpdate:currentPage":e[3]||(e[3]=a=>c.current=a),"page-size":c.size,"onUpdate:pageSize":e[4]||(e[4]=a=>c.size=a),"page-sizes":[10,20,50,100],total:c.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:j,onCurrentChange:L},null,8,["current-page","page-size","total"])])]),_:1}),t(nt,{modelValue:D.value,"onUpdate:modelValue":e[5]||(e[5]=a=>D.value=a),title:`像素配置 - ${(M=z.value)==null?void 0:M.title}`,width:"800px","close-on-click-modal":!1},{default:l(()=>[s("div",oe,[t(ot,{title:"像素配置说明",type:"info",closable:!1,"show-icon":""},{default:l(()=>[...e[25]||(e[25]=[s("p",null,"• Google Ads: 需要转化ID和转化标签",-1),s("p",null,"• Facebook: 需要像素ID",-1),s("p",null,"• TikTok: 需要像素ID",-1),s("p",null,"• 自定义: 可以添加任意像素代码",-1)])]),_:1}),s("div",ne,[t(v,{type:"primary",onClick:Z},{default:l(()=>[t(o,null,{default:l(()=>[t(i(U))]),_:1}),e[26]||(e[26]=p(" 打开详细配置 ",-1))]),_:1})])])]),_:1},8,["modelValue","title"])])}}}),pe=Ct(de,[["__scopeId","data-v-815c9a28"]]);export{pe as default};
