import{d as Z,h as b,P as z,Z as G,r,Q as H,c as V,o as P,b as t,w as a,_ as J,e as i,u as y,x as O,E as A,W as X,a as f,g as Y,t as m,U as ee,$ as te,N as h,a0 as ae}from"./index-cca_yqSo.js";import{b as le,c as se,u as ne}from"./order-CU7dEI1p.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const de={class:"ip-blacklist"},re={class:"table-header"},ie={class:"table-title"},ue={class:"table-actions"},pe={key:0},ce={class:"text-gray"},_e={key:1,class:"text-gray"},fe={class:"pagination-wrapper"},me=Z({__name:"index",setup(ge){const k=b(!1),x=b(!1),v=b(!1),I=b(),w=z({ip:""}),u=z({ip_address:"",reason:""}),E=/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,M={ip_address:[{required:!0,message:"请输入IP地址",trigger:"blur"},{validator:(n,e,d)=>{!e||E.test(e)||e.includes(":")?d():d(new Error("请输入有效的IP地址"))},trigger:"blur"}]},o=z({current:1,size:20,total:0}),D=b([]),N=n=>n?new Date(n).toLocaleString("zh-CN"):"--",c=async()=>{k.value=!0;try{const{data:n}=await le({page:o.current,size:o.size});D.value=n.list,o.total=n.total}catch{h.error("获取黑名单列表失败")}finally{k.value=!1}},C=()=>{o.current=1,c()},R=()=>{w.ip="",C()},$=n=>{o.size=n,o.current=1,c()},F=n=>{o.current=n,c()},T=()=>{u.ip_address="",u.reason="",v.value=!0},K=async()=>{I.value&&await I.value.validate(async n=>{var e,d;if(n){x.value=!0;try{await se({ip_address:u.ip_address,reason:u.reason||"手动添加"}),h.success("IP已加入黑名单"),v.value=!1,c()}catch(s){const p=((d=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:d.message)||(s==null?void 0:s.message)||"添加失败";h.error(p)}finally{x.value=!1}}})},L=n=>{ae.confirm(`确定要将IP "${n.ip_address}" 从黑名单中移除吗？

移除后，该IP将可以正常访问正品页面。`,"移除确认",{confirmButtonText:"确定移除",cancelButtonText:"取消",type:"warning"}).then(async()=>{var e,d;try{await ne({ip_address:n.ip_address}),h.success("IP已从黑名单移除"),c()}catch(s){const p=((d=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:d.message)||(s==null?void 0:s.message)||"移除失败";h.error(p)}})};return G(()=>{c()}),(n,e)=>{const d=r("el-input"),s=r("el-form-item"),p=r("el-icon"),_=r("el-button"),B=r("el-form"),U=r("el-card"),S=r("el-tag"),g=r("el-table-column"),j=r("el-table"),q=r("el-pagination"),Q=r("el-dialog"),W=H("loading");return P(),V("div",de,[t(U,{class:"search-card",shadow:"never"},{default:a(()=>[t(B,{model:w,inline:!0,class:"search-form"},{default:a(()=>[t(s,{label:"IP地址"},{default:a(()=>[t(d,{modelValue:w.ip,"onUpdate:modelValue":e[0]||(e[0]=l=>w.ip=l),placeholder:"请输入IP地址",clearable:"",style:{width:"200px"},onKeyup:J(C,["enter"])},null,8,["modelValue"])]),_:1}),t(s,null,{default:a(()=>[t(_,{type:"primary",onClick:C},{default:a(()=>[t(p,null,{default:a(()=>[t(y(O))]),_:1}),e[7]||(e[7]=i(" 搜索 ",-1))]),_:1}),t(_,{onClick:R},{default:a(()=>[t(p,null,{default:a(()=>[t(y(A))]),_:1}),e[8]||(e[8]=i(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(U,{class:"table-card",shadow:"never"},{header:a(()=>[f("div",re,[f("div",ie,[e[9]||(e[9]=f("span",null,"IP黑名单",-1)),t(S,{type:"info",size:"small"},{default:a(()=>[i(m(o.total)+" 条记录",1)]),_:1})]),f("div",ue,[t(_,{type:"primary",onClick:T},{default:a(()=>[t(p,null,{default:a(()=>[t(y(te))]),_:1}),e[10]||(e[10]=i(" 添加IP ",-1))]),_:1}),t(_,{onClick:c},{default:a(()=>[t(p,null,{default:a(()=>[t(y(A))]),_:1}),e[11]||(e[11]=i(" 刷新 ",-1))]),_:1})])])]),default:a(()=>[X((P(),Y(j,{data:D.value,stripe:"",border:"",style:{width:"100%"}},{default:a(()=>[t(g,{prop:"id",label:"ID",width:"80",align:"center"}),t(g,{prop:"ip_address",label:"IP地址",width:"180"},{default:a(({row:l})=>[t(S,{type:"danger"},{default:a(()=>[i(m(l.ip_address),1)]),_:2},1024)]),_:1}),t(g,{prop:"reason",label:"拉黑原因","min-width":"200","show-overflow-tooltip":""},{default:a(({row:l})=>[i(m(l.reason||"--"),1)]),_:1}),t(g,{label:"关联订单",width:"200"},{default:a(({row:l})=>[l.order_number?(P(),V("div",pe,[f("div",null,m(l.order_number),1),f("div",ce,m(l.customer_name)+" - "+m(l.phone),1)])):(P(),V("span",_e,"--"))]),_:1}),t(g,{prop:"created_at",label:"拉黑时间",width:"180",align:"center"},{default:a(({row:l})=>[i(m(N(l.created_at)),1)]),_:1}),t(g,{label:"操作",width:"120",align:"center",fixed:"right"},{default:a(({row:l})=>[t(_,{type:"danger",size:"small",link:"",onClick:ve=>L(l)},{default:a(()=>[t(p,null,{default:a(()=>[t(y(ee))]),_:1}),e[12]||(e[12]=i(" 移除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[W,k.value]]),f("div",fe,[t(q,{"current-page":o.current,"onUpdate:currentPage":e[1]||(e[1]=l=>o.current=l),"page-size":o.size,"onUpdate:pageSize":e[2]||(e[2]=l=>o.size=l),"page-sizes":[10,20,50,100],total:o.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:$,onCurrentChange:F},null,8,["current-page","page-size","total"])])]),_:1}),t(Q,{modelValue:v.value,"onUpdate:modelValue":e[6]||(e[6]=l=>v.value=l),title:"添加IP到黑名单",width:"500px","close-on-click-modal":!1},{footer:a(()=>[t(_,{onClick:e[5]||(e[5]=l=>v.value=!1)},{default:a(()=>[...e[13]||(e[13]=[i("取消",-1)])]),_:1}),t(_,{type:"primary",onClick:K,loading:x.value},{default:a(()=>[...e[14]||(e[14]=[i("确定添加",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(B,{model:u,rules:M,ref_key:"addFormRef",ref:I,"label-width":"100px"},{default:a(()=>[t(s,{label:"IP地址",prop:"ip_address"},{default:a(()=>[t(d,{modelValue:u.ip_address,"onUpdate:modelValue":e[3]||(e[3]=l=>u.ip_address=l),placeholder:"请输入IP地址"},null,8,["modelValue"])]),_:1}),t(s,{label:"拉黑原因",prop:"reason"},{default:a(()=>[t(d,{modelValue:u.reason,"onUpdate:modelValue":e[4]||(e[4]=l=>u.reason=l),type:"textarea",rows:3,placeholder:"请输入拉黑原因（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),we=oe(me,[["__scopeId","data-v-bd36e404"]]);export{we as default};
