import{a2 as S,d as X,h as D,P as F,Z as ke,r as u,Q as Ce,c as O,o as p,b as e,w as t,au as N,u as c,x as I,F as J,f as Q,g as C,e as i,E as W,W as xe,R as j,a as s,t as o,av as Z,aw as ze,ax as Ve,ay as De,az as Oe,U as G,V as Be,N as g,aA as H}from"./index-C86HIY7U.js";import{_ as Se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const A={pending:"待确认",confirmed:"已确认",processing:"处理中",shipped:"已发货",delivered:"已送达",cancelled:"已取消",refunded:"已退款"},T={pending:"warning",confirmed:"primary",processing:"info",shipped:"success",delivered:"success",cancelled:"danger",refunded:"danger"},Ue=(m={})=>{const x=Object.fromEntries(Object.entries(m).filter(([,z])=>z!=null&&z!==""));return S.get("/admin/orders",{params:x})},$e=m=>S.get(`/admin/orders/${m}`),je=(m,x)=>S.put(`/admin/orders/${m}/status`,x),Le=m=>S.delete(`/admin/orders/${m}`),Ye=m=>S.delete("/admin/orders/batch",{data:{ids:m}}),Re=(m={})=>S.get("/admin/orders/export",{params:m,responseType:"blob"}),Ae={class:"order-management"},Ee={class:"table-header"},Me={class:"table-title"},Ne={class:"table-actions"},Te={class:"order-number"},qe={class:"product-info"},Ke=["src","alt"],Pe={class:"product-details"},Fe={class:"product-title"},Ie={class:"product-subtitle"},Je={class:"customer-info"},Qe={class:"customer-name"},We={class:"customer-phone"},Ze={key:0,class:"customer-email"},Ge={class:"address-info"},He={class:"amount-info"},Xe={class:"amount"},et={class:"currency"},tt={class:"time-info"},at={class:"action-buttons"},lt={key:0,class:"batch-actions"},ot={class:"batch-buttons"},nt={class:"pagination-wrapper"},st={key:0,class:"order-detail"},dt={key:0},rt={class:"product-detail-info"},it=["src","alt"],ut={class:"product-detail-text"},ct={class:"product-title"},_t={class:"product-price"},pt={class:"product-quantity"},mt={class:"dialog-footer"},ft=X({name:"OrderList"}),vt=X({...ft,setup(m){const x=D(!1),z=D(!1),L=D(!1),n=D(null),V=D([]),d=F({order_number:"",customer_name:"",phone:"",status:"",start_date:"",end_date:""}),E=D(null),f=F({current:1,size:20,total:0}),q=D([]),U=()=>{f.current=1,k()},ee=()=>{Object.assign(d,{order_number:"",customer_name:"",phone:"",status:"",start_date:"",end_date:""}),E.value=null,U()},te=r=>{r?(d.start_date=r[0],d.end_date=r[1]):(d.start_date="",d.end_date="")},K=async r=>{try{const{data:l}=await $e(r.id);n.value=l,L.value=!0}catch{g.error("获取订单详情失败")}},ae=async(r,l)=>{try{await je(r.id,{status:l}),g.success("订单状态更新成功"),k()}catch{g.error("订单状态更新失败")}},le=r=>{H.confirm(`确定要删除订单 "${r.order_number}" 吗？删除后无法恢复！`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"}).then(async()=>{try{await Le(r.id),g.success("删除成功"),k()}catch{g.error("删除失败")}})},oe=()=>{const r=V.value.map(l=>l.order_number).join("、");H.confirm(`确定要删除选中的 ${V.value.length} 个订单吗？
订单号：${r}`,"批量删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"}).then(async()=>{try{const l=V.value.map(_=>_.id);await Ye(l),g.success("批量删除成功"),V.value=[],k()}catch{g.error("批量删除失败")}})},ne=async()=>{z.value=!0;try{const r={...d,order_number:d.order_number||void 0,customer_name:d.customer_name||void 0,phone:d.phone||void 0,status:d.status||void 0,start_date:d.start_date||void 0,end_date:d.end_date||void 0},l=await Re(r),_=new Blob([l.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),B=window.URL.createObjectURL(_),v=document.createElement("a");v.href=B,v.download=`订单列表_${new Date().toISOString().slice(0,10)}.xlsx`,document.body.appendChild(v),v.click(),document.body.removeChild(v),window.URL.revokeObjectURL(B),g.success("导出成功")}catch{g.error("导出失败")}finally{z.value=!1}},se=r=>{V.value=r},de=r=>{f.size=r,k()},re=r=>{f.current=r,k()},k=async()=>{x.value=!0;try{const r={page:f.current,size:f.size,order_number:d.order_number||void 0,customer_name:d.customer_name||void 0,phone:d.phone||void 0,status:d.status||void 0,start_date:d.start_date||void 0,end_date:d.end_date||void 0},{data:l}=await Ue(r);q.value=l.list,f.total=l.total}catch{g.error("获取订单列表失败")}finally{x.value=!1}};return ke(()=>{k()}),(r,l)=>{const _=u("el-icon"),B=u("el-input"),v=u("el-form-item"),ie=u("el-option"),ue=u("el-select"),ce=u("el-date-picker"),y=u("el-button"),_e=u("el-form"),P=u("el-card"),$=u("el-tag"),b=u("el-table-column"),pe=u("el-link"),Y=u("el-avatar"),me=u("el-dropdown-item"),fe=u("el-dropdown-menu"),ve=u("el-dropdown"),he=u("el-table"),be=u("el-alert"),ge=u("el-pagination"),h=u("el-descriptions-item"),M=u("el-descriptions"),ye=u("el-dialog"),we=Ce("loading");return p(),O("div",Ae,[e(P,{class:"search-card",shadow:"never"},{default:t(()=>[e(_e,{model:d,inline:"",class:"search-form"},{default:t(()=>[e(v,{label:"订单号"},{default:t(()=>[e(B,{modelValue:d.order_number,"onUpdate:modelValue":l[0]||(l[0]=a=>d.order_number=a),placeholder:"请输入订单号",clearable:"",style:{width:"200px"},onKeyup:N(U,["enter"])},{prefix:t(()=>[e(_,null,{default:t(()=>[e(c(I))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(v,{label:"客户姓名"},{default:t(()=>[e(B,{modelValue:d.customer_name,"onUpdate:modelValue":l[1]||(l[1]=a=>d.customer_name=a),placeholder:"请输入客户姓名",clearable:"",style:{width:"150px"},onKeyup:N(U,["enter"])},null,8,["modelValue"])]),_:1}),e(v,{label:"手机号"},{default:t(()=>[e(B,{modelValue:d.phone,"onUpdate:modelValue":l[2]||(l[2]=a=>d.phone=a),placeholder:"请输入手机号",clearable:"",style:{width:"150px"},onKeyup:N(U,["enter"])},null,8,["modelValue"])]),_:1}),e(v,{label:"订单状态"},{default:t(()=>[e(ue,{modelValue:d.status,"onUpdate:modelValue":l[3]||(l[3]=a=>d.status=a),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:t(()=>[(p(!0),O(J,null,Q(c(A),(a,w)=>(p(),C(ie,{key:w,label:a,value:w},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(v,{label:"下单时间"},{default:t(()=>[e(ce,{modelValue:E.value,"onUpdate:modelValue":l[4]||(l[4]=a=>E.value=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:te,style:{width:"240px"}},null,8,["modelValue"])]),_:1}),e(v,null,{default:t(()=>[e(y,{type:"primary",onClick:U},{default:t(()=>[e(_,null,{default:t(()=>[e(c(I))]),_:1}),l[9]||(l[9]=i(" 搜索 ",-1))]),_:1}),e(y,{onClick:ee},{default:t(()=>[e(_,null,{default:t(()=>[e(c(W))]),_:1}),l[10]||(l[10]=i(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(P,{class:"table-card",shadow:"never"},{header:t(()=>[s("div",Ee,[s("div",Me,[l[11]||(l[11]=s("span",null,"订单列表",-1)),e($,{type:"info",size:"small"},{default:t(()=>[i(o(f.total)+" 条记录",1)]),_:1})]),s("div",Ne,[e(y,{size:"small",onClick:ne,loading:z.value},{default:t(()=>[e(_,null,{default:t(()=>[e(c(Be))]),_:1}),l[12]||(l[12]=i(" 导出 ",-1))]),_:1},8,["loading"]),e(y,{size:"small",onClick:k},{default:t(()=>[e(_,null,{default:t(()=>[e(c(W))]),_:1}),l[13]||(l[13]=i(" 刷新 ",-1))]),_:1})])])]),default:t(()=>[xe((p(),C(he,{data:q.value,stripe:"",border:"",style:{width:"100%"},"header-cell-style":{background:"#f8f9fa",color:"#606266"},onSelectionChange:se},{default:t(()=>[e(b,{type:"selection",width:"55"}),e(b,{prop:"order_number",label:"订单号",width:"180","show-overflow-tooltip":""},{default:t(({row:a})=>[s("div",Te,[e(pe,{type:"primary",onClick:w=>K(a)},{default:t(()=>[i(o(a.order_number),1)]),_:2},1032,["onClick"])])]),_:1}),e(b,{label:"商品信息","min-width":"250","show-overflow-tooltip":""},{default:t(({row:a})=>[s("div",qe,[a.product_images&&a.product_images[0]?(p(),C(Y,{key:0,size:40,class:"product-avatar"},{default:t(()=>[s("img",{src:a.product_images[0],alt:a.product_title,style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,Ke)]),_:2},1024)):(p(),C(Y,{key:1,size:40,class:"product-avatar"},{default:t(()=>[e(_,null,{default:t(()=>[e(c(Z))]),_:1})]),_:1})),s("div",Pe,[s("div",Fe,o(a.product_title||"商品已删除"),1),s("div",Ie,"数量: "+o(a.quantity),1)])])]),_:1}),e(b,{label:"客户信息",width:"180"},{default:t(({row:a})=>[s("div",Je,[s("div",Qe,o(a.customer_name),1),s("div",We,o(a.phone),1),a.email?(p(),O("div",Ze,o(a.email),1)):j("",!0)])]),_:1}),e(b,{label:"收货地址","min-width":"200","show-overflow-tooltip":""},{default:t(({row:a})=>[s("div",Ge,o(a.province)+o(a.city)+o(a.district)+o(a.address),1)]),_:1}),e(b,{prop:"total_amount",label:"订单金额",width:"120",align:"center"},{default:t(({row:a})=>[s("div",He,[s("span",Xe,o(a.total_amount||a.product_price*a.quantity),1),s("span",et,o(a.currency||"JPY"),1)])]),_:1}),e(b,{prop:"payment_method",label:"支付方式",width:"100",align:"center"},{default:t(({row:a})=>[e($,{size:"small",type:"info"},{default:t(()=>[i(o(a.payment_method||"COD"),1)]),_:2},1024)]),_:1}),e(b,{prop:"status",label:"订单状态",width:"100",align:"center"},{default:t(({row:a})=>[e($,{type:c(T)[a.status],size:"small"},{default:t(()=>[i(o(c(A)[a.status]||a.status),1)]),_:2},1032,["type"])]),_:1}),e(b,{prop:"created_at",label:"下单时间",width:"180","show-overflow-tooltip":""},{default:t(({row:a})=>[s("div",tt,[e(_,{class:"time-icon"},{default:t(()=>[e(c(ze))]),_:1}),s("span",null,o(a.created_at),1)])]),_:1}),e(b,{label:"操作",width:"280",fixed:"right",align:"center"},{default:t(({row:a})=>[s("div",at,[e(y,{size:"small",type:"primary",link:"",onClick:w=>K(a)},{default:t(()=>[e(_,null,{default:t(()=>[e(c(Ve))]),_:1}),l[14]||(l[14]=i(" 查看 ",-1))]),_:1},8,["onClick"]),e(ve,{onCommand:w=>ae(a,w)},{dropdown:t(()=>[e(fe,null,{default:t(()=>[(p(!0),O(J,null,Q(c(A),(w,R)=>(p(),C(me,{key:R,command:R,disabled:a.status===R},{default:t(()=>[e($,{type:c(T)[R],size:"small"},{default:t(()=>[i(o(w),1)]),_:2},1032,["type"])]),_:2},1032,["command","disabled"]))),128))]),_:2},1024)]),default:t(()=>[e(y,{size:"small",type:"success",link:""},{default:t(()=>[e(_,null,{default:t(()=>[e(c(De))]),_:1}),l[15]||(l[15]=i(" 状态 ",-1)),e(_,{class:"el-icon--right"},{default:t(()=>[e(c(Oe))]),_:1})]),_:1})]),_:2},1032,["onCommand"]),e(y,{size:"small",type:"danger",link:"",onClick:w=>le(a)},{default:t(()=>[e(_,null,{default:t(()=>[e(c(G))]),_:1}),l[16]||(l[16]=i(" 删除 ",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[we,x.value]]),V.value.length>0?(p(),O("div",lt,[e(be,{title:`已选择 ${V.value.length} 个订单`,type:"info","show-icon":"",closable:!1},{default:t(()=>[s("div",ot,[e(y,{size:"small",type:"danger",onClick:oe},{default:t(()=>[e(_,null,{default:t(()=>[e(c(G))]),_:1}),l[17]||(l[17]=i(" 批量删除 ",-1))]),_:1})])]),_:1},8,["title"])])):j("",!0),s("div",nt,[e(ge,{"current-page":f.current,"onUpdate:currentPage":l[5]||(l[5]=a=>f.current=a),"page-size":f.size,"onUpdate:pageSize":l[6]||(l[6]=a=>f.size=a),"page-sizes":[10,20,50,100],total:f.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:de,onCurrentChange:re},null,8,["current-page","page-size","total"])])]),_:1}),e(ye,{modelValue:L.value,"onUpdate:modelValue":l[8]||(l[8]=a=>L.value=a),title:"订单详情",width:"800px","close-on-click-modal":!1,"destroy-on-close":""},{footer:t(()=>[s("div",mt,[e(y,{onClick:l[7]||(l[7]=a=>L.value=!1)},{default:t(()=>[...l[18]||(l[18]=[i("关闭",-1)])]),_:1})])]),default:t(()=>[n.value?(p(),O("div",st,[e(M,{title:"订单信息",column:2,border:""},{default:t(()=>[e(h,{label:"订单号"},{default:t(()=>[i(o(n.value.order_number),1)]),_:1}),e(h,{label:"订单状态"},{default:t(()=>[e($,{type:c(T)[n.value.status],size:"small"},{default:t(()=>[i(o(c(A)[n.value.status]),1)]),_:1},8,["type"])]),_:1}),e(h,{label:"下单时间"},{default:t(()=>[i(o(n.value.created_at),1)]),_:1}),e(h,{label:"更新时间"},{default:t(()=>[i(o(n.value.updated_at),1)]),_:1}),e(h,{label:"支付方式"},{default:t(()=>[i(o(n.value.payment_method),1)]),_:1}),e(h,{label:"订单金额"},{default:t(()=>[i(o(n.value.total_amount||n.value.product_price*n.value.quantity)+" "+o(n.value.currency),1)]),_:1})]),_:1}),e(M,{title:"客户信息",column:2,border:"",style:{"margin-top":"20px"}},{default:t(()=>[e(h,{label:"客户姓名"},{default:t(()=>[i(o(n.value.customer_name),1)]),_:1}),e(h,{label:"联系电话"},{default:t(()=>[i(o(n.value.phone),1)]),_:1}),e(h,{label:"邮箱地址",span:2},{default:t(()=>[i(o(n.value.email||"未填写"),1)]),_:1}),e(h,{label:"收货地址",span:2},{default:t(()=>[i(o(n.value.province)+o(n.value.city)+o(n.value.district)+o(n.value.address)+" ",1),n.value.postal_code?(p(),O("span",dt,"（"+o(n.value.postal_code)+"）",1)):j("",!0)]),_:1}),n.value.comments?(p(),C(h,{key:0,label:"客户备注",span:2},{default:t(()=>[i(o(n.value.comments),1)]),_:1})):j("",!0)]),_:1}),e(M,{title:"商品信息",column:1,border:"",style:{"margin-top":"20px"}},{default:t(()=>[e(h,{label:"商品"},{default:t(()=>[s("div",rt,[n.value.product_images&&n.value.product_images[0]?(p(),C(Y,{key:0,size:60},{default:t(()=>[s("img",{src:n.value.product_images[0],alt:n.value.product_title,style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,it)]),_:1})):(p(),C(Y,{key:1,size:60},{default:t(()=>[e(_,null,{default:t(()=>[e(c(Z))]),_:1})]),_:1})),s("div",ut,[s("div",ct,o(n.value.product_title||"商品已删除"),1),s("div",_t,"单价: "+o(n.value.product_price)+" "+o(n.value.currency),1),s("div",pt,"数量: "+o(n.value.quantity),1)])])]),_:1})]),_:1})])):j("",!0)]),_:1},8,["modelValue"])])}}}),gt=Se(vt,[["__scopeId","data-v-8475f7e1"]]);export{gt as default};
