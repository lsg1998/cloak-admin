import{d as X,h as V,P,Z as ge,r as c,Q as we,c as D,o as m,b as e,w as t,az as N,u as _,x as I,F as J,f as Q,g as C,e as i,E as W,W as ke,R as S,a as s,t as o,aA as Z,aB as Ce,aC as xe,aD as ze,aE as Ve,U as G,V as De,N as f,aF as H}from"./index-BPD81Zva.js";import{a as $,O as q,b as Oe,u as Be,d as Se,c as Ue,e as Le,f as Ye}from"./order-C8lQIW2x.js";import{_ as $e}from"./_plugin-vue_export-helper-DlAUqK2U.js";const je={class:"order-management"},Re={class:"table-header"},Ae={class:"table-title"},Ee={class:"table-actions"},Me={class:"order-number"},Ne={class:"product-info"},qe=["src","alt"],Te={class:"product-details"},Fe={class:"product-title"},Ke={class:"product-subtitle"},Pe={class:"customer-info"},Ie={class:"customer-name"},Je={class:"customer-phone"},Qe={key:0,class:"customer-email"},We={class:"address-info"},Ze={class:"amount-info"},Ge={class:"amount"},He={class:"currency"},Xe={class:"time-info"},et={class:"action-buttons"},tt={key:0,class:"batch-actions"},at={class:"batch-buttons"},lt={class:"pagination-wrapper"},ot={key:0,class:"order-detail"},nt={key:0},st={class:"product-detail-info"},dt=["src","alt"],rt={class:"product-detail-text"},it={class:"product-title"},ut={class:"product-price"},ct={class:"product-quantity"},_t={class:"dialog-footer"},pt=X({name:"OrderList"}),mt=X({...pt,setup(ft){const j=V(!1),R=V(!1),U=V(!1),n=V(null),x=V([]),d=P({order_number:"",customer_name:"",phone:"",status:"",start_date:"",end_date:""}),A=V(null),v=P({current:1,size:20,total:0}),T=V([]),O=()=>{v.current=1,k()},ee=()=>{Object.assign(d,{order_number:"",customer_name:"",phone:"",status:"",start_date:"",end_date:""}),A.value=null,O()},te=r=>{r?(d.start_date=r[0],d.end_date=r[1]):(d.start_date="",d.end_date="")},F=async r=>{try{const{data:a}=await Oe(r.id);n.value=a,U.value=!0}catch{f.error("获取订单详情失败")}},ae=async(r,a)=>{try{await Be(r.id,{status:a}),f.success("订单状态更新成功"),k()}catch{f.error("订单状态更新失败")}},le=r=>{H.confirm(`确定要删除订单 "${r.order_number}" 吗？删除后无法恢复！`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"}).then(async()=>{try{await Se(r.id),f.success("删除成功"),k()}catch{f.error("删除失败")}})},oe=()=>{const r=x.value.map(a=>a.order_number).join("、");H.confirm(`确定要删除选中的 ${x.value.length} 个订单吗？
订单号：${r}`,"批量删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"}).then(async()=>{try{const a=x.value.map(u=>u.id);await Ue(a),f.success("批量删除成功"),x.value=[],k()}catch{f.error("批量删除失败")}})},ne=async()=>{R.value=!0;try{const r={...d,order_number:d.order_number||void 0,customer_name:d.customer_name||void 0,phone:d.phone||void 0,status:d.status||void 0,start_date:d.start_date||void 0,end_date:d.end_date||void 0},a=await Le(r);let u,p;if(a&&a.data)p=a.data;else if(typeof a=="string"&&a.trim())p=a;else{f.warning("没有数据可导出");return}if(!p||typeof p=="string"&&p.trim()===""){f.warning("导出的数据为空");return}if(p instanceof Blob)u=p;else if(typeof p=="string")u=new Blob([p],{type:"text/csv; charset=utf-8"});else{const E=typeof p=="object"?JSON.stringify(p):String(p);u=new Blob([E],{type:"text/csv; charset=utf-8"})}if(u.size===0){f.warning("导出的数据为空");return}const y=window.URL.createObjectURL(u),z=document.createElement("a");z.href=y,z.download=`订单列表_${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(z),z.click(),document.body.removeChild(z),window.URL.revokeObjectURL(y),f.success("导出成功")}catch(r){console.error("导出失败:",r),f.error("导出失败")}finally{R.value=!1}},se=r=>{x.value=r},de=r=>{v.size=r,k()},re=r=>{v.current=r,k()},k=async()=>{j.value=!0;try{const r={page:v.current,size:v.size,order_number:d.order_number||void 0,customer_name:d.customer_name||void 0,phone:d.phone||void 0,status:d.status||void 0,start_date:d.start_date||void 0,end_date:d.end_date||void 0},{data:a}=await Ye(r);T.value=a.list,v.total=a.total}catch{f.error("获取订单列表失败")}finally{j.value=!1}};return ge(()=>{k()}),(r,a)=>{const u=c("el-icon"),p=c("el-input"),y=c("el-form-item"),z=c("el-option"),E=c("el-select"),ie=c("el-date-picker"),g=c("el-button"),ue=c("el-form"),K=c("el-card"),B=c("el-tag"),b=c("el-table-column"),ce=c("el-link"),L=c("el-avatar"),_e=c("el-dropdown-item"),pe=c("el-dropdown-menu"),me=c("el-dropdown"),fe=c("el-table"),ve=c("el-alert"),he=c("el-pagination"),h=c("el-descriptions-item"),M=c("el-descriptions"),be=c("el-dialog"),ye=we("loading");return m(),D("div",je,[e(K,{class:"search-card",shadow:"never"},{default:t(()=>[e(ue,{model:d,inline:"",class:"search-form"},{default:t(()=>[e(y,{label:"订单号"},{default:t(()=>[e(p,{modelValue:d.order_number,"onUpdate:modelValue":a[0]||(a[0]=l=>d.order_number=l),placeholder:"请输入订单号",clearable:"",style:{width:"200px"},onKeyup:N(O,["enter"])},{prefix:t(()=>[e(u,null,{default:t(()=>[e(_(I))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(y,{label:"客户姓名"},{default:t(()=>[e(p,{modelValue:d.customer_name,"onUpdate:modelValue":a[1]||(a[1]=l=>d.customer_name=l),placeholder:"请输入客户姓名",clearable:"",style:{width:"150px"},onKeyup:N(O,["enter"])},null,8,["modelValue"])]),_:1}),e(y,{label:"手机号"},{default:t(()=>[e(p,{modelValue:d.phone,"onUpdate:modelValue":a[2]||(a[2]=l=>d.phone=l),placeholder:"请输入手机号",clearable:"",style:{width:"150px"},onKeyup:N(O,["enter"])},null,8,["modelValue"])]),_:1}),e(y,{label:"订单状态"},{default:t(()=>[e(E,{modelValue:d.status,"onUpdate:modelValue":a[3]||(a[3]=l=>d.status=l),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:t(()=>[(m(!0),D(J,null,Q(_($),(l,w)=>(m(),C(z,{key:w,label:l,value:w},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(y,{label:"下单时间"},{default:t(()=>[e(ie,{modelValue:A.value,"onUpdate:modelValue":a[4]||(a[4]=l=>A.value=l),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:te,style:{width:"240px"}},null,8,["modelValue"])]),_:1}),e(y,null,{default:t(()=>[e(g,{type:"primary",onClick:O},{default:t(()=>[e(u,null,{default:t(()=>[e(_(I))]),_:1}),a[9]||(a[9]=i(" 搜索 ",-1))]),_:1}),e(g,{onClick:ee},{default:t(()=>[e(u,null,{default:t(()=>[e(_(W))]),_:1}),a[10]||(a[10]=i(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(K,{class:"table-card",shadow:"never"},{header:t(()=>[s("div",Re,[s("div",Ae,[a[11]||(a[11]=s("span",null,"订单列表",-1)),e(B,{type:"info",size:"small"},{default:t(()=>[i(o(v.total)+" 条记录",1)]),_:1})]),s("div",Ee,[e(g,{size:"small",onClick:ne,loading:R.value},{default:t(()=>[e(u,null,{default:t(()=>[e(_(De))]),_:1}),a[12]||(a[12]=i(" 导出 ",-1))]),_:1},8,["loading"]),e(g,{size:"small",onClick:k},{default:t(()=>[e(u,null,{default:t(()=>[e(_(W))]),_:1}),a[13]||(a[13]=i(" 刷新 ",-1))]),_:1})])])]),default:t(()=>[ke((m(),C(fe,{data:T.value,stripe:"",border:"",style:{width:"100%"},"header-cell-style":{background:"#f8f9fa",color:"#606266"},onSelectionChange:se},{default:t(()=>[e(b,{type:"selection",width:"55"}),e(b,{prop:"order_number",label:"订单号",width:"180","show-overflow-tooltip":""},{default:t(({row:l})=>[s("div",Me,[e(ce,{type:"primary",onClick:w=>F(l)},{default:t(()=>[i(o(l.order_number),1)]),_:2},1032,["onClick"])])]),_:1}),e(b,{label:"商品信息","min-width":"250","show-overflow-tooltip":""},{default:t(({row:l})=>[s("div",Ne,[l.product_images&&l.product_images[0]?(m(),C(L,{key:0,size:40,class:"product-avatar"},{default:t(()=>[s("img",{src:l.product_images[0],alt:l.product_title,style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,qe)]),_:2},1024)):(m(),C(L,{key:1,size:40,class:"product-avatar"},{default:t(()=>[e(u,null,{default:t(()=>[e(_(Z))]),_:1})]),_:1})),s("div",Te,[s("div",Fe,o(l.product_title||"商品已删除"),1),s("div",Ke,"数量: "+o(l.quantity),1)])])]),_:1}),e(b,{label:"客户信息",width:"180"},{default:t(({row:l})=>[s("div",Pe,[s("div",Ie,o(l.customer_name),1),s("div",Je,o(l.phone),1),l.email?(m(),D("div",Qe,o(l.email),1)):S("",!0)])]),_:1}),e(b,{label:"收货地址","min-width":"200","show-overflow-tooltip":""},{default:t(({row:l})=>[s("div",We,o(l.province)+o(l.city)+o(l.district)+o(l.address),1)]),_:1}),e(b,{prop:"total_amount",label:"订单金额",width:"120",align:"center"},{default:t(({row:l})=>[s("div",Ze,[s("span",Ge,o(l.total_amount||l.product_price*l.quantity),1),s("span",He,o(l.currency||"JPY"),1)])]),_:1}),e(b,{prop:"payment_method",label:"支付方式",width:"100",align:"center"},{default:t(({row:l})=>[e(B,{size:"small",type:"info"},{default:t(()=>[i(o(l.payment_method||"COD"),1)]),_:2},1024)]),_:1}),e(b,{prop:"status",label:"订单状态",width:"100",align:"center"},{default:t(({row:l})=>[e(B,{type:_(q)[l.status],size:"small"},{default:t(()=>[i(o(_($)[l.status]||l.status),1)]),_:2},1032,["type"])]),_:1}),e(b,{prop:"created_at",label:"下单时间",width:"180","show-overflow-tooltip":""},{default:t(({row:l})=>[s("div",Xe,[e(u,{class:"time-icon"},{default:t(()=>[e(_(Ce))]),_:1}),s("span",null,o(l.created_at),1)])]),_:1}),e(b,{label:"操作",width:"280",fixed:"right",align:"center"},{default:t(({row:l})=>[s("div",et,[e(g,{size:"small",type:"primary",link:"",onClick:w=>F(l)},{default:t(()=>[e(u,null,{default:t(()=>[e(_(xe))]),_:1}),a[14]||(a[14]=i(" 查看 ",-1))]),_:1},8,["onClick"]),e(me,{onCommand:w=>ae(l,w)},{dropdown:t(()=>[e(pe,null,{default:t(()=>[(m(!0),D(J,null,Q(_($),(w,Y)=>(m(),C(_e,{key:Y,command:Y,disabled:l.status===Y},{default:t(()=>[e(B,{type:_(q)[Y],size:"small"},{default:t(()=>[i(o(w),1)]),_:2},1032,["type"])]),_:2},1032,["command","disabled"]))),128))]),_:2},1024)]),default:t(()=>[e(g,{size:"small",type:"success",link:""},{default:t(()=>[e(u,null,{default:t(()=>[e(_(ze))]),_:1}),a[15]||(a[15]=i(" 状态 ",-1)),e(u,{class:"el-icon--right"},{default:t(()=>[e(_(Ve))]),_:1})]),_:1})]),_:2},1032,["onCommand"]),e(g,{size:"small",type:"danger",link:"",onClick:w=>le(l)},{default:t(()=>[e(u,null,{default:t(()=>[e(_(G))]),_:1}),a[16]||(a[16]=i(" 删除 ",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[ye,j.value]]),x.value.length>0?(m(),D("div",tt,[e(ve,{title:`已选择 ${x.value.length} 个订单`,type:"info","show-icon":"",closable:!1},{default:t(()=>[s("div",at,[e(g,{size:"small",type:"danger",onClick:oe},{default:t(()=>[e(u,null,{default:t(()=>[e(_(G))]),_:1}),a[17]||(a[17]=i(" 批量删除 ",-1))]),_:1})])]),_:1},8,["title"])])):S("",!0),s("div",lt,[e(he,{"current-page":v.current,"onUpdate:currentPage":a[5]||(a[5]=l=>v.current=l),"page-size":v.size,"onUpdate:pageSize":a[6]||(a[6]=l=>v.size=l),"page-sizes":[10,20,50,100],total:v.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:de,onCurrentChange:re},null,8,["current-page","page-size","total"])])]),_:1}),e(be,{modelValue:U.value,"onUpdate:modelValue":a[8]||(a[8]=l=>U.value=l),title:"订单详情",width:"800px","close-on-click-modal":!1,"destroy-on-close":""},{footer:t(()=>[s("div",_t,[e(g,{onClick:a[7]||(a[7]=l=>U.value=!1)},{default:t(()=>[...a[18]||(a[18]=[i("关闭",-1)])]),_:1})])]),default:t(()=>[n.value?(m(),D("div",ot,[e(M,{title:"订单信息",column:2,border:""},{default:t(()=>[e(h,{label:"订单号"},{default:t(()=>[i(o(n.value.order_number),1)]),_:1}),e(h,{label:"订单状态"},{default:t(()=>[e(B,{type:_(q)[n.value.status],size:"small"},{default:t(()=>[i(o(_($)[n.value.status]),1)]),_:1},8,["type"])]),_:1}),e(h,{label:"下单时间"},{default:t(()=>[i(o(n.value.created_at),1)]),_:1}),e(h,{label:"更新时间"},{default:t(()=>[i(o(n.value.updated_at),1)]),_:1}),e(h,{label:"支付方式"},{default:t(()=>[i(o(n.value.payment_method),1)]),_:1}),e(h,{label:"订单金额"},{default:t(()=>[i(o(n.value.total_amount||n.value.product_price*n.value.quantity)+" "+o(n.value.currency),1)]),_:1})]),_:1}),e(M,{title:"客户信息",column:2,border:"",style:{"margin-top":"20px"}},{default:t(()=>[e(h,{label:"客户姓名"},{default:t(()=>[i(o(n.value.customer_name),1)]),_:1}),e(h,{label:"联系电话"},{default:t(()=>[i(o(n.value.phone),1)]),_:1}),e(h,{label:"邮箱地址",span:2},{default:t(()=>[i(o(n.value.email||"未填写"),1)]),_:1}),e(h,{label:"收货地址",span:2},{default:t(()=>[i(o(n.value.province)+o(n.value.city)+o(n.value.district)+o(n.value.address)+" ",1),n.value.postal_code?(m(),D("span",nt,"（"+o(n.value.postal_code)+"）",1)):S("",!0)]),_:1}),n.value.comments?(m(),C(h,{key:0,label:"客户备注",span:2},{default:t(()=>[i(o(n.value.comments),1)]),_:1})):S("",!0)]),_:1}),e(M,{title:"商品信息",column:1,border:"",style:{"margin-top":"20px"}},{default:t(()=>[e(h,{label:"商品"},{default:t(()=>[s("div",st,[n.value.product_images&&n.value.product_images[0]?(m(),C(L,{key:0,size:60},{default:t(()=>[s("img",{src:n.value.product_images[0],alt:n.value.product_title,style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,dt)]),_:1})):(m(),C(L,{key:1,size:60},{default:t(()=>[e(u,null,{default:t(()=>[e(_(Z))]),_:1})]),_:1})),s("div",rt,[s("div",it,o(n.value.product_title||"商品已删除"),1),s("div",ut,"单价: "+o(n.value.product_price)+" "+o(n.value.currency),1),s("div",ct,"数量: "+o(n.value.quantity),1)])])]),_:1})]),_:1})])):S("",!0)]),_:1},8,["modelValue"])])}}}),yt=$e(mt,[["__scopeId","data-v-6c74ffd7"]]);export{yt as default};
