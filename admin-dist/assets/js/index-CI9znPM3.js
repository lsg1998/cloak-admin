import{d as Ee,h as b,P as I,Z as we,r as i,Q as Ve,c as v,o as _,b as l,w as a,_ as Ce,e as s,a as z,W as Te,u as ze,$ as Le,g as U,R as Z,t as L,F as H,f as K,N as E,a0 as xe}from"./index-DYa8pX8D.js";import{c as S}from"./cloakRule-BFz6xtPM.js";import{_ as Oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ge={class:"cloak-rule-list"},Ue={class:"table-header"},Se={class:"table-actions"},Ae={key:1,class:"text-gray-400"},De={key:0},Me={key:1,class:"text-gray-400"},Ne={key:0},Re={key:1,class:"text-gray-400"},he={class:"pagination-wrapper"},Ie={class:"dialog-footer"},Fe=Ee({__name:"index",setup(Be){const A=b(!1),D=b(!1),w=b(!1),G=b(""),M=b(),V=b("DEFAULT"),W=[{label:"日本",value:"JA"},{label:"中国",value:"ZH"},{label:"英国",value:"EN"},{label:"斯洛伐克",value:"SK"},{label:"斯洛文尼亚",value:"SI"},{label:"波兰",value:"PL"},{label:"葡萄牙",value:"PT"},{label:"匈牙利",value:"HU"},{label:"意大利",value:"IT"},{label:"西班牙",value:"ES"},{label:"捷克",value:"CZ"}],q=[{label:"亚洲/东京 (日本)",value:"Asia/Tokyo"},{label:"亚洲/上海 (中国)",value:"Asia/Shanghai"},{label:"欧洲/伦敦 (英国)",value:"Europe/London"},{label:"欧洲/布拉迪斯拉发 (斯洛伐克)",value:"Europe/Bratislava"},{label:"欧洲/卢布尔雅那 (斯洛文尼亚)",value:"Europe/Ljubljana"},{label:"欧洲/华沙 (波兰)",value:"Europe/Warsaw"},{label:"欧洲/里斯本 (葡萄牙)",value:"Europe/Lisbon"},{label:"欧洲/布达佩斯 (匈牙利)",value:"Europe/Budapest"},{label:"欧洲/罗马 (意大利)",value:"Europe/Rome"},{label:"欧洲/马德里 (西班牙)",value:"Europe/Madrid"},{label:"欧洲/布拉格 (捷克)",value:"Europe/Prague"},{label:"美国/纽约 (美国东部)",value:"America/New_York"},{label:"美国/洛杉矶 (美国西部)",value:"America/Los_Angeles"},{label:"欧洲/巴黎 (法国)",value:"Europe/Paris"},{label:"欧洲/柏林 (德国)",value:"Europe/Berlin"},{label:"亚洲/首尔 (韩国)",value:"Asia/Seoul"},{label:"亚洲/新加坡 (新加坡)",value:"Asia/Singapore"},{label:"澳大利亚/悉尼 (澳大利亚)",value:"Australia/Sydney"}],J={JA:"Asia/Tokyo",ZH:"Asia/Shanghai",EN:"Europe/London",SK:"Europe/Bratislava",SI:"Europe/Ljubljana",PL:"Europe/Warsaw",PT:"Europe/Lisbon",HU:"Europe/Budapest",IT:"Europe/Rome",ES:"Europe/Madrid",CZ:"Europe/Prague"},c=I({name:"",mode:"",is_active:null}),p=I({page:1,size:20,total:0}),N=b([]),Q=b([]),n=I({name:"",target_regions:[],mode:"cloak",google_detection_mode:"DEFAULT",spider_whitelist:[],block_pc:0,block_proxy:0,blocked_keywords:[],allowed_countries:[],blocked_countries:[],allowed_organizations:[],blocked_organizations:[],allowed_timezones:[],description:"",is_active:1}),Y={name:[{required:!0,message:"请输入规则名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],mode:[{required:!0,message:"请选择模式",trigger:"change"}]},X=o=>({cloak:"warning",green:"success",open:"info",audit:"danger"})[o]||"info",ee=o=>({cloak:"斗篷",green:"绿色",open:"全开",audit:"审核"})[o]||o,le=o=>({DEFAULT:"info",GOOGLE_STRICT:"danger",GOOGLE_LENIENT:"success"})[o]||"info",ae=o=>({DEFAULT:"默认",GOOGLE_STRICT:"严格",GOOGLE_LENIENT:"宽松"})[o]||o,F=()=>{let o=n.description||"";o=o.replace(/\[GOOGLE_\w+\]/g,""),V.value!=="DEFAULT"&&(o=`[${V.value}] ${o}`.trim()),n.description=o},te=o=>o.includes("GOOGLE_STRICT")?"GOOGLE_STRICT":o.includes("GOOGLE_LENIENT")?"GOOGLE_LENIENT":"DEFAULT",oe=o=>o?new Date(o).toLocaleString("zh-CN"):"--",C=async()=>{try{A.value=!0;const o={page:p.page,size:p.size,...c},e=await S.getCloakRules(o);e.code===200&&(N.value=e.data.list,p.total=e.data.total)}catch(o){console.error("获取斗篷规则列表失败:",o),E.error("获取斗篷规则列表失败")}finally{A.value=!1}},R=()=>{p.page=1,C()},ne=()=>{Object.assign(c,{name:"",mode:"",is_active:null}),R()},se=o=>{p.size=o,p.page=1,C()},de=o=>{p.page=o,C()},ie=o=>{Q.value=o},ue=()=>{G.value="新增斗篷规则",B(),w.value=!0},re=o=>{G.value="编辑斗篷规则",Object.assign(n,{...o,target_regions:o.target_regions||[],spider_whitelist:o.spider_whitelist||[],blocked_keywords:o.blocked_keywords||[],allowed_countries:o.allowed_countries||[],blocked_countries:o.blocked_countries||[],allowed_organizations:o.allowed_organizations||[],blocked_organizations:o.blocked_organizations||[]}),V.value=te(o.description||""),w.value=!0},pe=async o=>{try{E.info(`查看使用规则"${o.name}"的商品功能待实现`)}catch(e){console.error("查看商品失败:",e),E.error("查看商品失败")}},_e=async o=>{try{await xe.confirm(`确定要删除规则"${o.name}"吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await S.deleteCloakRule(o.id)).code===200&&(E.success("删除成功"),C())}catch(e){e!=="cancel"&&(console.error("删除斗篷规则失败:",e),E.error("删除失败"))}},me=o=>{const e=[];o.forEach(g=>{const d=J[g];d&&!e.includes(d)&&e.push(d)}),(n.allowed_timezones.length===0||e.length>0)&&(n.allowed_timezones=e)},B=()=>{var o;Object.assign(n,{name:"",target_regions:[],mode:"cloak",spider_whitelist:[],block_pc:0,block_proxy:0,blocked_keywords:[],allowed_countries:[],blocked_countries:[],allowed_organizations:[],blocked_organizations:[],allowed_timezones:[],redirect_url:"",audit_url:"",description:"",is_active:1}),V.value="DEFAULT",(o=M.value)==null||o.clearValidate()},ce=async()=>{var o;try{await((o=M.value)==null?void 0:o.validate()),F(),D.value=!0;const e=G.value.includes("编辑");let g;if(e){const d=n.id;g=await S.updateCloakRule(d,n)}else g=await S.createCloakRule(n);g.code===200&&(E.success(e?"更新成功":"创建成功"),w.value=!1,C())}catch(e){console.error("提交失败:",e),E.error("提交失败")}finally{D.value=!1}},ge=()=>{B()};return we(()=>{C()}),(o,e)=>{const g=i("el-input"),d=i("el-form-item"),u=i("el-option"),x=i("el-select"),f=i("el-button"),P=i("el-form"),j=i("el-card"),fe=i("el-icon"),m=i("el-table-column"),h=i("el-tag"),be=i("el-table"),ve=i("el-pagination"),k=i("el-col"),T=i("el-row"),r=i("el-radio"),y=i("el-tooltip"),O=i("el-radio-group"),ke=i("el-dialog"),ye=Ve("loading");return _(),v("div",Ge,[l(j,{class:"search-card",shadow:"never"},{default:a(()=>[l(P,{model:c,inline:!0,class:"search-form"},{default:a(()=>[l(d,{label:"规则名称"},{default:a(()=>[l(g,{modelValue:c.name,"onUpdate:modelValue":e[0]||(e[0]=t=>c.name=t),placeholder:"请输入规则名称",clearable:"",style:{width:"200px"},onKeyup:Ce(R,["enter"])},null,8,["modelValue"])]),_:1}),l(d,{label:"模式"},{default:a(()=>[l(x,{modelValue:c.mode,"onUpdate:modelValue":e[1]||(e[1]=t=>c.mode=t),placeholder:"请选择模式",clearable:"",style:{width:"150px"}},{default:a(()=>[l(u,{label:"斗篷",value:"cloak"}),l(u,{label:"绿色",value:"green"}),l(u,{label:"全开",value:"open"}),l(u,{label:"审核",value:"audit"})]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"状态"},{default:a(()=>[l(x,{modelValue:c.is_active,"onUpdate:modelValue":e[2]||(e[2]=t=>c.is_active=t),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:a(()=>[l(u,{label:"启用",value:1}),l(u,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),l(d,null,{default:a(()=>[l(f,{type:"primary",onClick:R},{default:a(()=>[...e[17]||(e[17]=[s("搜索",-1)])]),_:1}),l(f,{onClick:ne},{default:a(()=>[...e[18]||(e[18]=[s("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(j,{class:"table-card",shadow:"never"},{default:a(()=>[z("div",Ue,[e[20]||(e[20]=z("div",{class:"table-title"},"斗篷规则列表",-1)),z("div",Se,[l(f,{type:"primary",onClick:ue},{default:a(()=>[l(fe,null,{default:a(()=>[l(ze(Le))]),_:1}),e[19]||(e[19]=s(" 新增规则 ",-1))]),_:1})])]),Te((_(),U(be,{data:N.value,stripe:"",style:{width:"100%"},onSelectionChange:ie},{default:a(()=>[l(m,{type:"selection",width:"55"}),l(m,{prop:"id",label:"ID",width:"80"}),l(m,{prop:"name",label:"规则名称","min-width":"150","show-overflow-tooltip":""}),l(m,{prop:"mode",label:"模式",width:"100",align:"center"},{default:a(({row:t})=>[l(h,{type:X(t.mode)},{default:a(()=>[s(L(ee(t.mode)),1)]),_:2},1032,["type"])]),_:1}),N.value.some(t=>t.mode==="cloak")?(_(),U(m,{key:0,prop:"google_detection_mode",label:"谷歌检测",width:"120",align:"center"},{default:a(({row:t})=>[t.mode==="cloak"?(_(),U(h,{key:0,type:le(t.google_detection_mode)},{default:a(()=>[s(L(ae(t.google_detection_mode)),1)]),_:2},1032,["type"])):(_(),v("span",Ae,"--"))]),_:1})):Z("",!0),l(m,{prop:"target_regions",label:"投放地区",width:"120","show-overflow-tooltip":""},{default:a(({row:t})=>[t.target_regions&&t.target_regions.length>0?(_(),v("span",De,L(t.target_regions.join(", ")),1)):(_(),v("span",Me,"--"))]),_:1}),l(m,{prop:"blocked_organizations",label:"屏蔽组织","min-width":"150","show-overflow-tooltip":""},{default:a(({row:t})=>[t.blocked_organizations&&t.blocked_organizations.length>0?(_(),v("span",Ne,L(t.blocked_organizations.join(", ")),1)):(_(),v("span",Re,"--"))]),_:1}),l(m,{prop:"is_active",label:"状态",width:"80",align:"center"},{default:a(({row:t})=>[l(h,{type:t.is_active?"success":"danger"},{default:a(()=>[s(L(t.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"created_at",label:"创建时间",width:"160"},{default:a(({row:t})=>[s(L(oe(t.created_at)),1)]),_:1}),l(m,{label:"操作",width:"280",fixed:"right"},{default:a(({row:t})=>[l(f,{type:"primary",size:"small",onClick:$=>re(t)},{default:a(()=>[...e[21]||(e[21]=[s(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(f,{type:"warning",size:"small",onClick:$=>pe(t)},{default:a(()=>[...e[22]||(e[22]=[s(" 查看商品 ",-1)])]),_:1},8,["onClick"]),l(f,{type:"danger",size:"small",onClick:$=>_e(t)},{default:a(()=>[...e[23]||(e[23]=[s(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ye,A.value]]),z("div",he,[l(ve,{"current-page":p.page,"onUpdate:currentPage":e[3]||(e[3]=t=>p.page=t),"page-size":p.size,"onUpdate:pageSize":e[4]||(e[4]=t=>p.size=t),total:p.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:se,onCurrentChange:de},null,8,["current-page","page-size","total"])])]),_:1}),l(ke,{modelValue:w.value,"onUpdate:modelValue":e[16]||(e[16]=t=>w.value=t),title:G.value,width:"800px","close-on-click-modal":!1,onClose:ge},{footer:a(()=>[z("div",Ie,[l(f,{onClick:e[15]||(e[15]=t=>w.value=!1)},{default:a(()=>[...e[38]||(e[38]=[s("取消",-1)])]),_:1}),l(f,{type:"primary",loading:D.value,onClick:ce},{default:a(()=>[...e[39]||(e[39]=[s(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:a(()=>[l(P,{ref_key:"formRef",ref:M,model:n,rules:Y,"label-width":"120px",class:"cloak-rule-form"},{default:a(()=>[l(T,{gutter:20},{default:a(()=>[l(k,{span:24},{default:a(()=>[l(d,{label:"规则名称",prop:"name"},{default:a(()=>[l(g,{modelValue:n.name,"onUpdate:modelValue":e[5]||(e[5]=t=>n.name=t),placeholder:"请输入规则名称",maxlength:"50"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(T,{gutter:20},{default:a(()=>[l(k,{span:24},{default:a(()=>[l(d,{label:"模式",prop:"mode"},{default:a(()=>[l(O,{modelValue:n.mode,"onUpdate:modelValue":e[6]||(e[6]=t=>n.mode=t)},{default:a(()=>[l(y,{content:"只有投放地区客户能访问真实链接",placement:"top"},{default:a(()=>[l(r,{value:"cloak"},{default:a(()=>[...e[24]||(e[24]=[s("斗篷",-1)])]),_:1})]),_:1}),l(y,{content:"所有客户访问真实链接",placement:"top"},{default:a(()=>[l(r,{value:"open"},{default:a(()=>[...e[25]||(e[25]=[s("全开",-1)])]),_:1})]),_:1}),l(y,{content:"所有客户访问重定向链接",placement:"top"},{default:a(()=>[l(r,{value:"green"},{default:a(()=>[...e[26]||(e[26]=[s("绿色",-1)])]),_:1})]),_:1}),l(y,{content:"所有客户访问审核页面",placement:"top"},{default:a(()=>[l(r,{value:"audit"},{default:a(()=>[...e[27]||(e[27]=[s("审核",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(T,{gutter:20},{default:a(()=>[l(k,{span:24},{default:a(()=>[l(d,{label:"投放地区"},{default:a(()=>[l(x,{modelValue:n.target_regions,"onUpdate:modelValue":e[7]||(e[7]=t=>n.target_regions=t),multiple:"",placeholder:"请选择投放地区",style:{width:"100%"},onChange:me},{default:a(()=>[(_(),v(H,null,K(W,t=>l(u,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(T,{gutter:20},{default:a(()=>[l(k,{span:24},{default:a(()=>[l(d,{label:"允许时区"},{default:a(()=>[l(x,{modelValue:n.allowed_timezones,"onUpdate:modelValue":e[8]||(e[8]=t=>n.allowed_timezones=t),multiple:"",placeholder:"请选择允许的时区",style:{width:"100%"}},{default:a(()=>[(_(),v(H,null,K(q,t=>l(u,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),e[28]||(e[28]=z("div",{class:"form-tip"},"选择投放地区后会自动推荐对应时区，也可手动选择",-1))]),_:1})]),_:1})]),_:1}),l(T,{gutter:20},{default:a(()=>[l(k,{span:24},{default:a(()=>[l(d,{label:"状态"},{default:a(()=>[l(O,{modelValue:n.is_active,"onUpdate:modelValue":e[9]||(e[9]=t=>n.is_active=t)},{default:a(()=>[l(r,{label:1},{default:a(()=>[...e[29]||(e[29]=[s("启用",-1)])]),_:1}),l(r,{label:0},{default:a(()=>[...e[30]||(e[30]=[s("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(d,{label:"屏蔽组织"},{default:a(()=>[l(x,{modelValue:n.blocked_organizations,"onUpdate:modelValue":e[10]||(e[10]=t=>n.blocked_organizations=t),multiple:"",filterable:"","allow-create":"",placeholder:"请输入要屏蔽的组织关键词",style:{width:"100%"}},{default:a(()=>[l(u,{label:"Google",value:"google"}),l(u,{label:"Facebook",value:"facebook"}),l(u,{label:"Amazon",value:"amazon"}),l(u,{label:"Microsoft",value:"microsoft"}),l(u,{label:"Cloudflare",value:"cloudflare"})]),_:1},8,["modelValue"])]),_:1}),n.mode==="cloak"?(_(),U(d,{key:0,label:"谷歌检测模式"},{default:a(()=>[l(O,{modelValue:V.value,"onUpdate:modelValue":e[11]||(e[11]=t=>V.value=t),onChange:F},{default:a(()=>[l(y,{content:"使用系统默认的谷歌检测规则",placement:"top"},{default:a(()=>[l(r,{value:"DEFAULT"},{default:a(()=>[...e[31]||(e[31]=[s("默认",-1)])]),_:1})]),_:1}),l(y,{content:"更激进的过滤规则：严格识别和过滤谷歌爬虫、审核系统，对可疑流量展示合规内容",placement:"top"},{default:a(()=>[l(r,{value:"GOOGLE_STRICT"},{default:a(()=>[...e[32]||(e[32]=[s("谷歌(严格)",-1)])]),_:1})]),_:1}),l(y,{content:"较温和的过滤规则：只过滤明确的谷歌机器人",placement:"top"},{default:a(()=>[l(r,{value:"GOOGLE_LENIENT"},{default:a(()=>[...e[33]||(e[33]=[s("谷歌(宽松)",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})):Z("",!0),l(T,{gutter:20},{default:a(()=>[l(k,{span:12},{default:a(()=>[l(d,{label:"屏蔽PC"},{default:a(()=>[l(O,{modelValue:n.block_pc,"onUpdate:modelValue":e[12]||(e[12]=t=>n.block_pc=t)},{default:a(()=>[l(r,{label:0},{default:a(()=>[...e[34]||(e[34]=[s("未开启",-1)])]),_:1}),l(r,{label:1},{default:a(()=>[...e[35]||(e[35]=[s("开启",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(k,{span:12},{default:a(()=>[l(d,{label:"屏蔽代理"},{default:a(()=>[l(O,{modelValue:n.block_proxy,"onUpdate:modelValue":e[13]||(e[13]=t=>n.block_proxy=t)},{default:a(()=>[l(r,{label:0},{default:a(()=>[...e[36]||(e[36]=[s("未开启",-1)])]),_:1}),l(r,{label:1},{default:a(()=>[...e[37]||(e[37]=[s("开启",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(d,{label:"备注"},{default:a(()=>[l(g,{modelValue:n.description,"onUpdate:modelValue":e[14]||(e[14]=t=>n.description=t),type:"textarea",rows:3,placeholder:"请输入备注信息",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Ze=Oe(Fe,[["__scopeId","data-v-ffe90eee"]]);export{Ze as default};
