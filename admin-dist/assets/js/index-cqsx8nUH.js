import{d as ie,h as b,P as F,s as te,Z as Me,r as f,Q as Ue,c as V,o as n,a as o,b as e,w as t,g as c,q as Se,u as d,aK as Te,x as ae,e as r,E as J,aP as le,t as i,n as S,aQ as L,aN as O,aA as Ie,aR as Ne,aS as Ae,aT as Fe,aU as Le,aV as Oe,aW as oe,ay as Ye,W as Ee,_ as Ke,R as Be,F as se,f as ne,N as D}from"./index-Ch2GYJpF.js";import{g as re}from"./product-V7ARAiqz.js";import{_ as qe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ze={class:"pixel-analytics"},je={class:"overview-stats"},He={class:"stat-content"},Je={class:"stat-icon total"},Qe={class:"stat-info"},We={class:"stat-number"},Ge={class:"stat-content"},$e={class:"stat-icon revenue"},Xe={class:"stat-info"},et={class:"stat-number"},tt={class:"stat-content"},at={class:"stat-icon cost"},lt={class:"stat-info"},ot={class:"stat-number"},st={class:"stat-content"},nt={class:"stat-icon roi"},rt={class:"stat-info"},it={class:"stat-number"},dt={class:"card-header"},ut={class:"platform-info"},ct={class:"platform-name"},pt={class:"card-header"},_t={key:1},ft={class:"product-info"},vt={class:"product-title"},mt={class:"card-header"},gt={class:"chart-controls"},ht={class:"chart-placeholder"},yt=["src"],bt={key:1},Ct={key:0},kt={key:1},wt=ie({name:"PixelAnalytics"}),zt=ie({...wt,setup(Pt){const Q=b(!1),de=b(),Y=b("conversions"),g=F({dateRange:[],platform:"",productId:""}),ue=b([]),M=b(""),T=b(!1),E=b(!1),K=b([]),C=F({title:"",country:""}),k=F({current:1,size:10,total:0}),ce=[{code:"SK",name:"斯洛伐克"},{code:"CZ",name:"捷克"},{code:"PL",name:"波兰"},{code:"HU",name:"匈牙利"},{code:"DE",name:"德国"},{code:"AT",name:"奥地利"},{code:"RO",name:"罗马尼亚"},{code:"JP",name:"日本"}],pe={SK:"斯洛伐克",CZ:"捷克",PL:"波兰",HU:"匈牙利",DE:"德国",AT:"奥地利",RO:"罗马尼亚",JP:"日本"},_e=te(()=>{const s={};return K.value.forEach(l=>{if(l.country){const h=l.country.toUpperCase();s[h]=(s[h]||0)+1}}),s}),B=te(()=>{const s=_e.value,l=[],h=[];return ce.forEach(m=>{const v=s[m.code]||0;v>0?l.push({...m,count:v}):h.push(m)}),l.sort((m,v)=>v.count-m.count),{withProducts:l,withoutProducts:h}}),u=F({totalConversions:0,totalRevenue:0,totalCost:0,roi:0,conversionChange:0,revenueChange:0,costChange:0,roiChange:0}),I=b([]),fe=b([]),ve=()=>{x()},q=()=>{x()},me=()=>{g.dateRange=[],g.platform="",g.productId="",M.value="",x()},x=async()=>{Q.value=!0;try{await new Promise(s=>setTimeout(s,1e3)),W(),D.success("数据加载成功")}catch{D.error("数据加载失败")}finally{Q.value=!1}},ge=async()=>{try{await new Promise(s=>setTimeout(s,500)),D.success("排行数据已更新")}catch{D.error("排行数据加载失败")}},W=()=>{const s=I.value.reduce((v,w)=>v+w.conversions,0),l=I.value.reduce((v,w)=>v+w.revenue,0),h=I.value.reduce((v,w)=>v+w.cost,0),m=h>0?Math.round((l/h-1)*100):0;u.totalConversions=s,u.totalRevenue=l,u.totalCost=h,u.roi=m,u.conversionChange=Math.random()*20-10,u.revenueChange=Math.random()*20-10,u.costChange=Math.random()*20-10,u.roiChange=Math.random()*20-10},he=()=>{Y.value},ye=s=>{D.info(`查看商品 ${s.title} 的详细数据`)},y=s=>s>=1e6?(s/1e6).toFixed(1)+"M":s>=1e3?(s/1e3).toFixed(1)+"K":s.toString(),G=s=>s>=5?"success":s>=3?"warning":"danger",$=s=>s>=300?"success":s>=200?"warning":"danger",be=async()=>{try{const{data:s}=await re({page:1,size:1e3,product_type:"original"});ue.value=s.list}catch(s){console.error("加载商品列表失败:",s)}},Ce=()=>{T.value=!0,N()},N=async()=>{E.value=!0;try{const{data:s}=await re({page:k.current,size:k.size,title:C.title||void 0,country:C.country||void 0,product_type:"original"});K.value=s.list,k.total=s.total}catch(s){console.error("加载商品列表失败:",s),D.error("加载商品列表失败")}finally{E.value=!1}},Z=()=>{k.current=1,N()},ke=()=>{C.title="",C.country="",Z()},we=s=>{g.productId=s.id,M.value=s.title,T.value=!1,q()},ze=()=>{g.productId="",M.value="",q()};return Me(()=>{be(),x(),W()}),(s,l)=>{const h=f("el-date-picker"),m=f("el-form-item"),v=f("el-option"),w=f("el-select"),p=f("el-icon"),X=f("el-input"),P=f("el-button"),ee=f("el-form"),z=f("el-card"),A=f("el-col"),Pe=f("el-row"),U=f("el-avatar"),_=f("el-table-column"),R=f("el-tag"),j=f("el-table"),H=f("el-radio-button"),Re=f("el-radio-group"),Ve=f("el-pagination"),xe=f("el-dialog"),De=Ue("loading");return n(),V("div",Ze,[l[28]||(l[28]=o("div",{class:"page-header"},[o("h2",null,"像素跟踪数据"),o("p",null,"查看各平台的像素跟踪效果和转化数据")],-1)),e(z,{class:"filter-card",shadow:"never"},{default:t(()=>[e(ee,{model:g,inline:"",class:"filter-form"},{default:t(()=>[e(m,{label:"时间范围"},{default:t(()=>[e(h,{modelValue:g.dateRange,"onUpdate:modelValue":l[0]||(l[0]=a=>g.dateRange=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:ve},null,8,["modelValue"])]),_:1}),e(m,{label:"平台"},{default:t(()=>[e(w,{modelValue:g.platform,"onUpdate:modelValue":l[1]||(l[1]=a=>g.platform=a),placeholder:"选择平台",clearable:"",onChange:q},{default:t(()=>[e(v,{label:"全部平台",value:""}),e(v,{label:"Google Ads",value:"google_ads"}),e(v,{label:"Facebook",value:"facebook"}),e(v,{label:"TikTok",value:"tiktok"})]),_:1},8,["modelValue"])]),_:1}),e(m,{label:"商品"},{default:t(()=>[e(X,{modelValue:M.value,"onUpdate:modelValue":l[2]||(l[2]=a=>M.value=a),placeholder:"点击选择商品",readonly:"",style:{width:"250px",cursor:"pointer"},onClick:Ce},{suffix:t(()=>[g.productId?(n(),c(p,{key:0,onClick:Se(ze,["stop"]),style:{cursor:"pointer"}},{default:t(()=>[e(d(Te))]),_:1})):(n(),c(p,{key:1},{default:t(()=>[e(d(ae))]),_:1}))]),_:1},8,["modelValue"])]),_:1}),e(m,null,{default:t(()=>[e(P,{type:"primary",onClick:x},{default:t(()=>[e(p,null,{default:t(()=>[e(d(ae))]),_:1}),l[9]||(l[9]=r(" 查询 ",-1))]),_:1}),e(P,{onClick:me},{default:t(()=>[e(p,null,{default:t(()=>[e(d(J))]),_:1}),l[10]||(l[10]=r(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),o("div",je,[e(Pe,{gutter:20},{default:t(()=>[e(A,{span:6},{default:t(()=>[e(z,{class:"stat-card"},{default:t(()=>[o("div",He,[o("div",Je,[e(p,null,{default:t(()=>[e(d(le))]),_:1})]),o("div",Qe,[o("div",We,i(u.totalConversions),1),l[11]||(l[11]=o("div",{class:"stat-label"},"总转化数",-1)),o("div",{class:S(["stat-change",u.conversionChange>=0?"positive":"negative"])},[e(p,null,{default:t(()=>[u.conversionChange>=0?(n(),c(d(L),{key:0})):(n(),c(d(O),{key:1}))]),_:1}),r(" "+i(Math.abs(u.conversionChange))+"% ",1)],2)])])]),_:1})]),_:1}),e(A,{span:6},{default:t(()=>[e(z,{class:"stat-card"},{default:t(()=>[o("div",Ge,[o("div",$e,[e(p,null,{default:t(()=>[e(d(Ie))]),_:1})]),o("div",Xe,[o("div",et,"¥"+i(y(u.totalRevenue)),1),l[12]||(l[12]=o("div",{class:"stat-label"},"总收入",-1)),o("div",{class:S(["stat-change",u.revenueChange>=0?"positive":"negative"])},[e(p,null,{default:t(()=>[u.revenueChange>=0?(n(),c(d(L),{key:0})):(n(),c(d(O),{key:1}))]),_:1}),r(" "+i(Math.abs(u.revenueChange))+"% ",1)],2)])])]),_:1})]),_:1}),e(A,{span:6},{default:t(()=>[e(z,{class:"stat-card"},{default:t(()=>[o("div",tt,[o("div",at,[e(p,null,{default:t(()=>[e(d(Ne))]),_:1})]),o("div",lt,[o("div",ot,"¥"+i(y(u.totalCost)),1),l[13]||(l[13]=o("div",{class:"stat-label"},"总成本",-1)),o("div",{class:S(["stat-change",u.costChange>=0?"positive":"negative"])},[e(p,null,{default:t(()=>[u.costChange>=0?(n(),c(d(L),{key:0})):(n(),c(d(O),{key:1}))]),_:1}),r(" "+i(Math.abs(u.costChange))+"% ",1)],2)])])]),_:1})]),_:1}),e(A,{span:6},{default:t(()=>[e(z,{class:"stat-card"},{default:t(()=>[o("div",st,[o("div",nt,[e(p,null,{default:t(()=>[e(d(Ae))]),_:1})]),o("div",rt,[o("div",it,i(u.roi)+"%",1),l[14]||(l[14]=o("div",{class:"stat-label"},"ROI",-1)),o("div",{class:S(["stat-change",u.roiChange>=0?"positive":"negative"])},[e(p,null,{default:t(()=>[u.roiChange>=0?(n(),c(d(L),{key:0})):(n(),c(d(O),{key:1}))]),_:1}),r(" "+i(Math.abs(u.roiChange))+"% ",1)],2)])])]),_:1})]),_:1})]),_:1})]),e(z,{class:"platform-comparison",shadow:"never"},{header:t(()=>[o("div",dt,[l[16]||(l[16]=o("span",null,"平台效果对比",-1)),e(P,{size:"small",onClick:x},{default:t(()=>[e(p,null,{default:t(()=>[e(d(J))]),_:1}),l[15]||(l[15]=r(" 刷新 ",-1))]),_:1})])]),default:t(()=>[e(j,{data:I.value,stripe:"",border:""},{default:t(()=>[e(_,{prop:"platform",label:"平台",width:"120"},{default:t(({row:a})=>[o("div",ut,[e(U,{size:32,class:S(`platform-avatar ${a.platform}`)},{default:t(()=>[a.platform==="google_ads"?(n(),c(p,{key:0},{default:t(()=>[e(d(Fe))]),_:1})):a.platform==="facebook"?(n(),c(p,{key:1},{default:t(()=>[e(d(Le))]),_:1})):(n(),c(p,{key:2},{default:t(()=>[e(d(Oe))]),_:1}))]),_:2},1032,["class"]),o("span",ct,i(a.platformName),1)])]),_:1}),e(_,{prop:"impressions",label:"展示次数",width:"120",align:"right"},{default:t(({row:a})=>[r(i(y(a.impressions)),1)]),_:1}),e(_,{prop:"clicks",label:"点击次数",width:"120",align:"right"},{default:t(({row:a})=>[r(i(y(a.clicks)),1)]),_:1}),e(_,{prop:"conversions",label:"转化次数",width:"120",align:"right"},{default:t(({row:a})=>[r(i(y(a.conversions)),1)]),_:1}),e(_,{prop:"conversionRate",label:"转化率",width:"100",align:"right"},{default:t(({row:a})=>[e(R,{type:G(a.conversionRate),size:"small"},{default:t(()=>[r(i(a.conversionRate)+"% ",1)]),_:2},1032,["type"])]),_:1}),e(_,{prop:"cost",label:"成本",width:"120",align:"right"},{default:t(({row:a})=>[r(" ¥"+i(y(a.cost)),1)]),_:1}),e(_,{prop:"revenue",label:"收入",width:"120",align:"right"},{default:t(({row:a})=>[r(" ¥"+i(y(a.revenue)),1)]),_:1}),e(_,{prop:"roi",label:"ROI",width:"100",align:"right"},{default:t(({row:a})=>[e(R,{type:$(a.roi),size:"small"},{default:t(()=>[r(i(a.roi)+"% ",1)]),_:2},1032,["type"])]),_:1}),e(_,{prop:"cpa",label:"CPA",width:"120",align:"right"},{default:t(({row:a})=>[r(" ¥"+i(y(a.cpa)),1)]),_:1})]),_:1},8,["data"])]),_:1}),e(z,{class:"product-ranking",shadow:"never"},{header:t(()=>[o("div",pt,[l[18]||(l[18]=o("span",null,"商品效果排行",-1)),e(P,{size:"small",onClick:ge},{default:t(()=>[e(p,null,{default:t(()=>[e(d(J))]),_:1}),l[17]||(l[17]=r(" 刷新 ",-1))]),_:1})])]),default:t(()=>[e(j,{data:fe.value,stripe:"",border:""},{default:t(()=>[e(_,{type:"index",label:"排名",width:"80",align:"center"},{default:t(({$index:a})=>[a<3?(n(),c(R,{key:0,type:a===0?"danger":a===1?"warning":"success",size:"small"},{default:t(()=>[r(i(a+1),1)]),_:2},1032,["type"])):(n(),V("span",_t,i(a+1),1))]),_:1}),e(_,{prop:"title",label:"商品标题","min-width":"200","show-overflow-tooltip":""},{default:t(({row:a})=>[o("div",ft,[a.image_urls&&a.image_urls[0]?(n(),c(U,{key:0,size:32,src:a.image_urls[0],shape:"square"},null,8,["src"])):(n(),c(U,{key:1,size:32,shape:"square"},{default:t(()=>[e(p,null,{default:t(()=>[e(d(oe))]),_:1})]),_:1})),o("span",vt,i(a.title),1)])]),_:1}),e(_,{prop:"conversions",label:"转化数",width:"100",align:"right"},{default:t(({row:a})=>[r(i(y(a.conversions)),1)]),_:1}),e(_,{prop:"revenue",label:"收入",width:"120",align:"right"},{default:t(({row:a})=>[r(" ¥"+i(y(a.revenue)),1)]),_:1}),e(_,{prop:"conversionRate",label:"转化率",width:"100",align:"right"},{default:t(({row:a})=>[e(R,{type:G(a.conversionRate),size:"small"},{default:t(()=>[r(i(a.conversionRate)+"% ",1)]),_:2},1032,["type"])]),_:1}),e(_,{prop:"roi",label:"ROI",width:"100",align:"right"},{default:t(({row:a})=>[e(R,{type:$(a.roi),size:"small"},{default:t(()=>[r(i(a.roi)+"% ",1)]),_:2},1032,["type"])]),_:1}),e(_,{label:"操作",width:"120",align:"center"},{default:t(({row:a})=>[e(P,{size:"small",type:"primary",link:"",onClick:Rt=>ye(a)},{default:t(()=>[e(p,null,{default:t(()=>[e(d(Ye))]),_:1}),l[19]||(l[19]=r(" 查看详情 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(z,{class:"trend-chart",shadow:"never"},{header:t(()=>[o("div",mt,[l[23]||(l[23]=o("span",null,"转化趋势",-1)),o("div",gt,[e(Re,{modelValue:Y.value,"onUpdate:modelValue":l[3]||(l[3]=a=>Y.value=a),size:"small",onChange:he},{default:t(()=>[e(H,{label:"conversions"},{default:t(()=>[...l[20]||(l[20]=[r("转化数",-1)])]),_:1}),e(H,{label:"revenue"},{default:t(()=>[...l[21]||(l[21]=[r("收入",-1)])]),_:1}),e(H,{label:"roi"},{default:t(()=>[...l[22]||(l[22]=[r("ROI",-1)])]),_:1})]),_:1},8,["modelValue"])])])]),default:t(()=>[o("div",{class:"chart-container",ref_key:"chartContainer",ref:de},[o("div",ht,[e(p,{class:"chart-icon"},{default:t(()=>[e(d(le))]),_:1}),l[24]||(l[24]=o("p",null,"图表加载中...",-1))])],512)]),_:1}),e(xe,{modelValue:T.value,"onUpdate:modelValue":l[8]||(l[8]=a=>T.value=a),title:"选择商品",width:"900px","close-on-click-modal":!1},{default:t(()=>[e(ee,{model:C,inline:"",style:{"margin-bottom":"16px"}},{default:t(()=>[e(m,{label:"商品标题"},{default:t(()=>[e(X,{modelValue:C.title,"onUpdate:modelValue":l[4]||(l[4]=a=>C.title=a),placeholder:"请输入商品标题",clearable:"",style:{width:"200px"},onKeyup:Ke(Z,["enter"])},null,8,["modelValue"])]),_:1}),e(m,{label:"国家"},{default:t(()=>[e(w,{modelValue:C.country,"onUpdate:modelValue":l[5]||(l[5]=a=>C.country=a),placeholder:"请选择国家",clearable:"",style:{width:"200px"}},{default:t(()=>[(n(!0),V(se,null,ne(B.value.withProducts,a=>(n(),c(v,{key:a.code,label:`${a.name} (${a.count}条)`,value:a.code},null,8,["label","value"]))),128)),B.value.withProducts.length>0?(n(),c(v,{key:0,disabled:"",value:""},{default:t(()=>[...l[25]||(l[25]=[o("span",{style:{color:"#dcdfe6"}},"──────────",-1)])]),_:1})):Be("",!0),(n(!0),V(se,null,ne(B.value.withoutProducts,a=>(n(),c(v,{key:a.code,label:a.name,value:a.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(m,null,{default:t(()=>[e(P,{type:"primary",onClick:Z},{default:t(()=>[...l[26]||(l[26]=[r("搜索",-1)])]),_:1}),e(P,{onClick:ke},{default:t(()=>[...l[27]||(l[27]=[r("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),Ee((n(),c(j,{data:K.value,"max-height":"400px",onRowClick:we,style:{cursor:"pointer"}},{default:t(()=>[e(_,{label:"商品图片",width:"80"},{default:t(({row:a})=>[a.image_urls&&a.image_urls[0]?(n(),c(U,{key:0,size:50},{default:t(()=>[o("img",{src:a.image_urls[0],style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,yt)]),_:2},1024)):(n(),c(U,{key:1,size:50},{default:t(()=>[e(p,null,{default:t(()=>[e(d(oe))]),_:1})]),_:1}))]),_:1}),e(_,{prop:"title",label:"商品标题","show-overflow-tooltip":"","min-width":"200"}),e(_,{label:"国家",width:"120"},{default:t(({row:a})=>[a.country?(n(),c(R,{key:0,type:"success",size:"small"},{default:t(()=>[r(i(pe[a.country.toUpperCase()]||a.country),1)]),_:2},1024)):(n(),V("span",bt,"--"))]),_:1}),e(_,{prop:"sell_price",label:"价格",width:"100",align:"right"},{default:t(({row:a})=>[a.sell_price?(n(),V("span",Ct,i(a.sell_price),1)):(n(),V("span",kt,"--"))]),_:1}),e(_,{label:"状态",width:"80"},{default:t(({row:a})=>[e(R,{type:a.status==="active"?"success":"info",size:"small"},{default:t(()=>[r(i(a.status==="active"?"上架":a.status==="inactive"?"下架":"草稿"),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])),[[De,E.value]]),e(Ve,{"current-page":k.current,"onUpdate:currentPage":l[6]||(l[6]=a=>k.current=a),"page-size":k.size,"onUpdate:pageSize":l[7]||(l[7]=a=>k.size=a),total:k.total,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onCurrentChange:N,onSizeChange:N,style:{"margin-top":"16px","justify-content":"center"}},null,8,["current-page","page-size","total"])]),_:1},8,["modelValue"])])}}}),Mt=qe(zt,[["__scopeId","data-v-40200b54"]]);export{Mt as default};
