import{d as ge,h as g,P as A,Z as fe,r as d,Q as be,c as k,o as _,b as e,w as t,_ as ve,e as s,a as z,W as ke,u as ye,$ as we,g as U,R as P,t as E,F as Ve,f as Ce,N as L,a0 as Ee}from"./index-BnedJ701.js";import{c as D}from"./cloakRule-B0TuvLQU.js";import{_ as Te}from"./_plugin-vue_export-helper-DlAUqK2U.js";const xe={class:"cloak-rule-list"},ze={class:"table-header"},Le={class:"table-actions"},Ge={key:1,class:"text-gray-400"},Oe={key:0},Ue={key:1,class:"text-gray-400"},De={key:0},Ne={key:1,class:"text-gray-400"},Re={class:"pagination-wrapper"},Me={class:"dialog-footer"},Se=ge({__name:"index",setup(Ie){const N=g(!1),R=g(!1),y=g(!1),G=g(""),M=g(),w=g("DEFAULT"),K=[{label:"日本",value:"JA"},{label:"中国",value:"ZH"},{label:"英国",value:"EN"},{label:"斯洛伐克",value:"SK"},{label:"斯洛文尼亚",value:"SI"},{label:"波兰",value:"PL"},{label:"葡萄牙",value:"PT"},{label:"匈牙利",value:"HU"},{label:"意大利",value:"IT"},{label:"西班牙",value:"ES"},{label:"捷克",value:"CZ"}],m=A({name:"",mode:"",is_active:null}),u=A({page:1,size:20,total:0}),S=g([]),Z=g([]),n=A({name:"",target_regions:[],mode:"cloak",google_detection_mode:"DEFAULT",spider_whitelist:[],block_pc:0,block_proxy:0,blocked_keywords:[],allowed_countries:[],blocked_countries:[],allowed_organizations:[],blocked_organizations:[],description:"",is_active:1}),q={name:[{required:!0,message:"请输入规则名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],mode:[{required:!0,message:"请选择模式",trigger:"change"}]},H=o=>({cloak:"warning",green:"success",open:"info",audit:"danger"})[o]||"info",J=o=>({cloak:"斗篷",green:"绿色",open:"全开",audit:"审核"})[o]||o,Q=o=>({DEFAULT:"info",GOOGLE_STRICT:"danger",GOOGLE_LENIENT:"success"})[o]||"info",W=o=>({DEFAULT:"默认",GOOGLE_STRICT:"严格",GOOGLE_LENIENT:"宽松"})[o]||o,h=()=>{let o=n.description||"";o=o.replace(/\[GOOGLE_\w+\]/g,""),w.value!=="DEFAULT"&&(o=`[${w.value}] ${o}`.trim()),n.description=o},X=o=>o.includes("GOOGLE_STRICT")?"GOOGLE_STRICT":o.includes("GOOGLE_LENIENT")?"GOOGLE_LENIENT":"DEFAULT",Y=o=>o?new Date(o).toLocaleString("zh-CN"):"--",V=async()=>{try{N.value=!0;const o={page:u.page,size:u.size,...m},l=await D.getCloakRules(o);l.code===200&&(S.value=l.data.list,u.total=l.data.total)}catch(o){console.error("获取斗篷规则列表失败:",o),L.error("获取斗篷规则列表失败")}finally{N.value=!1}},I=()=>{u.page=1,V()},ee=()=>{Object.assign(m,{name:"",mode:"",is_active:null}),I()},le=o=>{u.size=o,u.page=1,V()},te=o=>{u.page=o,V()},ae=o=>{Z.value=o},oe=()=>{G.value="新增斗篷规则",B(),y.value=!0},ne=o=>{G.value="编辑斗篷规则",Object.assign(n,{...o,target_regions:o.target_regions||[],spider_whitelist:o.spider_whitelist||[],blocked_keywords:o.blocked_keywords||[],allowed_countries:o.allowed_countries||[],blocked_countries:o.blocked_countries||[],allowed_organizations:o.allowed_organizations||[],blocked_organizations:o.blocked_organizations||[]}),w.value=X(o.description||""),y.value=!0},se=async o=>{try{await Ee.confirm(`确定要删除规则"${o.name}"吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await D.deleteCloakRule(o.id)).code===200&&(L.success("删除成功"),V())}catch(l){l!=="cancel"&&(console.error("删除斗篷规则失败:",l),L.error("删除失败"))}},B=()=>{var o;Object.assign(n,{name:"",target_regions:[],mode:"cloak",spider_whitelist:[],block_pc:0,block_proxy:0,blocked_keywords:[],allowed_countries:[],blocked_countries:[],allowed_organizations:[],blocked_organizations:[],redirect_url:"",audit_url:"",description:"",is_active:1}),w.value="DEFAULT",(o=M.value)==null||o.clearValidate()},de=async()=>{var o;try{await((o=M.value)==null?void 0:o.validate()),h(),R.value=!0;const l=G.value.includes("编辑");let f;if(l){const i=n.id;f=await D.updateCloakRule(i,n)}else f=await D.createCloakRule(n);f.code===200&&(L.success(l?"更新成功":"创建成功"),y.value=!1,V())}catch(l){console.error("提交失败:",l),L.error("提交失败")}finally{R.value=!1}},ie=()=>{B()};return fe(()=>{V()}),(o,l)=>{const f=d("el-input"),i=d("el-form-item"),p=d("el-option"),O=d("el-select"),b=d("el-button"),$=d("el-form"),j=d("el-card"),re=d("el-icon"),c=d("el-table-column"),F=d("el-tag"),ue=d("el-table"),pe=d("el-pagination"),C=d("el-col"),T=d("el-row"),r=d("el-radio"),v=d("el-tooltip"),x=d("el-radio-group"),_e=d("el-dialog"),ce=be("loading");return _(),k("div",xe,[e(j,{class:"search-card",shadow:"never"},{default:t(()=>[e($,{model:m,inline:!0,class:"search-form"},{default:t(()=>[e(i,{label:"规则名称"},{default:t(()=>[e(f,{modelValue:m.name,"onUpdate:modelValue":l[0]||(l[0]=a=>m.name=a),placeholder:"请输入规则名称",clearable:"",style:{width:"200px"},onKeyup:ve(I,["enter"])},null,8,["modelValue"])]),_:1}),e(i,{label:"模式"},{default:t(()=>[e(O,{modelValue:m.mode,"onUpdate:modelValue":l[1]||(l[1]=a=>m.mode=a),placeholder:"请选择模式",clearable:"",style:{width:"150px"}},{default:t(()=>[e(p,{label:"斗篷",value:"cloak"}),e(p,{label:"绿色",value:"green"}),e(p,{label:"全开",value:"open"}),e(p,{label:"审核",value:"audit"})]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"状态"},{default:t(()=>[e(O,{modelValue:m.is_active,"onUpdate:modelValue":l[2]||(l[2]=a=>m.is_active=a),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:t(()=>[e(p,{label:"启用",value:1}),e(p,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),e(i,null,{default:t(()=>[e(b,{type:"primary",onClick:I},{default:t(()=>[...l[16]||(l[16]=[s("搜索",-1)])]),_:1}),e(b,{onClick:ee},{default:t(()=>[...l[17]||(l[17]=[s("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(j,{class:"table-card",shadow:"never"},{default:t(()=>[z("div",ze,[l[19]||(l[19]=z("div",{class:"table-title"},"斗篷规则列表",-1)),z("div",Le,[e(b,{type:"primary",onClick:oe},{default:t(()=>[e(re,null,{default:t(()=>[e(ye(we))]),_:1}),l[18]||(l[18]=s(" 新增规则 ",-1))]),_:1})])]),ke((_(),U(ue,{data:S.value,stripe:"",style:{width:"100%"},onSelectionChange:ae},{default:t(()=>[e(c,{type:"selection",width:"55"}),e(c,{prop:"id",label:"ID",width:"80"}),e(c,{prop:"name",label:"规则名称","min-width":"150","show-overflow-tooltip":""}),e(c,{prop:"mode",label:"模式",width:"100",align:"center"},{default:t(({row:a})=>[e(F,{type:H(a.mode)},{default:t(()=>[s(E(J(a.mode)),1)]),_:2},1032,["type"])]),_:1}),S.value.some(a=>a.mode==="cloak")?(_(),U(c,{key:0,prop:"google_detection_mode",label:"谷歌检测",width:"120",align:"center"},{default:t(({row:a})=>[a.mode==="cloak"?(_(),U(F,{key:0,type:Q(a.google_detection_mode)},{default:t(()=>[s(E(W(a.google_detection_mode)),1)]),_:2},1032,["type"])):(_(),k("span",Ge,"--"))]),_:1})):P("",!0),e(c,{prop:"target_regions",label:"投放地区",width:"120","show-overflow-tooltip":""},{default:t(({row:a})=>[a.target_regions&&a.target_regions.length>0?(_(),k("span",Oe,E(a.target_regions.join(", ")),1)):(_(),k("span",Ue,"--"))]),_:1}),e(c,{prop:"blocked_organizations",label:"屏蔽组织","min-width":"150","show-overflow-tooltip":""},{default:t(({row:a})=>[a.blocked_organizations&&a.blocked_organizations.length>0?(_(),k("span",De,E(a.blocked_organizations.join(", ")),1)):(_(),k("span",Ne,"--"))]),_:1}),e(c,{prop:"is_active",label:"状态",width:"80",align:"center"},{default:t(({row:a})=>[e(F,{type:a.is_active?"success":"danger"},{default:t(()=>[s(E(a.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),e(c,{prop:"created_at",label:"创建时间",width:"160"},{default:t(({row:a})=>[s(E(Y(a.created_at)),1)]),_:1}),e(c,{label:"操作",width:"200",fixed:"right"},{default:t(({row:a})=>[e(b,{type:"primary",size:"small",onClick:me=>ne(a)},{default:t(()=>[...l[20]||(l[20]=[s(" 编辑 ",-1)])]),_:1},8,["onClick"]),e(b,{type:"danger",size:"small",onClick:me=>se(a)},{default:t(()=>[...l[21]||(l[21]=[s(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ce,N.value]]),z("div",Re,[e(pe,{"current-page":u.page,"onUpdate:currentPage":l[3]||(l[3]=a=>u.page=a),"page-size":u.size,"onUpdate:pageSize":l[4]||(l[4]=a=>u.size=a),total:u.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:le,onCurrentChange:te},null,8,["current-page","page-size","total"])])]),_:1}),e(_e,{modelValue:y.value,"onUpdate:modelValue":l[15]||(l[15]=a=>y.value=a),title:G.value,width:"800px","close-on-click-modal":!1,onClose:ie},{footer:t(()=>[z("div",Me,[e(b,{onClick:l[14]||(l[14]=a=>y.value=!1)},{default:t(()=>[...l[35]||(l[35]=[s("取消",-1)])]),_:1}),e(b,{type:"primary",loading:R.value,onClick:de},{default:t(()=>[...l[36]||(l[36]=[s(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:t(()=>[e($,{ref_key:"formRef",ref:M,model:n,rules:q,"label-width":"120px",class:"cloak-rule-form"},{default:t(()=>[e(T,{gutter:20},{default:t(()=>[e(C,{span:24},{default:t(()=>[e(i,{label:"规则名称",prop:"name"},{default:t(()=>[e(f,{modelValue:n.name,"onUpdate:modelValue":l[5]||(l[5]=a=>n.name=a),placeholder:"请输入规则名称",maxlength:"50"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(T,{gutter:20},{default:t(()=>[e(C,{span:24},{default:t(()=>[e(i,{label:"模式",prop:"mode"},{default:t(()=>[e(x,{modelValue:n.mode,"onUpdate:modelValue":l[6]||(l[6]=a=>n.mode=a)},{default:t(()=>[e(v,{content:"只有投放地区客户能访问真实链接",placement:"top"},{default:t(()=>[e(r,{value:"cloak"},{default:t(()=>[...l[22]||(l[22]=[s("斗篷",-1)])]),_:1})]),_:1}),e(v,{content:"所有客户访问真实链接",placement:"top"},{default:t(()=>[e(r,{value:"open"},{default:t(()=>[...l[23]||(l[23]=[s("全开",-1)])]),_:1})]),_:1}),e(v,{content:"所有客户访问重定向链接",placement:"top"},{default:t(()=>[e(r,{value:"green"},{default:t(()=>[...l[24]||(l[24]=[s("绿色",-1)])]),_:1})]),_:1}),e(v,{content:"所有客户访问审核页面",placement:"top"},{default:t(()=>[e(r,{value:"audit"},{default:t(()=>[...l[25]||(l[25]=[s("审核",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(T,{gutter:20},{default:t(()=>[e(C,{span:24},{default:t(()=>[e(i,{label:"投放地区"},{default:t(()=>[e(O,{modelValue:n.target_regions,"onUpdate:modelValue":l[7]||(l[7]=a=>n.target_regions=a),multiple:"",placeholder:"请选择投放地区",style:{width:"100%"}},{default:t(()=>[(_(),k(Ve,null,Ce(K,a=>e(p,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(T,{gutter:20},{default:t(()=>[e(C,{span:24},{default:t(()=>[e(i,{label:"状态"},{default:t(()=>[e(x,{modelValue:n.is_active,"onUpdate:modelValue":l[8]||(l[8]=a=>n.is_active=a)},{default:t(()=>[e(r,{label:1},{default:t(()=>[...l[26]||(l[26]=[s("启用",-1)])]),_:1}),e(r,{label:0},{default:t(()=>[...l[27]||(l[27]=[s("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(i,{label:"屏蔽组织"},{default:t(()=>[e(O,{modelValue:n.blocked_organizations,"onUpdate:modelValue":l[9]||(l[9]=a=>n.blocked_organizations=a),multiple:"",filterable:"","allow-create":"",placeholder:"请输入要屏蔽的组织关键词",style:{width:"100%"}},{default:t(()=>[e(p,{label:"Google",value:"google"}),e(p,{label:"Facebook",value:"facebook"}),e(p,{label:"Amazon",value:"amazon"}),e(p,{label:"Microsoft",value:"microsoft"}),e(p,{label:"Cloudflare",value:"cloudflare"})]),_:1},8,["modelValue"])]),_:1}),n.mode==="cloak"?(_(),U(i,{key:0,label:"谷歌检测模式"},{default:t(()=>[e(x,{modelValue:w.value,"onUpdate:modelValue":l[10]||(l[10]=a=>w.value=a),onChange:h},{default:t(()=>[e(v,{content:"使用系统默认的谷歌检测规则",placement:"top"},{default:t(()=>[e(r,{value:"DEFAULT"},{default:t(()=>[...l[28]||(l[28]=[s("默认",-1)])]),_:1})]),_:1}),e(v,{content:"更激进的过滤规则：严格识别和过滤谷歌爬虫、审核系统，对可疑流量展示合规内容",placement:"top"},{default:t(()=>[e(r,{value:"GOOGLE_STRICT"},{default:t(()=>[...l[29]||(l[29]=[s("谷歌(严格)",-1)])]),_:1})]),_:1}),e(v,{content:"较温和的过滤规则：只过滤明确的谷歌机器人",placement:"top"},{default:t(()=>[e(r,{value:"GOOGLE_LENIENT"},{default:t(()=>[...l[30]||(l[30]=[s("谷歌(宽松)",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})):P("",!0),e(T,{gutter:20},{default:t(()=>[e(C,{span:12},{default:t(()=>[e(i,{label:"屏蔽PC"},{default:t(()=>[e(x,{modelValue:n.block_pc,"onUpdate:modelValue":l[11]||(l[11]=a=>n.block_pc=a)},{default:t(()=>[e(r,{label:0},{default:t(()=>[...l[31]||(l[31]=[s("未开启",-1)])]),_:1}),e(r,{label:1},{default:t(()=>[...l[32]||(l[32]=[s("开启",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(C,{span:12},{default:t(()=>[e(i,{label:"屏蔽代理"},{default:t(()=>[e(x,{modelValue:n.block_proxy,"onUpdate:modelValue":l[12]||(l[12]=a=>n.block_proxy=a)},{default:t(()=>[e(r,{label:0},{default:t(()=>[...l[33]||(l[33]=[s("未开启",-1)])]),_:1}),e(r,{label:1},{default:t(()=>[...l[34]||(l[34]=[s("开启",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(i,{label:"备注"},{default:t(()=>[e(f,{modelValue:n.description,"onUpdate:modelValue":l[13]||(l[13]=a=>n.description=a),type:"textarea",rows:3,placeholder:"请输入备注信息",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Be=Te(Se,[["__scopeId","data-v-02e5cecd"]]);export{Be as default};
