import{d as ee,P as N,h as p,Z as we,r as s,Q as ke,c as k,o as m,b as e,w as t,F as A,f as B,g as M,_ as xe,u as y,x as G,e as n,E as J,W as ze,t as _,ay as Ue,as as Te,U as je,a as j,$ as De,R as Ee,N as V}from"./index-CixW5Lxi.js";import{u as $e}from"./useHandleData-D3vgundb.js";import{d as Ae,e as Be,b as Me,u as X,f as Y,h as Le,i as Se}from"./email-DMMGi6gN.js";import{_ as qe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Fe={class:"email-templates"},He={class:"table-header"},Ne={class:"table-title"},Re={class:"table-actions"},Pe={key:0},Ke=["innerHTML"],Ie=ee({name:"EmailTemplates"}),Oe=ee({...Ie,setup(Qe){const u=N({template_code:"",country_code:"",is_active:"",keyword:""}),r=N({page:1,page_size:20,total:0}),R=p([]),L=p(!1),P=p([]),S=p([]),C=p(!1),q=p("新建模板"),x=p(!1),D=p(),F=p(!1),d=N({id:null,template_code:"",country_code:"en",template_name:"",subject:"",html_content:"",is_active:!0}),le=["order_number","customer_name","product_title","quantity","total_amount","currency","address","city","country","product_image"],te={template_code:[{required:!0,message:"请输入模板代码",trigger:"blur"}],country_code:[{required:!0,message:"请选择国家代码",trigger:"change"}],template_name:[{required:!0,message:"请输入模板名称",trigger:"blur"}],subject:[{required:!0,message:"请输入邮件主题",trigger:"blur"}],html_content:[{required:!0,message:"请输入HTML内容",trigger:"blur"}]},H=p(!1),c=p(null),g=async()=>{L.value=!0;try{const o={page:r.page,page_size:r.page_size,...u},{data:l}=await Ae(o);R.value=l.list,r.total=l.pagination.total}catch(o){console.error("加载数据失败:",o),V.error("加载数据失败")}finally{L.value=!1}},ae=async()=>{try{const{data:o}=await Be();P.value=o}catch(o){console.error("加载模板代码失败:",o)}},oe=async()=>{try{const{data:o}=await Me();S.value=o}catch(o){console.error("加载国家代码失败:",o)}},K=()=>{r.page=1,g()},ne=()=>{u.template_code="",u.country_code="",u.is_active="",u.keyword="",r.page=1,g()},se=o=>{r.page=o,g()},de=o=>{r.page_size=o,r.page=1,g()},ue=async o=>{try{await X(o.id,{template_code:o.template_code,country_code:o.country_code,template_name:o.template_name,subject:o.subject,html_content:o.html_content,is_active:o.is_active?1:0}),V.success("状态更新成功")}catch(l){console.error("状态更新失败:",l),V.error("状态更新失败"),o.is_active=!o.is_active}},re=()=>{x.value=!1,q.value="新建邮件模板",C.value=!0},ie=async o=>{x.value=!0,q.value="编辑邮件模板";try{const{data:l}=await Y(o.id);Object.assign(d,l),C.value=!0}catch(l){console.error("加载模板详情失败:",l),V.error("加载模板详情失败")}},pe=async o=>{try{const{data:l}=await Y(o.id);c.value=l,H.value=!0}catch(l){console.error("加载模板详情失败:",l),V.error("加载模板详情失败")}},ce=async o=>{await $e(()=>Le(o.id),`确定要删除模板 "${o.template_name}" 吗？`,"删除成功"),g()},me=async()=>{D.value&&await D.value.validate(async o=>{if(o){F.value=!0;try{const l={...d};x.value?(await X(l.id,l),V.success("更新成功")):(await Se(l),V.success("创建成功")),C.value=!1,g()}catch(l){console.error("提交失败:",l),V.error(l.message||"操作失败")}finally{F.value=!1}}})},_e=()=>{var o;(o=D.value)==null||o.resetFields(),Object.assign(d,{id:null,template_code:"",country_code:"en",template_name:"",subject:"",html_content:"",is_active:!0})},fe=o=>{d.html_content+=`{${o}}`},ve=o=>o<1024?o+" B":o<1048576?(o/1024).toFixed(1)+" KB":(o/1048576).toFixed(1)+" MB";return we(()=>{g(),ae(),oe()}),(o,l)=>{const z=s("el-option"),E=s("el-select"),i=s("el-form-item"),b=s("el-icon"),U=s("el-input"),f=s("el-button"),I=s("el-form"),O=s("el-card"),T=s("el-tag"),v=s("el-table-column"),Q=s("el-switch"),ge=s("el-table"),be=s("el-pagination"),$=s("el-col"),W=s("el-row"),ye=s("el-text"),Z=s("el-dialog"),h=s("el-descriptions-item"),Ve=s("el-descriptions"),Ce=s("el-divider"),he=ke("loading");return m(),k("div",Fe,[e(O,{class:"search-card",shadow:"never"},{default:t(()=>[e(I,{model:u,inline:"",class:"search-form"},{default:t(()=>[e(i,{label:"模板代码"},{default:t(()=>[e(E,{modelValue:u.template_code,"onUpdate:modelValue":l[0]||(l[0]=a=>u.template_code=a),placeholder:"请选择模板",clearable:"",style:{width:"200px"}},{default:t(()=>[(m(!0),k(A,null,B(P.value,a=>(m(),M(z,{key:a.template_code,label:a.description||a.template_code,value:a.template_code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"国家"},{default:t(()=>[e(E,{modelValue:u.country_code,"onUpdate:modelValue":l[1]||(l[1]=a=>u.country_code=a),placeholder:"请选择国家",clearable:"",style:{width:"150px"}},{default:t(()=>[(m(!0),k(A,null,B(S.value,a=>(m(),M(z,{key:a.code,label:a.name,value:a.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"状态"},{default:t(()=>[e(E,{modelValue:u.is_active,"onUpdate:modelValue":l[2]||(l[2]=a=>u.is_active=a),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:t(()=>[e(z,{label:"启用",value:1}),e(z,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"关键词"},{default:t(()=>[e(U,{modelValue:u.keyword,"onUpdate:modelValue":l[3]||(l[3]=a=>u.keyword=a),placeholder:"搜索模板名称或主题",clearable:"",style:{width:"200px"},onKeyup:xe(K,["enter"])},{prefix:t(()=>[e(b,null,{default:t(()=>[e(y(G))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(i,null,{default:t(()=>[e(f,{type:"primary",onClick:K},{default:t(()=>[e(b,null,{default:t(()=>[e(y(G))]),_:1}),l[15]||(l[15]=n(" 搜索 ",-1))]),_:1}),e(f,{onClick:ne},{default:t(()=>[e(b,null,{default:t(()=>[e(y(J))]),_:1}),l[16]||(l[16]=n(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(O,{class:"table-card",shadow:"never"},{header:t(()=>[j("div",He,[j("div",Ne,[l[17]||(l[17]=j("span",null,"邮件模板",-1)),e(T,{type:"info",size:"small"},{default:t(()=>[n(_(r.total)+" 个模板",1)]),_:1})]),j("div",Re,[e(f,{type:"primary",size:"small",onClick:re},{default:t(()=>[e(b,null,{default:t(()=>[e(y(De))]),_:1}),l[18]||(l[18]=n(" 新建模板 ",-1))]),_:1}),e(f,{size:"small",onClick:g},{default:t(()=>[e(b,null,{default:t(()=>[e(y(J))]),_:1}),l[19]||(l[19]=n(" 刷新 ",-1))]),_:1})])])]),default:t(()=>[ze((m(),M(ge,{data:R.value,border:"",stripe:""},{default:t(()=>[e(v,{prop:"id",label:"ID",width:"60",align:"center"}),e(v,{prop:"template_code",label:"模板代码",width:"180"}),e(v,{prop:"country_code",label:"国家",width:"80",align:"center"},{default:t(({row:a})=>[e(T,{size:"small"},{default:t(()=>[n(_(a.country_code.toUpperCase()),1)]),_:2},1024)]),_:1}),e(v,{prop:"template_name",label:"模板名称","min-width":"200"}),e(v,{prop:"subject",label:"邮件主题","min-width":"250","show-overflow-tooltip":""}),e(v,{label:"内容大小",width:"100",align:"center"},{default:t(({row:a})=>[e(T,{type:"info",size:"small"},{default:t(()=>[n(_(ve(a.content_length)),1)]),_:2},1024)]),_:1}),e(v,{prop:"is_active",label:"状态",width:"80",align:"center"},{default:t(({row:a})=>[e(Q,{modelValue:a.is_active,"onUpdate:modelValue":w=>a.is_active=w,onChange:w=>ue(a)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(v,{prop:"updated_at",label:"更新时间",width:"160"}),e(v,{label:"操作",width:"180",fixed:"right",align:"center"},{default:t(({row:a})=>[e(f,{link:"",type:"primary",size:"small",onClick:w=>pe(a)},{default:t(()=>[e(b,null,{default:t(()=>[e(y(Ue))]),_:1}),l[20]||(l[20]=n(" 预览 ",-1))]),_:1},8,["onClick"]),e(f,{link:"",type:"primary",size:"small",onClick:w=>ie(a)},{default:t(()=>[e(b,null,{default:t(()=>[e(y(Te))]),_:1}),l[21]||(l[21]=n(" 编辑 ",-1))]),_:1},8,["onClick"]),e(f,{link:"",type:"danger",size:"small",onClick:w=>ce(a)},{default:t(()=>[e(b,null,{default:t(()=>[e(y(je))]),_:1}),l[22]||(l[22]=n(" 删除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[he,L.value]]),e(be,{"current-page":r.page,"onUpdate:currentPage":l[4]||(l[4]=a=>r.page=a),"page-size":r.page_size,"onUpdate:pageSize":l[5]||(l[5]=a=>r.page_size=a),total:r.total,"page-sizes":[20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:de,onCurrentChange:se,class:"pagination"},null,8,["current-page","page-size","total"])]),_:1}),e(Z,{modelValue:C.value,"onUpdate:modelValue":l[13]||(l[13]=a=>C.value=a),title:q.value,width:"80%","close-on-click-modal":!1,onClosed:_e},{footer:t(()=>[e(f,{onClick:l[12]||(l[12]=a=>C.value=!1)},{default:t(()=>[...l[24]||(l[24]=[n("取消",-1)])]),_:1}),e(f,{type:"primary",onClick:me,loading:F.value},{default:t(()=>[...l[25]||(l[25]=[n("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[e(I,{model:d,rules:te,ref_key:"formRef",ref:D,"label-width":"120px"},{default:t(()=>[e(W,{gutter:20},{default:t(()=>[e($,{span:12},{default:t(()=>[e(i,{label:"模板代码",prop:"template_code"},{default:t(()=>[e(U,{modelValue:d.template_code,"onUpdate:modelValue":l[6]||(l[6]=a=>d.template_code=a),placeholder:"如：picking_notification",disabled:x.value},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e($,{span:12},{default:t(()=>[e(i,{label:"国家代码",prop:"country_code"},{default:t(()=>[e(E,{modelValue:d.country_code,"onUpdate:modelValue":l[7]||(l[7]=a=>d.country_code=a),placeholder:"请选择国家",disabled:x.value},{default:t(()=>[(m(!0),k(A,null,B(S.value,a=>(m(),M(z,{key:a.code,label:a.name,value:a.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),e(W,{gutter:20},{default:t(()=>[e($,{span:12},{default:t(()=>[e(i,{label:"模板名称",prop:"template_name"},{default:t(()=>[e(U,{modelValue:d.template_name,"onUpdate:modelValue":l[8]||(l[8]=a=>d.template_name=a),placeholder:"请输入模板名称"},null,8,["modelValue"])]),_:1})]),_:1}),e($,{span:12},{default:t(()=>[e(i,{label:"是否启用",prop:"is_active"},{default:t(()=>[e(Q,{modelValue:d.is_active,"onUpdate:modelValue":l[9]||(l[9]=a=>d.is_active=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(i,{label:"邮件主题",prop:"subject"},{default:t(()=>[e(U,{modelValue:d.subject,"onUpdate:modelValue":l[10]||(l[10]=a=>d.subject=a),placeholder:"请输入邮件主题"},null,8,["modelValue"])]),_:1}),e(i,{label:"可用变量"},{default:t(()=>[(m(),k(A,null,B(le,a=>e(T,{key:a,size:"small",style:{"margin-right":"8px","margin-bottom":"8px"},onClick:w=>fe(a)},{default:t(()=>[n(_("{"+a+"}"),1)]),_:2},1032,["onClick"])),64)),e(ye,{type:"info",size:"small",style:{display:"block","margin-top":"5px"}},{default:t(()=>[...l[23]||(l[23]=[n(" 点击变量可插入到光标位置 ",-1)])]),_:1})]),_:1}),e(i,{label:"HTML内容",prop:"html_content"},{default:t(()=>[e(U,{modelValue:d.html_content,"onUpdate:modelValue":l[11]||(l[11]=a=>d.html_content=a),type:"textarea",rows:20,placeholder:"请输入邮件HTML内容，可使用变量，如：order_number、customer_name 等，需用花括号包裹",style:{"font-family":"monospace"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(Z,{modelValue:H.value,"onUpdate:modelValue":l[14]||(l[14]=a=>H.value=a),title:"邮件预览",width:"60%"},{default:t(()=>[c.value?(m(),k("div",Pe,[e(Ve,{column:2,border:""},{default:t(()=>[e(h,{label:"模板代码"},{default:t(()=>[n(_(c.value.template_code),1)]),_:1}),e(h,{label:"国家"},{default:t(()=>[n(_(c.value.country_code),1)]),_:1}),e(h,{label:"模板名称",span:2},{default:t(()=>[n(_(c.value.template_name),1)]),_:1}),e(h,{label:"邮件主题",span:2},{default:t(()=>[n(_(c.value.subject),1)]),_:1}),e(h,{label:"状态"},{default:t(()=>[e(T,{type:c.value.is_active?"success":"danger"},{default:t(()=>[n(_(c.value.is_active?"启用":"禁用"),1)]),_:1},8,["type"])]),_:1}),e(h,{label:"更新时间"},{default:t(()=>[n(_(c.value.updated_at),1)]),_:1})]),_:1}),e(Ce,null,{default:t(()=>[...l[26]||(l[26]=[n("邮件内容预览",-1)])]),_:1}),j("div",{class:"email-preview",innerHTML:c.value.html_content},null,8,Ke)])):Ee("",!0)]),_:1},8,["modelValue"])])}}}),Xe=qe(Oe,[["__scopeId","data-v-14301631"]]);export{Xe as default};
