import{a5 as P,d as qe,h as m,P as oe,Z as He,r as p,Q as Je,c as r,o as n,b as t,a as s,w as a,_ as Xe,g as I,q as he,u as b,aE as Ye,x as ke,e as c,aS as Ze,t as i,aO as et,aI as tt,bh as st,bi as at,bj as lt,bk as ot,F as ne,f as ie,W as re,E as ze,n as nt,R as B,av as it,aG as rt,N as k,a0 as dt}from"./index-BffqHnU8.js";import{g as ut}from"./product-C1YgZwIS.js";import{_ as ct}from"./_plugin-vue_export-helper-DlAUqK2U.js";const K={getVisitorIps:y=>P.get("/admin/statistics/visitor-ips",y),getVisitorIp:y=>P.get(`/admin/statistics/visitor-ips/${y}`),getIpStatistics:y=>P.get("/admin/statistics/visitor-ips-stats",y),deleteVisitorIp:y=>P.delete(`/admin/statistics/visitor-ips/${y}`),syncBehaviorData:()=>P.post("/admin/statistics/sync-behavior-data")},Ce={getSummary:y=>P.get("/admin/user-behavior/summary",y),getTimeline:y=>P.get("/admin/user-behavior/timeline",y),fetchFromRedis:y=>P.get("/admin/user-behavior/fetch-from-redis",{ip:y})},pt={class:"visitor-ip-list"},_t={class:"statistics-title"},ft={class:"stat-content"},vt={class:"stat-value"},mt={class:"stat-icon"},yt={class:"stat-content"},gt={class:"stat-value"},bt={class:"stat-icon"},ht={class:"stat-content"},kt={class:"stat-value"},zt={class:"stat-icon"},Ct={class:"stat-content"},xt={class:"stat-value"},It={class:"stat-icon"},St={class:"stat-content"},Vt={class:"stat-value"},Tt={class:"stat-icon"},wt={class:"stat-content"},Pt={class:"stat-value"},Lt={class:"stat-icon"},Bt={class:"source-stats-list"},Dt={class:"source-name"},At={class:"source-count"},Mt={class:"count-value"},Rt={class:"table-header"},Ut={class:"table-actions"},Ft={class:"ip-list"},Nt={class:"ip-header"},$t={class:"ip-address"},Et={class:"ip-actions"},Ot={class:"ip-content"},Kt={class:"ip-section"},jt={class:"address-info"},Gt={class:"address-line"},Qt={class:"value"},Wt={class:"address-line"},qt={class:"value"},Ht={class:"address-line"},Jt=["title"],Xt={class:"address-line"},Yt=["title"],Zt={class:"ip-section"},es={class:"organization-info"},ts={class:"org-name"},ss={class:"org-tags"},as={class:"ip-section"},ls={class:"basic-type"},os={class:"type-line"},ns={class:"type-line"},is={class:"value"},rs={class:"type-line"},ds={class:"value"},us={class:"type-line"},cs={key:1,class:"value"},ps={class:"type-line"},_s={key:1,class:"value"},fs={class:"ip-section"},vs={class:"behavior-info"},ms={class:"behavior-summary"},ys={key:0,class:"duration-text"},gs={key:1,class:"no-data-text"},bs={class:"behavior-actions"},hs={key:0,class:"ip-section"},ks={class:"detailed-type"},zs={class:"type-line"},Cs={class:"type-line"},xs={class:"value"},Is={class:"type-line"},Ss={class:"value"},Vs={class:"pagination-wrapper"},Ts={class:"product-select-dialog"},ws={key:0,class:"ip-detail"},Ps={key:0},Ls={key:1,class:"text-gray-400"},Bs={key:0},Ds={key:1,class:"text-gray-400"},As={key:0},Ms={key:1,class:"text-gray-400"},Rs={key:0},Us={key:1,class:"text-gray-400"},Fs={key:0},Ns={key:1,class:"text-gray-400"},$s={key:0},Es={key:1,class:"text-gray-400"},Os={key:0},Ks={key:1,class:"text-gray-400"},js={key:0},Gs={key:1,class:"text-gray-400"},Qs={key:0,class:"referer-info"},Ws={key:1,class:"text-gray-400"},qs={key:0,class:"referer-info"},Hs={key:1,class:"text-gray-400"},Js={key:1,class:"text-gray-400"},Xs={key:0,class:"location-info"},Ys={class:"timeline-container"},Zs={key:0,class:"timeline-content"},ea={class:"timeline-header"},ta={class:"timeline-list"},sa={class:"timeline-item-content"},aa={class:"action-description"},la={class:"action-text"},oa={key:0,class:"action-detail"},na=qe({__name:"index",setup(y){const j=m(!1),G=m(!1),Q=m(!1),d=m(null),W=m(!1),q=m(!1),C=m(null),g=oe({ip:"",timeRange:"today",visitorType:"",productId:""}),R=m(!1),H=m(!1),J=m([]),U=m([]),F=m(""),D=m(""),V=oe({page:1,size:20,total:0}),z=oe({page:1,size:20,total:0}),X=m([]),T=m({totalIps:0,todayIps:0,totalCountries:0,totalCities:0,genuineCount:0,fakeCount:0,countryStats:[],cityStats:[],productTypeStats:[],sourceStats:[]}),Y=l=>l?new Date(l).toLocaleString("zh-CN"):"--",xe=l=>{const e=[];return l.country&&e.push(l.country),l.region&&e.push(l.region),l.city&&e.push(l.city),e.length>0?e.join(" - "):null},N=l=>{const e=["proxy","vpn","tor","anonymizer"],u=(l.organization||"").toLowerCase();return e.some(f=>u.includes(f))},Ie=l=>{const e=["amazon","google","microsoft","cloudflare","digitalocean","linode","vultr","aws","gcp","azure"],u=(l.organization||"").toLowerCase();return e.some(f=>u.includes(f))},de=l=>A(l)?"爬虫":N(l)?"代理":"访客",ue=l=>A(l)?"primary":N(l)?"warning":"success",Z=l=>{const e=["google","facebook","twitter","linkedin","microsoft","bytedance","tiktok"],u=(l.organization||"").toLowerCase(),f=(l.user_agent||"").trim(),h=e.some(v=>u.includes(v)),E=!f||f.length<20;return h&&E},A=l=>{if(Z(l))return!0;const e=["bot","crawler","spider","scraper","crawl","googlebot","bingbot","slurp","duckduckbot","facebook","facebookexternalhit","facebot","twitter","twitterbot","linkedin","linkedinbot","whatsapp","telegrambot","bytedance","bytespider","semrush","ahrefs","mj12bot","petalbot","yandex","baidu"],u=(l.user_agent||"").toLowerCase(),f=(l.organization||"").toLowerCase();return e.some(h=>u.includes(h)||f.includes(h))},Se=l=>{const e=l.user_agent||"";return e.includes("Mobile")?"Mobile":e.includes("Tablet")?"Tablet":e.includes("Desktop")?"Desktop":null},Ve=l=>{const e=l.user_agent||"";return e.includes("Android")?"Android":e.includes("iOS")||e.includes("iPhone")||e.includes("iPad")?"iOS":e.includes("Windows")?"Windows":e.includes("Mac")?"macOS":e.includes("Linux")?"Linux":null},Te=l=>{const e=(l.user_agent||"").toLowerCase(),u=(l.organization||"").toLowerCase();return Z(l)?u.includes("google")?"Google 审核爬虫":u.includes("facebook")?"Facebook 审核爬虫":u.includes("twitter")?"Twitter 审核爬虫":u.includes("linkedin")?"LinkedIn 审核爬虫":u.includes("microsoft")?"Microsoft 审核爬虫":u.includes("bytedance")||u.includes("tiktok")?"TikTok 审核爬虫":"审核爬虫":e.includes("googlebot")||u.includes("google")&&e.includes("bot")?"Googlebot":e.includes("bingbot")||u.includes("microsoft")&&e.includes("bot")?"BingBot":e.includes("facebook")?"Facebook Crawler":e.includes("twitter")?"Twitter Bot":e.includes("ahrefs")||u.includes("ahrefs")?"aHrefs Bot":e.includes("httpx")?"httpx":e.includes("barkrowler")?"Barkrowler":A(l)?"通用爬虫":null},we=l=>{const e=(l.user_agent||"").toLowerCase(),u=(l.organization||"").toLowerCase();return Z(l)?"广告/内容合规审核（无UA或异常UA）":e.includes("googlebot")||u.includes("google")&&e.includes("bot")||e.includes("bingbot")||u.includes("microsoft")&&e.includes("bot")?"搜索引擎蜘蛛":e.includes("facebook")||e.includes("twitter")?"社交媒体爬虫":e.includes("ahrefs")||u.includes("ahrefs")?"SEO分析爬虫":A(l)?"通用网络爬虫":null},ce=l=>({A:"primary",B:"success",C:"warning",D:"danger",E:"info"})[l]||"info",pe=l=>({A:"A页",B:"B页",C:"C页",D:"D页",E:"E页"})[l]||l,Pe=l=>({YouTube:"danger","Android App":"success",Google:"primary",Facebook:"primary",Instagram:"warning",TikTok:"danger","Twitter/X":"info",直接访问:"info",其他:""})[l]||"info",Le=()=>({today:"今天",yesterday:"昨天",week:"本周",month:"本月",all:"全部时间"})[g.timeRange]||"今天",M=async()=>{try{j.value=!0;const l={page:z.page,size:z.size,...g},e=await K.getVisitorIps(l);e.code===200&&(X.value=e.data.list,z.total=e.data.total)}catch(l){console.error("获取访客IP列表失败:",l),k.error("获取访客IP列表失败")}finally{j.value=!1}},$=async()=>{try{const l=await K.getIpStatistics({timeRange:g.timeRange||"today"});l.code===200&&(T.value=l.data)}catch(l){console.error("获取统计数据失败:",l),k.error("获取统计数据失败")}},ee=()=>{z.page=1,M(),$()},Be=()=>{Object.assign(g,{ip:"",timeRange:"today",visitorType:"",productId:""}),D.value="",ee()},te=async()=>{try{H.value=!0;const{data:l}=await ut({page:V.page,size:V.size});J.value=l.list||[],U.value=l.list||[],V.total=l.total||0}catch{k.error("加载商品列表失败")}finally{H.value=!1}},De=()=>{if(!F.value){U.value=J.value;return}const l=F.value.toLowerCase();U.value=J.value.filter(e=>{var u,f;return((u=e.title)==null?void 0:u.toLowerCase().includes(l))||((f=e.spu_id)==null?void 0:f.toLowerCase().includes(l))})},_e=l=>{g.productId=l.spu_id,D.value=l.title,R.value=!1,k.success(`已选择商品: ${l.title}`)},Ae=()=>{g.productId="",D.value=""},Me=async()=>{try{await dt.confirm("确定要同步Redis中的用户行为数据到MySQL吗？","同步确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),G.value=!0;const{data:l}=await K.syncBehaviorData();l.successCount>0?(k.success(`同步完成！成功: ${l.successCount} 条，失败: ${l.failCount} 条`),await Promise.all([M(),$()])):k.info("没有数据需要同步")}catch(l){l!=="cancel"&&k.error(l.message||"同步失败")}finally{G.value=!1}},Re=l=>{z.size=l,z.page=1,M()},Ue=l=>{z.page=l,M()},Fe=async l=>{try{const e=await K.getVisitorIp(l.ip_address);e.code===200&&(d.value=e.data,Q.value=!0)}catch(e){console.error("获取IP详情失败:",e),k.error("获取IP详情失败")}},Ne=async l=>{try{const e=await Ce.fetchFromRedis(l.ip_address);e.code===200&&(e.data?(l.behaviorSummary=e.data,k.success("获取成功（来自Redis）")):k.info("Redis中暂无该IP的轨迹数据"))}catch(e){console.error("从Redis获取数据失败:",e),k.error("获取失败")}},$e=async l=>{try{if(!l.behaviorSummary){k.warning("该IP暂无行为轨迹数据");return}q.value=!0,W.value=!0,C.value=null;const e={sessionId:l.behaviorSummary.sessionId,ip:l.ip_address,productId:l.behaviorSummary.productId,date:l.behaviorSummary.visitDate.replace(/-/g,"")},u=await Ce.getTimeline(e);u.code===200&&(C.value=u.data)}catch(e){console.error("获取用户行为轨迹失败:",e),k.error("获取用户行为轨迹失败")}finally{q.value=!1}},Ee=l=>({enter:"success",leave:"info",scroll:"primary",click_sku:"warning",select_province:"warning",select_city:"warning",fill_name:"warning",fill_phone:"warning",submit_order:"danger",order_success:"success",order_fail:"danger"})[l]||"info",Oe=l=>({enter:"success",leave:"info",scroll:"",click_sku:"warning",select_province:"primary",select_city:"primary",fill_name:"warning",fill_phone:"warning",submit_order:"danger",order_success:"success",order_fail:"danger"})[l]||"info";return He(()=>{M(),$(),te()}),(l,e)=>{const u=p("el-input"),f=p("el-form-item"),h=p("el-option"),E=p("el-select"),v=p("el-icon"),w=p("el-button"),Ke=p("el-form"),S=p("el-card"),L=p("el-col"),fe=p("el-row"),x=p("el-tag"),ve=p("el-pagination"),se=p("el-table-column"),je=p("el-table"),ae=p("el-dialog"),_=p("el-descriptions-item"),me=p("el-link"),ye=p("el-descriptions"),O=p("el-text"),Ge=p("el-timeline-item"),Qe=p("el-timeline"),We=p("el-empty"),le=Je("loading");return n(),r("div",pt,[t(S,{class:"search-card",shadow:"never"},{default:a(()=>[t(Ke,{model:g,inline:!0,class:"search-form"},{default:a(()=>[t(f,{label:"IP地址"},{default:a(()=>[t(u,{modelValue:g.ip,"onUpdate:modelValue":e[0]||(e[0]=o=>g.ip=o),placeholder:"请输入IP地址",clearable:"",style:{width:"200px"},onKeyup:Xe(ee,["enter"])},null,8,["modelValue"])]),_:1}),t(f,{label:"时间筛选"},{default:a(()=>[t(E,{modelValue:g.timeRange,"onUpdate:modelValue":e[1]||(e[1]=o=>g.timeRange=o),placeholder:"请选择时间范围",style:{width:"150px"}},{default:a(()=>[t(h,{label:"当天",value:"today"}),t(h,{label:"昨天",value:"yesterday"}),t(h,{label:"本周",value:"week"}),t(h,{label:"本月",value:"month"}),t(h,{label:"全部",value:"all"})]),_:1},8,["modelValue"])]),_:1}),t(f,{label:"访客类型"},{default:a(()=>[t(E,{modelValue:g.visitorType,"onUpdate:modelValue":e[2]||(e[2]=o=>g.visitorType=o),placeholder:"请选择类型",clearable:"",style:{width:"150px"}},{default:a(()=>[t(h,{label:"访客",value:"visitor"}),t(h,{label:"爬虫",value:"bot"}),t(h,{label:"代理",value:"proxy"})]),_:1},8,["modelValue"])]),_:1}),t(f,{label:"商品筛选"},{default:a(()=>[t(u,{modelValue:D.value,"onUpdate:modelValue":e[3]||(e[3]=o=>D.value=o),placeholder:"点击选择商品",readonly:"",style:{width:"200px"},onClick:e[4]||(e[4]=o=>R.value=!0)},{suffix:a(()=>[g.productId?(n(),I(v,{key:0,onClick:he(Ae,["stop"]),style:{cursor:"pointer"}},{default:a(()=>[t(b(Ye))]),_:1})):(n(),I(v,{key:1},{default:a(()=>[t(b(ke))]),_:1}))]),_:1},8,["modelValue"])]),_:1}),t(f,null,{default:a(()=>[t(w,{type:"primary",onClick:ee},{default:a(()=>[...e[13]||(e[13]=[c("搜索",-1)])]),_:1}),t(w,{onClick:Be},{default:a(()=>[...e[14]||(e[14]=[c("重置",-1)])]),_:1}),t(w,{type:"success",onClick:Me,loading:G.value},{default:a(()=>[t(v,null,{default:a(()=>[t(b(Ze))]),_:1}),e[15]||(e[15]=c(" 一键同步轨迹 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),s("div",_t,[s("h3",null,"统计数据（"+i(Le())+"）",1)]),t(fe,{gutter:20,class:"statistics-cards"},{default:a(()=>[t(L,{span:4},{default:a(()=>[t(S,{class:"stat-card"},{default:a(()=>[s("div",ft,[s("div",vt,i(T.value.totalIps),1),e[16]||(e[16]=s("div",{class:"stat-label"},"总IP数",-1))]),s("div",mt,[t(v,null,{default:a(()=>[t(b(et))]),_:1})])]),_:1})]),_:1}),t(L,{span:4},{default:a(()=>[t(S,{class:"stat-card"},{default:a(()=>[s("div",yt,[s("div",gt,i(T.value.todayIps),1),e[17]||(e[17]=s("div",{class:"stat-label"},"今日新增",-1))]),s("div",bt,[t(v,null,{default:a(()=>[t(b(tt))]),_:1})])]),_:1})]),_:1}),t(L,{span:4},{default:a(()=>[t(S,{class:"stat-card genuine"},{default:a(()=>[s("div",ht,[s("div",kt,i(T.value.genuineCount),1),e[18]||(e[18]=s("div",{class:"stat-label"},"访问正品",-1))]),s("div",zt,[t(v,null,{default:a(()=>[t(b(st))]),_:1})])]),_:1})]),_:1}),t(L,{span:4},{default:a(()=>[t(S,{class:"stat-card fake"},{default:a(()=>[s("div",Ct,[s("div",xt,i(T.value.fakeCount),1),e[19]||(e[19]=s("div",{class:"stat-label"},"访问仿品",-1))]),s("div",It,[t(v,null,{default:a(()=>[t(b(at))]),_:1})])]),_:1})]),_:1}),t(L,{span:4},{default:a(()=>[t(S,{class:"stat-card"},{default:a(()=>[s("div",St,[s("div",Vt,i(T.value.totalCountries),1),e[20]||(e[20]=s("div",{class:"stat-label"},"涉及国家",-1))]),s("div",Tt,[t(v,null,{default:a(()=>[t(b(lt))]),_:1})])]),_:1})]),_:1}),t(L,{span:4},{default:a(()=>[t(S,{class:"stat-card"},{default:a(()=>[s("div",wt,[s("div",Pt,i(T.value.totalCities),1),e[21]||(e[21]=s("div",{class:"stat-label"},"涉及城市",-1))]),s("div",Lt,[t(v,null,{default:a(()=>[t(b(ot))]),_:1})])]),_:1})]),_:1})]),_:1}),t(fe,{gutter:20,class:"statistics-cards",style:{"margin-top":"20px"}},{default:a(()=>[t(L,{span:24},{default:a(()=>[t(S,{class:"source-stats-card"},{default:a(()=>[e[23]||(e[23]=s("div",{class:"card-header"},[s("h3",null,"访问来源统计")],-1)),s("div",Bt,[(n(!0),r(ne,null,ie(T.value.sourceStats,o=>(n(),r("div",{key:o.source,class:"source-item"},[s("div",Dt,[t(x,{type:Pe(o.source),size:"default"},{default:a(()=>[c(i(o.source),1)]),_:2},1032,["type"])]),s("div",At,[s("span",Mt,i(o.count),1),e[22]||(e[22]=s("span",{class:"count-label"},"次",-1))])]))),128))])]),_:1})]),_:1})]),_:1}),t(S,{class:"table-card",shadow:"never"},{default:a(()=>[s("div",Rt,[e[25]||(e[25]=s("div",{class:"table-title"},"访客IP列表",-1)),s("div",Ut,[t(w,{onClick:$},{default:a(()=>[t(v,null,{default:a(()=>[t(b(ze))]),_:1}),e[24]||(e[24]=c(" 刷新统计 ",-1))]),_:1})])]),re((n(),r("div",Ft,[(n(!0),r(ne,null,ie(X.value,(o,ge)=>(n(),r("div",{key:o.id,class:nt(["ip-item",{"last-item":ge===X.value.length-1}])},[s("div",Nt,[s("div",$t,i(o.ip_address),1),s("div",Et,[t(w,{type:"primary",size:"small",onClick:be=>Fe(o)},{default:a(()=>[...e[26]||(e[26]=[c("查看",-1)])]),_:1},8,["onClick"])])]),s("div",Ot,[s("div",Kt,[e[31]||(e[31]=s("div",{class:"section-title"},"地址信息",-1)),s("div",jt,[s("div",Gt,[e[27]||(e[27]=s("span",{class:"label"},"地址:",-1)),s("span",Qt,i(xe(o)||"-"),1)]),s("div",Wt,[e[28]||(e[28]=s("span",{class:"label"},"时间:",-1)),s("span",qt,i(Y(o.last_visit)),1)]),s("div",Ht,[e[29]||(e[29]=s("span",{class:"label"},"访问页面:",-1)),s("span",{class:"value referer",title:o.access_address||"-"},i(o.access_address||"-"),9,Jt)]),s("div",Xt,[e[30]||(e[30]=s("span",{class:"label"},"来源:",-1)),s("span",{class:"value referer",title:o.referer||"-"},i(o.referer||"-"),9,Yt)])])]),s("div",Zt,[e[34]||(e[34]=s("div",{class:"section-title"},"组织信息",-1)),s("div",es,[s("div",ts,i(o.organization||"-"),1),s("div",ss,[N(o)?(n(),I(x,{key:0,size:"small",type:"info"},{default:a(()=>[...e[32]||(e[32]=[c("代理",-1)])]),_:1})):B("",!0),Ie(o)?(n(),I(x,{key:1,size:"small",type:"warning"},{default:a(()=>[...e[33]||(e[33]=[c("机房",-1)])]),_:1})):B("",!0)])])]),s("div",as,[e[40]||(e[40]=s("div",{class:"section-title"},"基础类型",-1)),s("div",ls,[s("div",os,[e[35]||(e[35]=s("span",{class:"label"},"类型:",-1)),t(x,{type:ue(o),size:"small"},{default:a(()=>[c(i(de(o)),1)]),_:2},1032,["type"])]),s("div",ns,[e[36]||(e[36]=s("span",{class:"label"},"设备:",-1)),s("span",is,i(Se(o)||"-"),1)]),s("div",rs,[e[37]||(e[37]=s("span",{class:"label"},"系统:",-1)),s("span",ds,i(Ve(o)||"-"),1)]),s("div",us,[e[38]||(e[38]=s("span",{class:"label"},"商品:",-1)),o.product_id?(n(),I(x,{key:0,size:"small",type:"success"},{default:a(()=>[c(i(o.product_id),1)]),_:2},1024)):(n(),r("span",cs,"-"))]),s("div",ps,[e[39]||(e[39]=s("span",{class:"label"},"产品类型:",-1)),o.product_type?(n(),I(x,{key:0,size:"small",type:ce(o.product_type)},{default:a(()=>[c(i(pe(o.product_type)),1)]),_:2},1032,["type"])):(n(),r("span",_s,"-"))])])]),s("div",fs,[e[43]||(e[43]=s("div",{class:"section-title"},"用户轨迹",-1)),s("div",vs,[s("div",ms,[t(v,null,{default:a(()=>[t(b(it))]),_:1}),o.behaviorSummary?(n(),r("span",ys," 停留 "+i(o.behaviorSummary.durationText||"0秒"),1)):(n(),r("span",gs,"暂无轨迹数据"))]),s("div",bs,[o.behaviorSummary?B("",!0):(n(),I(w,{key:0,type:"warning",size:"small",onClick:be=>Ne(o)},{default:a(()=>[t(v,null,{default:a(()=>[t(b(ze))]),_:1}),e[41]||(e[41]=c(" 获取 ",-1))]),_:1},8,["onClick"])),t(w,{type:"primary",size:"small",disabled:!o.behaviorSummary,onClick:be=>$e(o)},{default:a(()=>[t(v,null,{default:a(()=>[t(b(rt))]),_:1}),e[42]||(e[42]=c(" 查看详情 ",-1))]),_:1},8,["disabled","onClick"])])])]),A(o)||N(o)?(n(),r("div",hs,[e[47]||(e[47]=s("div",{class:"section-title"},"详细类型",-1)),s("div",ks,[s("div",zs,[e[44]||(e[44]=s("span",{class:"label"},"类型:",-1)),t(x,{type:ue(o),size:"small"},{default:a(()=>[c(i(de(o)),1)]),_:2},1032,["type"])]),s("div",Cs,[e[45]||(e[45]=s("span",{class:"label"},"名称:",-1)),s("span",xs,i(Te(o)||"-"),1)]),s("div",Is,[e[46]||(e[46]=s("span",{class:"label"},"说明:",-1)),s("span",Ss,i(we(o)||"-"),1)])])])):B("",!0)])],2))),128))])),[[le,j.value]]),s("div",Vs,[t(ve,{"current-page":z.page,"onUpdate:currentPage":e[5]||(e[5]=o=>z.page=o),"page-size":z.size,"onUpdate:pageSize":e[6]||(e[6]=o=>z.size=o),total:z.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Re,onCurrentChange:Ue},null,8,["current-page","page-size","total"])])]),_:1}),t(ae,{modelValue:R.value,"onUpdate:modelValue":e[10]||(e[10]=o=>R.value=o),title:"选择商品",width:"800px","close-on-click-modal":!1},{default:a(()=>[s("div",Ts,[t(u,{modelValue:F.value,"onUpdate:modelValue":e[7]||(e[7]=o=>F.value=o),placeholder:"搜索商品标题或ID",clearable:"",style:{"margin-bottom":"20px"},onInput:De},{prefix:a(()=>[t(v,null,{default:a(()=>[t(b(ke))]),_:1})]),_:1},8,["modelValue"]),re((n(),I(je,{data:U.value,height:"400","highlight-current-row":"",onRowClick:_e},{default:a(()=>[t(se,{prop:"spu_id",label:"商品ID",width:"180"}),t(se,{prop:"title",label:"商品标题","show-overflow-tooltip":""}),t(se,{label:"操作",width:"100",align:"center"},{default:a(o=>[t(w,{type:"primary",size:"small",onClick:he(ge=>_e(o.row),["stop"])},{default:a(()=>[...e[48]||(e[48]=[c("选择",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,H.value]]),t(ve,{"current-page":V.page,"onUpdate:currentPage":e[8]||(e[8]=o=>V.page=o),"page-size":V.size,"onUpdate:pageSize":e[9]||(e[9]=o=>V.size=o),total:V.total,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",style:{"margin-top":"20px"},onSizeChange:te,onCurrentChange:te},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue"]),t(ae,{modelValue:Q.value,"onUpdate:modelValue":e[11]||(e[11]=o=>Q.value=o),title:"IP详情",width:"600px","close-on-click-modal":!1},{default:a(()=>[d.value?(n(),r("div",ws,[t(ye,{column:2,border:""},{default:a(()=>[t(_,{label:"IP地址"},{default:a(()=>[c(i(d.value.ip_address),1)]),_:1}),t(_,{label:"国家"},{default:a(()=>[d.value.country?(n(),r("span",Ps,i(d.value.country),1)):(n(),r("span",Ls,"--"))]),_:1}),t(_,{label:"国家代码"},{default:a(()=>[d.value.country?(n(),r("span",Bs,i(d.value.country),1)):(n(),r("span",Ds,"--"))]),_:1}),t(_,{label:"地区"},{default:a(()=>[d.value.region?(n(),r("span",As,i(d.value.region),1)):(n(),r("span",Ms,"--"))]),_:1}),t(_,{label:"城市"},{default:a(()=>[d.value.city?(n(),r("span",Rs,i(d.value.city),1)):(n(),r("span",Us,"--"))]),_:1}),t(_,{label:"时区"},{default:a(()=>[d.value.timezone?(n(),r("span",Fs,i(d.value.timezone),1)):(n(),r("span",Ns,"--"))]),_:1}),t(_,{label:"ISP"},{default:a(()=>[d.value.organization?(n(),r("span",$s,i(d.value.organization),1)):(n(),r("span",Es,"--"))]),_:1}),t(_,{label:"主机名"},{default:a(()=>[d.value.hostname?(n(),r("span",Os,i(d.value.hostname),1)):(n(),r("span",Ks,"--"))]),_:1}),t(_,{label:"邮编"},{default:a(()=>[d.value.postal_code?(n(),r("span",js,i(d.value.postal_code),1)):(n(),r("span",Gs,"--"))]),_:1}),t(_,{label:"访问页面",span:2},{default:a(()=>[d.value.access_address?(n(),r("div",Qs,[t(me,{href:d.value.access_address,target:"_blank",type:"primary",size:"small"},{default:a(()=>[c(i(d.value.access_address),1)]),_:1},8,["href"])])):(n(),r("span",Ws,"--"))]),_:1}),t(_,{label:"来源页面",span:2},{default:a(()=>[d.value.referer?(n(),r("div",qs,[t(me,{href:d.value.referer,target:"_blank",type:"primary",size:"small"},{default:a(()=>[c(i(d.value.referer),1)]),_:1},8,["href"])])):(n(),r("span",Hs,"--"))]),_:1}),t(_,{label:"产品类型"},{default:a(()=>[d.value.product_type?(n(),I(x,{key:0,type:ce(d.value.product_type),size:"small"},{default:a(()=>[c(i(pe(d.value.product_type)),1)]),_:1},8,["type"])):(n(),r("span",Js,"--"))]),_:1}),t(_,{label:"访问次数"},{default:a(()=>[t(x,{type:"info"},{default:a(()=>[c(i(d.value.visit_count),1)]),_:1})]),_:1}),t(_,{label:"首次访问"},{default:a(()=>[c(i(Y(d.value.first_visit)),1)]),_:1}),t(_,{label:"最后访问"},{default:a(()=>[c(i(Y(d.value.last_visit)),1)]),_:1})]),_:1}),d.value.location?(n(),r("div",Xs,[e[49]||(e[49]=s("h4",null,"地理位置",-1)),s("p",null,"坐标: "+i(d.value.location),1)])):B("",!0)])):B("",!0)]),_:1},8,["modelValue"]),t(ae,{modelValue:W.value,"onUpdate:modelValue":e[12]||(e[12]=o=>W.value=o),title:"用户行为轨迹",width:"800px","close-on-click-modal":!1},{default:a(()=>[re((n(),r("div",Ys,[C.value?(n(),r("div",Zs,[s("div",ea,[t(ye,{column:2,size:"small",border:""},{default:a(()=>[t(_,{label:"Session ID"},{default:a(()=>[t(O,{size:"small",type:"info"},{default:a(()=>[c(i(C.value.sessionId),1)]),_:1})]),_:1}),t(_,{label:"数据来源"},{default:a(()=>[t(x,{type:C.value.source==="redis"?"success":"info",size:"small"},{default:a(()=>[c(i(C.value.source==="redis"?"Redis (实时)":"MySQL (历史)"),1)]),_:1},8,["type"])]),_:1}),t(_,{label:"进入时间"},{default:a(()=>[c(i(C.value.enterTime),1)]),_:1}),t(_,{label:"离开时间"},{default:a(()=>[c(i(C.value.exitTime||"未离开"),1)]),_:1}),t(_,{label:"停留时长"},{default:a(()=>[t(O,{type:"primary"},{default:a(()=>[c(i(C.value.durationText),1)]),_:1})]),_:1}),t(_,{label:"操作次数"},{default:a(()=>[t(O,{type:"warning"},{default:a(()=>[c(i(C.value.actions.length)+" 次",1)]),_:1})]),_:1})]),_:1})]),s("div",ta,[t(Qe,null,{default:a(()=>[(n(!0),r(ne,null,ie(C.value.actions,o=>(n(),I(Ge,{key:o.sequence,timestamp:o.time,type:Ee(o.type),placement:"top"},{default:a(()=>[s("div",sa,[s("div",aa,[t(x,{type:Oe(o.type),size:"small"},{default:a(()=>[c(i(o.typeName),1)]),_:2},1032,["type"]),s("span",la,i(o.description),1)]),o.detail?(n(),r("div",oa,[t(O,{size:"small",type:"info"},{default:a(()=>[c(" 详情: "+i(JSON.stringify(o.detail)),1)]),_:2},1024)])):B("",!0)])]),_:2},1032,["timestamp","type"]))),128))]),_:1})])])):(n(),I(We,{key:1,description:"暂无轨迹数据"}))])),[[le,q.value]])]),_:1},8,["modelValue"])])}}}),ua=ct(na,[["__scopeId","data-v-1b106378"]]);export{ua as default};
