import{d as we,h as v,P,Z as Ee,r,Q as Ve,c as k,o as m,b as l,w as a,_ as Ce,e as d,a as y,W as Te,u as ze,$ as xe,g as G,R as Z,t as U,F as q,f as H,N as V,a0 as Le}from"./index-DdlOh_Uu.js";import{c as O}from"./cloakRule-CRWqCpao.js";import{_ as Ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ae={class:"cloak-rule-list"},Ge={class:"table-header"},Oe={class:"table-actions"},Se={key:1,class:"text-gray-400"},De={key:0},Re={key:1,class:"text-gray-400"},Ie={key:0},Me={key:1,class:"text-gray-400"},Ne={class:"pagination-wrapper"},Pe={class:"dialog-footer"},Fe=we({__name:"index",setup(Be){const S=v(!1),D=v(!1),C=v(!1),A=v(""),R=v(),T=v("DEFAULT"),K=[{label:"日本",value:"JA"},{label:"中国",value:"ZH"},{label:"英国",value:"EN"},{label:"斯洛伐克",value:"SK"},{label:"斯洛文尼亚",value:"SI"},{label:"波兰",value:"PL"},{label:"葡萄牙",value:"PT"},{label:"匈牙利",value:"HU"},{label:"意大利",value:"IT"},{label:"西班牙",value:"ES"},{label:"捷克",value:"CZ"}],W=[{label:"亚洲/东京 (日本)",value:"Asia/Tokyo"},{label:"亚洲/上海 (中国)",value:"Asia/Shanghai"},{label:"欧洲/伦敦 (英国)",value:"Europe/London"},{label:"欧洲/布拉迪斯拉发 (斯洛伐克)",value:"Europe/Bratislava"},{label:"欧洲/卢布尔雅那 (斯洛文尼亚)",value:"Europe/Ljubljana"},{label:"欧洲/华沙 (波兰)",value:"Europe/Warsaw"},{label:"欧洲/里斯本 (葡萄牙)",value:"Europe/Lisbon"},{label:"欧洲/布达佩斯 (匈牙利)",value:"Europe/Budapest"},{label:"欧洲/罗马 (意大利)",value:"Europe/Rome"},{label:"欧洲/马德里 (西班牙)",value:"Europe/Madrid"},{label:"欧洲/布拉格 (捷克)",value:"Europe/Prague"},{label:"美国/纽约 (美国东部)",value:"America/New_York"},{label:"美国/洛杉矶 (美国西部)",value:"America/Los_Angeles"},{label:"欧洲/巴黎 (法国)",value:"Europe/Paris"},{label:"欧洲/柏林 (德国)",value:"Europe/Berlin"},{label:"亚洲/首尔 (韩国)",value:"Asia/Seoul"},{label:"亚洲/新加坡 (新加坡)",value:"Asia/Singapore"},{label:"澳大利亚/悉尼 (澳大利亚)",value:"Australia/Sydney"}],J={JA:"Asia/Tokyo",ZH:"Asia/Shanghai",EN:"Europe/London",SK:"Europe/Bratislava",SI:"Europe/Ljubljana",PL:"Europe/Warsaw",PT:"Europe/Lisbon",HU:"Europe/Budapest",IT:"Europe/Rome",ES:"Europe/Madrid",CZ:"Europe/Prague"},c=P({name:"",mode:"",is_active:null}),p=P({page:1,size:20,total:0}),I=v([]),Y=v([]),n=P({name:"",target_regions:[],mode:"cloak",google_detection_mode:"DEFAULT",spider_whitelist:[],block_pc:0,block_proxy:0,block_empty_referer:0,blocked_keywords:[],allowed_countries:[],blocked_countries:[],allowed_organizations:[],blocked_organizations:[],allowed_timezones:[],allowed_referers:[],description:"",is_active:1}),Q={name:[{required:!0,message:"请输入规则名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],mode:[{required:!0,message:"请选择模式",trigger:"change"}]},X=t=>({cloak:"warning",green:"success",open:"info",audit:"danger"})[t]||"info",ee=t=>({cloak:"斗篷",green:"绿色",open:"全开",audit:"审核"})[t]||t,le=t=>({DEFAULT:"info",GOOGLE_STRICT:"danger",GOOGLE_LENIENT:"success"})[t]||"info",ae=t=>({DEFAULT:"默认(严格)",GOOGLE_STRICT:"严格",GOOGLE_LENIENT:"宽松"})[t]||t,F=()=>{let t=n.description||"";t=t.replace(/\[GOOGLE_\w+\]/g,""),T.value!=="DEFAULT"&&(t=`[${T.value}] ${t}`.trim()),n.description=t},oe=t=>t.includes("GOOGLE_STRICT")?"GOOGLE_STRICT":t.includes("GOOGLE_LENIENT")?"GOOGLE_LENIENT":"DEFAULT",te=t=>t?new Date(t).toLocaleString("zh-CN"):"--",z=async()=>{try{S.value=!0;const t={page:p.page,size:p.size,...c},e=await O.getCloakRules(t);e.code===200&&(I.value=e.data.list,p.total=e.data.total)}catch(t){console.error("获取斗篷规则列表失败:",t),V.error("获取斗篷规则列表失败")}finally{S.value=!1}},M=()=>{p.page=1,z()},ne=()=>{Object.assign(c,{name:"",mode:"",is_active:null}),M()},de=t=>{p.size=t,p.page=1,z()},se=t=>{p.page=t,z()},ue=t=>{Y.value=t},re=()=>{A.value="新增斗篷规则",B(),C.value=!0},ie=t=>{A.value="编辑斗篷规则",Object.assign(n,{...t,target_regions:t.target_regions||[],spider_whitelist:t.spider_whitelist||[],blocked_keywords:t.blocked_keywords||[],allowed_countries:t.allowed_countries||[],blocked_countries:t.blocked_countries||[],allowed_organizations:t.allowed_organizations||[],blocked_organizations:t.blocked_organizations||[]}),T.value=oe(t.description||""),C.value=!0},pe=async t=>{try{V.info(`查看使用规则"${t.name}"的商品功能待实现`)}catch(e){console.error("查看商品失败:",e),V.error("查看商品失败")}},me=async t=>{try{await Le.confirm(`确定要删除规则"${t.name}"吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await O.deleteCloakRule(t.id)).code===200&&(V.success("删除成功"),z())}catch(e){e!=="cancel"&&(console.error("删除斗篷规则失败:",e),V.error("删除失败"))}},_e=t=>{const e=[];t.forEach(f=>{const s=J[f];s&&!e.includes(s)&&e.push(s)}),(n.allowed_timezones.length===0||e.length>0)&&(n.allowed_timezones=e)},B=()=>{var t;Object.assign(n,{name:"",target_regions:[],mode:"cloak",spider_whitelist:[],block_pc:0,block_proxy:0,block_empty_referer:0,blocked_keywords:[],allowed_countries:[],blocked_countries:[],allowed_organizations:[],blocked_organizations:[],allowed_timezones:[],allowed_referers:[],redirect_url:"",audit_url:"",description:"",is_active:1}),T.value="DEFAULT",(t=R.value)==null||t.clearValidate()},ce=async()=>{var t;try{await((t=R.value)==null?void 0:t.validate()),F(),D.value=!0;const e=A.value.includes("编辑");let f;if(e){const s=n.id;f=await O.updateCloakRule(s,n)}else f=await O.createCloakRule(n);f.code===200&&(V.success(e?"更新成功":"创建成功"),C.value=!1,z())}catch(e){console.error("提交失败:",e),V.error("提交失败")}finally{D.value=!1}},fe=()=>{B()};return Ee(()=>{z()}),(t,e)=>{const f=r("el-input"),s=r("el-form-item"),u=r("el-option"),x=r("el-select"),b=r("el-button"),h=r("el-form"),j=r("el-card"),ge=r("el-icon"),_=r("el-table-column"),N=r("el-tag"),be=r("el-table"),ve=r("el-pagination"),g=r("el-col"),w=r("el-row"),i=r("el-radio"),E=r("el-tooltip"),L=r("el-radio-group"),ke=r("el-dialog"),ye=Ve("loading");return m(),k("div",Ae,[l(j,{class:"search-card",shadow:"never"},{default:a(()=>[l(h,{model:c,inline:!0,class:"search-form"},{default:a(()=>[l(s,{label:"规则名称"},{default:a(()=>[l(f,{modelValue:c.name,"onUpdate:modelValue":e[0]||(e[0]=o=>c.name=o),placeholder:"请输入规则名称",clearable:"",style:{width:"200px"},onKeyup:Ce(M,["enter"])},null,8,["modelValue"])]),_:1}),l(s,{label:"模式"},{default:a(()=>[l(x,{modelValue:c.mode,"onUpdate:modelValue":e[1]||(e[1]=o=>c.mode=o),placeholder:"请选择模式",clearable:"",style:{width:"150px"}},{default:a(()=>[l(u,{label:"斗篷",value:"cloak"}),l(u,{label:"绿色",value:"green"}),l(u,{label:"全开",value:"open"}),l(u,{label:"审核",value:"audit"})]),_:1},8,["modelValue"])]),_:1}),l(s,{label:"状态"},{default:a(()=>[l(x,{modelValue:c.is_active,"onUpdate:modelValue":e[2]||(e[2]=o=>c.is_active=o),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:a(()=>[l(u,{label:"启用",value:1}),l(u,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),l(s,null,{default:a(()=>[l(b,{type:"primary",onClick:M},{default:a(()=>[...e[19]||(e[19]=[d("搜索",-1)])]),_:1}),l(b,{onClick:ne},{default:a(()=>[...e[20]||(e[20]=[d("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(j,{class:"table-card",shadow:"never"},{default:a(()=>[y("div",Ge,[e[22]||(e[22]=y("div",{class:"table-title"},"斗篷规则列表",-1)),y("div",Oe,[l(b,{type:"primary",onClick:re},{default:a(()=>[l(ge,null,{default:a(()=>[l(ze(xe))]),_:1}),e[21]||(e[21]=d(" 新增规则 ",-1))]),_:1})])]),Te((m(),G(be,{data:I.value,stripe:"",style:{width:"100%"},onSelectionChange:ue},{default:a(()=>[l(_,{type:"selection",width:"55"}),l(_,{prop:"id",label:"ID",width:"80"}),l(_,{prop:"name",label:"规则名称","min-width":"150","show-overflow-tooltip":""}),l(_,{prop:"mode",label:"模式",width:"100",align:"center"},{default:a(({row:o})=>[l(N,{type:X(o.mode)},{default:a(()=>[d(U(ee(o.mode)),1)]),_:2},1032,["type"])]),_:1}),I.value.some(o=>o.mode==="cloak")?(m(),G(_,{key:0,prop:"google_detection_mode",label:"谷歌检测",width:"120",align:"center"},{default:a(({row:o})=>[o.mode==="cloak"?(m(),G(N,{key:0,type:le(o.google_detection_mode)},{default:a(()=>[d(U(ae(o.google_detection_mode)),1)]),_:2},1032,["type"])):(m(),k("span",Se,"--"))]),_:1})):Z("",!0),l(_,{prop:"target_regions",label:"投放地区",width:"120","show-overflow-tooltip":""},{default:a(({row:o})=>[o.target_regions&&o.target_regions.length>0?(m(),k("span",De,U(o.target_regions.join(", ")),1)):(m(),k("span",Re,"--"))]),_:1}),l(_,{prop:"blocked_organizations",label:"屏蔽组织","min-width":"150","show-overflow-tooltip":""},{default:a(({row:o})=>[o.blocked_organizations&&o.blocked_organizations.length>0?(m(),k("span",Ie,U(o.blocked_organizations.join(", ")),1)):(m(),k("span",Me,"--"))]),_:1}),l(_,{prop:"is_active",label:"状态",width:"80",align:"center"},{default:a(({row:o})=>[l(N,{type:o.is_active?"success":"danger"},{default:a(()=>[d(U(o.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(_,{prop:"created_at",label:"创建时间",width:"160"},{default:a(({row:o})=>[d(U(te(o.created_at)),1)]),_:1}),l(_,{label:"操作",width:"280",fixed:"right"},{default:a(({row:o})=>[l(b,{type:"primary",size:"small",onClick:$=>ie(o)},{default:a(()=>[...e[23]||(e[23]=[d(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(b,{type:"warning",size:"small",onClick:$=>pe(o)},{default:a(()=>[...e[24]||(e[24]=[d(" 查看商品 ",-1)])]),_:1},8,["onClick"]),l(b,{type:"danger",size:"small",onClick:$=>me(o)},{default:a(()=>[...e[25]||(e[25]=[d(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ye,S.value]]),y("div",Ne,[l(ve,{"current-page":p.page,"onUpdate:currentPage":e[3]||(e[3]=o=>p.page=o),"page-size":p.size,"onUpdate:pageSize":e[4]||(e[4]=o=>p.size=o),total:p.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:de,onCurrentChange:se},null,8,["current-page","page-size","total"])])]),_:1}),l(ke,{modelValue:C.value,"onUpdate:modelValue":e[18]||(e[18]=o=>C.value=o),title:A.value,width:"800px","close-on-click-modal":!1,onClose:fe},{footer:a(()=>[y("div",Pe,[l(b,{onClick:e[17]||(e[17]=o=>C.value=!1)},{default:a(()=>[...e[44]||(e[44]=[d("取消",-1)])]),_:1}),l(b,{type:"primary",loading:D.value,onClick:ce},{default:a(()=>[...e[45]||(e[45]=[d(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:a(()=>[l(h,{ref_key:"formRef",ref:R,model:n,rules:Q,"label-width":"120px",class:"cloak-rule-form"},{default:a(()=>[l(w,{gutter:20},{default:a(()=>[l(g,{span:24},{default:a(()=>[l(s,{label:"规则名称",prop:"name"},{default:a(()=>[l(f,{modelValue:n.name,"onUpdate:modelValue":e[5]||(e[5]=o=>n.name=o),placeholder:"请输入规则名称",maxlength:"50"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(w,{gutter:20},{default:a(()=>[l(g,{span:24},{default:a(()=>[l(s,{label:"模式",prop:"mode"},{default:a(()=>[l(L,{modelValue:n.mode,"onUpdate:modelValue":e[6]||(e[6]=o=>n.mode=o)},{default:a(()=>[l(E,{content:"只有投放地区客户能访问真实链接",placement:"top"},{default:a(()=>[l(i,{value:"cloak"},{default:a(()=>[...e[26]||(e[26]=[d("斗篷",-1)])]),_:1})]),_:1}),l(E,{content:"所有客户访问真实链接",placement:"top"},{default:a(()=>[l(i,{value:"open"},{default:a(()=>[...e[27]||(e[27]=[d("全开",-1)])]),_:1})]),_:1}),l(E,{content:"所有客户访问重定向链接",placement:"top"},{default:a(()=>[l(i,{value:"green"},{default:a(()=>[...e[28]||(e[28]=[d("绿色",-1)])]),_:1})]),_:1}),l(E,{content:"所有客户访问审核页面",placement:"top"},{default:a(()=>[l(i,{value:"audit"},{default:a(()=>[...e[29]||(e[29]=[d("审核",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(w,{gutter:20},{default:a(()=>[l(g,{span:24},{default:a(()=>[l(s,{label:"投放地区"},{default:a(()=>[l(x,{modelValue:n.target_regions,"onUpdate:modelValue":e[7]||(e[7]=o=>n.target_regions=o),multiple:"",placeholder:"请选择投放地区",style:{width:"100%"},onChange:_e},{default:a(()=>[(m(),k(q,null,H(K,o=>l(u,{key:o.value,label:o.label,value:o.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(w,{gutter:20},{default:a(()=>[l(g,{span:24},{default:a(()=>[l(s,{label:"允许时区"},{default:a(()=>[l(x,{modelValue:n.allowed_timezones,"onUpdate:modelValue":e[8]||(e[8]=o=>n.allowed_timezones=o),multiple:"",placeholder:"请选择允许的时区",style:{width:"100%"}},{default:a(()=>[(m(),k(q,null,H(W,o=>l(u,{key:o.value,label:o.label,value:o.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),e[30]||(e[30]=y("div",{class:"form-tip"},"选择投放地区后会自动推荐对应时区，也可手动选择",-1))]),_:1})]),_:1})]),_:1}),l(w,{gutter:20},{default:a(()=>[l(g,{span:24},{default:a(()=>[l(s,{label:"Referer白名单"},{default:a(()=>[l(x,{modelValue:n.allowed_referers,"onUpdate:modelValue":e[9]||(e[9]=o=>n.allowed_referers=o),multiple:"",filterable:"","allow-create":"",placeholder:"请输入允许的Referer来源（支持手动输入）",style:{width:"100%"}},{default:a(()=>[l(u,{label:"youtube.com",value:"youtube.com"}),l(u,{label:"youtu.be",value:"youtu.be"}),l(u,{label:"m.youtube.com",value:"m.youtube.com"}),l(u,{label:"android-app://com.google.android.googlequicksearchbox",value:"android-app://com.google.android.googlequicksearchbox"}),l(u,{label:"facebook.com",value:"facebook.com"}),l(u,{label:"instagram.com",value:"instagram.com"}),l(u,{label:"twitter.com",value:"twitter.com"}),l(u,{label:"tiktok.com",value:"tiktok.com"})]),_:1},8,["modelValue"]),e[31]||(e[31]=y("div",{class:"form-tip"}," 白名单内的来源将显示正品页面。留空则使用默认白名单（YouTube、Android Google App）。可手动输入自定义域名 ",-1))]),_:1})]),_:1})]),_:1}),l(w,{gutter:20},{default:a(()=>[l(g,{span:24},{default:a(()=>[l(s,{label:"状态"},{default:a(()=>[l(L,{modelValue:n.is_active,"onUpdate:modelValue":e[10]||(e[10]=o=>n.is_active=o)},{default:a(()=>[l(i,{label:1},{default:a(()=>[...e[32]||(e[32]=[d("启用",-1)])]),_:1}),l(i,{label:0},{default:a(()=>[...e[33]||(e[33]=[d("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(s,{label:"屏蔽组织"},{default:a(()=>[l(x,{modelValue:n.blocked_organizations,"onUpdate:modelValue":e[11]||(e[11]=o=>n.blocked_organizations=o),multiple:"",filterable:"","allow-create":"",placeholder:"请输入要屏蔽的组织关键词",style:{width:"100%"}},{default:a(()=>[l(u,{label:"Google",value:"google"}),l(u,{label:"Facebook",value:"facebook"}),l(u,{label:"Amazon",value:"amazon"}),l(u,{label:"Microsoft",value:"microsoft"}),l(u,{label:"Cloudflare",value:"cloudflare"})]),_:1},8,["modelValue"])]),_:1}),n.mode==="cloak"?(m(),G(s,{key:0,label:"谷歌检测模式"},{default:a(()=>[l(L,{modelValue:T.value,"onUpdate:modelValue":e[12]||(e[12]=o=>T.value=o),onChange:F},{default:a(()=>[l(E,{content:"系统默认严格模式：激进过滤谷歌爬虫、审核系统、数据中心IP等",placement:"top"},{default:a(()=>[l(i,{value:"DEFAULT"},{default:a(()=>[...e[34]||(e[34]=[d("默认(严格)",-1)])]),_:1})]),_:1}),l(E,{content:"明确使用严格模式：检测hostname、机器人标识、数据中心IP、AS号码、可疑组织",placement:"top"},{default:a(()=>[l(i,{value:"GOOGLE_STRICT"},{default:a(()=>[...e[35]||(e[35]=[d("谷歌(严格)",-1)])]),_:1})]),_:1}),l(E,{content:"较温和的过滤规则：只过滤明确的谷歌机器人，不检测数据中心IP和AS号码",placement:"top"},{default:a(()=>[l(i,{value:"GOOGLE_LENIENT"},{default:a(()=>[...e[36]||(e[36]=[d("谷歌(宽松)",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})):Z("",!0),l(w,{gutter:20},{default:a(()=>[l(g,{span:8},{default:a(()=>[l(s,{label:"屏蔽PC"},{default:a(()=>[l(L,{modelValue:n.block_pc,"onUpdate:modelValue":e[13]||(e[13]=o=>n.block_pc=o)},{default:a(()=>[l(i,{label:0},{default:a(()=>[...e[37]||(e[37]=[d("未开启",-1)])]),_:1}),l(i,{label:1},{default:a(()=>[...e[38]||(e[38]=[d("开启",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(g,{span:8},{default:a(()=>[l(s,{label:"屏蔽代理"},{default:a(()=>[l(L,{modelValue:n.block_proxy,"onUpdate:modelValue":e[14]||(e[14]=o=>n.block_proxy=o)},{default:a(()=>[l(i,{label:0},{default:a(()=>[...e[39]||(e[39]=[d("未开启",-1)])]),_:1}),l(i,{label:1},{default:a(()=>[...e[40]||(e[40]=[d("开启",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(g,{span:8},{default:a(()=>[l(s,{label:"屏蔽空Referer"},{default:a(()=>[l(L,{modelValue:n.block_empty_referer,"onUpdate:modelValue":e[15]||(e[15]=o=>n.block_empty_referer=o)},{default:a(()=>[l(i,{label:0},{default:a(()=>[...e[41]||(e[41]=[d("未开启",-1)])]),_:1}),l(i,{label:1},{default:a(()=>[...e[42]||(e[42]=[d("开启",-1)])]),_:1})]),_:1},8,["modelValue"]),e[43]||(e[43]=y("div",{class:"form-tip"},"开启后，无referer的访问将显示仿品",-1))]),_:1})]),_:1})]),_:1}),l(s,{label:"备注"},{default:a(()=>[l(f,{modelValue:n.description,"onUpdate:modelValue":e[16]||(e[16]=o=>n.description=o),type:"textarea",rows:3,placeholder:"请输入备注信息",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Ze=Ue(Fe,[["__scopeId","data-v-bc65dabe"]]);export{Ze as default};
