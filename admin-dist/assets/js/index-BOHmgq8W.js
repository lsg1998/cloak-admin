import{d as W,h as z,P as F,s as G,Z as pe,r as u,Q as me,c as v,o as c,a,b as e,w as l,u as i,aX as ge,t as b,aC as A,aV as ve,aW as be,_ as ke,x as O,g as x,R as he,F as J,f as K,e as m,E as q,W as ye,b0 as N,aY as xe,aL as I,ar as Ce,ay as we,b1 as Pe,N as S,a0 as ze}from"./index-CChpJfj1.js";import{g as Ve}from"./product-KO2-6g0n.js";import{g as Ae}from"./pixel-C0vBC8N3.js";import{_ as Se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Te={class:"pixel-management"},De={class:"stats-cards"},Ee={class:"stat-content"},Ue={class:"stat-icon google"},$e={class:"stat-info"},Be={class:"stat-number"},Fe={class:"stat-content"},Ge={class:"stat-icon enabled"},Ne={class:"stat-info"},Ie={class:"stat-number"},Re={class:"stat-content"},Le={class:"stat-icon google"},Me={class:"stat-info"},Oe={class:"stat-number"},Je={class:"stat-content"},Ke={class:"stat-icon facebook"},qe={class:"stat-info"},We={class:"stat-number"},Ze={class:"table-header"},je={class:"table-title"},He={class:"table-actions"},Qe={class:"product-info"},Xe={class:"product-details"},Ye={class:"product-title"},et={class:"product-id"},tt={key:0,class:"pixel-status"},lt={key:1,class:"pixel-status"},at={key:0,class:"pixel-status"},st={key:1,class:"pixel-status"},ot={key:0,class:"pixel-status"},nt={key:1,class:"pixel-status"},dt={key:1,style:{color:"#999999"}},it={class:"time-info"},ut={class:"action-buttons"},ct={class:"pagination-wrapper"},rt={class:"pixel-config-content"},_t={class:"config-actions"},ft=W({name:"PixelManagement"}),pt=W({...ft,setup(mt){const T=z(!1),D=z(!1),V=z(null),g=z(null),f=F({totalProducts:0,enabledProducts:0,googleAdsCount:0,facebookCount:0}),r=F({title:"",pixelStatus:"",platform:"",country:""}),_=F({current:1,size:20,total:0}),E=z([]),Z=[{code:"SK",name:"斯洛伐克"},{code:"CZ",name:"捷克"},{code:"PL",name:"波兰"},{code:"HU",name:"匈牙利"},{code:"DE",name:"德国"},{code:"AT",name:"奥地利"},{code:"RO",name:"罗马尼亚"},{code:"JP",name:"日本"}],j=G(()=>{const n={};return E.value.forEach(t=>{if(t.country){const o=t.country.toUpperCase();n[o]=(n[o]||0)+1}}),n}),U=G(()=>{const n=j.value,t=[],o=[];return Z.forEach(d=>{const p=n[d.code]||0;p>0?t.push({...d,count:p}):o.push(d)}),t.sort((d,p)=>p.count-d.count),{withProducts:t,withoutProducts:o}}),H=G(()=>{var n;if(!((n=g.value)!=null&&n.google_ads_accounts))return!1;try{return JSON.parse(g.value.google_ads_accounts).some(o=>o.enabled)}catch{return!1}}),R=()=>{_.current=1,C()},Q=()=>{r.title="",r.pixelStatus="",r.platform="",r.country="",_.current=1,C()},X=n=>{_.size=n,_.current=1,C()},Y=n=>{_.current=n,C()},ee=n=>{V.value=n,D.value=!0},te=n=>{S.info(`查看商品 ${n.title} 的像素配置详情`)},le=n=>{ze.confirm(`确定要测试商品 "${n.title}" 的像素配置吗？`,"测试确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{S.success("像素测试已启动，请查看控制台输出")})},ae=()=>{S.info("批量配置功能开发中...")},se=()=>{V.value&&window.open(`/product/list?pixelConfig=${V.value.id}`,"_blank")},C=async()=>{T.value=!0;try{const[n,t]=await Promise.all([Ve({page:_.current,size:_.size,title:r.title||void 0,country:r.country||void 0,product_type:"original"}),Ae()]);E.value=n.data.list,_.total=n.data.total,g.value=t.data,oe(n.data.list)}catch{S.error("获取数据失败")}finally{T.value=!1}},oe=n=>{if(f.totalProducts=n.length,g.value){const t=g.value;f.enabledProducts=t.enabled?n.length:0;let o=!1;if(t.google_ads_accounts)try{o=JSON.parse(t.google_ads_accounts).some(p=>p.enabled)}catch(d){console.error("解析Google Ads账户配置失败:",d)}f.googleAdsCount=o?n.length:0,f.facebookCount=t.facebook_enabled?n.length:0}else f.enabledProducts=n.filter(t=>t.pixel_enabled).length,f.googleAdsCount=n.filter(t=>{var o,d;return(d=(o=t.pixel_config)==null?void 0:o.google_ads)==null?void 0:d.enabled}).length,f.facebookCount=n.filter(t=>{var o,d;return(d=(o=t.pixel_config)==null?void 0:o.facebook)==null?void 0:d.enabled}).length};return pe(()=>{C()}),(n,t)=>{var M;const o=u("el-icon"),d=u("el-card"),p=u("el-col"),ne=u("el-row"),de=u("el-input"),w=u("el-form-item"),k=u("el-option"),$=u("el-select"),h=u("el-button"),ie=u("el-form"),B=u("el-tag"),L=u("el-avatar"),y=u("el-table-column"),ue=u("el-table"),ce=u("el-pagination"),re=u("el-alert"),_e=u("el-dialog"),fe=me("loading");return c(),v("div",Te,[t[29]||(t[29]=a("div",{class:"page-header"},[a("h2",null,"像素配置管理"),a("p",null,"管理所有商品的像素跟踪配置，支持Google Ads、Facebook、TikTok等平台")],-1)),a("div",De,[e(ne,{gutter:20},{default:l(()=>[e(p,{span:6},{default:l(()=>[e(d,{class:"stat-card"},{default:l(()=>[a("div",Ee,[a("div",Ue,[e(o,null,{default:l(()=>[e(i(ge))]),_:1})]),a("div",$e,[a("div",Be,b(f.totalProducts),1),t[7]||(t[7]=a("div",{class:"stat-label"},"总商品数",-1))])])]),_:1})]),_:1}),e(p,{span:6},{default:l(()=>[e(d,{class:"stat-card"},{default:l(()=>[a("div",Fe,[a("div",Ge,[e(o,null,{default:l(()=>[e(i(A))]),_:1})]),a("div",Ne,[a("div",Ie,b(f.enabledProducts),1),t[8]||(t[8]=a("div",{class:"stat-label"},"已启用像素",-1))])])]),_:1})]),_:1}),e(p,{span:6},{default:l(()=>[e(d,{class:"stat-card"},{default:l(()=>[a("div",Re,[a("div",Le,[e(o,null,{default:l(()=>[e(i(ve))]),_:1})]),a("div",Me,[a("div",Oe,b(f.googleAdsCount),1),t[9]||(t[9]=a("div",{class:"stat-label"},"Google Ads",-1))])])]),_:1})]),_:1}),e(p,{span:6},{default:l(()=>[e(d,{class:"stat-card"},{default:l(()=>[a("div",Je,[a("div",Ke,[e(o,null,{default:l(()=>[e(i(be))]),_:1})]),a("div",qe,[a("div",We,b(f.facebookCount),1),t[10]||(t[10]=a("div",{class:"stat-label"},"Facebook",-1))])])]),_:1})]),_:1})]),_:1})]),e(d,{class:"search-card",shadow:"never"},{default:l(()=>[e(ie,{model:r,inline:"",class:"search-form"},{default:l(()=>[e(w,{label:"商品标题"},{default:l(()=>[e(de,{modelValue:r.title,"onUpdate:modelValue":t[0]||(t[0]=s=>r.title=s),placeholder:"请输入商品标题",clearable:"",style:{width:"200px"},onKeyup:ke(R,["enter"])},{prefix:l(()=>[e(o,null,{default:l(()=>[e(i(O))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(w,{label:"像素状态"},{default:l(()=>[e($,{modelValue:r.pixelStatus,"onUpdate:modelValue":t[1]||(t[1]=s=>r.pixelStatus=s),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:l(()=>[e(k,{label:"已启用",value:"enabled"}),e(k,{label:"未启用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1}),e(w,{label:"平台类型"},{default:l(()=>[e($,{modelValue:r.platform,"onUpdate:modelValue":t[2]||(t[2]=s=>r.platform=s),placeholder:"请选择平台",clearable:"",style:{width:"120px"}},{default:l(()=>[e(k,{label:"Google Ads",value:"google_ads"}),e(k,{label:"Facebook",value:"facebook"}),e(k,{label:"TikTok",value:"tiktok"})]),_:1},8,["modelValue"])]),_:1}),e(w,{label:"国家筛选"},{default:l(()=>[e($,{modelValue:r.country,"onUpdate:modelValue":t[3]||(t[3]=s=>r.country=s),placeholder:"请选择国家",clearable:"",style:{width:"200px"}},{default:l(()=>[(c(!0),v(J,null,K(U.value.withProducts,s=>(c(),x(k,{key:s.code,label:`${s.name} (${s.count}条)`,value:s.code},null,8,["label","value"]))),128)),U.value.withProducts.length>0?(c(),x(k,{key:0,disabled:"",value:""},{default:l(()=>[...t[11]||(t[11]=[a("span",{style:{color:"#dcdfe6"}},"──────────",-1)])]),_:1})):he("",!0),(c(!0),v(J,null,K(U.value.withoutProducts,s=>(c(),x(k,{key:s.code,label:s.name,value:s.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(w,null,{default:l(()=>[e(h,{type:"primary",onClick:R},{default:l(()=>[e(o,null,{default:l(()=>[e(i(O))]),_:1}),t[12]||(t[12]=m(" 搜索 ",-1))]),_:1}),e(h,{onClick:Q},{default:l(()=>[e(o,null,{default:l(()=>[e(i(q))]),_:1}),t[13]||(t[13]=m(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(d,{class:"table-card",shadow:"never"},{default:l(()=>[a("div",Ze,[a("div",je,[t[14]||(t[14]=a("span",null,"像素配置列表",-1)),e(B,{type:"info",size:"small"},{default:l(()=>[m(b(_.total)+" 条记录",1)]),_:1})]),a("div",He,[e(h,{type:"primary",onClick:ae},{default:l(()=>[e(o,null,{default:l(()=>[e(i(N))]),_:1}),t[15]||(t[15]=m(" 批量配置 ",-1))]),_:1}),e(h,{size:"small",onClick:C},{default:l(()=>[e(o,null,{default:l(()=>[e(i(q))]),_:1}),t[16]||(t[16]=m(" 刷新 ",-1))]),_:1})])]),ye((c(),x(ue,{data:E.value,stripe:"",border:"",style:{width:"100%"},"header-cell-style":{background:"#f8f9fa",color:"#606266"}},{default:l(()=>[e(y,{prop:"title",label:"商品标题","min-width":"200","show-overflow-tooltip":""},{default:l(({row:s})=>[a("div",Qe,[s.image_urls&&s.image_urls[0]?(c(),x(L,{key:0,size:40,src:s.image_urls[0],shape:"square"},null,8,["src"])):(c(),x(L,{key:1,size:40,shape:"square"},{default:l(()=>[e(o,null,{default:l(()=>[e(i(xe))]),_:1})]),_:1})),a("div",Xe,[a("div",Ye,b(s.title),1),a("div",et,"ID: "+b(s.id),1)])])]),_:1}),e(y,{label:"像素状态",width:"100",align:"center"},{default:l(()=>{var s;return[e(B,{type:(s=g.value)!=null&&s.enabled?"success":"info",size:"small"},{default:l(()=>{var P;return[m(b((P=g.value)!=null&&P.enabled?"已启用":"未启用"),1)]}),_:1},8,["type"])]}),_:1}),e(y,{label:"Google Ads",width:"120",align:"center"},{default:l(()=>[H.value?(c(),v("div",tt,[e(o,{class:"status-icon success"},{default:l(()=>[e(i(A))]),_:1}),t[17]||(t[17]=a("span",{class:"status-text"},"已配置",-1))])):(c(),v("div",lt,[e(o,{class:"status-icon disabled"},{default:l(()=>[e(i(I))]),_:1}),t[18]||(t[18]=a("span",{class:"status-text"},"未配置",-1))]))]),_:1}),e(y,{label:"Facebook",width:"120",align:"center"},{default:l(()=>{var s;return[(s=g.value)!=null&&s.facebook_enabled?(c(),v("div",at,[e(o,{class:"status-icon success"},{default:l(()=>[e(i(A))]),_:1}),t[19]||(t[19]=a("span",{class:"status-text"},"已配置",-1))])):(c(),v("div",st,[e(o,{class:"status-icon disabled"},{default:l(()=>[e(i(I))]),_:1}),t[20]||(t[20]=a("span",{class:"status-text"},"未配置",-1))]))]}),_:1}),e(y,{label:"TikTok",width:"120",align:"center"},{default:l(()=>{var s;return[(s=g.value)!=null&&s.tiktok_enabled?(c(),v("div",ot,[e(o,{class:"status-icon success"},{default:l(()=>[e(i(A))]),_:1}),t[21]||(t[21]=a("span",{class:"status-text"},"已配置",-1))])):(c(),v("div",nt,[e(o,{class:"status-icon disabled"},{default:l(()=>[e(i(I))]),_:1}),t[22]||(t[22]=a("span",{class:"status-text"},"未配置",-1))]))]}),_:1}),e(y,{label:"自定义像素",width:"120",align:"center"},{default:l(()=>{var s;return[(s=g.value)!=null&&s.custom_pixels?(c(),x(B,{key:0,type:"warning",size:"small"},{default:l(()=>[...t[23]||(t[23]=[m("已配置",-1)])]),_:1})):(c(),v("span",dt,"--"))]}),_:1}),e(y,{prop:"updated_at",label:"更新时间",width:"180","show-overflow-tooltip":""},{default:l(({row:s})=>[a("div",it,[e(o,{class:"time-icon"},{default:l(()=>[e(i(Ce))]),_:1}),a("span",null,b(s.updated_at),1)])]),_:1}),e(y,{label:"操作",width:"200",fixed:"right",align:"center"},{default:l(({row:s})=>[a("div",ut,[e(h,{size:"small",type:"primary",link:"",onClick:P=>ee(s)},{default:l(()=>[e(o,null,{default:l(()=>[e(i(N))]),_:1}),t[24]||(t[24]=m(" 配置 ",-1))]),_:1},8,["onClick"]),e(h,{size:"small",type:"success",link:"",onClick:P=>te(s)},{default:l(()=>[e(o,null,{default:l(()=>[e(i(we))]),_:1}),t[25]||(t[25]=m(" 查看 ",-1))]),_:1},8,["onClick"]),e(h,{size:"small",type:"warning",link:"",onClick:P=>le(s)},{default:l(()=>[e(o,null,{default:l(()=>[e(i(Pe))]),_:1}),t[26]||(t[26]=m(" 测试 ",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[fe,T.value]]),a("div",ct,[e(ce,{"current-page":_.current,"onUpdate:currentPage":t[4]||(t[4]=s=>_.current=s),"page-size":_.size,"onUpdate:pageSize":t[5]||(t[5]=s=>_.size=s),"page-sizes":[10,20,50,100],total:_.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:X,onCurrentChange:Y},null,8,["current-page","page-size","total"])])]),_:1}),e(_e,{modelValue:D.value,"onUpdate:modelValue":t[6]||(t[6]=s=>D.value=s),title:`像素配置 - ${(M=V.value)==null?void 0:M.title}`,width:"800px","close-on-click-modal":!1},{default:l(()=>[a("div",rt,[e(re,{title:"像素配置说明",type:"info",closable:!1,"show-icon":""},{default:l(()=>[...t[27]||(t[27]=[a("p",null,"• Google Ads: 需要转化ID和转化标签",-1),a("p",null,"• Facebook: 需要像素ID",-1),a("p",null,"• TikTok: 需要像素ID",-1),a("p",null,"• 自定义: 可以添加任意像素代码",-1)])]),_:1}),a("div",_t,[e(h,{type:"primary",onClick:se},{default:l(()=>[e(o,null,{default:l(()=>[e(i(N))]),_:1}),t[28]||(t[28]=m(" 打开详细配置 ",-1))]),_:1})])])]),_:1},8,["modelValue","title"])])}}}),ht=Se(pt,[["__scopeId","data-v-c71d2a92"]]);export{ht as default};
