import{d as U,P as Z,h as S,Z as j,aJ as q,r as u,Q as K,c as D,o as y,a,b as e,w as t,e as w,u as k,x as $,E as ee,ay as te,t as _,b5 as ae,aV as se,bw as le,W as oe,g as A,M as ne,N as ie}from"./index-Bo6A_Mt9.js";import"./index-BpCvQqaw.js";import{c as re}from"./statistics-YJOjbwZp.js";import{aU as N}from"./installCanvasRenderer-Bf4uGEF_.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ce={class:"traffic-statistics-page"},ue={class:"overview-stats"},_e={class:"stat-content"},fe={class:"stat-icon total"},ve={class:"stat-info"},me={class:"stat-number"},pe={class:"stat-content"},he={class:"stat-icon sources"},ge={class:"stat-info"},be={class:"stat-number"},ye={class:"stat-content"},we={class:"stat-icon peak"},ke={class:"stat-info"},xe={class:"stat-number"},Te={class:"stat-sub"},Re={class:"stat-content"},ze={class:"stat-icon avg"},Ce={class:"stat-info"},Se={class:"stat-number"},Ae={class:"chart-header"},Ve={key:3},Ee={class:"visit-count"},Fe={class:"percentage-cell"},Le={class:"percentage-text"},Me=U({name:"TrafficStatisticsPage"}),De=U({...Me,setup(Ne){const r=Z({timeRange:"24h",source:"",timezone:"Asia/Shanghai"}),T=S(!1),d=S(null),V=S(),E=S();let f=null,v=null;const R=o=>o?o.toLocaleString():"0",B=o=>o==null?null:`${o.toString().padStart(2,"0")}:00`,I=()=>({"24h":"24小时","3d":"最近3天",week:"本周",month:"本月","7d":"最近7天","30d":"最近30天"})[r.timeRange]||"流量",P=o=>({YouTube:"danger",Google:"success",Facebook:"primary",Instagram:"warning",TikTok:"info","Twitter/X":"","Android App":"success",直接访问:"info",其他:""})[o]||"",L=o=>!d.value||!d.value.total_visits?0:Math.round(o/d.value.total_visits*100),W=()=>{h()},G=()=>{if(!V.value||!d.value)return;f=N(V.value);const o=r.timeRange==="24h"||r.timeRange==="3d",s=o?d.value.hourly_stats:d.value.daily_stats,l=s.map(c=>o?c.label:c.date),p=s.map(c=>c.count),g={tooltip:{trigger:"axis",formatter:c=>{const x=c[0];return`${x.name}<br/>访问量: ${R(x.value)}`}},grid:{left:"3%",right:"4%",bottom:"10%",containLabel:!0},xAxis:{type:"category",data:l,axisLabel:{rotate:o?0:45,interval:o&&r.timeRange==="24h"?2:0}},yAxis:{type:"value",name:"访问量"},series:[{name:"访问量",type:"line",data:p,smooth:!0,itemStyle:{color:"#409EFF"},lineStyle:{color:"#409EFF",width:2},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(64, 158, 255, 0.3)"},{offset:1,color:"rgba(64, 158, 255, 0.1)"}]}}}]};f.setOption(g),window.addEventListener("resize",F)},H=()=>{if(!E.value||!d.value||!d.value.source_stats.length)return;v=N(E.value);const o=d.value.source_stats.slice(0,10).map(l=>({value:l.count,name:l.source})),s={tooltip:{trigger:"item",formatter:l=>{const p=(l.value/d.value.total_visits*100).toFixed(1);return`${l.name}<br/>访问量: ${R(l.value)}<br/>占比: ${p}%`}},legend:{orient:"vertical",left:"left",top:"middle",itemWidth:12,itemHeight:12,textStyle:{fontSize:12}},series:[{name:"流量来源",type:"pie",radius:["40%","70%"],center:["60%","50%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:8,borderColor:"#fff",borderWidth:2},label:{show:!1},emphasis:{label:{show:!0,fontSize:14,fontWeight:"bold"}},data:o}]};v.setOption(s),window.addEventListener("resize",F)},F=()=>{f&&f.resize(),v&&v.resize()},h=async()=>{T.value=!0;try{const o=await re({timeRange:r.timeRange,source:r.source||void 0,timezone:r.timezone});o.code===200&&(d.value=o.data,await ne(),f&&f.dispose(),v&&v.dispose(),G(),H())}catch(o){console.error("加载流量统计数据失败:",o),ie.error("加载流量统计数据失败")}finally{T.value=!1}},O=()=>{r.timeRange="24h",r.source="",r.timezone="Asia/Shanghai",h()};return j(()=>{h()}),q(()=>{f&&f.dispose(),v&&v.dispose(),window.removeEventListener("resize",F)}),(o,s)=>{const l=u("el-option"),p=u("el-select"),g=u("el-form-item"),c=u("el-icon"),x=u("el-button"),X=u("el-form"),m=u("el-card"),b=u("el-col"),M=u("el-row"),z=u("el-tag"),C=u("el-table-column"),Y=u("el-progress"),J=u("el-table"),Q=K("loading");return y(),D("div",ce,[s[12]||(s[12]=a("div",{class:"page-header"},[a("h2",null,"流量统计分析"),a("p",null,"根据来源和时间段进行详细的流量分析")],-1)),e(m,{class:"filter-card",shadow:"never"},{default:t(()=>[e(X,{model:r,inline:"",class:"filter-form"},{default:t(()=>[e(g,{label:"时间段"},{default:t(()=>[e(p,{modelValue:r.timeRange,"onUpdate:modelValue":s[0]||(s[0]=n=>r.timeRange=n),placeholder:"请选择时间段",onChange:W,style:{width:"180px"}},{default:t(()=>[e(l,{label:"最近24小时",value:"24h"}),e(l,{label:"最近3天",value:"3d"}),e(l,{label:"本周",value:"week"}),e(l,{label:"本月",value:"month"}),e(l,{label:"最近7天",value:"7d"}),e(l,{label:"最近30天",value:"30d"})]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"流量来源"},{default:t(()=>[e(p,{modelValue:r.source,"onUpdate:modelValue":s[1]||(s[1]=n=>r.source=n),placeholder:"请选择来源",clearable:"",onChange:h,style:{width:"180px"}},{default:t(()=>[e(l,{label:"全部来源",value:""}),e(l,{label:"直接访问",value:"直接访问"}),e(l,{label:"YouTube",value:"YouTube"}),e(l,{label:"Google",value:"Google"}),e(l,{label:"Facebook",value:"Facebook"}),e(l,{label:"Instagram",value:"Instagram"}),e(l,{label:"TikTok",value:"TikTok"}),e(l,{label:"Twitter/X",value:"Twitter/X"}),e(l,{label:"Android App",value:"Android App"}),e(l,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"时区"},{default:t(()=>[e(p,{modelValue:r.timezone,"onUpdate:modelValue":s[2]||(s[2]=n=>r.timezone=n),onChange:h,style:{width:"140px"}},{default:t(()=>[e(l,{label:"北京时间",value:"Asia/Shanghai"}),e(l,{label:"欧洲时间",value:"Europe/Paris"})]),_:1},8,["modelValue"])]),_:1}),e(g,null,{default:t(()=>[e(x,{type:"primary",onClick:h,loading:T.value},{default:t(()=>[e(c,null,{default:t(()=>[e(k($))]),_:1}),s[3]||(s[3]=w(" 查询 ",-1))]),_:1},8,["loading"]),e(x,{onClick:O},{default:t(()=>[e(c,null,{default:t(()=>[e(k(ee))]),_:1}),s[4]||(s[4]=w(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a("div",ue,[e(M,{gutter:20},{default:t(()=>[e(b,{xs:24,sm:12,md:6},{default:t(()=>[e(m,{class:"stat-card",shadow:"hover"},{default:t(()=>{var n;return[a("div",_e,[a("div",fe,[e(c,null,{default:t(()=>[e(k(te))]),_:1})]),a("div",ve,[a("div",me,_(R(((n=d.value)==null?void 0:n.total_visits)||0)),1),s[5]||(s[5]=a("div",{class:"stat-label"},"总访问量",-1))])])]}),_:1})]),_:1}),e(b,{xs:24,sm:12,md:6},{default:t(()=>[e(m,{class:"stat-card",shadow:"hover"},{default:t(()=>{var n;return[a("div",pe,[a("div",he,[e(c,null,{default:t(()=>[e(k(ae))]),_:1})]),a("div",ge,[a("div",be,_(((n=d.value)==null?void 0:n.source_count)||0),1),s[6]||(s[6]=a("div",{class:"stat-label"},"来源数量",-1))])])]}),_:1})]),_:1}),e(b,{xs:24,sm:12,md:6},{default:t(()=>[e(m,{class:"stat-card",shadow:"hover"},{default:t(()=>{var n,i;return[a("div",ye,[a("div",we,[e(c,null,{default:t(()=>[e(k(se))]),_:1})]),a("div",ke,[a("div",xe,_(B((n=d.value)==null?void 0:n.peak_hour)||"-"),1),s[7]||(s[7]=a("div",{class:"stat-label"},"峰值时段",-1)),a("div",Te,_(((i=d.value)==null?void 0:i.peak_count)||0)+"次访问",1)])])]}),_:1})]),_:1}),e(b,{xs:24,sm:12,md:6},{default:t(()=>[e(m,{class:"stat-card",shadow:"hover"},{default:t(()=>{var n;return[a("div",Re,[a("div",ze,[e(c,null,{default:t(()=>[e(k(le))]),_:1})]),a("div",Ce,[a("div",Se,_(((n=d.value)==null?void 0:n.avg_visits_per_hour)||0),1),s[8]||(s[8]=a("div",{class:"stat-label"},"平均每小时",-1)),s[9]||(s[9]=a("div",{class:"stat-sub"},"访问量",-1))])])]}),_:1})]),_:1})]),_:1})]),e(M,{gutter:20,class:"charts-section"},{default:t(()=>[e(b,{xs:24,lg:16},{default:t(()=>[e(m,{class:"chart-card",shadow:"never"},{header:t(()=>[a("div",Ae,[a("span",null,_(I())+"流量趋势",1)])]),default:t(()=>[a("div",{ref_key:"trendChartRef",ref:V,class:"chart-container"},null,512)]),_:1})]),_:1}),e(b,{xs:24,lg:8},{default:t(()=>[e(m,{class:"chart-card",shadow:"never"},{header:t(()=>[...s[10]||(s[10]=[a("span",null,"流量来源分布",-1)])]),default:t(()=>[a("div",{ref_key:"sourceChartRef",ref:E,class:"chart-container"},null,512)]),_:1})]),_:1})]),_:1}),e(m,{class:"table-card",shadow:"never",style:{"margin-top":"20px"}},{header:t(()=>[...s[11]||(s[11]=[a("div",{class:"card-header"},[a("span",{class:"card-title"},"来源详细数据")],-1)])]),default:t(()=>{var n;return[oe((y(),A(J,{data:((n=d.value)==null?void 0:n.source_stats)||[],border:""},{default:t(()=>[e(C,{label:"排名",width:"80",align:"center"},{default:t(({$index:i})=>[i===0?(y(),A(z,{key:0,type:"danger",size:"small"},{default:t(()=>[w(_(i+1),1)]),_:2},1024)):i===1?(y(),A(z,{key:1,type:"warning",size:"small"},{default:t(()=>[w(_(i+1),1)]),_:2},1024)):i===2?(y(),A(z,{key:2,type:"success",size:"small"},{default:t(()=>[w(_(i+1),1)]),_:2},1024)):(y(),D("span",Ve,_(i+1),1))]),_:1}),e(C,{label:"来源","min-width":"150"},{default:t(({row:i})=>[e(z,{type:P(i.source),size:"small"},{default:t(()=>[w(_(i.source),1)]),_:2},1032,["type"])]),_:1}),e(C,{label:"访问量",width:"120",align:"right"},{default:t(({row:i})=>[a("span",Ee,_(R(i.count)),1)]),_:1}),e(C,{label:"占比",width:"200"},{default:t(({row:i})=>[a("div",Fe,[e(Y,{percentage:L(i.count),"stroke-width":10},null,8,["percentage"]),a("span",Le,_(L(i.count))+"%",1)])]),_:1})]),_:1},8,["data"])),[[Q,T.value]])]}),_:1})])}}}),Ge=de(De,[["__scopeId","data-v-f38e1b45"]]);export{Ge as default};
