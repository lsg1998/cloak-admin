import{d as R,h as u,Z as T,aJ as A,r as d,Q as D,g as N,o as g,w as r,W as B,c as x,a as e,e as F,t as _,R as L,b as t,u as U,E as M,M as $,N as H}from"./index-B-i6bX06.js";import"./index-BpCvQqaw.js";import{g as I}from"./statistics-Dm4Tqgsu.js";import{aU as J}from"./installCanvasRenderer-Bf4uGEF_.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";const P={class:"card-header"},Q={class:"header-actions"},W={class:"traffic-content"},Z={class:"hourly-chart"},j={class:"section-title"},q={class:"timezone-label"},G={class:"stats-inline"},K={class:"total-visits-inline"},X={key:0,class:"peak-inline"},Y=R({__name:"index",setup(ee){const v=u(!1),c=u("today"),p=u("Asia/Shanghai"),o=u({total_visits:0,source_stats:[],hourly_stats:[],daily_stats:[],peak_hour:0,peak_count:0,low_hour:null,low_count:0}),f=u();let s=null;const w=a=>`${a.toString().padStart(2,"0")}:00`,k=()=>{if(!f.value)return;s=J(f.value);const a=o.value.hourly_stats.map(n=>n.label),l=o.value.hourly_stats.map(n=>n.count),i={tooltip:{trigger:"axis",formatter:n=>{const h=n[0];return`${h.name}<br/>访问量: ${h.value}`}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:a,axisLabel:{rotate:45,interval:0}},yAxis:{type:"value",name:"访问量"},series:[{name:"访问量",type:"line",data:l,smooth:!0,itemStyle:{color:"#409EFF"},lineStyle:{color:"#409EFF",width:2},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(64, 158, 255, 0.3)"},{offset:1,color:"rgba(64, 158, 255, 0.1)"}]}},emphasis:{itemStyle:{color:"#66b1ff"}}}]};s.setOption(i),window.addEventListener("resize",b)},b=()=>{s&&s.resize()},C=()=>{m()},S=()=>{m()},m=async()=>{v.value=!0;try{const a=await I({timeRange:c.value,timezone:p.value});a.code===200&&(o.value=a.data,await $(),s&&s.dispose(),k())}catch(a){console.error("加载流量统计数据失败:",a),H.error("加载流量统计数据失败")}finally{v.value=!1}};return T(()=>{m()}),A(()=>{s&&s.dispose(),window.removeEventListener("resize",b)}),(a,l)=>{const i=d("el-option"),n=d("el-select"),h=d("el-icon"),z=d("el-button"),V=d("el-card"),E=D("loading");return g(),N(V,{class:"traffic-statistics-card",shadow:"never"},{header:r(()=>[e("div",P,[l[2]||(l[2]=e("span",null,"流量统计",-1)),e("div",Q,[t(n,{modelValue:p.value,"onUpdate:modelValue":l[0]||(l[0]=y=>p.value=y),size:"small",onChange:C,style:{width:"140px","margin-right":"8px"}},{default:r(()=>[t(i,{label:"北京时间",value:"Asia/Shanghai"}),t(i,{label:"欧洲时间",value:"Europe/Paris"})]),_:1},8,["modelValue"]),t(n,{modelValue:c.value,"onUpdate:modelValue":l[1]||(l[1]=y=>c.value=y),size:"small",onChange:S,style:{width:"120px"}},{default:r(()=>[t(i,{label:"今天",value:"today"}),t(i,{label:"最近7天",value:"7d"}),t(i,{label:"最近30天",value:"30d"})]),_:1},8,["modelValue"]),t(z,{type:"primary",size:"small",onClick:m},{default:r(()=>[t(h,null,{default:r(()=>[t(U(M))]),_:1})]),_:1})])])]),default:r(()=>[B((g(),x("div",W,[e("div",Z,[e("div",j,[e("span",null,[F(_(c.value==="today"?"今日":c.value==="7d"?"7天":"30天")+"流量趋势 ",1),e("span",q,"("+_(p.value==="Asia/Shanghai"?"北京时间":"欧洲时间")+")",1)]),e("span",G,[e("span",K,"总访问量："+_(o.value.total_visits||0),1),o.value.peak_count>0?(g(),x("span",X," 峰值时段："+_(o.value.peak_label||w(o.value.peak_hour))+" ("+_(o.value.peak_count)+"次访问) ",1)):L("",!0)])]),e("div",{ref_key:"hourlyChartRef",ref:f,class:"chart-container"},null,512)])])),[[E,v.value]])]),_:1})}}}),ne=O(Y,[["__scopeId","data-v-35c3a9d0"]]);export{ne as T};
