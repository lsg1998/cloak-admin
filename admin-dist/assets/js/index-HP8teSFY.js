import{d as te,h as B,P as J,Z as xe,r as _,Q as we,c as p,o as d,b as t,w as e,_ as P,u as m,x as Q,F as W,f as Z,g as v,e as i,E as G,W as Ve,R as z,a as s,t as o,aB as H,aC as De,aD as Oe,aE as Be,aF as Se,U as X,V as Ue,N as b,a0 as ee}from"./index-Bj6ddc6A.js";import{a as Y,O as T,b as Le,u as Re,d as je,c as Ye,e as $e,f as Ae}from"./order-B4aIjaOl.js";import{_ as Ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Me={class:"order-management"},Ne={class:"table-header"},Pe={class:"table-title"},Te={class:"table-actions"},qe={class:"order-number"},Fe={class:"product-info"},Ie=["src","alt"],Ke={class:"product-details"},Je={class:"product-title"},Qe={class:"product-subtitle"},We={class:"customer-info"},Ze={class:"customer-name"},Ge={class:"customer-phone"},He={key:0,class:"customer-email"},Xe={class:"address-info"},et={class:"address-line"},tt={class:"address-value"},at={key:0,class:"address-line"},lt={class:"address-value"},st={key:1,class:"address-line"},ot={class:"address-value"},nt={class:"amount-info"},dt={class:"amount"},it={class:"currency"},rt={class:"payment-info"},ut={key:0,class:"product-type"},ct={class:"time-info"},_t={key:0,class:"ip-info"},pt={class:"ip-address"},mt={key:0,class:"ip-location"},ft={key:1,class:"ip-no-location"},vt={key:1,class:"no-data"},yt={key:1,class:"no-data"},ht={class:"url-info"},gt={key:1,class:"no-data"},bt={class:"action-buttons"},kt={key:0,class:"batch-actions"},zt={class:"batch-buttons"},Ct={class:"pagination-wrapper"},xt={key:0,class:"order-detail"},wt={class:"address-detail"},Vt={class:"address-line"},Dt={class:"address-value"},Ot={key:0,class:"address-line"},Bt={class:"address-value"},St={key:1,class:"address-line"},Ut={class:"address-value"},Lt={class:"product-detail-info"},Rt=["src","alt"],jt={class:"product-detail-text"},Yt={class:"product-title"},$t={class:"product-price"},At={class:"product-quantity"},Et={key:1,class:"no-data"},Mt={key:1,class:"no-data"},Nt={key:1,class:"no-data"},Pt={key:1,class:"no-data"},Tt={key:0,class:"user-agent-info"},qt={key:1,class:"no-data"},Ft={class:"dialog-footer"},It=te({name:"OrderList"}),Kt=te({...It,setup(Jt){const $=B(!1),A=B(!1),U=B(!1),n=B(null),D=B([]),u=J({order_number:"",customer_name:"",phone:"",status:"",start_date:"",end_date:""}),E=B(null),k=J({current:1,size:20,total:0}),q=B([]),S=()=>{k.current=1,V()},ae=()=>{Object.assign(u,{order_number:"",customer_name:"",phone:"",status:"",start_date:"",end_date:""}),E.value=null,S()},le=r=>{r?(u.start_date=r[0],u.end_date=r[1]):(u.start_date="",u.end_date="")},F=async r=>{try{const{data:l}=await Le(r.id);n.value=l,U.value=!0}catch{b.error("获取订单详情失败")}},se=async(r,l)=>{try{await Re(r.id,{status:l}),b.success("订单状态更新成功"),V()}catch{b.error("订单状态更新失败")}},oe=r=>{ee.confirm(`确定要删除订单 "${r.order_number}" 吗？删除后无法恢复！`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"}).then(async()=>{try{await je(r.id),b.success("删除成功"),V()}catch{b.error("删除失败")}})},ne=()=>{const r=D.value.map(l=>l.order_number).join("、");ee.confirm(`确定要删除选中的 ${D.value.length} 个订单吗？
订单号：${r}`,"批量删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"}).then(async()=>{try{const l=D.value.map(c=>c.id);await Ye(l),b.success("批量删除成功"),D.value=[],V()}catch{b.error("批量删除失败")}})},de=async()=>{A.value=!0;try{const r={...u,order_number:u.order_number||void 0,customer_name:u.customer_name||void 0,phone:u.phone||void 0,status:u.status||void 0,start_date:u.start_date||void 0,end_date:u.end_date||void 0},l=await $e(r);let c,y;if(l&&l.data)y=l.data;else if(typeof l=="string"&&l.trim())y=l;else{b.warning("没有数据可导出");return}if(!y||typeof y=="string"&&y.trim()===""){b.warning("导出的数据为空");return}if(y instanceof Blob)c=y;else if(typeof y=="string")c=new Blob([y],{type:"text/csv; charset=utf-8"});else{const M=typeof y=="object"?JSON.stringify(y):String(y);c=new Blob([M],{type:"text/csv; charset=utf-8"})}if(c.size===0){b.warning("导出的数据为空");return}const C=window.URL.createObjectURL(c),O=document.createElement("a");O.href=C,O.download=`订单列表_${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(O),O.click(),document.body.removeChild(O),window.URL.revokeObjectURL(C),b.success("导出成功")}catch(r){console.error("导出失败:",r),b.error("导出失败")}finally{A.value=!1}},ie=r=>{D.value=r},re=r=>{k.size=r,V()},ue=r=>{k.current=r,V()},V=async()=>{$.value=!0;try{const r={page:k.current,size:k.size,order_number:u.order_number||void 0,customer_name:u.customer_name||void 0,phone:u.phone||void 0,status:u.status||void 0,start_date:u.start_date||void 0,end_date:u.end_date||void 0},{data:l}=await Ae(r);q.value=l.list,k.total=l.total}catch{b.error("获取订单列表失败")}finally{$.value=!1}},I=(r,l,c)=>[r,l,c].filter(Boolean).join(" ")||"--",ce=r=>({original:"正品",replica:"仿品"})[r]||r,_e=r=>({original:"success",replica:"warning"})[r]||"info";return xe(()=>{V()}),(r,l)=>{const c=_("el-icon"),y=_("el-input"),C=_("el-form-item"),O=_("el-option"),M=_("el-select"),pe=_("el-date-picker"),x=_("el-button"),me=_("el-form"),K=_("el-card"),h=_("el-tag"),g=_("el-table-column"),N=_("el-link"),L=_("el-avatar"),fe=_("el-dropdown-item"),ve=_("el-dropdown-menu"),ye=_("el-dropdown"),he=_("el-table"),ge=_("el-alert"),be=_("el-pagination"),f=_("el-descriptions-item"),R=_("el-descriptions"),ke=_("el-text"),ze=_("el-dialog"),Ce=we("loading");return d(),p("div",Me,[t(K,{class:"search-card",shadow:"never"},{default:e(()=>[t(me,{model:u,inline:"",class:"search-form"},{default:e(()=>[t(C,{label:"订单号"},{default:e(()=>[t(y,{modelValue:u.order_number,"onUpdate:modelValue":l[0]||(l[0]=a=>u.order_number=a),placeholder:"请输入订单号",clearable:"",style:{width:"200px"},onKeyup:P(S,["enter"])},{prefix:e(()=>[t(c,null,{default:e(()=>[t(m(Q))]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(C,{label:"客户姓名"},{default:e(()=>[t(y,{modelValue:u.customer_name,"onUpdate:modelValue":l[1]||(l[1]=a=>u.customer_name=a),placeholder:"请输入客户姓名",clearable:"",style:{width:"150px"},onKeyup:P(S,["enter"])},null,8,["modelValue"])]),_:1}),t(C,{label:"手机号"},{default:e(()=>[t(y,{modelValue:u.phone,"onUpdate:modelValue":l[2]||(l[2]=a=>u.phone=a),placeholder:"请输入手机号",clearable:"",style:{width:"150px"},onKeyup:P(S,["enter"])},null,8,["modelValue"])]),_:1}),t(C,{label:"订单状态"},{default:e(()=>[t(M,{modelValue:u.status,"onUpdate:modelValue":l[3]||(l[3]=a=>u.status=a),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:e(()=>[(d(!0),p(W,null,Z(m(Y),(a,w)=>(d(),v(O,{key:w,label:a,value:w},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(C,{label:"下单时间"},{default:e(()=>[t(pe,{modelValue:E.value,"onUpdate:modelValue":l[4]||(l[4]=a=>E.value=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:le,style:{width:"240px"}},null,8,["modelValue"])]),_:1}),t(C,null,{default:e(()=>[t(x,{type:"primary",onClick:S},{default:e(()=>[t(c,null,{default:e(()=>[t(m(Q))]),_:1}),l[9]||(l[9]=i(" 搜索 ",-1))]),_:1}),t(x,{onClick:ae},{default:e(()=>[t(c,null,{default:e(()=>[t(m(G))]),_:1}),l[10]||(l[10]=i(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(K,{class:"table-card",shadow:"never"},{header:e(()=>[s("div",Ne,[s("div",Pe,[l[11]||(l[11]=s("span",null,"订单列表",-1)),t(h,{type:"info",size:"small"},{default:e(()=>[i(o(k.total)+" 条记录",1)]),_:1})]),s("div",Te,[t(x,{size:"small",onClick:de,loading:A.value},{default:e(()=>[t(c,null,{default:e(()=>[t(m(Ue))]),_:1}),l[12]||(l[12]=i(" 导出 ",-1))]),_:1},8,["loading"]),t(x,{size:"small",onClick:V},{default:e(()=>[t(c,null,{default:e(()=>[t(m(G))]),_:1}),l[13]||(l[13]=i(" 刷新 ",-1))]),_:1})])])]),default:e(()=>[Ve((d(),v(he,{data:q.value,stripe:"",border:"",style:{width:"100%"},"header-cell-style":{background:"#f8f9fa",color:"#606266"},onSelectionChange:ie},{default:e(()=>[t(g,{type:"selection",width:"55"}),t(g,{prop:"order_number",label:"订单号",width:"180","show-overflow-tooltip":""},{default:e(({row:a})=>[s("div",qe,[t(N,{type:"primary",onClick:w=>F(a)},{default:e(()=>[i(o(a.order_number),1)]),_:2},1032,["onClick"])])]),_:1}),t(g,{label:"商品信息","min-width":"250","show-overflow-tooltip":""},{default:e(({row:a})=>[s("div",Fe,[a.product_images&&a.product_images[0]?(d(),v(L,{key:0,size:40,class:"product-avatar"},{default:e(()=>[s("img",{src:a.product_images[0],alt:a.product_title,style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,Ie)]),_:2},1024)):(d(),v(L,{key:1,size:40,class:"product-avatar"},{default:e(()=>[t(c,null,{default:e(()=>[t(m(H))]),_:1})]),_:1})),s("div",Ke,[s("div",Je,o(a.product_title||"商品已删除"),1),s("div",Qe,"数量: "+o(a.quantity),1)])])]),_:1}),t(g,{label:"客户信息",width:"180"},{default:e(({row:a})=>[s("div",We,[s("div",Ze,o(a.customer_name),1),s("div",Ge,o(a.phone),1),a.email?(d(),p("div",He,o(a.email),1)):z("",!0)])]),_:1}),t(g,{label:"收货地址","min-width":"250","show-overflow-tooltip":""},{default:e(({row:a})=>[s("div",Xe,[s("div",et,[l[14]||(l[14]=s("span",{class:"address-label"},"省市区:",-1)),s("span",tt,o(I(a.province,a.city,a.district)),1)]),a.postal_code?(d(),p("div",at,[l[15]||(l[15]=s("span",{class:"address-label"},"邮编:",-1)),s("span",lt,o(a.postal_code),1)])):z("",!0),a.address?(d(),p("div",st,[l[16]||(l[16]=s("span",{class:"address-label"},"详细:",-1)),s("span",ot,o(a.address),1)])):z("",!0)])]),_:1}),t(g,{prop:"total_amount",label:"订单金额",width:"120",align:"center"},{default:e(({row:a})=>[s("div",nt,[s("span",dt,o(a.total_amount||a.product_price*a.quantity),1),s("span",it,o(a.currency||"JPY"),1)])]),_:1}),t(g,{prop:"payment_method",label:"支付方式",width:"120",align:"center"},{default:e(({row:a})=>[s("div",rt,[t(h,{size:"small",type:"info"},{default:e(()=>[i(o(a.payment_method||"COD"),1)]),_:2},1024),a.product_type?(d(),p("div",ut,[t(h,{size:"small",type:_e(a.product_type)},{default:e(()=>[i(o(ce(a.product_type)),1)]),_:2},1032,["type"])])):z("",!0)])]),_:1}),t(g,{prop:"status",label:"订单状态",width:"100",align:"center"},{default:e(({row:a})=>[t(h,{type:m(T)[a.status],size:"small"},{default:e(()=>[i(o(m(Y)[a.status]||a.status),1)]),_:2},1032,["type"])]),_:1}),t(g,{prop:"created_at",label:"下单时间",width:"180","show-overflow-tooltip":""},{default:e(({row:a})=>[s("div",ct,[t(c,{class:"time-icon"},{default:e(()=>[t(m(De))]),_:1}),s("span",null,o(a.created_at),1)])]),_:1}),t(g,{prop:"ip_address",label:"下单IP",width:"250",align:"center","show-overflow-tooltip":""},{default:e(({row:a})=>[a.ip_address?(d(),p("div",_t,[s("div",pt,[t(h,{size:"small",type:"info"},{default:e(()=>[i(o(a.ip_address),1)]),_:2},1024)]),a.ip_info&&(a.ip_info.country||a.ip_info.city)?(d(),p("div",mt,[a.ip_info.country?(d(),v(h,{key:0,size:"small",type:"success"},{default:e(()=>[i(o(a.ip_info.country),1)]),_:2},1024)):z("",!0),a.ip_info.city?(d(),v(h,{key:1,size:"small",type:"warning",style:{"margin-left":"4px"}},{default:e(()=>[i(o(a.ip_info.city),1)]),_:2},1024)):z("",!0),a.ip_info.organization?(d(),v(h,{key:2,size:"small",type:"info",style:{"margin-left":"4px"}},{default:e(()=>[i(o(a.ip_info.organization),1)]),_:2},1024)):z("",!0)])):(d(),p("div",ft,[t(h,{size:"small",type:"info",plain:""},{default:e(()=>[...l[17]||(l[17]=[i("未获取到地理位置",-1)])]),_:1})]))])):(d(),p("span",vt,"--"))]),_:1}),t(g,{prop:"language_code",label:"语言",width:"80",align:"center"},{default:e(({row:a})=>[a.language_code?(d(),v(h,{key:0,size:"small",type:"success"},{default:e(()=>[i(o(a.language_code.toUpperCase()),1)]),_:2},1024)):(d(),p("span",yt,"--"))]),_:1}),t(g,{prop:"from_url",label:"来源URL","min-width":"200","show-overflow-tooltip":""},{default:e(({row:a})=>[s("div",ht,[a.from_url?(d(),v(N,{key:0,href:a.from_url,target:"_blank",type:"primary",size:"small"},{default:e(()=>[i(o(a.from_url.length>50?a.from_url.substring(0,50)+"...":a.from_url),1)]),_:2},1032,["href"])):(d(),p("span",gt,"--"))])]),_:1}),t(g,{label:"操作",width:"280",fixed:"right",align:"center"},{default:e(({row:a})=>[s("div",bt,[t(x,{size:"small",type:"primary",link:"",onClick:w=>F(a)},{default:e(()=>[t(c,null,{default:e(()=>[t(m(Oe))]),_:1}),l[18]||(l[18]=i(" 查看 ",-1))]),_:1},8,["onClick"]),t(ye,{onCommand:w=>se(a,w)},{dropdown:e(()=>[t(ve,null,{default:e(()=>[(d(!0),p(W,null,Z(m(Y),(w,j)=>(d(),v(fe,{key:j,command:j,disabled:a.status===j},{default:e(()=>[t(h,{type:m(T)[j],size:"small"},{default:e(()=>[i(o(w),1)]),_:2},1032,["type"])]),_:2},1032,["command","disabled"]))),128))]),_:2},1024)]),default:e(()=>[t(x,{size:"small",type:"success",link:""},{default:e(()=>[t(c,null,{default:e(()=>[t(m(Be))]),_:1}),l[19]||(l[19]=i(" 状态 ",-1)),t(c,{class:"el-icon--right"},{default:e(()=>[t(m(Se))]),_:1})]),_:1})]),_:2},1032,["onCommand"]),t(x,{size:"small",type:"danger",link:"",onClick:w=>oe(a)},{default:e(()=>[t(c,null,{default:e(()=>[t(m(X))]),_:1}),l[20]||(l[20]=i(" 删除 ",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[Ce,$.value]]),D.value.length>0?(d(),p("div",kt,[t(ge,{title:`已选择 ${D.value.length} 个订单`,type:"info","show-icon":"",closable:!1},{default:e(()=>[s("div",zt,[t(x,{size:"small",type:"danger",onClick:ne},{default:e(()=>[t(c,null,{default:e(()=>[t(m(X))]),_:1}),l[21]||(l[21]=i(" 批量删除 ",-1))]),_:1})])]),_:1},8,["title"])])):z("",!0),s("div",Ct,[t(be,{"current-page":k.current,"onUpdate:currentPage":l[5]||(l[5]=a=>k.current=a),"page-size":k.size,"onUpdate:pageSize":l[6]||(l[6]=a=>k.size=a),"page-sizes":[10,20,50,100],total:k.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:re,onCurrentChange:ue},null,8,["current-page","page-size","total"])])]),_:1}),t(ze,{modelValue:U.value,"onUpdate:modelValue":l[8]||(l[8]=a=>U.value=a),title:"订单详情",width:"800px","close-on-click-modal":!1,"destroy-on-close":""},{footer:e(()=>[s("div",Ft,[t(x,{onClick:l[7]||(l[7]=a=>U.value=!1)},{default:e(()=>[...l[25]||(l[25]=[i("关闭",-1)])]),_:1})])]),default:e(()=>[n.value?(d(),p("div",xt,[t(R,{title:"订单信息",column:2,border:""},{default:e(()=>[t(f,{label:"订单号"},{default:e(()=>[i(o(n.value.order_number),1)]),_:1}),t(f,{label:"订单状态"},{default:e(()=>[t(h,{type:m(T)[n.value.status],size:"small"},{default:e(()=>[i(o(m(Y)[n.value.status]),1)]),_:1},8,["type"])]),_:1}),t(f,{label:"下单时间"},{default:e(()=>[i(o(n.value.created_at),1)]),_:1}),t(f,{label:"更新时间"},{default:e(()=>[i(o(n.value.updated_at),1)]),_:1}),t(f,{label:"支付方式"},{default:e(()=>[i(o(n.value.payment_method),1)]),_:1}),t(f,{label:"订单金额"},{default:e(()=>[i(o(n.value.total_amount||n.value.product_price*n.value.quantity)+" "+o(n.value.currency),1)]),_:1})]),_:1}),t(R,{title:"客户信息",column:2,border:"",style:{"margin-top":"20px"}},{default:e(()=>[t(f,{label:"客户姓名"},{default:e(()=>[i(o(n.value.customer_name),1)]),_:1}),t(f,{label:"联系电话"},{default:e(()=>[i(o(n.value.phone),1)]),_:1}),t(f,{label:"邮箱地址",span:2},{default:e(()=>[i(o(n.value.email||"未填写"),1)]),_:1}),t(f,{label:"收货地址",span:2},{default:e(()=>[s("div",wt,[s("div",Vt,[l[22]||(l[22]=s("span",{class:"address-label"},"省市区:",-1)),s("span",Dt,o(I(n.value.province,n.value.city,n.value.district)),1)]),n.value.postal_code?(d(),p("div",Ot,[l[23]||(l[23]=s("span",{class:"address-label"},"邮编:",-1)),s("span",Bt,o(n.value.postal_code),1)])):z("",!0),n.value.address?(d(),p("div",St,[l[24]||(l[24]=s("span",{class:"address-label"},"详细地址:",-1)),s("span",Ut,o(n.value.address),1)])):z("",!0)])]),_:1}),n.value.comments?(d(),v(f,{key:0,label:"客户备注",span:2},{default:e(()=>[i(o(n.value.comments),1)]),_:1})):z("",!0)]),_:1}),t(R,{title:"商品信息",column:1,border:"",style:{"margin-top":"20px"}},{default:e(()=>[t(f,{label:"商品"},{default:e(()=>[s("div",Lt,[n.value.product_images&&n.value.product_images[0]?(d(),v(L,{key:0,size:60},{default:e(()=>[s("img",{src:n.value.product_images[0],alt:n.value.product_title,style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,Rt)]),_:1})):(d(),v(L,{key:1,size:60},{default:e(()=>[t(c,null,{default:e(()=>[t(m(H))]),_:1})]),_:1})),s("div",jt,[s("div",Yt,o(n.value.product_title||"商品已删除"),1),s("div",$t,"单价: "+o(n.value.product_price)+" "+o(n.value.currency),1),s("div",At,"数量: "+o(n.value.quantity),1)])])]),_:1})]),_:1}),t(R,{title:"技术信息",column:2,border:"",style:{"margin-top":"20px"}},{default:e(()=>[t(f,{label:"下单IP"},{default:e(()=>[n.value.ip_address?(d(),v(h,{key:0,type:"info",size:"small"},{default:e(()=>[i(o(n.value.ip_address),1)]),_:1})):(d(),p("span",Et,"--"))]),_:1}),t(f,{label:"语言代码"},{default:e(()=>[n.value.language_code?(d(),v(h,{key:0,type:"success",size:"small"},{default:e(()=>[i(o(n.value.language_code.toUpperCase()),1)]),_:1})):(d(),p("span",Mt,"--"))]),_:1}),t(f,{label:"页面追踪标识",span:2},{default:e(()=>[n.value.pd_val?(d(),v(h,{key:0,type:"warning",size:"small"},{default:e(()=>[i(o(n.value.pd_val),1)]),_:1})):(d(),p("span",Nt,"--"))]),_:1}),t(f,{label:"来源URL",span:2},{default:e(()=>[n.value.from_url?(d(),v(N,{key:0,href:n.value.from_url,target:"_blank",type:"primary",size:"small"},{default:e(()=>[i(o(n.value.from_url),1)]),_:1},8,["href"])):(d(),p("span",Pt,"--"))]),_:1}),t(f,{label:"浏览器信息",span:2},{default:e(()=>[n.value.user_agent?(d(),p("div",Tt,[t(ke,{size:"small",type:"info"},{default:e(()=>[i(o(n.value.user_agent),1)]),_:1})])):(d(),p("span",qt,"--"))]),_:1})]),_:1})])):z("",!0)]),_:1},8,["modelValue"])])}}}),Gt=Ee(Kt,[["__scopeId","data-v-801be77e"]]);export{Gt as default};
