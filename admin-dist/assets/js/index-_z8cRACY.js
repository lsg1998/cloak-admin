import{a5 as S,d as H,h as D,P as K,Z as be,r,Q as ye,c as $,o as P,b as e,g as W,R as A,w as a,_ as he,u as g,x as G,e as s,E as Q,a as d,t as n,W as we,aq as Ce,av as ke,aG as De,U as B,N as z,a0 as Z}from"./index-DsqJDd-_.js";import{_ as ze}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ve=(m={})=>{const x=Object.fromEntries(Object.entries(m).filter(([,V])=>V!=null&&V!==""));return S.get("/admin/performance-logs",x)},xe=m=>S.get(`/admin/performance-logs/${m}`),Pe=(m={})=>S.get("/admin/performance-logs-stats",m),Se=m=>S.delete(`/admin/performance-logs/${m}`),Le=m=>S.post("/admin/performance-logs/batch-delete",{ids:m}),Te={class:"performance-logs-management"},Ue={class:"stats-header"},Me={class:"stat-item"},Ie={class:"stat-value"},Fe={class:"stat-item"},Ne={class:"stat-value"},Re={class:"stat-item"},Ye={class:"stat-value"},Oe={class:"stat-item"},$e={class:"stat-value"},Ae={class:"table-header"},Be={class:"table-title"},je={class:"table-actions"},Ee={class:"url-info"},qe={class:"time-info"},Ke={key:0,class:"batch-actions"},We={class:"batch-buttons"},Ge={class:"pagination-wrapper"},Qe={key:0,class:"log-detail"},Ze={class:"metric-value"},He={class:"metric-value"},Je={class:"metric-value"},Xe={class:"metric-value"},et={class:"dialog-footer"},tt=H({name:"performanceLogs"}),at=H({...tt,setup(m){const x=D(!1),V=D([]),w=D([]),L=D(!1),i=D(null),y=D(null),_=K({search:"",device_type:"",start_date:"",end_date:""}),I=D(null),p=K({current:1,size:20,total:0}),F=()=>{p.current=1,C(),T()},J=()=>{Object.assign(_,{search:"",device_type:"",start_date:"",end_date:""}),I.value=null,F()},X=l=>{l?(_.start_date=l[0],_.end_date=l[1]):(_.start_date="",_.end_date="")},ee=async l=>{try{const{data:t}=await xe(l.id);i.value=t,L.value=!0}catch{z.error("获取日志详情失败")}},te=async l=>{try{await Z.confirm("确定要删除这条性能日志吗？","确认删除",{type:"warning"}),await Se(l.id),z.success("删除成功"),C(),T()}catch(t){t!=="cancel"&&z.error("删除失败")}},j=async()=>{if(w.value.length===0){z.warning("请选择要删除的日志");return}try{await Z.confirm(`确定要删除选中的 ${w.value.length} 条性能日志吗？`,"确认批量删除",{type:"warning"});const l=w.value.map(t=>t.id);await Le(l),z.success("批量删除成功"),C(),T()}catch(l){l!=="cancel"&&z.error("批量删除失败")}},ae=l=>{w.value=l},le=l=>{p.size=l,p.current=1,C()},se=l=>{p.current=l,C()},C=async()=>{x.value=!0;try{const l={page:p.current,limit:p.size,search:_.search||void 0,device_type:_.device_type||void 0,start_date:_.start_date||void 0,end_date:_.end_date||void 0},{data:t}=await Ve(l);V.value=t.list,p.total=t.total}catch{z.error("获取性能日志失败")}finally{x.value=!1}},T=async()=>{try{const l={start_date:_.start_date||new Date(Date.now()-6048e5).toISOString().split("T")[0],end_date:_.end_date||new Date().toISOString().split("T")[0]},{data:t}=await Pe(l);y.value=t}catch(l){console.error("获取统计数据失败:",l)}},E=l=>{if(!l||l==="")return"desktop";const t=l.toLowerCase();return t.includes("mobile")||t.includes("android")||t.includes("iphone")||t.includes("ipod")||t.includes("blackberry")||t.includes("windows phone")?"mobile":t.includes("ipad")||t.includes("tablet")||t.includes("android")&&!t.includes("mobile")?"tablet":(t.includes("windows")||t.includes("macintosh")||t.includes("mac os")||t.includes("linux")||t.includes("x11"),"desktop")},ne=l=>{const t=E(l);return{desktop:"primary",mobile:"success",tablet:"warning"}[t]||"info"},oe=l=>{const t=E(l);return{desktop:"桌面端",mobile:"移动端",tablet:"平板"}[t]||"未知"},de=l=>{if(!l||l==="")return"";try{const t=new URL(l);return t.hostname+t.pathname}catch{return l.length>30?l.substring(0,30)+"...":l}},N=(l,t)=>{const u=parseFloat(l);if(isNaN(u))return"info";switch(t){case"fcp":return u<=1800?"success":u<=3e3?"warning":"danger";case"lcp":return u<=2500?"success":u<=4e3?"warning":"danger";case"load":return u<=2e3?"success":u<=4e3?"warning":"danger";default:return"info"}};return be(()=>{C(),T()}),(l,t)=>{const u=r("el-icon"),q=r("el-input"),U=r("el-form-item"),R=r("el-option"),ie=r("el-select"),re=r("el-date-picker"),h=r("el-button"),ue=r("el-form"),b=r("el-card"),k=r("el-tag"),v=r("el-col"),M=r("el-row"),f=r("el-table-column"),ce=r("el-table"),_e=r("el-alert"),pe=r("el-pagination"),c=r("el-descriptions-item"),fe=r("el-link"),Y=r("el-descriptions"),O=r("el-divider"),me=r("el-dialog"),ve=ye("loading");return P(),$("div",Te,[e(b,{class:"search-card",shadow:"never"},{default:a(()=>[e(ue,{model:_,inline:"",class:"search-form"},{default:a(()=>[e(U,{label:"关键词"},{default:a(()=>[e(q,{modelValue:_.search,"onUpdate:modelValue":t[0]||(t[0]=o=>_.search=o),placeholder:"搜索页面URL、IP地址、页面标识",clearable:"",style:{width:"300px"},onKeyup:he(F,["enter"])},{prefix:a(()=>[e(u,null,{default:a(()=>[e(g(G))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(U,{label:"设备类型"},{default:a(()=>[e(ie,{modelValue:_.device_type,"onUpdate:modelValue":t[1]||(t[1]=o=>_.device_type=o),placeholder:"选择设备类型",clearable:"",style:{width:"120px"}},{default:a(()=>[e(R,{label:"桌面端",value:"desktop"}),e(R,{label:"移动端",value:"mobile"}),e(R,{label:"平板",value:"tablet"})]),_:1},8,["modelValue"])]),_:1}),e(U,{label:"日期范围"},{default:a(()=>[e(re,{modelValue:I.value,"onUpdate:modelValue":t[2]||(t[2]=o=>I.value=o),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:X,style:{width:"240px"}},null,8,["modelValue"])]),_:1}),e(U,null,{default:a(()=>[e(h,{type:"primary",onClick:F},{default:a(()=>[e(u,null,{default:a(()=>[e(g(G))]),_:1}),t[8]||(t[8]=s(" 搜索 ",-1))]),_:1}),e(h,{onClick:J},{default:a(()=>[e(u,null,{default:a(()=>[e(g(Q))]),_:1}),t[9]||(t[9]=s(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),y.value?(P(),W(b,{key:0,class:"stats-card",shadow:"never"},{header:a(()=>[d("div",Ue,[t[10]||(t[10]=d("span",null,"性能统计",-1)),e(k,{type:"info",size:"small"},{default:a(()=>[s(n(y.value.date_range.start_date)+" 至 "+n(y.value.date_range.end_date),1)]),_:1})])]),default:a(()=>[e(M,{gutter:20},{default:a(()=>[e(v,{span:6},{default:a(()=>[d("div",Me,[d("div",Ie,n(y.value.basic_stats.total_requests),1),t[11]||(t[11]=d("div",{class:"stat-label"},"总请求数",-1))])]),_:1}),e(v,{span:6},{default:a(()=>[d("div",Fe,[d("div",Ne,n(y.value.basic_stats.avg_fcp)+"ms",1),t[12]||(t[12]=d("div",{class:"stat-label"},"平均FCP",-1))])]),_:1}),e(v,{span:6},{default:a(()=>[d("div",Re,[d("div",Ye,n(y.value.basic_stats.avg_lcp)+"ms",1),t[13]||(t[13]=d("div",{class:"stat-label"},"平均LCP",-1))])]),_:1}),e(v,{span:6},{default:a(()=>[d("div",Oe,[d("div",$e,n(y.value.basic_stats.avg_page_load_time)+"ms",1),t[14]||(t[14]=d("div",{class:"stat-label"},"平均页面加载时间",-1))])]),_:1})]),_:1})]),_:1})):A("",!0),e(b,{class:"table-card",shadow:"never"},{header:a(()=>[d("div",Ae,[d("div",Be,[t[15]||(t[15]=d("span",null,"性能日志列表",-1)),e(k,{type:"info",size:"small"},{default:a(()=>[s(n(p.total)+" 条记录",1)]),_:1})]),d("div",je,[e(h,{size:"small",type:"danger",onClick:j,disabled:w.value.length===0},{default:a(()=>[e(u,null,{default:a(()=>[e(g(B))]),_:1}),t[16]||(t[16]=s(" 批量删除 ",-1))]),_:1},8,["disabled"]),e(h,{size:"small",onClick:C},{default:a(()=>[e(u,null,{default:a(()=>[e(g(Q))]),_:1}),t[17]||(t[17]=s(" 刷新 ",-1))]),_:1})])])]),default:a(()=>[we((P(),W(ce,{data:V.value,stripe:"",border:"",style:{width:"100%"},"header-cell-style":{background:"#f8f9fa",color:"#606266"},onSelectionChange:ae},{default:a(()=>[e(f,{type:"selection",width:"55"}),e(f,{prop:"id",label:"ID",width:"80",align:"center"}),e(f,{prop:"referrer",label:"来源URL","min-width":"250","show-overflow-tooltip":""},{default:a(({row:o})=>[d("div",Ee,[e(u,{class:"url-icon"},{default:a(()=>[e(g(Ce))]),_:1}),d("span",null,n(de(o.referrer)||"直接访问"),1)])]),_:1}),e(f,{prop:"pd_val",label:"页面标识",width:"150","show-overflow-tooltip":""}),e(f,{prop:"device_type",label:"设备类型",width:"120",align:"center"},{default:a(({row:o})=>[e(k,{type:ne(o.user_agent),size:"small"},{default:a(()=>[s(n(oe(o.user_agent)),1)]),_:2},1032,["type"])]),_:1}),e(f,{prop:"fcp",label:"FCP(ms)",width:"120",align:"center"},{default:a(({row:o})=>[e(k,{type:N(o.fcp,"fcp"),size:"small"},{default:a(()=>[s(n(o.fcp),1)]),_:2},1032,["type"])]),_:1}),e(f,{prop:"lcp",label:"LCP(ms)",width:"120",align:"center"},{default:a(({row:o})=>[e(k,{type:N(o.lcp,"lcp"),size:"small"},{default:a(()=>[s(n(o.lcp),1)]),_:2},1032,["type"])]),_:1}),e(f,{prop:"page_load_time",label:"页面加载(ms)",width:"140",align:"center"},{default:a(({row:o})=>[e(k,{type:N(o.page_load_time,"load"),size:"small"},{default:a(()=>[s(n(o.page_load_time),1)]),_:2},1032,["type"])]),_:1}),e(f,{prop:"ip_address",label:"IP地址",width:"150","show-overflow-tooltip":""}),e(f,{prop:"created_at",label:"记录时间",width:"180",align:"center"},{default:a(({row:o})=>[d("div",qe,[e(u,{class:"time-icon"},{default:a(()=>[e(g(ke))]),_:1}),d("span",null,n(o.created_at),1)])]),_:1}),e(f,{label:"操作",width:"200",fixed:"right",align:"center"},{default:a(({row:o})=>[e(h,{type:"primary",size:"small",onClick:ge=>ee(o)},{default:a(()=>[e(u,null,{default:a(()=>[e(g(De))]),_:1}),t[18]||(t[18]=s(" 查看详情 ",-1))]),_:1},8,["onClick"]),e(h,{type:"danger",size:"small",onClick:ge=>te(o)},{default:a(()=>[e(u,null,{default:a(()=>[e(g(B))]),_:1}),t[19]||(t[19]=s(" 删除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ve,x.value]]),w.value.length>0?(P(),$("div",Ke,[e(_e,{title:`已选择 ${w.value.length} 条日志`,type:"info","show-icon":"",closable:!1},{default:a(()=>[d("div",We,[e(h,{size:"small",type:"danger",onClick:j},{default:a(()=>[e(u,null,{default:a(()=>[e(g(B))]),_:1}),t[20]||(t[20]=s(" 批量删除 ",-1))]),_:1})])]),_:1},8,["title"])])):A("",!0),d("div",Ge,[e(pe,{"current-page":p.current,"onUpdate:currentPage":t[3]||(t[3]=o=>p.current=o),"page-size":p.size,"onUpdate:pageSize":t[4]||(t[4]=o=>p.size=o),"page-sizes":[10,20,50,100],total:p.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:le,onCurrentChange:se},null,8,["current-page","page-size","total"])])]),_:1}),e(me,{modelValue:L.value,"onUpdate:modelValue":t[7]||(t[7]=o=>L.value=o),title:"性能日志详情",width:"80%","close-on-click-modal":!1,"destroy-on-close":""},{footer:a(()=>[d("div",et,[e(h,{onClick:t[6]||(t[6]=o=>L.value=!1)},{default:a(()=>[...t[28]||(t[28]=[s("关闭",-1)])]),_:1})])]),default:a(()=>[i.value?(P(),$("div",Qe,[e(Y,{column:2,border:""},{default:a(()=>[e(c,{label:"日志ID"},{default:a(()=>[s(n(i.value.id),1)]),_:1}),e(c,{label:"页面标识"},{default:a(()=>[s(n(i.value.pd_val),1)]),_:1}),e(c,{label:"会话ID"},{default:a(()=>[s(n(i.value.session_id),1)]),_:1}),e(c,{label:"设备类型"},{default:a(()=>[e(k,{type:l.getDeviceTypeTag(i.value.device_type)},{default:a(()=>[s(n(l.getDeviceTypeText(i.value.device_type)),1)]),_:1},8,["type"])]),_:1}),e(c,{label:"页面URL",span:2},{default:a(()=>[e(fe,{href:i.value.page_url,target:"_blank",type:"primary"},{default:a(()=>[s(n(i.value.page_url),1)]),_:1},8,["href"])]),_:1}),e(c,{label:"来源页面",span:2},{default:a(()=>[s(n(i.value.referrer||"直接访问"),1)]),_:1}),e(c,{label:"语言代码"},{default:a(()=>[s(n(i.value.language_code),1)]),_:1}),e(c,{label:"IP地址"},{default:a(()=>[s(n(i.value.ip_address),1)]),_:1}),e(c,{label:"屏幕分辨率"},{default:a(()=>[s(n(i.value.screen_resolution),1)]),_:1}),e(c,{label:"视口大小"},{default:a(()=>[s(n(i.value.viewport_size),1)]),_:1}),e(c,{label:"记录时间"},{default:a(()=>[s(n(i.value.created_at),1)]),_:1}),e(c,{label:"进入时间"},{default:a(()=>[s(n(i.value.enter_time)+"ms",1)]),_:1})]),_:1}),e(O,{"content-position":"left"},{default:a(()=>[...t[21]||(t[21]=[s("性能指标",-1)])]),_:1}),e(M,{gutter:20},{default:a(()=>[e(v,{span:12},{default:a(()=>[e(b,{header:"网络性能"},{default:a(()=>[e(Y,{column:1,size:"small"},{default:a(()=>[e(c,{label:"DNS解析时间"},{default:a(()=>[s(n(i.value.dns_time)+"ms",1)]),_:1}),e(c,{label:"TCP连接时间"},{default:a(()=>[s(n(i.value.tcp_time)+"ms",1)]),_:1}),e(c,{label:"SSL握手时间"},{default:a(()=>[s(n(i.value.ssl_time)+"ms",1)]),_:1}),e(c,{label:"首字节响应时间"},{default:a(()=>[s(n(i.value.ttfb)+"ms",1)]),_:1})]),_:1})]),_:1})]),_:1}),e(v,{span:12},{default:a(()=>[e(b,{header:"页面性能"},{default:a(()=>[e(Y,{column:1,size:"small"},{default:a(()=>[e(c,{label:"DOM加载时间"},{default:a(()=>[s(n(i.value.dom_load_time)+"ms",1)]),_:1}),e(c,{label:"页面加载时间"},{default:a(()=>[s(n(i.value.page_load_time)+"ms",1)]),_:1}),e(c,{label:"总加载时间"},{default:a(()=>[s(n(i.value.total_load_time)+"ms",1)]),_:1}),e(c,{label:"onload事件时间"},{default:a(()=>[s(n(i.value.onload_time)+"ms",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(O,{"content-position":"left"},{default:a(()=>[...t[22]||(t[22]=[s("Web Vitals 核心指标",-1)])]),_:1}),e(M,{gutter:20},{default:a(()=>[e(v,{span:8},{default:a(()=>[e(b,{header:"FCP"},{default:a(()=>[d("div",Ze,n(i.value.fcp)+"ms",1),t[23]||(t[23]=d("div",{class:"metric-desc"},"首次内容绘制",-1))]),_:1})]),_:1}),e(v,{span:8},{default:a(()=>[e(b,{header:"LCP"},{default:a(()=>[d("div",He,n(i.value.lcp)+"ms",1),t[24]||(t[24]=d("div",{class:"metric-desc"},"最大内容绘制",-1))]),_:1})]),_:1}),e(v,{span:8},{default:a(()=>[e(b,{header:"FID"},{default:a(()=>[d("div",Je,n(i.value.fid)+"ms",1),t[25]||(t[25]=d("div",{class:"metric-desc"},"首次输入延迟",-1))]),_:1})]),_:1})]),_:1}),e(M,{gutter:20,style:{"margin-top":"20px"}},{default:a(()=>[e(v,{span:12},{default:a(()=>[e(b,{header:"CLS"},{default:a(()=>[d("div",Xe,n(i.value.cls),1),t[26]||(t[26]=d("div",{class:"metric-desc"},"累积布局偏移",-1))]),_:1})]),_:1})]),_:1}),e(O,{"content-position":"left"},{default:a(()=>[...t[27]||(t[27]=[s("用户代理信息",-1)])]),_:1}),e(q,{modelValue:i.value.user_agent,"onUpdate:modelValue":t[5]||(t[5]=o=>i.value.user_agent=o),type:"textarea",rows:3,readonly:"",placeholder:"用户代理信息"},null,8,["modelValue"])])):A("",!0)]),_:1},8,["modelValue"])])}}}),nt=ze(at,[["__scopeId","data-v-d3739949"]]);export{nt as default};
