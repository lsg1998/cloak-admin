import{a5 as m,d as k,h as D,P as $,s as j,Z as J,r as l,c as w,o as y,b as a,a as r,w as o,u as g,aN as O,g as P,R as Z,i as G,e as c,U as H,E as K,bd as Q,N as n,a0 as B}from"./index-BfIcwMEJ.js";import{T as X}from"./index-DZxhNfnt.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const f="/admin",ee=()=>m.get(f+"/settings/website"),te=_=>m.put(f+"/settings/website",_),ae=(_,i)=>m.put(f+`/settings/${_}`,i),oe=()=>m.post(f+"/settings/reset"),se=_=>{const i=new FormData;return i.append("logo",_),m.post(f+"/settings/upload-logo",i,{headers:{"Content-Type":"multipart/form-data"}})},le={class:"main-box"},ne={class:"table-box"},re={class:"card-header"},ie={class:"logo-upload-container"},ue={key:0,class:"logo-preview"},de=["src"],_e={key:1,class:"logo-placeholder"},pe={class:"logo-actions"},ge={class:"action-buttons"},ce=k({name:"settingsManage"}),me=k({...ce,setup(_){const i=D(),s=$({site_name:"",site_logo:"",default_language:"zh-CN",items_per_page:20,upload_max_size:10485760}),h=j({get:()=>Math.round(s.upload_max_size/1024/1024),set:t=>{s.upload_max_size=t*1024*1024}}),C={site_name:[{required:!0,message:"请输入网站名称",trigger:"blur"},{min:2,max:50,message:"网站名称长度在 2 到 50 个字符",trigger:"blur"}],default_language:[{required:!0,message:"请选择默认语言",trigger:"change"}],items_per_page:[{required:!0,message:"请输入每页显示条数",trigger:"blur"},{type:"number",min:10,max:100,message:"每页显示条数在 10 到 100 之间",trigger:"blur"}]},v=async()=>{try{const{data:t}=await ee();t.site_name&&(s.site_name=t.site_name.value),t.site_logo&&(s.site_logo=t.site_logo.value),t.default_language&&(s.default_language=t.default_language.value),t.items_per_page&&(s.items_per_page=parseInt(t.items_per_page.value)),t.upload_max_size&&(s.upload_max_size=parseInt(t.upload_max_size.value))}catch{n.error("获取网站设置失败")}},S=async()=>{if(i.value)try{await i.value.validate();const t={site_name:s.site_name,default_language:s.default_language,items_per_page:s.items_per_page.toString(),upload_max_size:s.upload_max_size.toString()};await te(t),n.success("网站设置保存成功")}catch{n.error("保存网站设置失败")}},M=()=>{v(),n.success("设置已刷新")},T=async()=>{try{await B.confirm("确定要重置所有网站设置为默认值吗？此操作不可撤销！","重置确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await oe(),await v(),n.success("网站设置已重置为默认值")}catch(t){t!=="cancel"&&n.error("重置网站设置失败")}},U=t=>{const e=t.type.startsWith("image/"),u=t.size/1024/1024<2;return e?u?!0:(n.error("上传图片大小不能超过 2MB!"),!1):(n.error("只能上传图片文件!"),!1)},N=async t=>{try{const{data:e}=await se(t.file);s.site_logo=e.logo_url,n.success("Logo上传成功")}catch{n.error("Logo上传失败")}},R=async()=>{try{await B.confirm("确定要删除当前Logo吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ae("site_logo",{value:""}),s.site_logo="",n.success("Logo删除成功")}catch(t){t!=="cancel"&&n.error("删除Logo失败")}},W=t=>t.startsWith("http")?t:`https://gammtt.shop${t}`;return J(()=>{v()}),(t,e)=>{const u=l("el-button"),A=l("el-input"),p=l("el-form-item"),b=l("el-col"),x=l("el-option"),E=l("el-select"),L=l("el-row"),V=l("el-input-number"),q=l("el-icon"),F=l("el-upload"),I=l("el-form"),z=l("el-card");return y(),w("div",le,[a(X,{label:"网站设置",title:"网站设置管理"}),r("div",ne,[a(z,{class:"box-card",style:{"margin-bottom":"20px"}},{header:o(()=>[r("div",re,[e[5]||(e[5]=r("span",null,"网站基本信息",-1)),a(u,{type:"primary",onClick:S},{default:o(()=>[...e[4]||(e[4]=[c("保存设置",-1)])]),_:1})])]),default:o(()=>[a(I,{model:s,rules:C,ref_key:"settingsFormRef",ref:i,"label-width":"120px"},{default:o(()=>[a(L,{gutter:20},{default:o(()=>[a(b,{span:12},{default:o(()=>[a(p,{label:"网站名称",prop:"site_name"},{default:o(()=>[a(A,{modelValue:s.site_name,"onUpdate:modelValue":e[0]||(e[0]=d=>s.site_name=d),placeholder:"请输入网站名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(b,{span:12},{default:o(()=>[a(p,{label:"默认语言",prop:"default_language"},{default:o(()=>[a(E,{modelValue:s.default_language,"onUpdate:modelValue":e[1]||(e[1]=d=>s.default_language=d),placeholder:"请选择默认语言",style:{width:"100%"}},{default:o(()=>[a(x,{label:"简体中文",value:"zh-CN"}),a(x,{label:"繁体中文",value:"zh-TW"}),a(x,{label:"English",value:"en-US"}),a(x,{label:"日本語",value:"ja-JP"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(L,{gutter:20},{default:o(()=>[a(b,{span:12},{default:o(()=>[a(p,{label:"每页显示条数",prop:"items_per_page"},{default:o(()=>[a(V,{modelValue:s.items_per_page,"onUpdate:modelValue":e[2]||(e[2]=d=>s.items_per_page=d),min:10,max:100,step:10,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),a(b,{span:12},{default:o(()=>[a(p,{label:"上传文件大小",prop:"upload_max_size"},{default:o(()=>[a(V,{modelValue:h.value,"onUpdate:modelValue":e[3]||(e[3]=d=>h.value=d),min:1,max:100,step:1,style:{width:"100%"}},null,8,["modelValue"]),e[6]||(e[6]=r("span",{style:{"margin-left":"10px",color:"#909399"}},"MB",-1))]),_:1})]),_:1})]),_:1}),a(p,{label:"网站Logo"},{default:o(()=>[r("div",ie,[s.site_logo?(y(),w("div",ue,[r("img",{src:W(s.site_logo),alt:"网站Logo"},null,8,de)])):(y(),w("div",_e,[a(q,null,{default:o(()=>[a(g(O))]),_:1}),e[7]||(e[7]=r("span",null,"暂无Logo",-1))])),r("div",pe,[a(F,{ref:"uploadRef","show-file-list":!1,"before-upload":U,"http-request":N,accept:"image/*"},{default:o(()=>[a(u,{type:"primary",icon:g(G)},{default:o(()=>[...e[8]||(e[8]=[c("上传Logo",-1)])]),_:1},8,["icon"])]),_:1},512),s.site_logo?(y(),P(u,{key:0,type:"danger",icon:g(H),onClick:R},{default:o(()=>[...e[9]||(e[9]=[c(" 删除Logo ",-1)])]),_:1},8,["icon"])):Z("",!0)])])]),_:1})]),_:1},8,["model"])]),_:1}),a(z,{class:"box-card"},{header:o(()=>[...e[10]||(e[10]=[r("div",{class:"card-header"},[r("span",null,"快捷操作")],-1)])]),default:o(()=>[r("div",ge,[a(u,{type:"success",icon:g(K),onClick:M},{default:o(()=>[...e[11]||(e[11]=[c("刷新设置",-1)])]),_:1},8,["icon"]),a(u,{type:"warning",icon:g(Q),onClick:T},{default:o(()=>[...e[12]||(e[12]=[c("重置为默认值",-1)])]),_:1},8,["icon"])])]),_:1})])])}}}),ye=Y(me,[["__scopeId","data-v-a286acf0"]]);export{ye as default};
