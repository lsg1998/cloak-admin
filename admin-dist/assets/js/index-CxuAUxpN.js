import{a5 as X,d as Y,h as f,P as J,Z as _e,r as s,c as G,o as c,a as i,b as e,w as a,g as w,R as P,e as u,t as B,u as m,aE as pe,U as j,$ as q,aL as fe,aO as me,F as M,f as W,at as be,E as ve,N as g,a0 as ge}from"./index-Bj6ddc6A.js";import{g as ke}from"./product-CUsRE0If.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";function Ve(){return X.get("/admin/pixel/global")}function xe(L){return X.put("/admin/pixel/global",L)}const we={class:"pixel-config"},Ce={class:"card-header"},Ae={class:"card-header"},Ue={class:"card-header"},he={class:"card-header"},De={class:"action-bar"},Ge=Y({name:"PixelConfig"}),Pe=Y({...Ge,setup(L){const E=f(!1),C=f(!1),N=f("添加 Google Ads 账户"),I=f(),U=f(-1),O=f(!1),R=f([]),b=f([]),n=J({name:"",conversion_id:"",conversion_label:"",enabled:!0,product_ids:[]}),Z={name:[{required:!0,message:"请输入账户名称",trigger:"blur"}],conversion_id:[{required:!0,message:"请输入转化ID",trigger:"blur"},{pattern:/^\d+$/,message:"转化ID只能包含数字",trigger:"blur"}],conversion_label:[{required:!0,message:"请输入转化标签",trigger:"blur"}]},d=J({facebook_enabled:0,facebook_pixel_id:"",tiktok_enabled:0,tiktok_pixel_id:""}),k=f([]),H=async()=>{O.value=!0;try{const{data:t}=await ke({});R.value=t.list.map(l=>({id:l.id,title:l.title}))}catch(t){console.error("加载商品列表失败",t)}finally{O.value=!1}},S=async()=>{try{const{data:t}=await Ve();if(t){if(t.google_ads_accounts)try{b.value=typeof t.google_ads_accounts=="string"?JSON.parse(t.google_ads_accounts):t.google_ads_accounts}catch{b.value=[]}if(d.facebook_enabled=t.facebook_enabled||0,d.facebook_pixel_id=t.facebook_pixel_id||"",d.tiktok_enabled=t.tiktok_enabled||0,d.tiktok_pixel_id=t.tiktok_pixel_id||"",t.custom_pixels)try{k.value=typeof t.custom_pixels=="string"?JSON.parse(t.custom_pixels):t.custom_pixels}catch{k.value=[]}}}catch(t){g.error("加载配置失败"),console.error(t)}},K=()=>{N.value="添加 Google Ads 账户",U.value=-1,Object.assign(n,{name:"",conversion_id:"",conversion_label:"",enabled:!0,product_ids:[]}),C.value=!0},Q=(t,l)=>{N.value="编辑 Google Ads 账户",U.value=l,Object.assign(n,{...t,product_ids:t.product_ids||[]}),C.value=!0},ee=async()=>{if(I.value)try{await I.value.validate();const t={name:n.name,conversion_id:n.conversion_id,conversion_label:n.conversion_label,enabled:n.enabled,product_ids:n.product_ids||[]};U.value>=0?(b.value[U.value]=t,g.success("账户更新成功")):(b.value.push(t),g.success("账户添加成功")),C.value=!1}catch(t){console.error(t)}},le=async t=>{try{await ge.confirm("确定要删除这个 Google Ads 账户吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),b.value.splice(t,1),g.success("删除成功")}catch{}},ae=()=>{g.info("请点击下方保存按钮保存修改")},oe=()=>{k.value.push({name:"",code:"",enabled:!0})},te=t=>{k.value.splice(t,1)},ne=async()=>{E.value=!0;try{await xe({google_ads_accounts:JSON.stringify(b.value),facebook_enabled:d.facebook_enabled,facebook_pixel_id:d.facebook_pixel_id,tiktok_enabled:d.tiktok_enabled,tiktok_pixel_id:d.tiktok_pixel_id,custom_pixels:JSON.stringify(k.value)}),g.success("配置保存成功，所有商品页面已生效"),await S()}catch(t){g.error("保存配置失败"),console.error(t)}finally{E.value=!1}},de=()=>{S(),g.info("已重置为当前保存的配置")};return _e(()=>{S(),H()}),(t,l)=>{const _=s("el-icon"),p=s("el-button"),y=s("el-table-column"),F=s("el-tag"),T=s("el-text"),A=s("el-switch"),se=s("el-table"),$=s("el-empty"),h=s("el-card"),r=s("el-form-item"),V=s("el-input"),D=s("el-form"),z=s("el-col"),ie=s("el-row"),ue=s("el-option"),re=s("el-select"),ce=s("el-dialog");return c(),G("div",we,[l[29]||(l[29]=i("div",{class:"page-header"},[i("h2",null,"全局像素配置"),i("p",null,"配置网站的像素跟踪代码，支持多个 Google Ads 账户，可为每个账户指定商品范围")],-1)),e(h,{class:"config-card",shadow:"never"},{header:a(()=>[i("div",Ce,[l[12]||(l[12]=i("span",{class:"card-title"},"Google Ads 账户管理",-1)),e(p,{type:"primary",onClick:K},{default:a(()=>[e(_,null,{default:a(()=>[e(m(q))]),_:1}),l[11]||(l[11]=u(" 添加账户 ",-1))]),_:1})])]),default:a(()=>[e(se,{data:b.value,stripe:"",border:"",style:{width:"100%"}},{default:a(()=>[e(y,{type:"index",label:"序号",width:"60",align:"center"}),e(y,{prop:"name",label:"账户名称","min-width":"150"},{default:a(({row:o})=>[e(F,null,{default:a(()=>[u(B(o.name),1)]),_:2},1024)]),_:1}),e(y,{prop:"conversion_id",label:"转化ID","min-width":"150"},{default:a(({row:o})=>[e(T,{type:"primary"},{default:a(()=>[u("AW-"+B(o.conversion_id),1)]),_:2},1024)]),_:1}),e(y,{prop:"conversion_label",label:"转化标签","min-width":"180"},{default:a(({row:o})=>[e(T,{type:"info"},{default:a(()=>[u(B(o.conversion_label),1)]),_:2},1024)]),_:1}),e(y,{prop:"product_ids",label:"应用商品","min-width":"180"},{default:a(({row:o})=>[!o.product_ids||o.product_ids.length===0?(c(),w(F,{key:0,type:"success"},{default:a(()=>[...l[13]||(l[13]=[u("全部商品",-1)])]),_:1})):(c(),w(F,{key:1,type:"warning"},{default:a(()=>[u("指定 "+B(o.product_ids.length)+" 个商品",1)]),_:2},1024))]),_:1}),e(y,{prop:"enabled",label:"状态",width:"100",align:"center"},{default:a(({row:o})=>[e(A,{modelValue:o.enabled,"onUpdate:modelValue":x=>o.enabled=x,onChange:ae},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(y,{label:"操作",width:"180",align:"center",fixed:"right"},{default:a(({row:o,$index:x})=>[e(p,{type:"primary",size:"small",link:"",onClick:v=>Q(o,x)},{default:a(()=>[e(_,null,{default:a(()=>[e(m(pe))]),_:1}),l[14]||(l[14]=u(" 编辑 ",-1))]),_:1},8,["onClick"]),e(p,{type:"danger",size:"small",link:"",onClick:v=>le(x)},{default:a(()=>[e(_,null,{default:a(()=>[e(m(j))]),_:1}),l[15]||(l[15]=u(" 删除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),b.value.length===0?(c(),w($,{key:0,description:"暂无 Google Ads 账户，点击右上角添加"})):P("",!0)]),_:1}),e(ie,{gutter:20},{default:a(()=>[e(z,{span:12},{default:a(()=>[e(h,{class:"config-card",shadow:"never"},{header:a(()=>[i("div",Ae,[e(_,{class:"platform-icon facebook"},{default:a(()=>[e(m(fe))]),_:1}),l[16]||(l[16]=i("span",{class:"card-title"},"Facebook 像素",-1))])]),default:a(()=>[e(D,{"label-width":"100px"},{default:a(()=>[e(r,{label:"启用"},{default:a(()=>[e(A,{modelValue:d.facebook_enabled,"onUpdate:modelValue":l[0]||(l[0]=o=>d.facebook_enabled=o),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),d.facebook_enabled?(c(),w(r,{key:0,label:"像素ID"},{default:a(()=>[e(V,{modelValue:d.facebook_pixel_id,"onUpdate:modelValue":l[1]||(l[1]=o=>d.facebook_pixel_id=o),placeholder:"例如: 123456789012345"},null,8,["modelValue"])]),_:1})):P("",!0)]),_:1})]),_:1})]),_:1}),e(z,{span:12},{default:a(()=>[e(h,{class:"config-card",shadow:"never"},{header:a(()=>[i("div",Ue,[e(_,{class:"platform-icon tiktok"},{default:a(()=>[e(m(me))]),_:1}),l[17]||(l[17]=i("span",{class:"card-title"},"TikTok 像素",-1))])]),default:a(()=>[e(D,{"label-width":"100px"},{default:a(()=>[e(r,{label:"启用"},{default:a(()=>[e(A,{modelValue:d.tiktok_enabled,"onUpdate:modelValue":l[2]||(l[2]=o=>d.tiktok_enabled=o),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),d.tiktok_enabled?(c(),w(r,{key:0,label:"像素ID"},{default:a(()=>[e(V,{modelValue:d.tiktok_pixel_id,"onUpdate:modelValue":l[3]||(l[3]=o=>d.tiktok_pixel_id=o),placeholder:"例如: C1234567890ABCDEF"},null,8,["modelValue"])]),_:1})):P("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),e(h,{class:"config-card",shadow:"never"},{header:a(()=>[i("div",he,[l[19]||(l[19]=i("span",{class:"card-title"},"自定义像素",-1)),e(p,{type:"primary",onClick:oe},{default:a(()=>[e(_,null,{default:a(()=>[e(m(q))]),_:1}),l[18]||(l[18]=u(" 添加自定义像素 ",-1))]),_:1})])]),default:a(()=>[(c(!0),G(M,null,W(k.value,(o,x)=>(c(),G("div",{key:x,class:"custom-pixel-item"},[e(D,{"label-width":"100px"},{default:a(()=>[e(r,{label:"像素名称"},{default:a(()=>[e(V,{modelValue:o.name,"onUpdate:modelValue":v=>o.name=v,placeholder:"例如: 第三方统计代码"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(r,{label:"启用状态"},{default:a(()=>[e(A,{modelValue:o.enabled,"onUpdate:modelValue":v=>o.enabled=v},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(r,{label:"像素代码"},{default:a(()=>[e(V,{modelValue:o.code,"onUpdate:modelValue":v=>o.code=v,type:"textarea",rows:4,placeholder:"粘贴像素代码..."},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(r,null,{default:a(()=>[e(p,{type:"danger",onClick:v=>te(x)},{default:a(()=>[e(_,null,{default:a(()=>[e(m(j))]),_:1}),l[20]||(l[20]=u(" 删除 ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128)),k.value.length===0?(c(),w($,{key:0,description:"暂无自定义像素"})):P("",!0)]),_:1}),i("div",De,[e(p,{type:"primary",size:"large",onClick:ne,loading:E.value},{default:a(()=>[e(_,null,{default:a(()=>[e(m(be))]),_:1}),l[21]||(l[21]=u(" 保存所有配置 ",-1))]),_:1},8,["loading"]),e(p,{size:"large",onClick:de},{default:a(()=>[e(_,null,{default:a(()=>[e(m(ve))]),_:1}),l[22]||(l[22]=u(" 重置 ",-1))]),_:1})]),e(ce,{modelValue:C.value,"onUpdate:modelValue":l[10]||(l[10]=o=>C.value=o),title:N.value,width:"700px"},{footer:a(()=>[e(p,{onClick:l[9]||(l[9]=o=>C.value=!1)},{default:a(()=>[...l[27]||(l[27]=[u("取消",-1)])]),_:1}),e(p,{type:"primary",onClick:ee},{default:a(()=>[...l[28]||(l[28]=[u("确定",-1)])]),_:1})]),default:a(()=>[e(D,{ref_key:"accountFormRef",ref:I,model:n,rules:Z,"label-width":"120px"},{default:a(()=>[e(r,{label:"账户名称",prop:"name"},{default:a(()=>[e(V,{modelValue:n.name,"onUpdate:modelValue":l[4]||(l[4]=o=>n.name=o),placeholder:"例如: 主投账户"},null,8,["modelValue"])]),_:1}),e(r,{label:"转化ID",prop:"conversion_id"},{default:a(()=>[e(V,{modelValue:n.conversion_id,"onUpdate:modelValue":l[5]||(l[5]=o=>n.conversion_id=o),placeholder:"例如: 17612844136"},{prepend:a(()=>[...l[23]||(l[23]=[u("AW-",-1)])]),_:1},8,["modelValue"]),l[24]||(l[24]=i("div",{class:"form-tip"},"在 Google Ads 后台创建转化操作后获取",-1))]),_:1}),e(r,{label:"转化标签",prop:"conversion_label"},{default:a(()=>[e(V,{modelValue:n.conversion_label,"onUpdate:modelValue":l[6]||(l[6]=o=>n.conversion_label=o),placeholder:"例如: REXpCP2e1aUbEOjYus5B"},null,8,["modelValue"]),l[25]||(l[25]=i("div",{class:"form-tip"},"转化操作对应的标签代码",-1))]),_:1}),e(r,{label:"应用商品"},{default:a(()=>[e(re,{modelValue:n.product_ids,"onUpdate:modelValue":l[7]||(l[7]=o=>n.product_ids=o),multiple:"",filterable:"",placeholder:"不选择则应用到全部商品",style:{width:"100%"},loading:O.value},{default:a(()=>[(c(!0),G(M,null,W(R.value,o=>(c(),w(ue,{key:o.id,label:o.title,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"]),l[26]||(l[26]=i("div",{class:"form-tip"},"不选择任何商品时，此像素将应用到全部商品页面",-1))]),_:1}),e(r,{label:"启用状态"},{default:a(()=>[e(A,{modelValue:n.enabled,"onUpdate:modelValue":l[8]||(l[8]=o=>n.enabled=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Ie=ye(Pe,[["__scopeId","data-v-04ddf5ed"]]);export{Ie as default};
