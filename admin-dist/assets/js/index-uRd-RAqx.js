import{a5 as Z,d as P,h as u,Z as W,b2 as X,r as h,c as j,o as G,a as t,b as s,w as i,e as H,u as m,E as J,aZ as K,t as _,aE as Q,bm as $,aO as I,M as tt,N as O}from"./index-BodoeLeb.js";import"./index-BpCvQqaw.js";import{aU as S}from"./installCanvasRenderer-Bf4uGEF_.js";import{_ as et}from"./_plugin-vue_export-helper-DlAUqK2U.js";const st=D=>Z.get("/admin/statistics/users",D),at={class:"customer-statistics"},ot={class:"date-range-selector"},lt={class:"stats-cards"},rt={class:"stat-card"},nt={class:"stat-icon total"},it={class:"stat-content"},ct={class:"stat-value"},dt={class:"stat-card"},ut={class:"stat-icon new"},_t={class:"stat-content"},pt={class:"stat-value"},vt={class:"stat-card"},ht={class:"stat-icon repeat"},mt={class:"stat-content"},ft={class:"stat-value"},gt={class:"stat-card"},bt={class:"stat-icon rate"},yt={class:"stat-content"},xt={class:"stat-value"},wt={class:"charts-container"},St={class:"chart-card"},Dt={class:"chart-content"},Ct={class:"chart-card"},kt={class:"chart-content"},zt={class:"chart-card full-width"},Yt={class:"chart-content"},Et={class:"chart-card"},Mt={class:"chart-content"},Ot=P({__name:"index",setup(D){const f=u(!1),a=u(null),p=u([new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0],new Date().toISOString().split("T")[0]]),g=u(),b=u(),y=u();let l=null,r=null,n=null;const x=o=>o.toLocaleString(),A=()=>!a.value||a.value.total_customers===0?"0.00":(a.value.repeat_customers/a.value.total_customers*100).toFixed(2),F=o=>{o&&(p.value=o,w())},R=()=>{w()},w=async()=>{try{f.value=!0;const o={start_date:p.value[0],end_date:p.value[1]},e=await st(o);e.code===200?(a.value=e.data,await tt(),V()):O.error(e.message||"获取统计数据失败")}catch(o){console.error("获取客户统计数据失败:",o),O.error("获取统计数据失败，请稍后重试")}finally{f.value=!1}},V=()=>{L(),N(),B()},L=()=>{if(!g.value||!a.value)return;l&&l.dispose(),l=S(g.value);const o={title:{text:"新客户获取趋势",left:"center",textStyle:{fontSize:14,color:"#333"}},tooltip:{trigger:"axis",formatter:"{b}<br/>新客户: {c}人"},xAxis:{type:"category",data:a.value.customer_trend.map(e=>e.date),axisLabel:{rotate:45}},yAxis:{type:"value",name:"新客户数"},series:[{data:a.value.customer_trend.map(e=>e.new_customer_count),type:"line",smooth:!0,itemStyle:{color:"#409EFF"},areaStyle:{color:"rgba(64, 158, 255, 0.1)"}}],grid:{top:60,right:30,bottom:80,left:60}};l.setOption(o)},N=()=>{if(!b.value||!a.value)return;r&&r.dispose(),r=S(b.value);const o={title:{text:"客户地区分布",left:"center",textStyle:{fontSize:14,color:"#333"}},tooltip:{trigger:"item",formatter:"{a}<br/>{b}: {c}人 ({d}%)"},series:[{name:"客户分布",type:"pie",radius:["40%","70%"],data:a.value.region_distribution.map(e=>({name:e.province,value:e.customer_count})),emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};r.setOption(o)},B=()=>{if(!y.value||!a.value)return;n&&n.dispose(),n=S(y.value);const o={title:{text:"客户购买频次分布",left:"center",textStyle:{fontSize:14,color:"#333"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:"{b}<br/>客户数: {c}人<br/>占比: {d}%"},xAxis:{type:"category",data:a.value.purchase_frequency.map(e=>e.frequency_range),axisLabel:{interval:0,rotate:30}},yAxis:{type:"value",name:"客户数"},series:[{data:a.value.purchase_frequency.map(e=>({value:e.customer_count,d:e.percentage})),type:"bar",itemStyle:{color:"#67C23A"},barWidth:"60%"}],grid:{top:60,right:30,bottom:80,left:60}};n.setOption(o)},C=()=>{l==null||l.resize(),r==null||r.resize(),n==null||n.resize()};return W(()=>{w(),window.addEventListener("resize",C)}),X(()=>{l==null||l.dispose(),r==null||r.dispose(),n==null||n.dispose(),window.removeEventListener("resize",C)}),(o,e)=>{var k,z,Y,E;const T=h("el-date-picker"),v=h("el-icon"),q=h("el-button"),c=h("el-table-column"),U=h("el-table");return G(),j("div",at,[e[10]||(e[10]=t("div",{class:"page-header"},[t("h1",{class:"page-title"},"客户统计"),t("p",{class:"page-description"},"查看客户地区分布、购买行为等统计数据")],-1)),t("div",ot,[s(T,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=d=>p.value=d),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:F,"default-value":[new Date(Date.now()-30*24*60*60*1e3),new Date]},null,8,["modelValue","default-value"]),s(q,{type:"primary",onClick:R,loading:f.value},{default:i(()=>[s(v,null,{default:i(()=>[s(m(J))]),_:1}),e[1]||(e[1]=H(" 刷新数据 ",-1))]),_:1},8,["loading"])]),t("div",lt,[t("div",rt,[t("div",nt,[s(v,null,{default:i(()=>[s(m(K))]),_:1})]),t("div",it,[t("div",ct,_(x(((k=a.value)==null?void 0:k.total_customers)||0)),1),e[2]||(e[2]=t("div",{class:"stat-label"},"总客户数",-1))])]),t("div",dt,[t("div",ut,[s(v,null,{default:i(()=>[s(m(Q))]),_:1})]),t("div",_t,[t("div",pt,_(x(((z=a.value)==null?void 0:z.new_customers)||0)),1),e[3]||(e[3]=t("div",{class:"stat-label"},"新客户数",-1))])]),t("div",vt,[t("div",ht,[s(v,null,{default:i(()=>[s(m($))]),_:1})]),t("div",mt,[t("div",ft,_(x(((Y=a.value)==null?void 0:Y.repeat_customers)||0)),1),e[4]||(e[4]=t("div",{class:"stat-label"},"回头客数量",-1))])]),t("div",gt,[t("div",bt,[s(v,null,{default:i(()=>[s(m(I))]),_:1})]),t("div",yt,[t("div",xt,_(A())+"%",1),e[5]||(e[5]=t("div",{class:"stat-label"},"回头客比例",-1))])])]),t("div",wt,[t("div",St,[e[6]||(e[6]=t("div",{class:"chart-header"},[t("h3",null,"客户购买趋势"),t("p",null,"新客户获取趋势分析")],-1)),t("div",Dt,[t("div",{ref_key:"customerTrendChart",ref:g,class:"chart"},null,512)])]),t("div",Ct,[e[7]||(e[7]=t("div",{class:"chart-header"},[t("h3",null,"客户地区分布"),t("p",null,"按省份统计客户分布情况")],-1)),t("div",kt,[t("div",{ref_key:"regionChart",ref:b,class:"chart"},null,512)])]),t("div",zt,[e[8]||(e[8]=t("div",{class:"chart-header"},[t("h3",null,"热门城市分布"),t("p",null,"客户数量最多的前10个城市")],-1)),t("div",Yt,[s(U,{data:((E=a.value)==null?void 0:E.city_distribution)||[],style:{width:"100%"}},{default:i(()=>[s(c,{prop:"province",label:"省份",width:"120"}),s(c,{prop:"city",label:"城市",width:"120"}),s(c,{prop:"customer_count",label:"客户数量",width:"100",align:"center"}),s(c,{prop:"order_count",label:"订单数量",width:"100",align:"center"}),s(c,{label:"客户占比",width:"120",align:"center"},{default:i(({row:d})=>{var M;return[t("span",null,_((d.customer_count/(((M=a.value)==null?void 0:M.total_customers)||1)*100).toFixed(2))+"%",1)]}),_:1}),s(c,{label:"平均订单数",align:"center"},{default:i(({row:d})=>[t("span",null,_((d.order_count/d.customer_count).toFixed(1)),1)]),_:1})]),_:1},8,["data"])])]),t("div",Et,[e[9]||(e[9]=t("div",{class:"chart-header"},[t("h3",null,"客户购买频次分布"),t("p",null,"客户购买次数分布情况")],-1)),t("div",Mt,[t("div",{ref_key:"frequencyChart",ref:y,class:"chart"},null,512)])])])])}}}),Lt=et(Ot,[["__scopeId","data-v-40acc447"]]);export{Lt as default};
